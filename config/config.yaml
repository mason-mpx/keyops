# ============================================================================
# KeyOps 配置文件
# ============================================================================

server:
  api_port: 8080              # API服务端口
  ssh_port: 2222               # SSH Gateway端口（用于直接SSH登录）
  mode: release                  # 运行模式: debug / release

# ============================================================================
# 数据库配置（必需）
# ============================================================================
# 支持 MySQL 和 PostgreSQL
# 可通过环境变量覆盖配置：
#   DB_DRIVER   - 数据库驱动类型: mysql, postgres (默认: mysql)
#   DB_HOST     - 数据库地址
#   DB_PORT     - 数据库端口 (MySQL默认: 3306, PostgreSQL默认: 5432)
#   DB_USER     - 数据库用户名
#   DB_PASSWORD - 数据库密码
#   DB_NAME     - 数据库名称
# ============================================================================
database:
  driver: mysql                # 数据库驱动: mysql, postgres (默认: mysql)
  host: 127.0.0.1              # 数据库地址（Docker Compose环境使用服务名，本地开发使用localhost）
  port: 3306                   # 数据库端口 (MySQL: 3306, PostgreSQL: 5432)
  user: root                   # 数据库用户名
  password: 123456             # 数据库密码
  dbname: keyops                # 数据库名称
  max_idle_conns: 10           # 最大空闲连接数
  max_open_conns: 100          # 最大打开连接数
  conn_max_lifetime: 3600      # 连接最大生存时间（秒）

# ============================================================================
# Redis配置（可选）
# ============================================================================
# 使用场景：
#   - 单机部署：设置 enabled: false（推荐）
#   - 多机器部署：设置 enabled: true，配置Redis连接信息
# 
# 功能说明：
#   - enabled: false 时，系统使用数据库模式，所有功能正常工作
#   - enabled: true 时，支持分布式特性：
#     * Casbin权限多机器自动同步
#     * 分布式锁（防止多机器重复执行任务）
#     * 配置变更多机器同步
# ============================================================================
redis:
  # 是否启用Redis
  # true  - 启用Redis，支持分布式特性（多机器部署推荐）
  # false - 禁用Redis，使用数据库模式（单机部署推荐）
  enabled: true
  
  # Redis服务器配置（仅在 enabled=true 时有效）
  host: localhost              # Redis服务器地址
  port: 6379                   # Redis服务器端口
  password: ""                 # Redis密码（如果Redis未设置密码则留空）
  db: 0                        # Redis数据库编号（默认0）
  
  # 连接配置（可选，有默认值，通常不需要修改）
  connect_timeout: 5           # 连接超时时间（秒，默认5）
  read_timeout: 3              # 读取超时时间（秒，默认3）
  write_timeout: 3             # 写入超时时间（秒，默认3）
  pool_size: 10                # 连接池大小（默认10）
  min_idle_conns: 5            # 最小空闲连接数（默认5）

# ============================================================================
# 安全配置（必需）
# ============================================================================
security:
  # JWT签名密钥（用于生成和验证JWT token）
  # - 建议长度：64字节或更长（更安全，推荐128字节）
  # - AES-256加密密钥会自动从此密钥提取前32字节用于加密SSH私钥等敏感数据
  # - 生产环境必须修改为强随机字符串（可使用命令生成：openssl rand -base64 48）
  jwt_secret: "DdzI7wyean0JDT86fIEY+XEPKa+swZRkAlDUojBhnUQUta4KY/EG3JnnI6mDSrxV"
  
  session_timeout: 3600        # 会话超时时间（秒）

# ============================================================================
# 日志配置
# ============================================================================
logging:
  level: info                  # 日志级别: debug / info / warn / error
  output: both                 # 日志输出: console / file / both
  file: logs/keyops.log         # 日志文件路径
  max_size: 100                # 单个日志文件最大大小（MB）
  max_backups: 10               # 保留的旧日志文件数量
  max_age: 30                   # 保留日志的最大天数
  compress: true                # 是否压缩旧日志文件

# ============================================================================
# SSH配置
# ============================================================================
ssh:
  timeout: 30                  # SSH连接超时时间（秒）
  keepalive_interval: 10       # SSH保活间隔（秒）
  max_sessions: 100            # 最大并发SSH会话数

# ============================================================================
# Proxy配置（可选）
# ============================================================================
# 使用场景：
#   - 不使用代理模式：设置 enabled: false（推荐，默认值）
#   - 使用代理模式：设置 enabled: true，会启动ProxyMonitor监控代理服务器状态
# 
# 功能说明：
#   - enabled: false 时，不启动ProxyMonitor，不会监控代理服务器（单机直连模式推荐）
#   - enabled: true 时，启动ProxyMonitor，定期检查代理服务器健康状态（代理模式必需）
# ============================================================================
proxy:
  # 是否启用Proxy功能
  # true  - 启用Proxy功能，会启动ProxyMonitor监控代理服务器状态（代理模式）
  # false - 禁用Proxy功能，不启动ProxyMonitor（单机直连模式，默认值）
  enabled: false

# ============================================================================
# 同步配置
# ============================================================================
sync:
  interval: 60                 # 同步间隔（秒，默认60秒）
  cleanup_days: 7              # 清理已同步数据的天数（默认7天）
  batch_size: 1000             # 每次同步的批量大小（默认1000）

