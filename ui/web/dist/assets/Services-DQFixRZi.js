import{u as A,r as n,bf as d,j as e,B as l,T as u,I as C,v as B,w as b,x as k,b as D,C as E,a as R,cz as L,cA as P}from"./index-OJNN34VQ.js";import{k as S}from"./index-PD8ZHfYa.js";import{k as O}from"./k8sClusterApi-mlnkQKnz.js";import{C as $}from"./ClusterSelector-DfMX1_uP.js";import{N as F}from"./NamespaceSelector-D2WCI4jt.js";import{Y as H}from"./YamlViewerDialog-iWTcDuYg.js";import{T as M,a as V,b as q,c as h,d as r,e as G}from"./TableRow-Dz3vPXNr.js";import"./utils-m9WO14YV.js";import"./yaml-chfuhXsb.js";import"./namespaces-D2j8PUT5.js";function ae(){const{t}=A(),[j,f]=n.useState(!1),[g,y]=n.useState([]),[a,v]=n.useState(""),[c,I]=n.useState(""),[w,T]=n.useState(null),[N,p]=n.useState(!1),[o,x]=n.useState(null);n.useEffect(()=>{a&&O.getCluster(a).then(T).catch(s=>{d(s?.response?.data?.message||"获取集群信息失败")})},[a]);const m=n.useCallback(async()=>{if(!a){d("请先选择集群");return}try{f(!0);const s={clusterId:a,namespace:c||void 0},i=await S.getServiceList(s);y(i)}catch(s){const i=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||"获取Service列表失败";d(i),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&y([])}finally{f(!1)}},[a,c]);return n.useEffect(()=>{a&&m()},[a,c,m]),e.jsxs(l,{sx:{width:"100%",p:3},children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[e.jsxs(l,{children:[e.jsx(u,{variant:"h4",component:"h1",fontWeight:"700",children:t("k8s.services.title")}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:t("k8s.services.subtitle")})]}),e.jsx(C,{onClick:m,disabled:!a||j,title:t("common.refresh"),children:e.jsx(B,{})})]}),e.jsx(b,{sx:{mb:3},children:e.jsx(k,{children:e.jsxs(l,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx($,{value:a,onChange:v,size:"medium",fullWidth:!0,label:t("k8s.selectCluster")})}),a&&e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(F,{value:c,onChange:I,clusterId:a,defaultNamespace:w?.defaultNamespace,size:"medium",fullWidth:!0,label:t("k8s.selectNamespace")})})]})})}),a?j?e.jsx(l,{display:"flex",justifyContent:"center",p:3,children:e.jsx(E,{})}):e.jsx(b,{children:e.jsx(k,{children:e.jsx(M,{children:e.jsxs(V,{children:[e.jsx(q,{children:e.jsxs(h,{children:[e.jsx(r,{children:t("k8s.services.name")}),e.jsx(r,{children:t("k8s.services.namespace")}),e.jsx(r,{children:t("k8s.services.type")}),e.jsx(r,{children:t("k8s.services.clusterIP")}),e.jsx(r,{children:t("k8s.services.ports")}),e.jsx(r,{children:t("k8s.services.age")}),e.jsx(r,{children:t("common.actions")})]})}),e.jsx(G,{children:g.length===0?e.jsx(h,{children:e.jsx(r,{colSpan:7,align:"center",children:e.jsx(u,{color:"textSecondary",children:t("common.noData")})})}):g.map((s,i)=>e.jsxs(h,{children:[e.jsx(r,{children:s.name}),e.jsx(r,{children:s.namespace}),e.jsx(r,{children:s.type}),e.jsx(r,{children:s.clusterIP}),e.jsx(r,{children:s.ports}),e.jsx(r,{children:s.age||"N/A"}),e.jsx(r,{children:e.jsxs(l,{display:"flex",gap:.5,children:[e.jsx(R,{size:"small",variant:"outlined",startIcon:e.jsx(L,{}),onClick:()=>{if(!a){d("请先选择集群");return}x(s),p(!0)},disabled:!a,children:t("k8s.viewDetails","详情")}),e.jsx(C,{size:"small",onClick:()=>{x(s),p(!0)},title:t("k8s.viewYaml"),children:e.jsx(P,{fontSize:"small"})})]})})]},i))})]})})})}):e.jsx(D,{severity:"info",children:t("k8s.selectClusterFirst")}),o&&e.jsx(H,{open:N,onClose:()=>{p(!1),x(null)},title:`${t("k8s.services.title")} - ${o.name}`,clusterId:a,namespace:o.namespace,resourceType:"service",resourceName:o.name,onLoadYaml:async(s,i,W,z)=>{const Y={clusterId:s,namespace:i};return await S.getResourceYaml(Y,W,z)}})]})}export{ae as default};
