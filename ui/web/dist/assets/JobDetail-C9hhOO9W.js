import{u as z,bg as J,ax as N,r as x,j as e,B as a,C as O,b as C,a as $,aA as Y,I as E,T as l,d as F,v as G,cA as U,w as h,x as p,a3 as X,a4 as D,a2 as K,Z as M,bl as V,bf as Z}from"./index-STo1oTDL.js";import{k as w,i as _}from"./index-BY4k-vmZ.js";import{P as q,Y as Q}from"./PodActions-BfL6KBNe.js";import{C as v}from"./Chip-v5QMYL72.js";import{G as I}from"./GridLegacy-t679NzKB.js";import"./utils-Bf2w_ouu.js";import"./yaml-CjebJvkV.js";import"./index-BQ8Tbohh.js";import"./k8sClusterApi-7xlxICBp.js";import"./PodLogsDialog-CzK18Pyc.js";import"./xterm-BqYE0GQX.js";import"./Switch-Do7Epm1v.js";function A(s){const{children:c,value:o,index:r,...u}=s;return e.jsx("div",{role:"tabpanel",hidden:o!==r,id:`job-tabpanel-${r}`,"aria-labelledby":`job-tab-${r}`,...u,children:o===r&&e.jsx(a,{sx:{p:3},children:c})})}function pe(){const{t:s}=z(),{clusterId:c,namespace:o,name:r}=J(),u=N(),[L,S]=x.useState(!0),[n,P]=x.useState(null),[W,T]=x.useState(null),[g,R]=x.useState(0),[H,B]=x.useState(!1),y=async()=>{if(!(!c||!o||!r))try{S(!0),T(null);const i=await _({clusterId:c,namespace:o},r);P(i)}catch(t){const i=(t&&typeof t=="object"&&"response"in t&&t.response&&typeof t.response=="object"&&"data"in t.response&&t.response.data&&typeof t.response.data=="object"&&"message"in t.response.data&&typeof t.response.data.message=="string"?t.response.data.message:null)||s("k8s.jobs.loadDetailFailed","获取Job详情失败");T(i||""),Z(i||"")}finally{S(!1)}};x.useEffect(()=>{c&&o&&r&&y()},[c,o,r]),x.useEffect(()=>{if(!c||!o||!r)return;const t=setInterval(()=>{y()},3e4);return()=>clearInterval(t)},[c,o,r]);const d=(t,i)=>i==null||i===""?null:e.jsxs(a,{sx:{mb:2},children:[e.jsx(l,{variant:"caption",color:"text.secondary",display:"block",children:t}),e.jsx(l,{variant:"body1",fontWeight:500,children:String(i)})]});if(L&&!n)return e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(O,{})});if(W&&!n)return e.jsxs(a,{sx:{p:3},children:[e.jsx(C,{severity:"error",children:W}),e.jsx($,{startIcon:e.jsx(Y,{}),onClick:()=>u("/k8s/jobs"),sx:{mt:2},children:s("common.back")})]});const b=n?(n.succeeded??0)>0&&(n.active??0)===0&&(n.failed??0)===0?"Succeeded":(n.failed??0)>0?"Failed":(n.active??0)>0?"Active":"Unknown":"Unknown";return e.jsxs(a,{sx:{width:"100%",p:3},children:[e.jsxs(a,{sx:{mb:3,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(E,{onClick:()=>u("/k8s/jobs"),children:e.jsx(Y,{})}),e.jsxs(a,{children:[e.jsx(l,{variant:"h4",component:"h1",fontWeight:"700",children:r}),e.jsxs(l,{variant:"body2",color:"text.secondary",children:[o," / ",c]})]})]}),e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(F,{title:s("common.refresh"),children:e.jsx(E,{onClick:y,children:e.jsx(G,{})})}),e.jsx($,{variant:"outlined",startIcon:e.jsx(U,{}),onClick:()=>B(!0),children:s("k8s.viewYaml")})]})]}),e.jsxs(a,{sx:{display:"flex",gap:2,mb:3,width:"100%",flexWrap:{xs:"wrap",sm:"nowrap"}},children:[e.jsx(h,{sx:{flex:1,minWidth:{xs:"100%",sm:0},display:"flex",flexDirection:"column"},children:e.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",minHeight:120},children:[e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mb:1},children:s("k8s.jobs.status","状态")}),e.jsx(l,{variant:"h4",fontWeight:"600",children:e.jsx(v,{label:b,color:b==="Succeeded"?"success":b==="Failed"?"error":b==="Active"?"info":"default",size:"small"})})]})}),e.jsx(h,{sx:{flex:1,minWidth:{xs:"100%",sm:0},display:"flex",flexDirection:"column"},children:e.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",minHeight:120},children:[e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mb:1},children:s("k8s.jobs.succeeded","成功")}),e.jsx(l,{variant:"h4",fontWeight:"600",color:"success.main",children:n?.succeeded||0})]})}),e.jsx(h,{sx:{flex:1,minWidth:{xs:"100%",sm:0},display:"flex",flexDirection:"column"},children:e.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",minHeight:120},children:[e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mb:1},children:s("k8s.jobs.failed","失败")}),e.jsx(l,{variant:"h4",fontWeight:"600",color:"error.main",children:n?.failed||0})]})}),e.jsx(h,{sx:{flex:1,minWidth:{xs:"100%",sm:0},display:"flex",flexDirection:"column"},children:e.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",minHeight:120},children:[e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mb:1},children:s("k8s.jobs.active","运行中")}),e.jsx(l,{variant:"h4",fontWeight:"600",color:"info.main",children:n?.active||0})]})}),e.jsx(h,{sx:{flex:1,minWidth:{xs:"100%",sm:0},display:"flex",flexDirection:"column"},children:e.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",minHeight:120},children:[e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mb:1},children:s("k8s.jobs.completions","完成数")}),e.jsx(l,{variant:"h4",fontWeight:"600",children:n?.completions!==void 0?n.completions:"-"})]})}),e.jsx(h,{sx:{flex:1,minWidth:{xs:"100%",sm:0},display:"flex",flexDirection:"column"},children:e.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",minHeight:120},children:[e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mb:1},children:s("k8s.jobs.duration","持续时间")}),e.jsx(l,{variant:"h4",fontWeight:"600",children:n?.duration||"-"})]})})]}),e.jsxs(h,{children:[e.jsx(a,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(X,{value:g,onChange:(t,i)=>R(i),children:[e.jsx(D,{icon:e.jsx(K,{}),iconPosition:"start",label:s("k8s.basicInfo")}),e.jsx(D,{icon:e.jsx(M,{}),iconPosition:"start",label:`${s("k8s.pods.title")} (${n?.pods?.length||0})`}),e.jsx(D,{icon:e.jsx(V,{}),iconPosition:"start",label:`${s("k8s.events.title")} (${n?.events?.length||0})`})]})}),e.jsx(A,{value:g,index:0,children:e.jsxs(I,{container:!0,spacing:3,children:[e.jsxs(I,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h6",sx:{mb:2},children:s("k8s.basicInfo")}),d(s("k8s.name"),n?.name),d(s("k8s.namespace"),n?.namespace),d(s("k8s.age"),n?.age),d(s("k8s.jobs.startTime","开始时间"),n?.startTime?new Date(n.startTime).toLocaleString("zh-CN"):"-"),d(s("k8s.jobs.completionTime","完成时间"),n?.completionTime?new Date(n.completionTime).toLocaleString("zh-CN"):"-"),d(s("k8s.jobs.parallelism","并行度"),n?.parallelism!==void 0?n.parallelism:"-"),d(s("k8s.jobs.backoffLimit","重试次数"),n?.backoffLimit!==void 0?n.backoffLimit:"-")]}),e.jsxs(I,{item:!0,xs:12,md:6,children:[e.jsx(l,{variant:"h6",sx:{mb:2},children:s("k8s.labels")}),n?.labels&&Object.keys(n.labels).length>0?e.jsx(a,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Object.entries(n.labels).map(([t,i])=>e.jsx(v,{label:`${t}=${i}`,size:"small"},t))}):e.jsx(l,{variant:"body2",color:"text.secondary",children:s("common.noData")})]})]})}),e.jsx(A,{value:g,index:1,children:n?.pods&&n.pods.length>0?e.jsxs(a,{children:[e.jsx(l,{variant:"h6",sx:{mb:2},children:s("k8s.pods.title")}),e.jsx(a,{sx:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #e0e0e0"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.name")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.status")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.node")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.restarts")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.age")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("common.actions")})]})}),e.jsx("tbody",{children:n.pods.map((t,i)=>e.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[e.jsx("td",{style:{padding:"12px"},children:t.name}),e.jsx("td",{style:{padding:"12px"},children:e.jsx(v,{label:t.status,color:t.status==="Running"?"success":"default",size:"small"})}),e.jsx("td",{style:{padding:"12px"},children:t.node||"-"}),e.jsx("td",{style:{padding:"12px"},children:t.restarts||0}),e.jsx("td",{style:{padding:"12px"},children:t.age||"-"}),e.jsx("td",{style:{padding:"12px"},children:e.jsx(q,{pod:t,clusterId:c||"",namespace:o||""})})]},i))})]})})]}):e.jsx(C,{severity:"info",children:s("common.noData")})}),e.jsx(A,{value:g,index:2,children:n?.events&&n.events.length>0?e.jsxs(a,{children:[e.jsx(l,{variant:"h6",sx:{mb:2},children:s("k8s.events.title")}),e.jsx(a,{sx:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #e0e0e0"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.type")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.reason")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.message")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.count")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.lastSeen")})]})}),e.jsx("tbody",{children:n.events.map((t,i)=>e.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[e.jsx("td",{style:{padding:"12px"},children:e.jsx(v,{label:t.type,color:t.type==="Warning"?"warning":"info",size:"small"})}),e.jsx("td",{style:{padding:"12px"},children:t.reason}),e.jsx("td",{style:{padding:"12px"},children:t.message}),e.jsx("td",{style:{padding:"12px"},children:t.count}),e.jsx("td",{style:{padding:"12px"},children:t.lastSeen})]},i))})]})})]}):e.jsx(C,{severity:"info",children:s("common.noData")})})]}),c&&o&&r&&e.jsx(Q,{open:H,onClose:()=>B(!1),title:`${s("k8s.jobs.title")} - ${r}`,clusterId:c,namespace:o,resourceType:"job",resourceName:r,onLoadYaml:async(t,i,m,j)=>{const f={clusterId:t,namespace:i};return await w.getResourceYaml(f,m,j)},onSaveYaml:async(t,i,m,j,f)=>{const k={clusterId:t,namespace:i};await w.updateResourceYaml(k,m,j,f),y()},onDryRun:async(t,i,m,j,f)=>{const k={clusterId:t,namespace:i};return await w.dryRunResourceYaml(k,m,j,f)}})]})}export{pe as default};
