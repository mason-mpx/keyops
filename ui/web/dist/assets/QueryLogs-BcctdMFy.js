import{u as Z,r as l,cd as ee,bf as se,j as e,B as a,w as te,x as re,T as r,d as j,I as p,v as ae,cp as ie,P as u,m as oe,s as D,cf as M,t as ne,F as A,n as $,o as H,M as d,a as E,b as N,be as le,D as S,i as de,k as ce,l as ue,p as xe}from"./index-OJNN34VQ.js";import{S as y}from"./Stack-D4jLN6n0.js";import{G as h}from"./GridLegacy-CDe511SR.js";import{S as he}from"./Skeleton-DzyhEav-.js";import{T as me,a as ge,b as je,c as O,d as i,e as pe}from"./TableRow-Dz3vPXNr.js";import{C as f}from"./Chip-pSvhxX1X.js";import{T as ye}from"./TablePagination-CuKuo8TO.js";import"./LastPage-COOW1SXp.js";function We(){const{t:s}=Z(),[Q,W]=l.useState(!0),[C,P]=l.useState([]),[_,R]=l.useState(0),[b,c]=l.useState(0),[v,G]=l.useState(10),[x,L]=l.useState(""),[m,k]=l.useState(""),[g,F]=l.useState(""),[o,V]=l.useState(null),[U,q]=l.useState(!1),[w,J]=l.useState(!1),T=l.useCallback(async()=>{W(!0);try{const t={page:b+1,page_size:v};x&&(t.search=x),m&&(t.db_type=m),g&&(t.status=g);const n=await ee.listQueryLogs(t);n&&n.list?(P(n.list||[]),R(n.total||0)):n&&n.code===200&&(P(n.data?.list||[]),R(n.data?.total||0))}catch(t){se(t.message||s("dms.queryLogs.loadFailed"))}finally{W(!1)}},[b,v,x,m,g,s]);l.useEffect(()=>{T()},[T]);const K=t=>{V(t),q(!0)},X=()=>{L(""),k(""),F(""),c(0)},z=t=>{switch(t){case"success":return"success";case"error":return"error";case"timeout":return"warning";default:return"default"}},I=t=>new Date(t).toLocaleString(),B=t=>t?t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`:"-";return e.jsxs(a,{sx:{p:3},children:[e.jsx(te,{elevation:2,sx:{borderRadius:2},children:e.jsxs(re,{children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(a,{children:[e.jsx(r,{variant:"h5",fontWeight:600,gutterBottom:!0,children:s("dms.queryLogs.title")}),e.jsx(r,{variant:"body2",color:"text.secondary",children:s("dms.queryLogs.subtitle")})]}),e.jsxs(y,{direction:"row",spacing:1,children:[e.jsx(j,{title:s("common.refresh"),children:e.jsx(p,{onClick:T,children:e.jsx(ae,{})})}),e.jsx(j,{title:s(w?"dms.queryLogs.hideFilters":"dms.queryLogs.showFilters"),children:e.jsx(p,{onClick:()=>J(!w),children:e.jsx(ie,{})})})]})]}),e.jsx(u,{elevation:0,sx:{p:2,mb:3,bgcolor:"background.default",borderRadius:2},children:e.jsxs(h,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(h,{item:!0,xs:12,md:4,children:e.jsx(oe,{placeholder:s("dms.queryLogs.searchPlaceholder"),value:x,onChange:t=>{L(t.target.value),c(0)},InputProps:{startAdornment:e.jsx(D,{position:"start",children:e.jsx(ne,{color:"action"})}),endAdornment:x&&e.jsx(D,{position:"end",children:e.jsx(p,{size:"small",onClick:()=>L(""),children:e.jsx(M,{fontSize:"small"})})})},fullWidth:!0,size:"small"})}),w&&e.jsxs(e.Fragment,{children:[e.jsx(h,{item:!0,xs:12,md:3,children:e.jsxs(A,{fullWidth:!0,size:"small",children:[e.jsx($,{children:s("dms.queryLogs.dbType")}),e.jsxs(H,{value:m,label:s("dms.queryLogs.dbType"),onChange:t=>{k(t.target.value),c(0)},children:[e.jsx(d,{value:"",children:s("common.all")}),e.jsx(d,{value:"mysql",children:"MySQL"}),e.jsx(d,{value:"postgresql",children:"PostgreSQL"}),e.jsx(d,{value:"mongodb",children:"MongoDB"}),e.jsx(d,{value:"redis",children:"Redis"})]})]})}),e.jsx(h,{item:!0,xs:12,md:3,children:e.jsxs(A,{fullWidth:!0,size:"small",children:[e.jsx($,{children:s("dms.queryLogs.status")}),e.jsxs(H,{value:g,label:s("dms.queryLogs.status"),onChange:t=>{F(t.target.value),c(0)},children:[e.jsx(d,{value:"",children:s("common.all")}),e.jsx(d,{value:"success",children:s("dms.queryLogs.status.success")}),e.jsx(d,{value:"error",children:s("dms.queryLogs.status.error")}),e.jsx(d,{value:"timeout",children:s("dms.queryLogs.status.timeout")})]})]})}),e.jsx(h,{item:!0,xs:12,md:2,children:e.jsx(E,{variant:"outlined",startIcon:e.jsx(M,{}),onClick:X,fullWidth:!0,size:"small",children:s("dms.queryLogs.clearFilters")})})]})]})}),Q?e.jsx(a,{children:[...Array(5)].map((t,n)=>e.jsx(he,{variant:"rectangular",height:60,sx:{mb:1,borderRadius:1}},n))}):C.length===0?e.jsx(N,{severity:"info",sx:{borderRadius:2},children:s("dms.queryLogs.noLogs")}):e.jsxs(me,{component:u,elevation:0,sx:{borderRadius:2},children:[e.jsxs(ge,{children:[e.jsx(je,{children:e.jsxs(O,{sx:{bgcolor:"background.default"},children:[e.jsx(i,{sx:{fontWeight:600},children:s("dms.queryLogs.columns.time")}),e.jsx(i,{sx:{fontWeight:600},children:s("dms.queryLogs.columns.user")}),e.jsx(i,{sx:{fontWeight:600},children:s("dms.queryLogs.columns.instance")}),e.jsx(i,{sx:{fontWeight:600},children:s("dms.queryLogs.columns.type")}),e.jsx(i,{sx:{fontWeight:600},children:s("dms.queryLogs.columns.database")}),e.jsx(i,{sx:{fontWeight:600},children:s("dms.queryLogs.columns.query")}),e.jsx(i,{sx:{fontWeight:600},children:s("dms.queryLogs.columns.status")}),e.jsx(i,{sx:{fontWeight:600},children:s("dms.queryLogs.columns.duration")}),e.jsx(i,{sx:{fontWeight:600},align:"right",children:s("dms.queryLogs.columns.actions")})]})}),e.jsx(pe,{children:C.map(t=>e.jsxs(O,{hover:!0,sx:{"&:hover":{bgcolor:"action.hover"},transition:"background-color 0.2s"},children:[e.jsx(i,{children:e.jsx(r,{variant:"body2",children:I(t.createdAt)})}),e.jsx(i,{children:e.jsx(r,{variant:"body2",fontWeight:500,children:t.username})}),e.jsx(i,{children:e.jsxs(a,{children:[e.jsx(r,{variant:"body2",fontWeight:500,children:t.instanceName}),e.jsx(f,{label:t.dbType.toUpperCase(),size:"small",sx:{mt:.5,fontSize:"0.7rem",height:20}})]})}),e.jsx(i,{children:t.queryType&&e.jsx(f,{label:t.queryType,size:"small",variant:"outlined"})}),e.jsx(i,{children:e.jsx(r,{variant:"body2",fontFamily:"monospace",children:t.databaseName||"-"})}),e.jsx(i,{children:e.jsx(j,{title:t.queryContent,children:e.jsx(r,{variant:"body2",sx:{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:"monospace",fontSize:"0.75rem"},children:t.queryContent})})}),e.jsx(i,{children:e.jsx(f,{label:s(`dms.queryLogs.status.${t.status}`),color:z(t.status),size:"small",variant:"outlined"})}),e.jsx(i,{children:e.jsx(r,{variant:"body2",color:"text.secondary",children:B(t.executionTimeMs)})}),e.jsx(i,{align:"right",children:e.jsx(j,{title:s("common.view"),children:e.jsx(p,{size:"small",onClick:()=>K(t),color:"primary",children:e.jsx(le,{fontSize:"small"})})})})]},t.id))})]}),e.jsx(S,{}),e.jsx(ye,{component:"div",count:_,page:b,onPageChange:(t,n)=>c(n),rowsPerPage:v,onRowsPerPageChange:t=>{G(parseInt(t.target.value,10)),c(0)},rowsPerPageOptions:[10,25,50,100],labelRowsPerPage:s("common.rowsPerPage")+":",labelDisplayedRows:({from:t,to:n,count:Y})=>`${t}-${n} ${s("common.of")} ${Y}`,sx:{borderTop:"1px solid #e2e8f0",mt:0,width:"100%",".MuiTablePagination-toolbar":{paddingLeft:2,paddingRight:2,minHeight:"52px",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},".MuiTablePagination-spacer":{flex:"1 1 auto"},".MuiTablePagination-selectLabel":{marginRight:1,marginBottom:0,fontWeight:500,fontSize:"0.875rem",color:"text.secondary",display:"flex",alignItems:"center",lineHeight:1.5},".MuiTablePagination-displayedRows":{marginBottom:0,fontWeight:500,fontSize:"0.875rem",color:"text.secondary",display:"flex",alignItems:"center",lineHeight:1.5},".MuiTablePagination-select":{fontSize:"0.875rem",marginRight:2,marginTop:0,marginBottom:0},".MuiTablePagination-actions":{marginLeft:1,display:"flex",alignItems:"center"}}})]})]})}),e.jsxs(de,{open:U,onClose:()=>q(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(ce,{sx:{pb:1,fontWeight:600},children:s("dms.queryLogs.detail.title")}),e.jsx(S,{}),e.jsx(ue,{sx:{pt:3},children:o&&e.jsxs(y,{spacing:3,children:[e.jsxs(a,{children:[e.jsx(r,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,color:"primary",children:s("dms.queryLogs.detail.basicInfo")}),e.jsx(u,{elevation:0,sx:{p:2,bgcolor:"background.default",borderRadius:1},children:e.jsxs(y,{spacing:1.5,children:[e.jsxs(a,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:s("dms.queryLogs.detail.executionTime")}),e.jsx(r,{variant:"body2",fontWeight:500,children:I(o.createdAt)})]}),e.jsxs(a,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:s("dms.queryLogs.columns.user")}),e.jsx(r,{variant:"body2",fontWeight:500,children:o.username})]}),e.jsxs(a,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:s("dms.queryLogs.detail.instance")}),e.jsxs(r,{variant:"body2",fontWeight:500,children:[o.instanceName," (",o.dbType,")"]})]}),e.jsxs(a,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:s("dms.queryLogs.detail.database")}),e.jsx(r,{variant:"body2",fontWeight:500,fontFamily:"monospace",children:o.databaseName||"-"})]})]})})]}),e.jsxs(a,{children:[e.jsx(r,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,color:"primary",children:s("dms.queryLogs.detail.statistics")}),e.jsx(u,{elevation:0,sx:{p:2,bgcolor:"background.default",borderRadius:1},children:e.jsxs(y,{spacing:1.5,children:[e.jsxs(a,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:s("dms.queryLogs.detail.queryType")}),e.jsx(r,{variant:"body2",fontWeight:500,children:o.queryType||"-"})]}),e.jsxs(a,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:s("dms.queryLogs.columns.status")}),e.jsx(a,{children:e.jsx(f,{label:s(`dms.queryLogs.status.${o.status}`),color:z(o.status),size:"small",sx:{mt:.5}})})]}),e.jsxs(a,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:s("dms.queryLogs.detail.affectedRows")}),e.jsx(r,{variant:"body2",fontWeight:500,children:o.affectedRows})]}),e.jsxs(a,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:s("dms.queryLogs.detail.resultCount")}),e.jsx(r,{variant:"body2",fontWeight:500,children:o.resultCount})]}),e.jsxs(a,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:s("dms.queryLogs.detail.executionTime")}),e.jsx(r,{variant:"body2",fontWeight:500,children:B(o.executionTimeMs)})]})]})})]}),e.jsxs(a,{children:[e.jsx(r,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,color:"primary",children:s("dms.queryLogs.detail.queryContent")}),e.jsx(u,{elevation:0,sx:{p:2,bgcolor:"background.default",borderRadius:1},children:e.jsx(r,{component:"pre",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"0.875rem",m:0,color:"text.primary"},children:o.queryContent})})]}),o.errorMessage&&e.jsxs(a,{children:[e.jsx(r,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,color:"error",children:s("dms.queryLogs.detail.errorMessage")}),e.jsx(N,{severity:"error",sx:{borderRadius:1},children:e.jsx(r,{component:"pre",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"0.875rem",m:0},children:o.errorMessage})})]}),o.resultPreview&&e.jsxs(a,{children:[e.jsx(r,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,color:"primary",children:s("dms.queryLogs.detail.resultPreview")}),e.jsx(u,{elevation:0,sx:{p:2,bgcolor:"background.default",borderRadius:1},children:e.jsx(r,{component:"pre",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"0.875rem",m:0,maxHeight:300,overflow:"auto"},children:o.resultPreview})})]})]})}),e.jsx(S,{}),e.jsx(xe,{sx:{p:2},children:e.jsx(E,{onClick:()=>q(!1),variant:"contained",sx:{borderRadius:1},children:s("common.close")})})]})]})}export{We as default};
