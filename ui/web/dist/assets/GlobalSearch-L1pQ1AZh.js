import{H as D,u as H,cL as N,ax as Q,r as i,bf as S,j as e,B as r,T as t,m as V,t as b,a as T,w as l,x as u,bi as P,K as A,Z as L,bj as R,a3 as X,a4 as x,C as Y,b as Z,W as _,X as J,Y as M,be as W}from"./index-wVs8DYHr.js";import{G as h}from"./GridLegacy-D8ppXx7z.js";import{L as O}from"./ListItemAvatar-BDX-5OXX.js";import{C as B}from"./Chip-DzNpApxT.js";const U={globalSearch:a=>D.get("/api/k8s/search",{params:{q:a}})};function te(){const{t:a}=H(),[y,q]=N(),p=Q(),[v,k]=i.useState(!1),[g,m]=i.useState([]),[o,j]=i.useState({cluster:0,node:0,pod:0,workload:0}),[w,E]=i.useState("all"),[d,f]=i.useState(y.get("q")||"");i.useEffect(()=>{const s=y.get("q");s&&(f(s),I(s))},[y]);const I=async s=>{if(!s.trim()){m([]),j({cluster:0,node:0,pod:0,workload:0});return}k(!0);try{const c=(await U.globalSearch(s)).data;c.code===0||!c.code?(m(c.results||[]),j(c.stats||{cluster:0,node:0,pod:0,workload:0})):(S(c.message||"搜索失败"),m([]),j({cluster:0,node:0,pod:0,workload:0}))}catch(n){const c=n;S(c?.response?.data?.message||c?.message||"搜索失败"),m([]),j({cluster:0,node:0,pod:0,workload:0})}finally{k(!1)}},$=s=>{f(s),q({q:s}),I(s)},z=s=>s==="all"?g:g.filter(n=>n.type===s),F=(s,n)=>{switch(n){case"cluster":return s==="active"?"success":"error";case"node":return s==="Ready"?"success":"error";case"pod":return s==="Running"?"success":s==="Pending"?"warning":"error";case"workload":return"info";default:return"default"}},G=s=>{switch(s){case"cluster":return e.jsx(P,{});case"node":return e.jsx(A,{});case"pod":return e.jsx(L,{});case"workload":return e.jsx(R,{});default:return e.jsx(W,{})}},K=s=>{switch(s.type){case"cluster":p(`/clusters/${s.clusterId}/status`);break;case"node":p(`/k8s/nodes?cluster=${s.clusterId}&node=${s.name}`);break;case"pod":p(`/k8s/pods?cluster=${s.clusterId}&namespace=${s.namespace}&pod=${s.name}`);break;case"workload":{const n=s.kind?.toLowerCase()||"deployment";p(`/k8s/${n}s?cluster=${s.clusterId}&namespace=${s.namespace}&name=${s.name}`);break}}},C=z(w);return e.jsxs(r,{sx:{width:"100%",p:3},children:[e.jsxs(r,{sx:{mb:3},children:[e.jsx(t,{variant:"h4",component:"h1",gutterBottom:!0,fontWeight:"700",children:a("search.title","全局搜索")}),e.jsxs(r,{sx:{display:"flex",gap:2,mt:2,maxWidth:800},children:[e.jsx(V,{fullWidth:!0,placeholder:a("search.placeholder","搜索集群、节点、容器组、工作负载..."),value:d,onChange:s=>f(s.target.value),onKeyPress:s=>{s.key==="Enter"&&$(d)},InputProps:{startAdornment:e.jsx(b,{sx:{mr:1,color:"text.secondary"}})},size:"medium"}),e.jsx(T,{variant:"contained",startIcon:e.jsx(b,{}),onClick:()=>$(d),disabled:v,sx:{minWidth:120},children:a("search.search","搜索")})]})]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l,{children:e.jsx(u,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(P,{color:"primary"}),e.jsx(t,{variant:"h6",children:o.cluster}),e.jsx(t,{variant:"body2",color:"text.secondary",children:a("search.cluster","集群")})]})})})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l,{children:e.jsx(u,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(A,{color:"primary"}),e.jsx(t,{variant:"h6",children:o.node}),e.jsx(t,{variant:"body2",color:"text.secondary",children:a("search.node","节点")})]})})})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l,{children:e.jsx(u,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(L,{color:"primary"}),e.jsx(t,{variant:"h6",children:o.pod}),e.jsx(t,{variant:"body2",color:"text.secondary",children:a("search.pod","容器组")})]})})})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l,{children:e.jsx(u,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(R,{color:"primary"}),e.jsx(t,{variant:"h6",children:o.workload}),e.jsx(t,{variant:"body2",color:"text.secondary",children:a("search.workload","工作负载")})]})})})})]}),e.jsxs(l,{children:[e.jsx(r,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(X,{value:w,onChange:(s,n)=>E(n),"aria-label":"搜索结果分类",children:[e.jsx(x,{label:`${a("search.all","全部")} (${g.length})`,value:"all"}),e.jsx(x,{label:`${a("search.cluster","集群")} (${o.cluster})`,value:"cluster"}),e.jsx(x,{label:`${a("search.node","节点")} (${o.node})`,value:"node"}),e.jsx(x,{label:`${a("search.pod","容器组")} (${o.pod})`,value:"pod"}),e.jsx(x,{label:`${a("search.workload","工作负载")} (${o.workload})`,value:"workload"})]})}),e.jsx(r,{sx:{position:"relative",minHeight:400},children:v?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:8},children:e.jsx(Y,{})}):C.length===0?e.jsx(r,{sx:{p:4},children:e.jsx(Z,{severity:"info",children:a("search.noResults","暂无搜索结果")})}):e.jsx(_,{children:C.map((s,n)=>e.jsxs(J,{sx:{borderBottom:"1px solid",borderColor:"divider","&:hover":{backgroundColor:"action.hover"}},secondaryAction:e.jsx(T,{variant:"text",startIcon:e.jsx(W,{}),onClick:()=>K(s),children:a("search.viewDetail","查看详情")}),children:[e.jsx(O,{children:G(s.type)}),e.jsx(M,{primary:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(t,{variant:"subtitle1",fontWeight:"600",children:s.name}),e.jsx(B,{label:s.status,size:"small",color:F(s.status,s.type)}),s.kind&&e.jsx(B,{label:s.kind,size:"small",variant:"outlined"})]}),secondary:e.jsxs(r,{sx:{mt:.5},children:[e.jsxs(t,{variant:"body2",color:"text.secondary",children:[s.type==="cluster"&&`API Server: ${s.description}`,s.type==="node"&&`IP: ${s.ip||s.description}`,s.type==="pod"&&`节点: ${s.description||"-"}`,s.type==="workload"&&`副本数: ${s.description||"-"}`]}),e.jsxs(r,{sx:{display:"flex",gap:2,mt:.5,flexWrap:"wrap"},children:[e.jsxs(t,{variant:"caption",color:"text.secondary",children:[a("search.cluster","集群"),": ",s.clusterName]}),s.namespace&&e.jsxs(t,{variant:"caption",color:"text.secondary",children:[a("search.namespace","命名空间"),": ",s.namespace]}),s.ip&&e.jsxs(t,{variant:"caption",color:"text.secondary",children:["IP: ",s.ip]})]})]})})]},`${s.type}-${s.id}-${n}`))})})]})]}),!d&&e.jsx(l,{children:e.jsxs(r,{sx:{p:8,textAlign:"center"},children:[e.jsx(b,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(t,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:a("search.enterKeyword","请输入搜索关键词开始搜索")})]})})]})}export{te as default};
