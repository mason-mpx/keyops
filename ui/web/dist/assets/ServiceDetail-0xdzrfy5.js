import{u as ve,bg as je,ax as ye,r as u,j as e,B as o,C as z,b as be,a as S,aA as ee,T as c,g as we,w as H,x as P,d as E,ar as Ce,I as Oe,be as Ae,i as se,k as te,l as re,m,M as d,_ as Se,p as ie,bf as $,bq as F,a7 as We,c3 as Ee,b4 as Te}from"./index-DNdAKB9f.js";import{d as ne}from"./deploymentApi-8qhygyBV.js";import{C as v}from"./Chip-B8lB6W_F.js";import{G as x}from"./GridLegacy-Bg8nSEpP.js";import{T as De,a as ze,b as Ie,c as le,d as h,e as _e}from"./TableRow-2FuGKbnY.js";import{A as I}from"./Autocomplete-DeIHe46-.js";import{S as ke}from"./Switch-psoPU8CH.js";function Pe(){const{t:r}=ve(),{id:_}=je(),C=ye(),[n,G]=u.useState(null),[f,ae]=u.useState([]),[O,oe]=u.useState([]),[ce,L]=u.useState(!0),[N,V]=u.useState(!1),[Y,K]=u.useState(""),[B,k]=u.useState(!1),[i,p]=u.useState({}),[q,Q]=u.useState(!1),[T,J]=u.useState([]),[D,X]=u.useState(!1),[de,R]=u.useState(!1),[b,U]=u.useState(null),[ue,y]=u.useState(""),[xe,M]=u.useState(!1),A=s=>{let t=[];return s.forEach(l=>{t.push(l),l.children&&l.children.length>0&&(t=t.concat(A(l.children)))}),t},w=(s,t)=>{if(!s)return"-";const a=A(t).find(j=>j.unitCode===s);return a?a.unitName:s},he=s=>{switch(s){case"Running":return"success";case"Stopped":return"error";case"Initializing":return"warning";default:return"default"}};u.useEffect(()=>{(async()=>{if(!_){K("应用ID不存在"),L(!1);return}L(!0);try{const t=await F.getApplication(_);G(t);const l=await Ee.getOrganizations();ae(l||[]),Z(t.name)}catch(t){const l=t,a=l?.response?.data?.message||l?.message||"加载应用详情失败";K(a),$(a)}finally{L(!1)}})()},[_]);const Z=async s=>{if(s)try{V(!0);const t=await ne.listDeployments({project_name:s,page_size:10});oe(t.items||[])}catch(t){console.error("加载部署记录失败:",t)}finally{V(!1)}},W=async(s="")=>{try{X(!0);const t=await Te.getUsersWithRoles({page:1,pageSize:10,keyword:s||void 0});J(t.users||[])}catch(t){console.error("加载用户列表失败:",t),J([])}finally{X(!1)}};u.useEffect(()=>{B&&W()},[B]);const pe=async s=>{U(s),R(!0),y(""),M(!0);try{if(s.log_path&&(s.log_path.startsWith("http://")||s.log_path.startsWith("https://"))){window.open(s.log_path,"_blank"),y("日志链接已在新窗口打开"),M(!1);return}try{const t=await ne.getDeployment(s.id);"build_log"in t&&typeof t.build_log=="string"?y(t.build_log):t.log_path?y(`日志路径: ${t.log_path}

如需查看完整日志，请联系管理员或访问日志文件。`):y("该发布记录暂无日志信息。")}catch{s.log_path?y(`日志路径: ${s.log_path}

如需查看完整日志，请联系管理员或访问日志文件。`):y("该发布记录暂无日志信息。")}}catch(t){console.error("获取日志失败:",t),y("获取日志失败: "+(t?.message||"未知错误"))}finally{M(!1)}};return ce?e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(z,{})}):Y||!n?e.jsxs(o,{sx:{p:3},children:[e.jsx(be,{severity:"error",children:Y||"应用不存在"}),e.jsx(S,{startIcon:e.jsx(ee,{}),onClick:()=>C("/services"),sx:{mt:2},children:"返回列表"})]}):e.jsxs(o,{sx:{p:3},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(o,{children:[e.jsx(S,{startIcon:e.jsx(ee,{}),onClick:()=>C("/services"),sx:{mb:1},children:"返回列表"}),e.jsx(c,{variant:"h4",component:"h1",fontWeight:"700",children:n.name}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:r("services.detail")||"应用详情"})]}),e.jsx(S,{variant:"contained",startIcon:e.jsx(we,{}),onClick:()=>{const s=t=>{if(!t)return"";try{const l=new Date(t),a=l.getFullYear(),j=String(l.getMonth()+1).padStart(2,"0"),ge=String(l.getDate()).padStart(2,"0"),fe=String(l.getHours()).padStart(2,"0"),me=String(l.getMinutes()).padStart(2,"0");return`${a}-${j}-${ge}T${fe}:${me}`}catch{return""}};p({...n,onlineAt:s(n.onlineAt),offlineAt:s(n.offlineAt)}),k(!0)},children:"编辑"})]}),e.jsx(H,{sx:{mb:3,boxShadow:2},children:e.jsxs(P,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(c,{variant:"h6",fontWeight:"600",children:"部署数据统计"}),e.jsx(v,{label:`共 ${O.length} 条记录`,size:"small",color:"primary",variant:"outlined"})]}),e.jsxs(o,{sx:{display:"flex",gap:2},children:[e.jsxs(o,{sx:{flex:1,textAlign:"center",p:2.5,bgcolor:"primary.main",borderRadius:2,color:"white",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)"}},children:[e.jsx(c,{variant:"h3",fontWeight:"700",children:O.length}),e.jsx(c,{variant:"body2",sx:{mt:1,opacity:.9},children:"总部署次数"})]}),e.jsxs(o,{sx:{flex:1,textAlign:"center",p:2.5,bgcolor:"success.main",borderRadius:2,color:"white",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)"}},children:[e.jsx(c,{variant:"h3",fontWeight:"700",children:O.filter(s=>s.status==="success").length}),e.jsx(c,{variant:"body2",sx:{mt:1,opacity:.9},children:"成功部署"})]}),e.jsxs(o,{sx:{flex:1,textAlign:"center",p:2.5,bgcolor:"error.main",borderRadius:2,color:"white",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)"}},children:[e.jsx(c,{variant:"h3",fontWeight:"700",children:O.filter(s=>s.status==="failed").length}),e.jsx(c,{variant:"body2",sx:{mt:1,opacity:.9},children:"失败部署"})]}),e.jsxs(o,{sx:{flex:1,textAlign:"center",p:2.5,bgcolor:"warning.main",borderRadius:2,color:"white",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)"}},children:[e.jsx(c,{variant:"h3",fontWeight:"700",children:O.filter(s=>s.status==="running"||s.status==="pending").length}),e.jsx(c,{variant:"body2",sx:{mt:1,opacity:.9},children:"进行中"})]})]})]})}),e.jsx(H,{sx:{mb:3,boxShadow:2},children:e.jsxs(P,{children:[e.jsx(c,{variant:"h6",gutterBottom:!0,fontWeight:"600",sx:{mb:3},children:r("services.basicInfo")||"基本信息"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.applicationName"),value:e.jsx(E,{title:n.name,arrow:!0,placement:"top",children:e.jsx(c,{variant:"body1",fontWeight:"600",color:"primary.main",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"block"},children:n.name})}),highlight:!0})}),w(n.org,f)&&w(n.org,f)!=="-"&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.org"),value:w(n.org,f)})}),w(n.lineOfBiz,f)&&w(n.lineOfBiz,f)!=="-"&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.lineOfBiz"),value:w(n.lineOfBiz,f)})}),w(n.department,f)&&w(n.department,f)!=="-"&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.department"),value:w(n.department,f)})}),e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.applicationType"),value:e.jsx(v,{label:r(`services.srvType.${n.srvType}`,n.srvType),size:"small",variant:"outlined",color:"primary"})})}),n.virtualTech&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.virtualTech"),value:n.virtualTech})}),e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.status"),value:e.jsx(v,{label:n.status,color:he(n.status),size:"small",sx:{fontWeight:600}}),highlight:!0})}),e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.isCritical"),value:n.isCritical?e.jsx(v,{label:r("services.yes"),color:"error",size:"small",sx:{fontWeight:600}}):e.jsx(v,{label:r("services.no"),size:"small",variant:"outlined"}),highlight:n.isCritical})}),n.site&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.site"),value:n.site})}),n.onlineAt&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.onlineAt"),value:e.jsx(E,{title:new Date(n.onlineAt).toLocaleString("zh-CN"),arrow:!0,placement:"top",children:e.jsx(c,{variant:"body2",fontWeight:"500",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"block"},children:new Date(n.onlineAt).toLocaleString("zh-CN")})})})}),n.offlineAt&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.offlineAt"),value:e.jsx(E,{title:new Date(n.offlineAt).toLocaleString("zh-CN"),arrow:!0,placement:"top",children:e.jsx(c,{variant:"body2",fontWeight:"500",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"block"},children:new Date(n.offlineAt).toLocaleString("zh-CN")})})})}),n.updatedAt&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.updatedAt")||"更新时间",value:e.jsx(E,{title:new Date(n.updatedAt).toLocaleString("zh-CN"),arrow:!0,placement:"top",children:e.jsx(c,{variant:"body2",color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"block"},children:new Date(n.updatedAt).toLocaleString("zh-CN")})})})}),n.gitUrl&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.gitUrl")||"Git地址",value:e.jsx(E,{title:n.gitUrl,arrow:!0,placement:"top",children:e.jsx(Ce,{href:n.gitUrl,target:"_blank",rel:"noopener noreferrer",sx:{fontSize:"0.875rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%",display:"block"},children:n.gitUrl})})})}),n.opsOwners&&n.opsOwners.length>0&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.opsOwners")||"运维负责人",value:e.jsx(o,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:n.opsOwners.map((s,t)=>e.jsx(v,{label:s,size:"small",color:"primary"},t))})})}),n.testOwners&&n.testOwners.length>0&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.testOwners")||"测试负责人",value:e.jsx(o,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:n.testOwners.map((s,t)=>e.jsx(v,{label:s,size:"small",color:"warning"},t))})})}),n.devOwners&&n.devOwners.length>0&&e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(g,{label:r("services.devOwners")||"研发负责人",value:e.jsx(o,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:n.devOwners.map((s,t)=>e.jsx(v,{label:s,size:"small",color:"success"},t))})})}),n.description&&e.jsx(x,{item:!0,xs:12,children:e.jsx(g,{label:r("services.description"),value:e.jsx(E,{title:n.description,arrow:!0,placement:"top",children:e.jsx(c,{variant:"body2",sx:{color:"text.secondary",lineHeight:1.6,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",maxHeight:"4.8em"},children:n.description})})})})]})]})}),e.jsx(H,{sx:{boxShadow:2},children:e.jsxs(P,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(c,{variant:"h6",fontWeight:"600",children:"历史发布记录"}),e.jsxs(o,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(v,{label:`共 ${O.length} 条记录`,size:"small",color:"primary",variant:"outlined"}),e.jsx(S,{size:"small",variant:"outlined",onClick:()=>Z(n.name),disabled:N,children:N?"加载中...":"刷新"})]})]}),N?e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:6},children:e.jsx(z,{size:40})}):O.length===0?e.jsxs(o,{sx:{textAlign:"center",p:6,bgcolor:"grey.50",borderRadius:2},children:[e.jsx(c,{variant:"body1",color:"text.secondary",children:"暂无发布记录"}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"该应用还没有发布记录"})]}):e.jsx(De,{children:e.jsxs(ze,{size:"small",children:[e.jsx(Ie,{children:e.jsxs(le,{sx:{bgcolor:"grey.100"},children:[e.jsx(h,{sx:{fontWeight:600},children:"环境"}),e.jsx(h,{sx:{fontWeight:600},children:"部署类型"}),e.jsx(h,{sx:{fontWeight:600},children:"版本"}),e.jsx(h,{sx:{fontWeight:600},children:"状态"}),e.jsx(h,{sx:{fontWeight:600},children:"创建人"}),e.jsx(h,{sx:{fontWeight:600},children:"开始时间"}),e.jsx(h,{sx:{fontWeight:600},children:"完成时间"}),e.jsx(h,{sx:{fontWeight:600},children:"耗时"}),e.jsx(h,{sx:{fontWeight:600},children:"操作"})]})}),e.jsx(_e,{children:O.map((s,t)=>e.jsxs(le,{sx:{"&:hover":{bgcolor:"action.hover"},bgcolor:t%2===0?"white":"grey.50"},children:[e.jsx(h,{children:e.jsx(v,{label:s.env_name||"未设置",size:"small",variant:"outlined"})}),e.jsx(h,{children:e.jsx(v,{label:s.deploy_type.toUpperCase(),size:"small",color:s.deploy_type==="k8s"?"primary":"default",variant:"outlined"})}),e.jsx(h,{children:e.jsx(c,{variant:"body2",sx:{fontFamily:"monospace"},children:s.version||"-"})}),e.jsx(h,{children:e.jsx(v,{label:s.status,size:"small",color:s.status==="success"?"success":s.status==="failed"?"error":s.status==="running"?"primary":"default"})}),e.jsx(h,{children:s.created_by_name||s.created_by||"-"}),e.jsx(h,{children:e.jsx(c,{variant:"body2",children:s.started_at?new Date(s.started_at).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})}),e.jsx(h,{children:e.jsx(c,{variant:"body2",children:s.completed_at?new Date(s.completed_at).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"})}),e.jsx(h,{children:s.duration?e.jsx(v,{label:`${Math.floor(s.duration/60)}分${s.duration%60}秒`,size:"small",variant:"outlined"}):"-"}),e.jsx(h,{children:e.jsx(E,{title:"查看发布日志",children:e.jsx(Oe,{size:"small",onClick:()=>pe(s),disabled:!s.log_path,children:e.jsx(Ae,{fontSize:"small"})})})})]},s.id))})]})})]})}),e.jsxs(se,{open:B,onClose:()=>k(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(te,{children:"编辑应用"}),e.jsx(re,{children:e.jsxs(o,{sx:{pt:2,display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(o,{sx:{display:"flex",gap:2},children:[e.jsx(m,{fullWidth:!0,label:r("services.applicationName"),value:i.name||"",onChange:s=>p({...i,name:s.target.value}),required:!0}),e.jsxs(m,{fullWidth:!0,label:r("services.status"),select:!0,value:i.status||"Initializing",onChange:s=>p({...i,status:s.target.value}),children:[e.jsx(d,{value:"Running",children:r("services.running")}),e.jsx(d,{value:"Stopped",children:r("services.stopped")}),e.jsx(d,{value:"Initializing",children:r("services.initializing")})]})]}),e.jsxs(o,{sx:{display:"flex",gap:2},children:[e.jsx(I,{fullWidth:!0,options:A(f),getOptionLabel:s=>s.unitName,value:A(f).find(s=>s.unitCode===i.org)||null,onChange:(s,t)=>p({...i,org:t?.unitCode||""}),renderInput:s=>e.jsx(m,{...s,label:r("services.org")})}),e.jsx(I,{fullWidth:!0,options:A(f),getOptionLabel:s=>s.unitName,value:A(f).find(s=>s.unitCode===i.lineOfBiz)||null,onChange:(s,t)=>p({...i,lineOfBiz:t?.unitCode||""}),renderInput:s=>e.jsx(m,{...s,label:r("services.lineOfBiz")})})]}),e.jsxs(o,{sx:{display:"flex",gap:2},children:[e.jsx(I,{fullWidth:!0,options:A(f),getOptionLabel:s=>s.unitName,value:A(f).find(s=>s.unitCode===i.department)||null,onChange:(s,t)=>p({...i,department:t?.unitCode||""}),renderInput:s=>e.jsx(m,{...s,label:r("services.department")})}),e.jsx(m,{fullWidth:!0,label:r("services.site"),value:i.site||"",onChange:s=>p({...i,site:s.target.value})})]}),e.jsxs(o,{sx:{display:"flex",gap:2},children:[e.jsxs(m,{fullWidth:!0,label:r("services.applicationType"),select:!0,value:i.srvType||"",onChange:s=>p({...i,srvType:s.target.value}),required:!0,children:[e.jsx(d,{value:"SERVER",children:r("services.srvType.SERVER")}),e.jsx(d,{value:"WEB",children:r("services.srvType.WEB")}),e.jsx(d,{value:"MIDDLEWARE",children:r("services.srvType.MIDDLEWARE")}),e.jsx(d,{value:"DATAWARE",children:r("services.srvType.DATAWARE")}),e.jsx(d,{value:"MOBILE",children:r("services.srvType.MOBILE")}),e.jsx(d,{value:"DATABASE",children:r("services.srvType.DATABASE")}),e.jsx(d,{value:"MICROSERVICE",children:r("services.srvType.MICROSERVICE")}),e.jsx(d,{value:"BATCH",children:r("services.srvType.BATCH")}),e.jsx(d,{value:"SCHEDULER",children:r("services.srvType.SCHEDULER")}),e.jsx(d,{value:"GATEWAY",children:r("services.srvType.GATEWAY")}),e.jsx(d,{value:"CACHE",children:r("services.srvType.CACHE")}),e.jsx(d,{value:"MESSAGE_QUEUE",children:r("services.srvType.MESSAGE_QUEUE")}),e.jsx(d,{value:"BACKEND",children:r("services.srvType.BACKEND")})]}),e.jsxs(m,{fullWidth:!0,label:r("services.virtualTech"),select:!0,value:i.virtualTech||"",onChange:s=>p({...i,virtualTech:s.target.value}),children:[e.jsx(d,{value:"",children:"无"}),e.jsx(d,{value:"K8S",children:"K8S"}),e.jsx(d,{value:"EC2",children:"EC2"}),e.jsx(d,{value:"ECS",children:"ECS"}),e.jsx(d,{value:"GCE",children:"GCE"})]})]}),e.jsx(m,{fullWidth:!0,label:r("services.description"),value:i.description||"",onChange:s=>p({...i,description:s.target.value}),multiline:!0,rows:3}),e.jsxs(o,{sx:{display:"flex",gap:2},children:[e.jsx(m,{fullWidth:!0,label:r("services.onlineAt"),type:"datetime-local",value:i.onlineAt||"",onChange:s=>p({...i,onlineAt:s.target.value}),InputLabelProps:{shrink:!0}}),e.jsx(m,{fullWidth:!0,label:r("services.offlineAt"),type:"datetime-local",value:i.offlineAt||"",onChange:s=>p({...i,offlineAt:s.target.value}),InputLabelProps:{shrink:!0}})]}),e.jsxs(o,{sx:{display:"flex",gap:2},children:[e.jsx(m,{fullWidth:!0,label:r("services.gitUrl")||"Git地址",value:i.gitUrl||"",onChange:s=>p({...i,gitUrl:s.target.value})}),e.jsx(I,{fullWidth:!0,multiple:!0,options:T,getOptionLabel:s=>typeof s=="string"?s:s.username||s.fullName||"",value:(i.opsOwners||[]).map(s=>T.find(l=>l.username===s||l.fullName===s)||s),onChange:(s,t)=>{const l=t.map(a=>typeof a=="string"?a:a.username||a.fullName||"");p({...i,opsOwners:l})},onInputChange:(s,t)=>{t?W(t):W()},loading:D,filterOptions:s=>s,renderInput:s=>e.jsx(m,{...s,label:r("services.opsOwners")||"运维负责人",placeholder:"搜索用户...",InputProps:{...s.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[D?e.jsx(z,{color:"inherit",size:20}):null,s.InputProps.endAdornment]})}}),renderOption:(s,t)=>{const l=typeof t=="string"?null:t,a=l?l.fullName||l.username||"":typeof t=="string"?t:"",j=l?.id||(typeof t=="string"?t:"");return u.createElement("li",{...s,key:j},a)}})]}),e.jsxs(o,{sx:{display:"flex",gap:2},children:[e.jsx(I,{fullWidth:!0,multiple:!0,options:T,getOptionLabel:s=>typeof s=="string"?s:s.username||s.fullName||"",value:(i.testOwners||[]).map(s=>T.find(l=>l.username===s||l.fullName===s)||s),onChange:(s,t)=>{const l=t.map(a=>typeof a=="string"?a:a.username||a.fullName||"");p({...i,testOwners:l})},onInputChange:(s,t)=>{t?W(t):W()},loading:D,filterOptions:s=>s.slice(0,10),renderInput:s=>e.jsx(m,{...s,label:r("services.testOwners")||"测试负责人",placeholder:"搜索用户...",InputProps:{...s.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[D?e.jsx(z,{color:"inherit",size:20}):null,s.InputProps.endAdornment]})}}),renderOption:(s,t)=>{const l=typeof t=="string"?null:t,a=l?l.username||l.fullName||"":typeof t=="string"?t:"",j=l?.id||(typeof t=="string"?t:String(t));return u.createElement("li",{...s,key:j},a)}}),e.jsx(I,{fullWidth:!0,multiple:!0,options:T,getOptionLabel:s=>typeof s=="string"?s:s.username||s.fullName||"",value:(i.devOwners||[]).map(s=>T.find(l=>l.username===s||l.fullName===s)||s),onChange:(s,t)=>{const l=t.map(a=>typeof a=="string"?a:a.username||a.fullName||"");p({...i,devOwners:l})},onInputChange:(s,t)=>{t?W(t):W()},loading:D,filterOptions:s=>s.slice(0,10),renderInput:s=>e.jsx(m,{...s,label:r("services.devOwners")||"研发负责人",placeholder:"搜索用户...",InputProps:{...s.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[D?e.jsx(z,{color:"inherit",size:20}):null,s.InputProps.endAdornment]})}}),renderOption:(s,t)=>{const l=typeof t=="string"?null:t,a=l?l.username||l.fullName||"":typeof t=="string"?t:"",j=l?.id||(typeof t=="string"?t:String(t));return u.createElement("li",{...s,key:j},a)}})]}),e.jsx(Se,{control:e.jsx(ke,{checked:i.isCritical||!1,onChange:s=>p({...i,isCritical:s.target.checked})}),label:r("services.isCritical")})]})}),e.jsxs(ie,{children:[e.jsx(S,{onClick:()=>k(!1),children:"取消"}),e.jsx(S,{variant:"contained",onClick:async()=>{if(!i.name?.trim()){$("应用名称不能为空");return}try{Q(!0);const s=a=>{if(!(!a||a.trim()===""))try{const j=new Date(a);return isNaN(j.getTime())?void 0:j.toISOString()}catch{return}},t={name:i.name||"",org:i.org||void 0,lineOfBiz:i.lineOfBiz||void 0,department:i.department||void 0,srvType:i.srvType||"",virtualTech:i.virtualTech||void 0,status:i.status||void 0,isCritical:i.isCritical||!1,site:i.site||void 0,description:i.description||void 0,onlineAt:s(i.onlineAt||""),offlineAt:s(i.offlineAt||""),gitUrl:i.gitUrl||void 0,opsOwners:i.opsOwners&&i.opsOwners.length>0?i.opsOwners:void 0,testOwners:i.testOwners&&i.testOwners.length>0?i.testOwners:void 0,devOwners:i.devOwners&&i.devOwners.length>0?i.devOwners:void 0};await F.updateApplication(n.id,t),We("更新成功"),k(!1);const l=await F.getApplication(n.id);G(l)}catch(s){const t=s,l=t?.response?.data?.message||t?.message||"更新失败";$(l)}finally{Q(!1)}},disabled:q,children:q?"保存中...":"保存"})]})]}),e.jsxs(se,{open:de,onClose:()=>{R(!1),U(null),y("")},maxWidth:"lg",fullWidth:!0,children:[e.jsxs(te,{children:["发布日志",b&&e.jsx(o,{sx:{mt:1},children:e.jsxs(c,{variant:"body2",color:"text.secondary",children:["环境: ",b.env_name||"未设置"," | 版本: ",b.version||"-"," | 状态: ",b.status]})})]}),e.jsx(re,{children:e.jsx(o,{sx:{pt:2},children:xe?e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:4},children:e.jsx(z,{})}):e.jsx(o,{sx:{bgcolor:"grey.900",color:"grey.100",p:2,borderRadius:1,fontFamily:"monospace",fontSize:"0.875rem",maxHeight:"60vh",overflow:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:ue||"暂无日志内容"})})}),e.jsxs(ie,{children:[e.jsx(S,{onClick:()=>{R(!1),U(null),y("")},children:"关闭"}),b?.log_path&&(b.log_path.startsWith("http://")||b.log_path.startsWith("https://"))&&e.jsx(S,{variant:"contained",onClick:()=>{b.log_path&&window.open(b.log_path,"_blank")},children:"在新窗口打开"})]})]})]})}function g({label:r,value:_,highlight:C=!1}){return e.jsxs(o,{sx:{p:2,borderRadius:2,bgcolor:C?"primary.50":"grey.50",border:C?"1px solid":"none",borderColor:C?"primary.200":"transparent",transition:"all 0.2s","&:hover":{bgcolor:C?"primary.100":"grey.100",transform:"translateY(-2px)",boxShadow:1}},children:[e.jsx(c,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1,fontWeight:C?600:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px"},children:r}),e.jsx(o,{sx:{minHeight:24},children:_})]})}export{Pe as default};
