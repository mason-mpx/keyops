import{u as f,r as l,j as r,B as h,T as x,w as g,x as w,C,b,I as o,be as T,c as z,V as S}from"./index-DNdAKB9f.js";import{t}from"./ticketApi-DZP3lA1o.js";import{T as v,a as B,b as I,c as j,d as e,e as A}from"./TableRow-2FuGKbnY.js";import{C as _}from"./Chip-B8lB6W_F.js";function P(){const{t:a}=f(),[c,p]=l.useState([]),[m,d]=l.useState(!1);l.useEffect(()=>{i()},[]);const i=async()=>{try{d(!0);const s=await t.list({status:"submitted"});s.data.code===0&&p(s.data.data||[])}catch(s){console.error("加载待审批工单失败:",s)}finally{d(!1)}},y=async s=>{try{await t.submit(s),await i()}catch(n){console.error("审批失败:",n)}},u=async s=>{try{await t.cancel(s),await i()}catch(n){console.error("拒绝失败:",n)}};return r.jsxs(h,{sx:{p:3},children:[r.jsx(x,{variant:"h4",gutterBottom:!0,children:"待我审批"}),r.jsx(g,{sx:{mt:3},children:r.jsxs(w,{children:[r.jsx(x,{variant:"h6",sx:{mb:2},children:"待审批工单"}),m?r.jsx(h,{sx:{display:"flex",justifyContent:"center",p:3},children:r.jsx(C,{})}):c.length===0?r.jsx(b,{severity:"info",children:"暂无待审批的工单"}):r.jsx(v,{children:r.jsxs(B,{children:[r.jsx(I,{children:r.jsxs(j,{children:[r.jsx(e,{children:"工单编号"}),r.jsx(e,{children:"标题"}),r.jsx(e,{children:"申请人"}),r.jsx(e,{children:"模板"}),r.jsx(e,{children:"优先级"}),r.jsx(e,{children:"创建时间"}),r.jsx(e,{align:"right",children:"操作"})]})}),r.jsx(A,{children:c.map(s=>r.jsxs(j,{children:[r.jsx(e,{children:s.ticket_number}),r.jsx(e,{children:s.title}),r.jsx(e,{children:s.applicant_username||s.applicant_name}),r.jsx(e,{children:s.template?.name||"-"}),r.jsx(e,{children:r.jsx(_,{label:s.priority==="low"?a("workorder.priority.low","低"):s.priority==="normal"?a("workorder.priority.normal","普通"):s.priority==="high"?a("workorder.priority.high","高"):s.priority==="urgent"?a("workorder.priority.urgent","紧急"):s.priority||a("workorder.priority.normal","普通"),size:"small"})}),r.jsx(e,{children:new Date(s.created_at).toLocaleDateString()}),r.jsxs(e,{align:"right",children:[r.jsx(o,{size:"small",color:"primary",children:r.jsx(T,{fontSize:"small"})}),r.jsx(o,{size:"small",color:"success",onClick:()=>y(s.id),children:r.jsx(z,{fontSize:"small"})}),r.jsx(o,{size:"small",color:"error",onClick:()=>u(s.id),children:r.jsx(S,{fontSize:"small"})})]})]},s.id))})]})})]})})]})}export{P as default};
