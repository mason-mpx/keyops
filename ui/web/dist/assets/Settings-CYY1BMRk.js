import{ak as ee,aj as te,r as m,al as de,c_ as ce,c$ as Se,j as e,af as _,an as se,ao as ae,ae as ue,c1 as he,ah as pe,d0 as we,bB as ke,aO as O,bL as Ie,aP as le,aE as Te,aG as Pe,bF as Me,u as G,a1 as ge,B as g,T as h,bi as V,D as k,m as p,_ as y,$ as xe,a as E,d1 as K,b as S,c as R,E as We,a6 as W,P as D,F as me,d2 as Ue,cY as J,aa as Q,C as Le,d3 as be,ab as Fe,n as Re,o as De,M as Y,bh as He,a5 as fe,a7 as je,a2 as Ne,a3 as Be,a4 as z}from"./index-STo1oTDL.js";import{S as C}from"./Stack-BJqE2zD7.js";import{S as U}from"./Switch-Do7Epm1v.js";import{S as ze}from"./Snackbar-hEMhwoCf.js";import{T as Ae}from"./TwoFactorSettings-C4O6Q5UC.js";import"./Chip-v5QMYL72.js";function Ee(t){return ee("MuiFormGroup",t)}te("MuiFormGroup",["root","row","error"]);const _e=t=>{const{classes:n,row:s,error:o}=t;return ae({root:["root",s&&"row",o&&"error"]},Ee,n)},Ge=_("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,s.row&&n.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),X=m.forwardRef(function(n,s){const o=de({props:n,name:"MuiFormGroup"}),{className:d,row:i=!1,...c}=o,r=ce(),a=Se({props:o,muiFormControl:r,states:["error"]}),b={...o,row:i,error:a.error},v=_e(b);return e.jsx(Ge,{className:se(v.root,d),ownerState:b,ref:s,...c})}),qe=ue(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),$e=ue(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"})),Oe=_("span",{name:"MuiRadioButtonIcon",shouldForwardProp:he})({position:"relative",display:"flex"}),Ve=_(qe,{name:"MuiRadioButtonIcon"})({transform:"scale(1)"}),Ke=_($e,{name:"MuiRadioButtonIcon"})(pe(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function ve(t){const{checked:n=!1,classes:s={},fontSize:o}=t,d={...t,checked:n};return e.jsxs(Oe,{className:s.root,ownerState:d,children:[e.jsx(Ve,{fontSize:o,className:s.background,ownerState:d}),e.jsx(Ke,{fontSize:o,className:s.dot,ownerState:d})]})}const Ce=m.createContext(void 0);function Ye(){return m.useContext(Ce)}function Ze(t){return ee("MuiRadio",t)}const ie=te("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Je=t=>{const{classes:n,color:s,size:o}=t,d={root:["root",`color${O(s)}`,o!=="medium"&&`size${O(o)}`]};return{...n,...ae(d,Ze,n)}},Qe=_(Ie,{shouldForwardProp:t=>he(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,s.size!=="medium"&&n[`size${O(s.size)}`],n[`color${O(s.color)}`]]}})(pe(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${ie.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.action.active,(t.vars||t).palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(le()).map(([n])=>({props:{color:n,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.alpha((t.vars||t).palette[n].main,(t.vars||t).palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(le()).map(([n])=>({props:{color:n,disabled:!1},style:{[`&.${ie.checked}`]:{color:(t.vars||t).palette[n].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function Xe(t,n){return typeof n=="object"&&n!==null?t===n:String(t)===String(n)}const et=e.jsx(ve,{checked:!0}),tt=e.jsx(ve,{}),Z=m.forwardRef(function(n,s){const o=de({props:n,name:"MuiRadio"}),{checked:d,checkedIcon:i=et,color:c="primary",icon:r=tt,name:a,onChange:b,size:v="medium",className:w,disabled:L,disableRipple:I=!1,slots:u={},slotProps:T={},inputProps:P,...H}=o,x=ce();let f=L;x&&typeof f>"u"&&(f=x.disabled),f??=!1;const N={...o,disabled:f,disableRipple:I,color:c,size:v},F=Je(N),l=Ye();let j=d;const q=we(b,l&&l.onChange);let M=a;l&&(typeof j>"u"&&(j=Xe(l.value,o.value)),typeof M>"u"&&(M=l.name));const B=T.input??P,[$,ye]=ke("root",{ref:s,elementType:Qe,className:se(F.root,w),shouldForwardComponentProp:!0,externalForwardedProps:{slots:u,slotProps:T,...H},getSlotProps:re=>({...re,onChange:(oe,...ne)=>{re.onChange?.(oe,...ne),q(oe,...ne)}}),ownerState:N,additionalProps:{type:"radio",icon:m.cloneElement(r,{fontSize:r.props.fontSize??v}),checkedIcon:m.cloneElement(i,{fontSize:i.props.fontSize??v}),disabled:f,name:M,checked:j,slots:u,slotProps:{input:typeof B=="function"?B(N):B}}});return e.jsx($,{...ye,classes:F})});function st(t){return ee("MuiRadioGroup",t)}te("MuiRadioGroup",["root","row","error"]);const at=t=>{const{classes:n,row:s,error:o}=t;return ae({root:["root",s&&"row",o&&"error"]},st,n)},rt=m.forwardRef(function(n,s){const{actions:o,children:d,className:i,defaultValue:c,name:r,onChange:a,value:b,...v}=n,w=m.useRef(null),L=at(n),[I,u]=Te({controlled:b,default:c,name:"RadioGroup"});m.useImperativeHandle(o,()=>({focus:()=>{let x=w.current.querySelector("input:not(:disabled):checked");x||(x=w.current.querySelector("input:not(:disabled)")),x&&x.focus()}}),[]);const T=Pe(s,w),P=Me(r),H=m.useMemo(()=>({name:P,onChange(x){u(x.target.value),a&&a(x,x.target.value)},value:I}),[P,a,u,I]);return e.jsx(Ce.Provider,{value:H,children:e.jsx(X,{role:"radiogroup",ref:T,className:se(L.root,i),...v,children:d})})});function ot({config:t,onChange:n}){const{t:s}=G(),{refreshSettings:o}=ge(),d=i=>{n({...t,showWatermark:i}),localStorage.setItem("showWatermark",String(i)),setTimeout(()=>o(),100)};return e.jsx(C,{spacing:4,children:e.jsxs(g,{children:[e.jsxs(h,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(V,{sx:{mr:1}})," ",s("settings.basicConfig")]}),e.jsx(k,{sx:{mb:3}}),e.jsxs(C,{spacing:3,children:[e.jsx(p,{label:s("settings.siteName"),value:t.siteName||"",onChange:i=>n({...t,siteName:i.target.value}),helperText:s("settings.displayOnTitle"),fullWidth:!0}),e.jsx(y,{control:e.jsx(U,{checked:t.showWatermark??!1,onChange:i=>d(i.target.checked)}),label:e.jsxs(g,{children:[e.jsx(h,{variant:"body1",children:s("settings.showWatermark")}),e.jsx(h,{variant:"caption",color:"text.secondary",children:s("settings.showWatermarkHelper")})]})})]})]})})}function nt({config:t,onChange:n}){const{t:s}=G(),[o,d]=m.useState(null),[i,c]=m.useState({open:!1,success:!1,message:""}),r=async a=>{d(a);try{let b;if(a==="feishu"){if(!t.feishuWebhook){c({open:!0,success:!1,message:s("settings.testNotificationEmptyWebhook")});return}b=await W.testFeishuNotification({webhook:t.feishuWebhook,secret:t.feishuSecret})}else if(a==="dingtalk"){if(!t.dingTalkWebhook){c({open:!0,success:!1,message:s("settings.testNotificationEmptyWebhook")});return}b=await W.testDingtalkNotification({webhook:t.dingTalkWebhook,secret:t.dingTalkSecret})}else if(a==="wechat"){if(!t.wechatCorpId||!t.wechatAgentId||!t.wechatSecret){c({open:!0,success:!1,message:s("settings.testNotificationMissingConfig")});return}b=await W.testWechatNotification({corpId:t.wechatCorpId,agentId:t.wechatAgentId,secret:t.wechatSecret})}c({open:!0,success:b?.success||!1,message:b?.message||s("settings.testNotificationSuccess")})}catch(b){console.error("Test notification failed:",b),c({open:!0,success:!1,message:b?.response?.data?.message||b?.message||s("settings.testNotificationFailed")})}finally{d(null)}};return e.jsxs(C,{spacing:4,children:[e.jsxs(g,{children:[e.jsxs(h,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(xe,{sx:{mr:1}})," ",s("settings.feishuNotification")]}),e.jsx(k,{sx:{mb:3}}),e.jsxs(C,{spacing:3,children:[e.jsx(y,{control:e.jsx(U,{checked:t.enableFeishu,onChange:a=>n({...t,enableFeishu:a.target.checked})}),label:s("settings.enableFeishuBot")}),e.jsx(p,{label:s("settings.feishuWebhook"),value:t.feishuWebhook,onChange:a=>n({...t,feishuWebhook:a.target.value}),disabled:!t.enableFeishu,placeholder:"https://open.feishu.cn/open-apis/bot/v2/hook/..."}),e.jsx(p,{label:s("settings.feishuSecret"),value:t.feishuSecret,onChange:a=>n({...t,feishuSecret:a.target.value}),disabled:!t.enableFeishu,helperText:s("settings.feishuSecretHelper")}),t.enableFeishu&&e.jsx(E,{variant:"outlined",size:"small",startIcon:e.jsx(K,{}),onClick:()=>r("feishu"),disabled:o!==null,sx:{alignSelf:"flex-start"},children:s(o==="feishu"?"settings.testing":"settings.testFeishuNotification")})]})]}),e.jsxs(g,{children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:s("settings.dingtalkNotification")}),e.jsx(k,{sx:{mb:3}}),e.jsxs(C,{spacing:3,children:[e.jsx(y,{control:e.jsx(U,{checked:t.enableDingTalk,onChange:a=>n({...t,enableDingTalk:a.target.checked})}),label:s("settings.enableDingtalkBot")}),e.jsx(p,{label:s("settings.dingtalkWebhook"),value:t.dingTalkWebhook,onChange:a=>n({...t,dingTalkWebhook:a.target.value}),disabled:!t.enableDingTalk,placeholder:"https://oapi.dingtalk.com/robot/send?access_token=..."}),e.jsx(p,{label:s("settings.dingtalkSecret"),value:t.dingTalkSecret,onChange:a=>n({...t,dingTalkSecret:a.target.value}),disabled:!t.enableDingTalk,helperText:s("settings.dingtalkSecretHelper")}),t.enableDingTalk&&e.jsx(E,{variant:"outlined",size:"small",startIcon:e.jsx(K,{}),onClick:()=>r("dingtalk"),disabled:o!==null,sx:{alignSelf:"flex-start"},children:s(o==="dingtalk"?"settings.testing":"settings.testDingtalkNotification")})]})]}),e.jsxs(g,{children:[e.jsx(h,{variant:"h6",gutterBottom:!0,children:s("settings.wechatNotification")}),e.jsx(k,{sx:{mb:3}}),e.jsxs(C,{spacing:3,children:[e.jsx(y,{control:e.jsx(U,{checked:t.enableWeChat,onChange:a=>n({...t,enableWeChat:a.target.checked})}),label:s("settings.enableWechatNotification")}),e.jsxs(g,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:3},children:[e.jsx(p,{label:s("settings.wechatCorpId"),value:t.wechatCorpId,onChange:a=>n({...t,wechatCorpId:a.target.value}),disabled:!t.enableWeChat}),e.jsx(p,{label:s("settings.wechatAgentId"),value:t.wechatAgentId,onChange:a=>n({...t,wechatAgentId:a.target.value}),disabled:!t.enableWeChat}),e.jsx(p,{label:s("settings.wechatSecret"),value:t.wechatSecret,onChange:a=>n({...t,wechatSecret:a.target.value}),disabled:!t.enableWeChat})]}),t.enableWeChat&&e.jsx(E,{variant:"outlined",size:"small",startIcon:e.jsx(K,{}),onClick:()=>r("wechat"),disabled:o!==null,sx:{alignSelf:"flex-start"},children:s(o==="wechat"?"settings.testing":"settings.testWechatNotification")})]})]}),e.jsx(ze,{open:i.open,autoHideDuration:6e3,onClose:()=>c({...i,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(S,{onClose:()=>c({...i,open:!1}),severity:i.success?"success":"error",icon:i.success?e.jsx(R,{}):e.jsx(We,{}),sx:{width:"100%"},children:i.message})})]})}function lt({config:t,onChange:n}){const{t:s}=G(),o=r=>{n({...t,authMethod:r,passwordLogin:{...t.passwordLogin,enabled:r==="password"},sso:{...t.sso,enabled:r==="sso"},ldap:{...t.ldap,enabled:r==="ldap"}})},d=(r,a)=>{n({...t,passwordLogin:{...t.passwordLogin,[r]:a}})},i=(r,a)=>{n({...t,sso:{...t.sso,[r]:a}})},c=(r,a)=>{n({...t,ldap:{...t.ldap,[r]:a}})};return e.jsxs(g,{children:[e.jsx(h,{variant:"h6",gutterBottom:!0,fontWeight:"600",children:s("settings.authConfig")}),e.jsx(h,{variant:"body2",color:"text.secondary",paragraph:!0,children:s("settings.authConfigDesc")}),e.jsx(S,{severity:"warning",sx:{mb:3},children:s("settings.authWarning")}),e.jsx(D,{sx:{p:3,mb:3},children:e.jsxs(me,{component:"fieldset",children:[e.jsx(Ue,{component:"legend",sx:{fontWeight:600,color:"text.primary",mb:2},children:s("settings.selectAuthMethod")}),e.jsxs(rt,{value:t.authMethod,onChange:r=>o(r.target.value),children:[e.jsx(y,{value:"password",control:e.jsx(Z,{}),label:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(J,{fontSize:"small"}),e.jsx(h,{children:s("settings.passwordAuthTitle")})]})}),e.jsx(y,{value:"sso",control:e.jsx(Z,{}),label:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{fontSize:"small"}),e.jsx(h,{children:s("settings.ssoAuthTitle")})]})}),e.jsx(y,{value:"ldap",control:e.jsx(Z,{}),label:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(V,{fontSize:"small"}),e.jsx(h,{children:s("settings.ldapAuthTitle")})]})})]})]})}),t.authMethod==="password"&&e.jsxs(D,{sx:{p:3,mb:3},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(J,{color:"primary"}),e.jsx(h,{variant:"h6",fontWeight:"600",children:s("settings.passwordAuthConfig")})]}),e.jsx(k,{sx:{mb:3}}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(p,{fullWidth:!0,label:s("settings.minPasswordLengthLabel"),type:"number",value:t.passwordLogin.passwordMinLength,onChange:r=>d("passwordMinLength",parseInt(r.target.value)),helperText:s("settings.minPasswordLengthHelper")}),e.jsx(p,{fullWidth:!0,label:s("settings.sessionTimeoutLabel"),type:"number",value:t.passwordLogin.sessionTimeout,onChange:r=>d("sessionTimeout",parseInt(r.target.value)),helperText:s("settings.sessionTimeoutHelperText")}),e.jsx(X,{children:e.jsx(y,{control:e.jsx(U,{checked:t.passwordLogin.passwordComplexity,onChange:r=>d("passwordComplexity",r.target.checked)}),label:s("settings.passwordComplexityLabel")})})]})]}),t.authMethod==="sso"&&e.jsxs(D,{sx:{p:3,mb:3},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(Q,{color:"primary"}),e.jsx(h,{variant:"h6",fontWeight:"600",children:s("settings.ssoAuthConfig")})]}),e.jsx(k,{sx:{mb:3}}),e.jsxs(S,{severity:"info",sx:{mb:3},children:[e.jsx(h,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:s("settings.ssoExampleTitle")})}),e.jsxs(h,{variant:"body2",component:"div",sx:{fontFamily:"monospace",fontSize:"0.85rem",lineHeight:1.6},children:[s("settings.ssoExampleProvider"),e.jsx("br",{}),s("settings.ssoExampleAuthUrl"),e.jsx("br",{}),s("settings.ssoExampleTokenUrl"),e.jsx("br",{}),s("settings.ssoExampleUserInfoUrl"),e.jsx("br",{}),s("settings.ssoExampleScopes")]}),e.jsx(h,{variant:"body2",sx:{mt:1,color:"text.secondary"},children:s("settings.ssoExampleNote")})]}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(p,{fullWidth:!0,label:s("settings.providerLabel"),value:t.sso.provider,onChange:r=>i("provider",r.target.value),helperText:s("settings.providerHelper")}),e.jsx(p,{fullWidth:!0,label:s("settings.clientIdLabel"),value:t.sso.clientId,onChange:r=>i("clientId",r.target.value),helperText:s("settings.clientIdHelper"),required:!0}),e.jsx(p,{fullWidth:!0,label:s("settings.clientSecretLabel"),type:"password",value:t.sso.clientSecret,onChange:r=>i("clientSecret",r.target.value),helperText:s("settings.clientSecretHelper"),required:!0}),e.jsx(p,{fullWidth:!0,label:s("settings.authUrlLabel"),value:t.sso.authUrl,onChange:r=>i("authUrl",r.target.value),placeholder:s("settings.authUrlPlaceholder"),helperText:s("settings.authUrlHelper"),required:!0}),e.jsx(p,{fullWidth:!0,label:s("settings.tokenUrlLabel"),value:t.sso.tokenUrl,onChange:r=>i("tokenUrl",r.target.value),placeholder:s("settings.tokenUrlPlaceholder"),helperText:s("settings.tokenUrlHelper"),required:!0}),e.jsx(p,{fullWidth:!0,label:s("settings.userInfoUrlLabel"),value:t.sso.userInfoUrl,onChange:r=>i("userInfoUrl",r.target.value),placeholder:s("settings.userInfoUrlPlaceholder"),helperText:s("settings.userInfoUrlHelper"),required:!0}),e.jsx(p,{fullWidth:!0,label:s("settings.redirectUrlLabel"),value:t.sso.redirectUrl,onChange:r=>i("redirectUrl",r.target.value),placeholder:s("settings.redirectUrlPlaceholder"),helperText:s("settings.redirectUrlHelper"),required:!0}),e.jsx(p,{fullWidth:!0,label:s("settings.scopesLabel"),value:t.sso.scopes,onChange:r=>i("scopes",r.target.value),placeholder:s("settings.scopesPlaceholder"),helperText:s("settings.scopesHelper2")})]})]}),t.authMethod==="ldap"&&e.jsxs(D,{sx:{p:3,mb:3},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(V,{color:"primary"}),e.jsx(h,{variant:"h6",fontWeight:"600",children:s("settings.ldapAuthConfig")})]}),e.jsx(k,{sx:{mb:3}}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(p,{fullWidth:!0,label:s("settings.ldapServerLabel"),value:t.ldap.server,onChange:r=>c("server",r.target.value),placeholder:s("settings.ldapServerPlaceholder"),required:!0}),e.jsx(p,{fullWidth:!0,label:s("settings.portLabel"),type:"number",value:t.ldap.port,onChange:r=>c("port",parseInt(r.target.value)),helperText:s("settings.portHelper"),required:!0}),e.jsx(p,{fullWidth:!0,label:s("settings.bindDnLabel"),value:t.ldap.bindDn,onChange:r=>c("bindDn",r.target.value),placeholder:s("settings.bindDnPlaceholder"),helperText:s("settings.bindDnHelper"),required:!0}),e.jsx(p,{fullWidth:!0,label:s("settings.bindPasswordLabel"),type:"password",value:t.ldap.bindPassword,onChange:r=>c("bindPassword",r.target.value),helperText:s("settings.bindPasswordHelper"),required:!0}),e.jsx(p,{fullWidth:!0,label:s("settings.baseDnLabel"),value:t.ldap.baseDn,onChange:r=>c("baseDn",r.target.value),placeholder:s("settings.baseDnPlaceholder"),helperText:s("settings.baseDnHelper"),required:!0}),e.jsx(p,{fullWidth:!0,label:s("settings.userFilterLabel"),value:t.ldap.userFilter,onChange:r=>c("userFilter",r.target.value),placeholder:s("settings.userFilterPlaceholder"),helperText:s("settings.userFilterHelper2"),required:!0}),e.jsx(X,{children:e.jsx(y,{control:e.jsx(U,{checked:t.ldap.useTLS,onChange:r=>c("useTLS",r.target.checked)}),label:s("settings.enableTlsLabel")})})]})]}),e.jsx(S,{severity:"info",children:e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:s("settings.currentAuthStatus")}),t.authMethod==="password"&&s("settings.passwordAuthStatus"),t.authMethod==="sso"&&s("settings.ssoAuthStatus"),t.authMethod==="ldap"&&s("settings.ldapAuthStatus")]})})]})}function it(){const{t}=G(),[n,s]=m.useState(!1),[o,d]=m.useState({enabled:!0,interval:5,method:"tcp",timeout:3,concurrent:20});m.useEffect(()=>{i()},[]);const i=async()=>{s(!0);try{const a=await W.getSettingsByCategory("host_monitor");a&&d({enabled:a.host_monitor_enabled==="true",interval:parseInt(a.host_monitor_interval)||5,method:a.host_monitor_method||"tcp",timeout:parseInt(a.host_monitor_timeout)||3,concurrent:parseInt(a.host_monitor_concurrent)||20})}catch(a){console.error("Failed to load host monitor config:",a)}finally{s(!1)}},c=(a,b)=>{d(v=>({...v,[a]:b}))},r=async()=>{try{const a={host_monitor:{host_monitor_enabled:o.enabled.toString(),host_monitor_interval:o.interval.toString(),host_monitor_method:o.method,host_monitor_timeout:o.timeout.toString(),host_monitor_concurrent:o.concurrent.toString()}};await W.updateSettings(a),je(t("settings.saveSuccess"))}catch(a){console.error("Failed to save host monitor config:",a),alert(t("settings.saveError"))}};return n?e.jsx(g,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(Le,{})}):e.jsxs(g,{children:[e.jsxs(C,{direction:"row",spacing:2,alignItems:"center",mb:2,children:[e.jsx(be,{color:"primary",sx:{fontSize:28}}),e.jsxs(g,{children:[e.jsx(h,{variant:"h6",children:t("settings.hostMonitorTitle")}),e.jsx(h,{variant:"body2",color:"text.secondary",children:t("settings.hostMonitorDesc")})]})]}),e.jsx(k,{sx:{mb:3}}),e.jsx(S,{severity:"info",icon:e.jsx(Fe,{}),sx:{mb:3},children:t("settings.monitorMethodHelper")}),e.jsx(D,{elevation:0,sx:{p:3,bgcolor:"background.default",mb:3},children:e.jsxs(C,{spacing:3,children:[e.jsx(y,{control:e.jsx(U,{checked:o.enabled,onChange:a=>c("enabled",a.target.checked),color:"primary"}),label:e.jsxs(g,{children:[e.jsx(h,{variant:"body1",children:t("settings.enableHostMonitor")}),e.jsx(h,{variant:"caption",color:"text.secondary",children:t("settings.enableHostMonitorHelper")})]})}),e.jsxs(me,{fullWidth:!0,disabled:!o.enabled,children:[e.jsx(Re,{children:t("settings.monitorMethod")}),e.jsxs(De,{value:o.method,label:t("settings.monitorMethod"),onChange:a=>c("method",a.target.value),children:[e.jsx(Y,{value:"tcp",children:e.jsxs(C,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(R,{fontSize:"small",color:"primary"}),e.jsx(h,{children:t("settings.monitorMethodTCP")})]})}),e.jsx(Y,{value:"icmp",children:e.jsxs(C,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(R,{fontSize:"small",color:"secondary"}),e.jsx(h,{children:t("settings.monitorMethodICMP")})]})}),e.jsx(Y,{value:"http",children:e.jsxs(C,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(R,{fontSize:"small",color:"success"}),e.jsx(h,{children:t("settings.monitorMethodHTTP")})]})})]}),e.jsxs(He,{children:[o.method==="tcp"&&t("settings.monitorMethodTCPHelper"),o.method==="icmp"&&t("settings.monitorMethodICMPHelper"),o.method==="http"&&t("settings.monitorMethodHTTPHelper")]})]}),e.jsx(p,{fullWidth:!0,type:"number",label:t("settings.monitorInterval"),value:o.interval,onChange:a=>c("interval",parseInt(a.target.value)),disabled:!o.enabled,helperText:t("settings.monitorIntervalHelper"),InputProps:{inputProps:{min:1,max:60}}}),e.jsx(p,{fullWidth:!0,type:"number",label:t("settings.monitorTimeout"),value:o.timeout,onChange:a=>c("timeout",parseInt(a.target.value)),disabled:!o.enabled,helperText:t("settings.monitorTimeoutHelper"),InputProps:{inputProps:{min:1,max:30}}}),e.jsx(p,{fullWidth:!0,type:"number",label:t("settings.monitorConcurrent"),value:o.concurrent,onChange:a=>c("concurrent",parseInt(a.target.value)),disabled:!o.enabled,helperText:t("settings.monitorConcurrentHelper"),InputProps:{inputProps:{min:1,max:100}}})]})}),o.enabled&&e.jsx(S,{severity:"success",icon:e.jsx(R,{}),children:e.jsx(h,{variant:"body2",children:t("settings.monitorConfigSummary",{interval:o.interval,method:o.method==="tcp"?t("settings.monitorMethodTCP"):o.method==="icmp"?t("settings.monitorMethodICMP"):t("settings.monitorMethodHTTP"),timeout:o.timeout,concurrent:o.concurrent})})}),!o.enabled&&e.jsx(S,{severity:"warning",children:e.jsx(h,{variant:"body2",children:t("settings.monitorDisabledMessage")})}),e.jsx(g,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:e.jsx(E,{variant:"contained",size:"large",startIcon:e.jsx(fe,{}),onClick:r,children:t("common.save")})})]})}function A(t){const{children:n,value:s,index:o,...d}=t;return e.jsx("div",{role:"tabpanel",hidden:s!==o,id:`settings-tabpanel-${o}`,"aria-labelledby":`settings-tab-${o}`,...d,children:s===o&&e.jsx(g,{sx:{py:3},children:n})})}function xt(){const{t}=G(),{refreshSettings:n}=ge(),[s,o]=m.useState(0),[d,i]=m.useState(!1),[c,r]=m.useState(!0),[a,b]=m.useState(!1),[v,w]=m.useState({siteName:"KeyOps",showWatermark:!1}),[L,I]=m.useState({enableFeishu:!1,feishuWebhook:"",feishuSecret:"",enableDingTalk:!1,dingTalkWebhook:"",dingTalkSecret:"",enableWeChat:!1,wechatCorpId:"",wechatAgentId:"",wechatSecret:""}),[u,T]=m.useState({authMethod:"password",passwordLogin:{enabled:!0,passwordMinLength:8,passwordComplexity:!0,sessionTimeout:30},sso:{enabled:!1,provider:"",clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",redirectUrl:"",scopes:"openid email profile"},ldap:{enabled:!1,server:"",port:389,bindDn:"",bindPassword:"",baseDn:"",userFilter:"(uid={username})",useTLS:!1}}),P=async()=>{try{r(!0);const x=await W.getAllSettings(),f={};Array.isArray(x)?x.forEach(l=>{f[l.category]||(f[l.category]={}),f[l.category][l.key]=l.value}):typeof x=="object"&&Object.keys(x).forEach(l=>{const j=x[l];typeof j=="object"&&(f[l]=j)});const N=l=>{if(typeof l!="string")return l;if(l==="true")return!0;if(l==="false")return!1;if(/^\d+$/.test(l)){const j=parseInt(l,10);if(!isNaN(j))return j}if(/^\d+\.\d+$/.test(l)){const j=parseFloat(l);if(!isNaN(j))return j}return l},F=(l,j)=>{const q={};for(const[M,B]of Object.entries(l)){let $=M;j&&M.startsWith(`${j}.`)&&($=M.substring(j.length+1)),q[$]=N(B)}return q};if(f.system&&w(l=>({...l,...F(f.system,"system")})),f.notification&&I(l=>({...l,...F(f.notification)})),f.auth){const l=F(f.auth),j={authMethod:l.authMethod||"password",passwordLogin:{enabled:l.passwordLoginEnabled??!0,passwordMinLength:l.passwordMinLength||8,passwordComplexity:l.passwordComplexity??!0,sessionTimeout:l.passwordSessionTimeout||30},sso:{enabled:l.ssoEnabled??!1,provider:l.ssoProvider||"",clientId:l.ssoClientId||"",clientSecret:l.ssoClientSecret||"",authUrl:l.ssoAuthUrl||"",tokenUrl:l.ssoTokenUrl||"",userInfoUrl:l.ssoUserInfoUrl||"",redirectUrl:l.ssoRedirectUrl||"",scopes:l.ssoScopes||"openid email profile"},ldap:{enabled:l.ldapEnabled??!1,server:l.ldapServer||"",port:l.ldapPort||389,bindDn:l.ldapBindDn||"",bindPassword:l.ldapBindPassword||"",baseDn:l.ldapBaseDn||"",userFilter:l.ldapUserFilter||"(uid={username})",useTLS:l.ldapUseTLS??!1}};T(j)}}catch(x){console.error("Failed to load settings:",x)}finally{r(!1)}};m.useEffect(()=>{P()},[]);const H=async()=>{try{b(!0);const x={authMethod:u.authMethod,passwordLoginEnabled:u.passwordLogin.enabled,passwordMinLength:u.passwordLogin.passwordMinLength,passwordComplexity:u.passwordLogin.passwordComplexity,passwordSessionTimeout:u.passwordLogin.sessionTimeout,ssoEnabled:u.sso.enabled,ssoProvider:u.sso.provider,ssoClientId:u.sso.clientId,ssoClientSecret:u.sso.clientSecret,ssoAuthUrl:u.sso.authUrl,ssoTokenUrl:u.sso.tokenUrl,ssoUserInfoUrl:u.sso.userInfoUrl,ssoRedirectUrl:u.sso.redirectUrl,ssoScopes:u.sso.scopes,ldapEnabled:u.ldap.enabled,ldapServer:u.ldap.server,ldapPort:u.ldap.port,ldapBindDn:u.ldap.bindDn,ldapBindPassword:u.ldap.bindPassword,ldapBaseDn:u.ldap.baseDn,ldapUserFilter:u.ldap.userFilter,ldapUseTLS:u.ldap.useTLS},f={system:v,notification:L,auth:x};await W.updateSettings(f),i(!0),je(t("settings.saveSuccess")),setTimeout(()=>i(!1),3e3),await n(),await P()}catch(x){console.error("Failed to save settings:",x),alert(t("settings.saveFailed")+": "+x.message)}finally{b(!1)}};return e.jsxs(g,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Ne,{sx:{fontSize:40,mr:2,color:"primary.main"}}),e.jsxs(g,{children:[e.jsx(h,{variant:"h4",component:"h1",fontWeight:"700",children:t("settings.title")}),e.jsx(h,{variant:"body2",color:"text.secondary",children:t("settings.adminConfig")})]})]}),c&&e.jsx(S,{severity:"info",sx:{mb:3},children:t("settings.loadingConfig")}),d&&e.jsx(S,{severity:"success",sx:{mb:3},icon:e.jsx(R,{}),children:t("settings.saveSuccessRestart")}),e.jsxs(D,{sx:{borderRadius:2,overflow:"hidden"},children:[e.jsxs(Be,{value:s,onChange:(x,f)=>o(f),variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider",bgcolor:"background.paper","& .MuiTab-root":{minHeight:64}},children:[e.jsx(z,{icon:e.jsx(V,{}),label:t("settings.systemConfig")}),e.jsx(z,{icon:e.jsx(xe,{}),label:t("settings.notificationConfig")}),e.jsx(z,{icon:e.jsx(J,{}),label:t("settings.authConfig")}),e.jsx(z,{icon:e.jsx(Q,{}),label:t("settings.twoFactor.title")}),e.jsx(z,{icon:e.jsx(be,{}),label:t("settings.hostMonitorConfig")})]}),e.jsxs(g,{sx:{px:3,maxWidth:1200},children:[e.jsx(A,{value:s,index:0,children:e.jsx(ot,{config:v,onChange:w})}),e.jsx(A,{value:s,index:1,children:e.jsx(nt,{config:L,onChange:I})}),e.jsx(A,{value:s,index:2,children:e.jsx(lt,{config:u,onChange:T})}),e.jsx(A,{value:s,index:3,children:e.jsx(Ae,{showGlobalConfig:!0})}),e.jsx(A,{value:s,index:4,children:e.jsx(it,{})})]}),[0,1,2].includes(s)&&e.jsx(g,{sx:{px:3,pb:3,display:"flex",justifyContent:"flex-end",gap:2},children:e.jsx(E,{variant:"contained",size:"large",startIcon:e.jsx(fe,{}),onClick:H,disabled:a,children:t(a?"common.saving":"common.save")})})]})]})}export{xt as default};
