import{u as Y,ax as $,b1 as q,r,c2 as v,j as e,B as n,C as z,T as l,I as H,v as J,K as G,c as U,V,bo as T,w as m,x as h,c7 as _,b as Q,z as Z}from"./index-STo1oTDL.js";import{g as ee}from"./websocket-kpX-T68k.js";import{R as D,T as I,C as se,X as te,Y as ae,L as oe}from"./CartesianChart-DTG_C87E.js";import{P as re,a as ne}from"./PieChart-aYPvio61.js";import{C as ie}from"./tooltipContext-B2CQC3Eu.js";import{L as le}from"./LineChart-X3O_N_Nd.js";import{L as ce}from"./Line-CRFNg42D.js";import{T as de,a as xe,b as me,c as b,d as o,e as he}from"./TableRow-e9fRaRV7.js";import{C as L}from"./Chip-v5QMYL72.js";import{S as fe}from"./Snackbar-hEMhwoCf.js";import"./value-BSrK5PS5.js";function Te(){const{t}=Y(),W=$(),{addSession:k}=q(),[R,f]=r.useState(!0),[d,E]=r.useState(null),[p,N]=r.useState([]),[y,g]=r.useState(null),[F,P]=r.useState([]),[S,A]=r.useState([]),[B,w]=r.useState(""),[K,x]=r.useState(!1),j=r.useCallback(async()=>{f(!0);try{const[s,a]=await Promise.all([v.getStats(),v.getFrequentHosts(5)]);E(s);const c=a.map(i=>({...i,tags:typeof i.tags=="string"?JSON.parse(i.tags||"[]"):i.tags}));N(c);const O=(localStorage.getItem("language")||"en")==="zh"?"zh-CN":"en-US",C=[];for(let i=6;i>=0;i--){const u=new Date;u.setDate(u.getDate()-i);const X=u.toLocaleDateString(O,{month:"short",day:"numeric"});C.push({date:X,count:Math.floor(Math.random()*20)+5})}P(C),s&&A([{name:t("dashboard.onlineHosts"),value:s.onlineHosts},{name:t("dashboard.offlineHosts"),value:s.offlineHosts}]),f(!1)}catch(s){console.error("Failed to load data:",s),f(!1)}},[t]);r.useEffect(()=>{j()},[j]);const M=async s=>{g(s);try{let a=p.find(c=>c.id===s);if(a||(a=await Z.getHost(s),a&&typeof a.tags=="string"&&(a.tags=JSON.parse(a.tags||"[]"))),!a){w(t("dashboard.hostNotFound")),x(!0),g(null);return}k(a),W("/terminal")}catch(a){const c=a instanceof Error?a.message:t("dashboard.connectFailed");w(c),x(!0)}finally{g(null)}};return R?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(z,{})}):e.jsxs(n,{children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(l,{variant:"h4",component:"h1",children:t("systemDashboard.title")}),e.jsx(H,{onClick:j,color:"primary",children:e.jsx(J,{})})]}),e.jsx(n,{sx:{display:"flex",gap:2.5,mb:3,flexWrap:{xs:"wrap",sm:"nowrap"}},children:[{label:t("dashboard.totalHosts"),value:d?.totalHosts||0,icon:G,color:"#3182ce",bg:"#ebf8ff"},{label:t("dashboard.onlineHosts"),value:d?.onlineHosts||0,icon:U,color:"#38a169",bg:"#f0fff4"},{label:t("dashboard.offlineHosts"),value:d?.offlineHosts||0,icon:V,color:"#e53e3e",bg:"#fff5f5"},{label:t("dashboard.todayLogins"),value:d?.recentLogins||0,icon:T,color:"#805ad5",bg:"#faf5ff"}].map((s,a)=>e.jsx(n,{sx:{flex:1,minWidth:{xs:"100%",sm:0}},children:e.jsx(m,{elevation:0,sx:{border:"1px solid #e2e8f0",width:"100%",height:{xs:"160px",sm:"180px"},transition:"all 0.3s ease","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.08)",transform:"translateY(-2px)"}},children:e.jsxs(h,{sx:{p:{xs:2.5,sm:3.5},height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(l,{variant:"body2",color:"text.secondary",fontWeight:500,sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.label}),e.jsx(n,{sx:{width:{xs:40,sm:48},height:{xs:40,sm:48},borderRadius:2.5,backgroundColor:s.bg,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(s.icon,{sx:{fontSize:{xs:24,sm:28},color:s.color}})})]}),e.jsx(l,{variant:"h2",fontWeight:"700",color:"text.primary",sx:{fontSize:{xs:"2rem",sm:"3rem"}},children:s.value})]})})},a))}),e.jsx(n,{sx:{mb:3},children:e.jsx(m,{elevation:0,sx:{border:"1px solid #e2e8f0",width:"100%"},children:e.jsxs(h,{sx:{p:{xs:2,sm:3}},children:[e.jsx(l,{variant:"h6",fontWeight:"600",color:"text.primary",mb:2,sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:t("dashboard.hostStatusDistribution")}),e.jsx(D,{width:"100%",height:280,children:e.jsxs(re,{children:[e.jsx(ne,{data:S,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:a})=>`${s}: ${((a??0)*100).toFixed(0)}%`,outerRadius:90,fill:"#8884d8",dataKey:"value",children:S.map((s,a)=>e.jsx(ie,{fill:a===0?"#38a169":"#e53e3e"},`cell-${a}`))}),e.jsx(I,{})]})})]})})}),e.jsx(n,{sx:{mb:3},children:e.jsx(m,{elevation:0,sx:{border:"1px solid #e2e8f0",width:"100%"},children:e.jsxs(h,{sx:{p:{xs:2,sm:3}},children:[e.jsx(l,{variant:"h6",fontWeight:"600",color:"text.primary",mb:2,sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:t("dashboard.loginTrend")}),e.jsx(D,{width:"100%",height:280,children:e.jsxs(le,{data:F,children:[e.jsx(se,{strokeDasharray:"3 3"}),e.jsx(te,{dataKey:"date"}),e.jsx(ae,{}),e.jsx(I,{}),e.jsx(oe,{}),e.jsx(ce,{type:"monotone",dataKey:"count",stroke:"#667eea",strokeWidth:2,name:t("dashboard.loginCount")})]})})]})})}),e.jsx(m,{elevation:0,sx:{mb:3,border:"1px solid #e2e8f0"},children:e.jsxs(h,{sx:{p:0},children:[e.jsx(n,{sx:{px:{xs:2,sm:3},py:2.5,borderBottom:"1px solid #e2e8f0"},children:e.jsx(l,{variant:"h6",fontWeight:"600",color:"text.primary",sx:{fontSize:{xs:"1rem",sm:"1.25rem"}},children:t("dashboard.recentHosts")})}),e.jsx(de,{sx:{overflowX:"auto"},children:e.jsxs(xe,{children:[e.jsx(me,{children:e.jsxs(b,{children:[e.jsx(o,{sx:{fontWeight:700,color:"#667eea",fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:t("dashboard.hostName")}),e.jsx(o,{sx:{fontWeight:700,color:"#667eea",fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:t("assets.hostIP")}),e.jsx(o,{sx:{fontWeight:700,color:"#667eea",fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:t("assets.deviceType")}),e.jsx(o,{sx:{fontWeight:700,color:"#667eea",fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:t("common.status")}),e.jsx(o,{align:"center",sx:{fontWeight:700,color:"#667eea",fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:t("common.actions")})]})}),e.jsx(he,{children:p.length===0?e.jsx(b,{children:e.jsx(o,{colSpan:5,align:"center",sx:{py:8},children:e.jsx(l,{variant:"body1",color:"text.secondary",children:t("dashboard.noHostsData")})})}):p.map(s=>e.jsxs(b,{hover:!0,children:[e.jsx(o,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:e.jsx(l,{fontWeight:600,children:s.name})}),e.jsx(o,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:e.jsx(L,{label:s.ip,size:"small",variant:"outlined",sx:{fontFamily:"monospace"}})}),e.jsx(o,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:s.deviceType?ee(s.deviceType):"-"}),e.jsx(o,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:e.jsx(L,{label:s.status==="online"?t("common.online"):t("common.offline"),color:s.status==="online"?"success":"error",size:"small"})}),e.jsx(o,{align:"center",sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:e.jsx(H,{size:"small",onClick:()=>M(s.id),disabled:s.status!=="online"||y===s.id,sx:{background:s.status==="online"?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"rgba(0,0,0,0.12)",color:"white"},children:y===s.id?e.jsx(z,{size:20,sx:{color:"white"}}):s.deviceType==="windows"?e.jsx(_,{fontSize:"small"}):e.jsx(T,{fontSize:"small"})})})]},s.id))})]})})]})}),e.jsx(fe,{open:K,autoHideDuration:6e3,onClose:()=>x(!1),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(Q,{onClose:()=>x(!1),severity:"error",sx:{width:"100%"},children:B})})]})}export{Te as default};
