import{u as _,r as i,bf as S,j as e,cx as de,B as o,T as m,I as y,aB as xe,D as me,C as ee,b as se,a2 as pe,b9 as T,Z as K,P as Z,bl as he,w as Q,x as U,be as je,bp as ue,cn as fe,v as ge,cj as ke,i as ye,k as be,l as Ce,p as Se,a as X,a7 as we}from"./index-wVs8DYHr.js";import{j as De,k as R}from"./index-BIq8ZW4m.js";import{k as Ie}from"./k8sClusterApi-Bz6qMnao.js";import{C as ve}from"./ClusterSelector-DqWR8dyY.js";import{N as Pe}from"./NamespaceSelector-BppKItkw.js";import{A as z,a as W,b as L}from"./AccordionSummary-C2EhSfe9.js";import{G as E}from"./GridLegacy-D8ppXx7z.js";import{C as w}from"./Chip-DzNpApxT.js";import{T as F,a as Y,b as B,c as f,d as a,e as M}from"./TableRow-17IyVPm2.js";import{P as Te,a as ze}from"./PodLogsDialog-Deovqn3s.js";import{Y as We}from"./YamlViewerDialog-B73aV8Jq.js";import"./utils-DifSMk6h.js";import"./yaml-B1Nq9-gN.js";import"./namespaces-Biqx1aVY.js";import"./xterm-BqYE0GQX.js";import"./Switch-DnfqMs2v.js";function Le({open:t,onClose:b,clusterId:h,namespace:g,podName:u}){const{t:n}=_(),[O,j]=i.useState(!1),[r,D]=i.useState(null),[I,C]=i.useState(null);i.useEffect(()=>{t&&h&&g&&u?k():(D(null),C(null))},[t,h,g,u]);const k=async()=>{try{j(!0),C(null);const c=await De({clusterId:h,namespace:g},u);D(c)}catch(l){const x=l?.response?.data?.message||n("k8s.pods.loadDetailFailed");C(x),S(x)}finally{j(!1)}},d=(l,c)=>c==null||c===""?null:e.jsxs(o,{sx:{mb:1.5},children:[e.jsx(m,{variant:"caption",color:"text.secondary",children:l}),e.jsx(m,{variant:"body2",children:String(c)})]}),A=l=>!l||Object.keys(l).length===0?null:e.jsxs(o,{sx:{mb:2},children:[e.jsx(m,{variant:"subtitle2",sx:{mb:1},children:n("k8s.labels")}),e.jsx(o,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:Object.entries(l).map(([c,x])=>e.jsx(w,{label:`${c}=${x}`,size:"small"},c))})]});return e.jsx(de,{anchor:"right",open:t,onClose:b,PaperProps:{sx:{width:{xs:"100%",sm:"600px",md:"800px"}}},children:e.jsxs(o,{sx:{p:3,height:"100%",overflow:"auto"},children:[e.jsxs(o,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(m,{variant:"h5",sx:{fontWeight:600},children:u}),e.jsx(y,{onClick:b,size:"small",children:e.jsx(xe,{})})]}),e.jsx(me,{sx:{mb:3}}),O?e.jsx(o,{display:"flex",justifyContent:"center",p:4,children:e.jsx(ee,{})}):I?e.jsx(se,{severity:"error",children:I}):r?e.jsxs(e.Fragment,{children:[e.jsxs(z,{defaultExpanded:!0,children:[e.jsx(W,{expandIcon:e.jsx(T,{}),children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(pe,{fontSize:"small"}),e.jsx(m,{variant:"subtitle1",fontWeight:600,children:n("k8s.basicInfo")})]})}),e.jsxs(L,{children:[e.jsxs(E,{container:!0,spacing:2,children:[e.jsxs(E,{item:!0,xs:12,sm:6,children:[d(n("k8s.name"),r.name),d(n("k8s.namespace"),r.namespace),d(n("k8s.status"),r.status),d(n("k8s.node"),r.node),d(n("k8s.pods.podIP"),r.podIP),d(n("k8s.pods.hostIP"),r.hostIP)]}),e.jsxs(E,{item:!0,xs:12,sm:6,children:[d(n("k8s.restarts"),r.restarts),d(n("k8s.age"),r.age),d(n("k8s.pods.qosClass"),r.qosClass),d(n("k8s.pods.serviceAccount"),r.serviceAccount),d(n("k8s.pods.creationTime"),r.creationTimestamp?new Date(r.creationTimestamp).toLocaleString():"-"),d(n("k8s.pods.startTime"),r.startTime?new Date(r.startTime).toLocaleString():"-")]})]}),A(r.labels)]})]}),r.containers&&r.containers.length>0&&e.jsxs(z,{children:[e.jsx(W,{expandIcon:e.jsx(T,{}),children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(K,{fontSize:"small"}),e.jsxs(m,{variant:"subtitle1",fontWeight:600,children:[n("k8s.containers")," (",r.containers.length,")"]})]})}),e.jsx(L,{children:r.containers.map((l,c)=>e.jsxs(o,{sx:{mb:3,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[e.jsx(m,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:l.name}),d(n("k8s.image"),l.image),e.jsxs(o,{sx:{mb:1},children:[e.jsx(m,{variant:"caption",color:"text.secondary",children:n("k8s.status")}),e.jsxs(o,{sx:{mt:.5},children:[e.jsx(w,{label:l.state,color:l.state==="Running"?"success":"default",size:"small",sx:{mr:1}}),e.jsx(w,{label:l.ready?"Ready":"Not Ready",color:l.ready?"success":"warning",size:"small"})]})]}),d(n("k8s.restarts"),l.restartCount)]},c))})]}),r.volumes&&r.volumes.length>0&&e.jsxs(z,{children:[e.jsx(W,{expandIcon:e.jsx(T,{}),children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(K,{fontSize:"small"}),e.jsxs(m,{variant:"subtitle1",fontWeight:600,children:[n("k8s.volumes")," (",r.volumes.length,")"]})]})}),e.jsx(L,{children:e.jsx(F,{component:Z,variant:"outlined",children:e.jsxs(Y,{size:"small",children:[e.jsx(B,{children:e.jsxs(f,{children:[e.jsx(a,{children:n("k8s.name")}),e.jsx(a,{children:n("k8s.type")}),e.jsx(a,{children:n("k8s.config")})]})}),e.jsx(M,{children:r.volumes.map((l,c)=>e.jsxs(f,{children:[e.jsx(a,{children:l.name}),e.jsx(a,{children:l.type}),e.jsx(a,{children:l.config?JSON.stringify(l.config):"-"})]},c))})]})})})]}),r.events&&r.events.length>0&&e.jsxs(z,{children:[e.jsx(W,{expandIcon:e.jsx(T,{}),children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(he,{fontSize:"small"}),e.jsxs(m,{variant:"subtitle1",fontWeight:600,children:[n("k8s.events.title")," (",r.events.length,")"]})]})}),e.jsx(L,{children:e.jsx(F,{component:Z,variant:"outlined",children:e.jsxs(Y,{size:"small",children:[e.jsx(B,{children:e.jsxs(f,{children:[e.jsx(a,{children:n("k8s.type")}),e.jsx(a,{children:n("k8s.reason")}),e.jsx(a,{children:n("k8s.message")}),e.jsx(a,{children:n("k8s.count")}),e.jsx(a,{children:n("k8s.lastSeen")})]})}),e.jsx(M,{children:r.events.map((l,c)=>e.jsxs(f,{children:[e.jsx(a,{children:e.jsx(w,{label:l.type,color:l.type==="Warning"?"warning":"info",size:"small"})}),e.jsx(a,{children:l.reason}),e.jsx(a,{children:l.message}),e.jsx(a,{children:l.count}),e.jsx(a,{children:l.lastSeen})]},c))})]})})})]})]}):null]})})}function Ze(){const{t}=_(),[b,h]=i.useState(!1),[g,u]=i.useState([]),[n,O]=i.useState(""),[j,r]=i.useState(""),[D,I]=i.useState(null),[C,k]=i.useState(!1),[d,A]=i.useState(null),[l,c]=i.useState(!1),[x,v]=i.useState(null),[ne,$]=i.useState(!1),[te,V]=i.useState(!1),[q,G]=i.useState(""),[ae,H]=i.useState(!1),[P,J]=i.useState(null);i.useEffect(()=>{n&&Ie.getCluster(n).then(I).catch(s=>{S(s?.response?.data?.message||"获取集群信息失败")})},[n]);const N=i.useCallback(async()=>{if(!n){S(t("k8s.selectClusterFirst"));return}try{h(!0);const s={clusterId:n,namespace:j||void 0},p=await R.getPodList(s);u(p)}catch(s){const p=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||t("k8s.pods.loadFailed");S(p),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&u([])}finally{h(!1)}},[n,j,t]),re=async()=>{if(!(!d||!n))try{h(!0);const s={clusterId:n,namespace:j||void 0};await R.restartPod(s,d.name),we(t("k8s.pods.restartSuccess")),k(!1),N()}catch(s){const p=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||t("k8s.pods.restartFailed");S(p)}finally{h(!1)}};i.useEffect(()=>{n&&N()},[n,j,N]);const le=s=>s?.toLowerCase().includes("running")||s?.toLowerCase().includes("ready")?"success":s?.toLowerCase().includes("pending")||s?.toLowerCase().includes("waiting")?"warning":s?.toLowerCase().includes("error")||s?.toLowerCase().includes("failed")?"error":"default";return e.jsxs(o,{sx:{width:"100%",p:3},children:[e.jsx(o,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:e.jsxs(o,{children:[e.jsx(m,{variant:"h4",component:"h1",fontWeight:"700",children:t("k8s.pods.title")}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:t("k8s.pods.subtitle")})]})}),e.jsx(Q,{sx:{mb:3},children:e.jsx(U,{children:e.jsxs(o,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(o,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(ve,{value:n,onChange:O,size:"medium",fullWidth:!0,label:t("k8s.selectCluster")})}),n&&e.jsx(o,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(Pe,{value:j,onChange:r,clusterId:n,defaultNamespace:D?.defaultNamespace,size:"medium",fullWidth:!0,label:t("k8s.selectNamespace")})})]})})}),n?b?e.jsx(o,{display:"flex",justifyContent:"center",p:3,children:e.jsx(ee,{})}):e.jsx(Q,{children:e.jsx(U,{children:e.jsx(F,{children:e.jsxs(Y,{children:[e.jsx(B,{children:e.jsxs(f,{children:[e.jsx(a,{children:t("k8s.pods.name")}),e.jsx(a,{children:t("k8s.pods.namespace")}),e.jsx(a,{children:t("k8s.pods.status")}),e.jsx(a,{children:t("k8s.pods.node")}),e.jsx(a,{children:t("k8s.pods.restarts")}),e.jsx(a,{children:t("k8s.pods.age")}),e.jsx(a,{children:t("common.actions")})]})}),e.jsx(M,{children:g.length===0?e.jsx(f,{children:e.jsx(a,{colSpan:7,align:"center",children:e.jsx(m,{color:"textSecondary",children:t("common.noData")})})}):g.map((s,p)=>e.jsxs(f,{children:[e.jsx(a,{children:s.name}),e.jsx(a,{children:s.namespace}),e.jsx(a,{children:e.jsx(w,{label:s.status,color:le(s.status),size:"small"})}),e.jsx(a,{children:s.node}),e.jsx(a,{children:s.restarts||0}),e.jsx(a,{children:s.age||"N/A"}),e.jsx(a,{children:e.jsxs(o,{display:"flex",gap:.5,children:[e.jsx(y,{size:"small",onClick:()=>{v(s),c(!0)},title:t("k8s.pods.viewDetail"),children:e.jsx(je,{fontSize:"small"})}),e.jsx(y,{size:"small",onClick:()=>{console.log("[Pods] Terminal button clicked:",s),v(s),V(!0),console.log("[Pods] Terminal dialog should open now")},title:t("k8s.pods.terminal"),disabled:s.status!=="Running",children:e.jsx(ue,{fontSize:"small"})}),e.jsx(y,{size:"small",onClick:()=>{v(s),$(!0)},title:t("k8s.pods.logs"),children:e.jsx(fe,{fontSize:"small"})}),e.jsx(y,{size:"small",onClick:()=>{A(s),k(!0)},title:t("k8s.pods.restart"),children:e.jsx(ge,{fontSize:"small"})}),e.jsx(y,{size:"small",onClick:()=>{J(s),H(!0)},title:t("k8s.viewYaml"),children:e.jsx(ke,{fontSize:"small"})})]})})]},p))})]})})})}):e.jsx(se,{severity:"info",children:t("k8s.selectClusterFirst")}),e.jsxs(ye,{open:C,onClose:()=>k(!1),children:[e.jsx(be,{children:t("k8s.pods.restart")}),e.jsx(Ce,{children:e.jsx(m,{children:t("k8s.pods.restartConfirm",{name:d?.name})})}),e.jsxs(Se,{children:[e.jsx(X,{onClick:()=>k(!1),children:t("common.cancel")}),e.jsx(X,{onClick:re,variant:"contained",color:"error",disabled:b,children:t("common.confirm")})]})]}),x&&e.jsx(Le,{open:l,onClose:()=>{c(!1),v(null)},clusterId:n,namespace:x.namespace,podName:x.name}),x&&e.jsx(Te,{open:te,onClose:()=>{V(!1),G("")},clusterId:n,namespace:x.namespace,podName:x.name,container:q}),x&&e.jsx(ze,{open:ne,onClose:()=>{$(!1),G("")},clusterId:n,namespace:x.namespace,podName:x.name,container:q}),P&&e.jsx(We,{open:ae,onClose:()=>{H(!1),J(null)},title:`${t("k8s.pods.title")} - ${P.name}`,clusterId:n,namespace:P.namespace,resourceType:"pod",resourceName:P.name,onLoadYaml:async(s,p,ie,oe)=>{const ce={clusterId:s,namespace:p};return await R.getResourceYaml(ce,ie,oe)}})]})}export{Ze as default};
