import{u as W,r,bf as c,j as e,B as l,T as x,I as y,v as z,w as b,x as k,b as Y,C as B,a as D,cz as E,cA as A}from"./index-STo1oTDL.js";import{k as R}from"./k8sClusterApi-7xlxICBp.js";import{g as L}from"./yaml-CjebJvkV.js";import{C as O}from"./ClusterSelector-D_9vFdZX.js";import{N as F}from"./NamespaceSelector-4s1JeenR.js";import{Y as H}from"./YamlViewerDialog-NxVah2E0.js";import{T as P,a as V,b as $,c as f,d as n,e as q}from"./TableRow-e9fRaRV7.js";import"./namespaces-ClIDLtp_.js";import"./utils-Bf2w_ouu.js";function ae(){const{t}=W(),[m,u]=r.useState(!1),[h,j]=r.useState([]),[a,M]=r.useState(""),[g,S]=r.useState(""),[I,T]=r.useState(null),[w,p]=r.useState(!1),[i,d]=r.useState(null);r.useEffect(()=>{a&&R.getCluster(a).then(T).catch(s=>{c(s?.response?.data?.message||"获取集群信息失败")})},[a]);const C=r.useCallback(async()=>{if(!a){c("请先选择集群");return}try{u(!0),j([])}catch(s){const o=s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:"获取ConfigMap列表失败";c(o),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&j([])}finally{u(!1)}},[a]);return r.useEffect(()=>{a&&C()},[a,g]),e.jsxs(l,{sx:{width:"100%",p:3},children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[e.jsxs(l,{children:[e.jsx(x,{variant:"h4",component:"h1",fontWeight:"700",children:t("k8s.configMaps.title","ConfigMaps 管理")}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:t("k8s.configMaps.subtitle","管理配置映射（ConfigMap）")})]}),e.jsx(y,{onClick:C,disabled:!a||m,title:t("common.refresh"),children:e.jsx(z,{})})]}),e.jsx(b,{sx:{mb:3},children:e.jsx(k,{children:e.jsxs(l,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(O,{value:a,onChange:M,size:"medium",fullWidth:!0,label:t("k8s.selectCluster")})}),a&&e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(F,{value:g,onChange:S,clusterId:a,defaultNamespace:I?.defaultNamespace,size:"medium",fullWidth:!0,label:t("k8s.selectNamespace")})})]})})}),a?m?e.jsx(l,{display:"flex",justifyContent:"center",p:3,children:e.jsx(B,{})}):e.jsx(b,{children:e.jsx(k,{children:e.jsx(P,{children:e.jsxs(V,{children:[e.jsx($,{children:e.jsxs(f,{children:[e.jsx(n,{children:t("k8s.configMaps.name","名称")}),e.jsx(n,{children:t("k8s.configMaps.namespace","命名空间")}),e.jsx(n,{children:t("k8s.configMaps.dataCount","数据项数")}),e.jsx(n,{children:t("k8s.configMaps.age","运行时间")}),e.jsx(n,{children:t("common.actions")})]})}),e.jsx(q,{children:h.length===0?e.jsx(f,{children:e.jsx(n,{colSpan:5,align:"center",children:e.jsx(x,{color:"textSecondary",children:t("common.noData")})})}):h.map((s,o)=>e.jsxs(f,{children:[e.jsx(n,{children:s.name}),e.jsx(n,{children:s.namespace}),e.jsx(n,{children:s.data}),e.jsx(n,{children:s.age||"N/A"}),e.jsx(n,{children:e.jsxs(l,{display:"flex",gap:.5,children:[e.jsx(D,{size:"small",variant:"outlined",startIcon:e.jsx(E,{}),onClick:()=>{if(!a){c("请先选择集群");return}d(s),p(!0)},disabled:!a,children:t("k8s.viewDetails","详情")}),e.jsx(y,{size:"small",onClick:()=>{d(s),p(!0)},title:t("k8s.viewYaml"),children:e.jsx(A,{fontSize:"small"})})]})})]},o))})]})})})}):e.jsx(Y,{severity:"info",children:t("k8s.selectClusterFirst")}),i&&e.jsx(H,{open:w,onClose:()=>{p(!1),d(null)},title:`ConfigMap - ${i.name}`,clusterId:a,namespace:i.namespace,resourceType:"configmap",resourceName:i.name,onLoadYaml:async(s,o,v,N)=>await L({clusterId:s,namespace:o},v,N)})]})}export{ae as default};
