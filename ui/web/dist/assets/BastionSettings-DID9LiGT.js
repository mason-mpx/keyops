import{u as w,j as e,B as i,T as h,Z as j,D as b,_ as x,F as M,n as z,o as O,M as I,m,$ as _,a0 as B,a1 as Z,r as u,a2 as q,b as P,c as G,P as J,a3 as K,a4 as D,a as Q,a5 as U,a6 as E,a7 as X}from"./index-STo1oTDL.js";import{S as c}from"./Stack-BJqE2zD7.js";import{S as g}from"./Switch-Do7Epm1v.js";function Y({config:s,onChange:r}){const{t}=w();return e.jsxs(c,{spacing:4,children:[e.jsxs(i,{children:[e.jsxs(h,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(j,{sx:{mr:1}})," ",t("settings.sessionRecording")]}),e.jsx(b,{sx:{mb:3}}),e.jsxs(c,{spacing:3,children:[e.jsx(x,{control:e.jsx(g,{checked:s.enableSessionRecording,onChange:a=>r({...s,enableSessionRecording:a.target.checked})}),label:t("settings.enableSessionRecording")}),e.jsxs(i,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:3},children:[e.jsxs(M,{disabled:!s.enableSessionRecording,children:[e.jsx(z,{children:t("settings.recordingFormatLabel")}),e.jsxs(O,{value:s.recordingFormat,label:t("settings.recordingFormatLabel"),onChange:a=>r({...s,recordingFormat:a.target.value}),children:[e.jsx(I,{value:"asciinema",children:t("settings.asciinemaText")}),e.jsx(I,{value:"mp4",children:t("settings.mp4Video")})]})]}),e.jsx(m,{type:"number",label:t("settings.sessionRetentionDays"),value:s.sessionRetentionDays,onChange:a=>r({...s,sessionRetentionDays:parseInt(a.target.value)}),helperText:t("settings.sessionRetentionHelper"),disabled:!s.enableSessionRecording}),e.jsx(m,{type:"number",label:t("settings.commandRetentionDays"),value:s.commandRetentionDays,onChange:a=>r({...s,commandRetentionDays:parseInt(a.target.value)}),helperText:t("settings.commandRetentionHelper")})]})]})]}),e.jsxs(i,{children:[e.jsxs(h,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(_,{sx:{mr:1}})," ",t("settings.realtimeAuditAlert")]}),e.jsx(b,{sx:{mb:3}}),e.jsxs(c,{spacing:2,children:[e.jsxs(i,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:1.5},children:[e.jsx(x,{control:e.jsx(g,{checked:s.enableRealTimeAudit,onChange:a=>r({...s,enableRealTimeAudit:a.target.checked})}),label:t("settings.enableCommandAudit")}),e.jsx(x,{control:e.jsx(g,{checked:s.enableDangerousCommandAlert,onChange:a=>r({...s,enableDangerousCommandAlert:a.target.checked})}),label:t("settings.dangerousCommandAlert")}),e.jsx(x,{control:e.jsx(g,{checked:s.enableFileTransferAudit,onChange:a=>r({...s,enableFileTransferAudit:a.target.checked})}),label:t("settings.fileTransferAudit")})]}),e.jsx(m,{label:t("settings.alertEmails"),value:s.alertEmails,onChange:a=>r({...s,alertEmails:a.target.value}),placeholder:"admin@example.com, security@example.com",helperText:t("settings.alertEmailsHelper"),disabled:!s.enableDangerousCommandAlert})]})]})]})}function ee({config:s,onChange:r}){const{t}=w();return e.jsxs(c,{spacing:4,children:[e.jsxs(i,{children:[e.jsxs(h,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(B,{sx:{mr:1}}),t("settings.windows.title")]}),e.jsx(b,{sx:{mb:3}}),e.jsx(c,{spacing:2,children:e.jsx(x,{control:e.jsx(g,{checked:s.enableWindowsAccess,onChange:a=>r({...s,enableWindowsAccess:a.target.checked})}),label:t("settings.windows.enableWindows")})})]}),e.jsxs(i,{children:[e.jsxs(h,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(j,{sx:{mr:1}}),t("settings.windows.guacdSection")]}),e.jsx(b,{sx:{mb:3}}),e.jsxs(c,{spacing:3,children:[e.jsxs(i,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:3},children:[e.jsx(m,{label:t("settings.windows.guacdHost"),value:s.guacdHost,onChange:a=>r({...s,guacdHost:a.target.value}),helperText:t("settings.windows.guacdHostHint")}),e.jsx(m,{label:t("settings.windows.guacdPort"),type:"number",value:s.guacdPort,onChange:a=>r({...s,guacdPort:Number(a.target.value)||0}),helperText:t("settings.windows.guacdPortHint")})]}),e.jsxs(c,{spacing:1,children:[e.jsx(x,{control:e.jsx(g,{checked:s.allowClipboard,onChange:a=>r({...s,allowClipboard:a.target.checked})}),label:t("settings.windows.allowClipboard")}),e.jsx(x,{control:e.jsx(g,{checked:s.enableFileTransfer,onChange:a=>r({...s,enableFileTransfer:a.target.checked})}),label:t("settings.windows.enableFileTransfer")}),s.enableFileTransfer&&e.jsx(m,{label:t("settings.windows.drivePath"),value:s.drivePath,onChange:a=>r({...s,drivePath:a.target.value}),helperText:t("settings.windows.drivePathHint")})]})]})]}),e.jsxs(i,{children:[e.jsxs(h,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(j,{sx:{mr:1}}),t("settings.windows.recordingSection")]}),e.jsx(b,{sx:{mb:3}}),e.jsxs(c,{spacing:3,children:[e.jsx(x,{control:e.jsx(g,{checked:s.recordingEnabled,onChange:a=>r({...s,recordingEnabled:a.target.checked})}),label:t("settings.windows.enableRecording")}),e.jsx(i,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:3},children:e.jsx(m,{label:t("settings.windows.recordingPath"),value:s.recordingPath,onChange:a=>r({...s,recordingPath:a.target.value}),helperText:t("settings.windows.recordingPathHint")})})]})]})]})}function H(s){const{children:r,value:t,index:a,...p}=s;return e.jsx("div",{role:"tabpanel",hidden:t!==a,id:`bastion-settings-tabpanel-${a}`,"aria-labelledby":`bastion-settings-tab-${a}`,...p,children:t===a&&e.jsx(i,{sx:{py:3},children:r})})}function ne(){const{t:s}=w(),{refreshSettings:r}=Z(),[t,a]=u.useState(0),[p,y]=u.useState(!1),[W,f]=u.useState(!0),[v,S]=u.useState(!1),[T,C]=u.useState({enableSessionRecording:!0,recordingFormat:"asciinema",sessionRetentionDays:90,commandRetentionDays:180,enableRealTimeAudit:!0,enableDangerousCommandAlert:!0,alertEmails:"security@example.com",enableFileTransferAudit:!0}),[A,R]=u.useState({enableWindowsAccess:!1,guacdHost:"localhost",guacdPort:4822,recordingEnabled:!0,recordingPath:"/replay",allowClipboard:!1,enableFileTransfer:!1,drivePath:"/replay-drive"}),k=async()=>{try{f(!0);const l=await E.getAllSettings(),d={};Array.isArray(l)?l.forEach(n=>{d[n.category]||(d[n.category]={}),d[n.category][n.key]=n.value}):typeof l=="object"&&Object.keys(l).forEach(n=>{const o=l[n];typeof o=="object"&&(d[n]=o)});const N=n=>{if(typeof n!="string")return n;if(n==="true")return!0;if(n==="false")return!1;if(/^\d+$/.test(n)){const o=parseInt(n,10);if(!isNaN(o))return o}if(/^\d+\.\d+$/.test(n)){const o=parseFloat(n);if(!isNaN(o))return o}return n},F=n=>{const o={};for(const[$,V]of Object.entries(n))o[$]=N(V);return o};d.audit&&C(n=>({...n,...F(d.audit)})),d.windows&&R(n=>({...n,...F(d.windows)}))}catch(l){console.error("Failed to load settings:",l)}finally{f(!1)}};u.useEffect(()=>{k()},[]);const L=async()=>{try{S(!0);const l={audit:T,windows:{...A,recordingFormat:"guac"}};await E.updateSettings(l),y(!0),X(s("settings.saveSuccess")),setTimeout(()=>y(!1),3e3),await r(),await k()}catch(l){console.error("Failed to save settings:",l),alert(s("settings.saveFailed")+": "+l.message)}finally{S(!1)}};return e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(q,{sx:{fontSize:40,mr:2,color:"primary.main"}}),e.jsxs(i,{children:[e.jsx(h,{variant:"h4",component:"h1",fontWeight:"700",children:s("bastionSettings.title")}),e.jsx(h,{variant:"body2",color:"text.secondary",children:s("bastionSettings.subtitle")})]})]}),W&&e.jsx(P,{severity:"info",sx:{mb:3},children:s("settings.loadingConfig")}),p&&e.jsx(P,{severity:"success",sx:{mb:3},icon:e.jsx(G,{}),children:s("settings.saveSuccessRestart")}),e.jsxs(J,{sx:{borderRadius:2,overflow:"hidden"},children:[e.jsxs(K,{value:t,onChange:(l,d)=>a(d),variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider",bgcolor:"background.paper","& .MuiTab-root":{minHeight:64}},children:[e.jsx(D,{icon:e.jsx(j,{}),label:s("settings.auditConfig")}),e.jsx(D,{icon:e.jsx(B,{}),label:s("settings.windows.tab")})]}),e.jsxs(i,{sx:{px:3,maxWidth:1200},children:[e.jsx(H,{value:t,index:0,children:e.jsx(Y,{config:T,onChange:C})}),e.jsx(H,{value:t,index:1,children:e.jsx(ee,{config:A,onChange:R})})]}),e.jsx(i,{sx:{px:3,pb:3,display:"flex",justifyContent:"flex-end",gap:2},children:e.jsx(Q,{variant:"contained",size:"large",startIcon:e.jsx(U,{}),onClick:L,disabled:v,children:s(v?"common.saving":"common.save")})})]})]})}export{ne as default};
