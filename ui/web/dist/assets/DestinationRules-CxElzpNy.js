import{u as W,r as n,bf as d,j as e,B as l,T as p,I as y,v,w as b,x as S,b as Y,C as E,cA as z}from"./index-OJNN34VQ.js";import{k as A}from"./k8sClusterApi-mlnkQKnz.js";import{g as B}from"./yaml-chfuhXsb.js";import{C as H}from"./ClusterSelector-DfMX1_uP.js";import{N as L}from"./NamespaceSelector-D2WCI4jt.js";import{Y as O}from"./YamlViewerDialog-iWTcDuYg.js";import{T as F,a as M,b as P,c as x,d as a,e as V}from"./TableRow-Dz3vPXNr.js";import"./namespaces-D2j8PUT5.js";import"./utils-m9WO14YV.js";function ee(){const{t:r}=W(),[m,u]=n.useState(!1),[h,j]=n.useState([]),[t,R]=n.useState(""),[f,D]=n.useState(""),[T,w]=n.useState(null),[I,g]=n.useState(!1),[i,C]=n.useState(null);n.useEffect(()=>{t&&A.getCluster(t).then(w).catch(s=>{d(s?.response?.data?.message||"获取集群信息失败")})},[t]);const c=n.useCallback(async()=>{if(!t){d("请先选择集群");return}try{u(!0),j([])}catch(s){const o=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||"获取DestinationRule列表失败";d(o),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&j([])}finally{u(!1)}},[t]);return n.useEffect(()=>{t&&c()},[t,f,c]),e.jsxs(l,{sx:{width:"100%",p:3},children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[e.jsxs(l,{children:[e.jsx(p,{variant:"h4",component:"h1",fontWeight:"700",children:"DestinationRules管理"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"管理目标规则（DestinationRule）"})]}),e.jsx(y,{onClick:c,disabled:!t||m,children:e.jsx(v,{})})]}),e.jsx(b,{sx:{mb:3},children:e.jsx(S,{children:e.jsxs(l,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(H,{value:t,onChange:R,size:"medium",fullWidth:!0,label:r("k8s.selectCluster")})}),t&&e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(L,{value:f,onChange:D,clusterId:t,defaultNamespace:T?.defaultNamespace,size:"medium",fullWidth:!0,label:r("k8s.selectNamespace")})})]})})}),t?m?e.jsx(l,{display:"flex",justifyContent:"center",p:3,children:e.jsx(E,{})}):e.jsx(b,{children:e.jsx(S,{children:e.jsx(F,{children:e.jsxs(M,{children:[e.jsx(P,{children:e.jsxs(x,{children:[e.jsx(a,{children:"名称"}),e.jsx(a,{children:"命名空间"}),e.jsx(a,{children:"Host"}),e.jsx(a,{children:"创建时间"}),e.jsx(a,{children:r("common.actions")})]})}),e.jsx(V,{children:h.length===0?e.jsx(x,{children:e.jsx(a,{colSpan:5,align:"center",children:e.jsx(p,{color:"textSecondary",children:r("common.noData")})})}):h.map((s,o)=>e.jsxs(x,{children:[e.jsx(a,{children:s.name}),e.jsx(a,{children:s.namespace}),e.jsx(a,{children:s.host}),e.jsx(a,{children:s.age||"N/A"}),e.jsx(a,{children:e.jsx(y,{size:"small",onClick:()=>{C(s),g(!0)},title:r("k8s.viewYaml"),children:e.jsx(z,{fontSize:"small"})})})]},o))})]})})})}):e.jsx(Y,{severity:"info",children:r("k8s.selectClusterFirst")}),i&&e.jsx(O,{open:I,onClose:()=>{g(!1),C(null)},title:`DestinationRule - ${i.name}`,clusterId:t,namespace:i.namespace,resourceType:"destinationrule",resourceName:i.name,onLoadYaml:async(s,o,k,N)=>await B({clusterId:s,namespace:o},k,N)})]})}export{ee as default};
