import{u as W,r,bf as x,j as e,B as l,T as m,I as b,v as Y,w as y,x as v,b as E,C as z,cA as A}from"./index-OJNN34VQ.js";import{k as B}from"./k8sClusterApi-mlnkQKnz.js";import{g as D}from"./yaml-chfuhXsb.js";import{C as R}from"./ClusterSelector-DfMX1_uP.js";import{N as O}from"./NamespaceSelector-D2WCI4jt.js";import{Y as H}from"./YamlViewerDialog-iWTcDuYg.js";import{T as L,a as F,b as M,c as u,d as t,e as P}from"./TableRow-Dz3vPXNr.js";import"./namespaces-D2j8PUT5.js";import"./utils-m9WO14YV.js";function ee(){const{t:n}=W(),[h,p]=r.useState(!1),[j,f]=r.useState([]),[s,T]=r.useState(""),[C,w]=r.useState(""),[I,V]=r.useState(null),[k,S]=r.useState(!1),[c,g]=r.useState(null);r.useEffect(()=>{s&&B.getCluster(s).then(V).catch(a=>{x(a?.response?.data?.message||"获取集群信息失败")})},[s]);const o=r.useCallback(async()=>{if(!s){x("请先选择集群");return}try{p(!0),f([])}catch(a){const i=a,d=i?.response?.data?.message||"获取VirtualService列表失败";x(d),i?.response?.status===403&&f([])}finally{p(!1)}},[s]);return r.useEffect(()=>{s&&o()},[s,C,o]),e.jsxs(l,{sx:{width:"100%",p:3},children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[e.jsxs(l,{children:[e.jsx(m,{variant:"h4",component:"h1",fontWeight:"700",children:"VirtualServices管理"}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"管理虚拟服务（VirtualService）"})]}),e.jsx(b,{onClick:o,disabled:!s||h,children:e.jsx(Y,{})})]}),e.jsx(y,{sx:{mb:3},children:e.jsx(v,{children:e.jsxs(l,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(R,{value:s,onChange:T,size:"medium",fullWidth:!0,label:n("k8s.selectCluster")})}),s&&e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(O,{value:C,onChange:w,clusterId:s,defaultNamespace:I?.defaultNamespace,size:"medium",fullWidth:!0,label:n("k8s.selectNamespace")})})]})})}),s?h?e.jsx(l,{display:"flex",justifyContent:"center",p:3,children:e.jsx(z,{})}):e.jsx(y,{children:e.jsx(v,{children:e.jsx(L,{children:e.jsxs(F,{children:[e.jsx(M,{children:e.jsxs(u,{children:[e.jsx(t,{children:"名称"}),e.jsx(t,{children:"命名空间"}),e.jsx(t,{children:"Hosts"}),e.jsx(t,{children:"创建时间"}),e.jsx(t,{children:n("common.actions")})]})}),e.jsx(P,{children:j.length===0?e.jsx(u,{children:e.jsx(t,{colSpan:5,align:"center",children:e.jsx(m,{color:"textSecondary",children:n("common.noData")})})}):j.map((a,i)=>e.jsxs(u,{children:[e.jsx(t,{children:a.name}),e.jsx(t,{children:a.namespace}),e.jsx(t,{children:a.hosts.join(", ")}),e.jsx(t,{children:a.age||"N/A"}),e.jsx(t,{children:e.jsx(b,{size:"small",onClick:()=>{g(a),S(!0)},title:n("k8s.viewYaml"),children:e.jsx(A,{fontSize:"small"})})})]},i))})]})})})}):e.jsx(E,{severity:"info",children:n("k8s.selectClusterFirst")}),c&&e.jsx(H,{open:k,onClose:()=>{S(!1),g(null)},title:`VirtualService - ${c.name}`,clusterId:s,namespace:c.namespace,resourceType:"virtualservice",resourceName:c.name,onLoadYaml:async(a,i,d,N)=>await D({clusterId:a,namespace:i},d,N)})]})}export{ee as default};
