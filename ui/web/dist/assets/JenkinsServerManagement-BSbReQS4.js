import{H as i,r as j,bf as c,j as e,B as m,T as p,a as g,v as O,A as R,w as E,x as L,c as q,V as H,d as W,I as $,bp as J,g as _,h as F,i as Q,k as V,l as G,m as b,_ as K,p as N,a7 as k}from"./index-STo1oTDL.js";import{T as X,a as Y,b as Z,c as A,d,e as ee}from"./TableRow-e9fRaRV7.js";import{C as D}from"./Chip-v5QMYL72.js";import{f as ae}from"./index-CEYi4unC.js";import{S as M}from"./Stack-BJqE2zD7.js";import{S as se}from"./Switch-Do7Epm1v.js";import"./typeof-QjJsDpFa.js";const f={listServers:async(t=1,s=10)=>{const r=await i.get("/api/jenkins/servers",{params:{page:t,page_size:s}});return{data:r.data?.data||r.data}},getServer:async t=>{const s=await i.get(`/api/jenkins/servers/${t}`);return{data:s.data?.data||s.data}},createServer:async t=>{const s=await i.post("/api/jenkins/servers",t);return{data:s.data?.data||s.data}},updateServer:async(t,s)=>{const r=await i.put(`/api/jenkins/servers/${t}`,s);return{data:r.data?.data||r.data}},deleteServer:async t=>{const s=await i.delete(`/api/jenkins/servers/${t}`);return{data:s.data?.data||s.data}},testConnection:async t=>{const s=await i.post("/api/jenkins/test-connection",t);return{data:s.data?.data||s.data}},getJobs:async t=>{const s=await i.get(`/api/jenkins/${t}/jobs`);return{data:s.data?.data||s.data}},searchJobs:async(t,s)=>{const r=await i.get(`/api/jenkins/${t}/jobs/search`,{params:{keyword:s}});return{data:r.data?.data||r.data}},getJobDetail:async(t,s)=>{const r=await i.get(`/api/jenkins/${t}/jobs/${encodeURIComponent(s)}`);return{data:r.data?.data||r.data}},startJob:async(t,s,r)=>{const l=await i.post(`/api/jenkins/${t}/jobs/${encodeURIComponent(s)}/start`,r||{});return{data:l.data?.data||l.data}},getBuildDetail:async(t,s,r)=>{const l=await i.get(`/api/jenkins/${t}/jobs/${encodeURIComponent(s)}/builds/${r}`);return{data:l.data?.data||l.data}},stopBuild:async(t,s,r,l)=>{const u=await i.post(`/api/jenkins/${t}/jobs/${encodeURIComponent(s)}/builds/${r}/stop`,l||{});return{data:u.data?.data||u.data}},getBuildLog:async(t,s,r,l=0)=>{const u=await i.get(`/api/jenkins/${t}/jobs/${encodeURIComponent(s)}/builds/${r}/log`,{params:{start:l}});return{data:u.data?.data||u.data}},getSystemInfo:async t=>{const s=await i.get(`/api/jenkins/${t}/system-info`);return{data:s.data?.data||s.data}},getQueueInfo:async t=>{const s=await i.get(`/api/jenkins/${t}/queue`);return{data:s.data?.data||s.data}}};function ce(){const[t,s]=j.useState([]),[r,l]=j.useState(!1),[u,v]=j.useState(!1),[h,w]=j.useState(null),[I,T]=j.useState(!1),[n,x]=j.useState({alias:"",url:"",username:"",password:"",description:"",enabled:!0});j.useEffect(()=>{y()},[]);const y=async()=>{try{l(!0);const o=(await f.listServers(1,100)).data;Array.isArray(o)?s(o):o&&Array.isArray(o.list)?s(o.list):o&&Array.isArray(o.data)?s(o.data):s([])}catch(a){const o=a?.response?.data?.message||"获取Jenkins服务器列表失败";c(o),s([])}finally{l(!1)}},C=a=>{a?(w(a),x({alias:a.alias,url:a.url,username:a.username,password:"",description:a.description||"",enabled:a.enabled})):(w(null),x({alias:"",url:"",username:"",password:"",description:"",enabled:!0})),v(!0)},S=()=>{v(!1),w(null),x({alias:"",url:"",username:"",password:"",description:"",enabled:!0})},U=async()=>{if(!n.url){c("请填写服务器URL");return}if(!n.username){c("请填写用户名");return}if(!n.password){c("请填写密码或API Token");return}try{T(!0);let a=n.url.trim();!a.startsWith("http://")&&!a.startsWith("https://")&&(a=`http://${a}`);const o=await f.testConnection({url:a,username:n.username,password:n.password});o.data.success?k("连接测试成功！"):c(o.data.message||"连接测试失败")}catch(a){const o=a?.response?.data?.message||"连接测试失败";c(o)}finally{T(!1)}},z=async()=>{if(!n.alias||!n.url){c("请填写必填字段");return}if(!n.username){c("请填写用户名");return}if(!n.password){c("请填写密码或API Token");return}try{let a=n.url.trim();if(!a.startsWith("http://")&&!a.startsWith("https://")&&(a=`http://${a}`),h){const o={alias:n.alias,url:a,username:n.username,password:n.password,description:n.description,enabled:n.enabled};await f.updateServer(h.id,o),k("Jenkins服务器更新成功")}else await f.createServer({...n,url:a}),k("Jenkins服务器添加成功");S(),y()}catch(a){const o=a?.response?.data?.message||(h?"更新服务器失败":"添加服务器失败");c(o)}},P=async a=>{if(window.confirm(`确认要删除Jenkins服务器 "${a.alias}" 吗？`))try{await f.deleteServer(a.id),k("Jenkins服务器删除成功"),y()}catch(o){const B=o?.response?.data?.message||"删除服务器失败";c(B)}};return e.jsxs(m,{sx:{width:"100%",p:{xs:2,sm:3},bgcolor:"#f5f7fa",minHeight:"100vh"},children:[e.jsxs(m,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsxs(m,{children:[e.jsx(p,{variant:"h4",component:"h1",fontWeight:"700",sx:{fontSize:{xs:"1.75rem",sm:"2rem"},color:"#1a202c",mb:.5},children:"Jenkins 服务器管理"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.875rem",color:"#718096"},children:"管理Jenkins服务器配置，包括添加、编辑、删除和测试连接"})]}),e.jsxs(m,{sx:{display:"flex",gap:2},children:[e.jsx(g,{variant:"outlined",startIcon:e.jsx(O,{}),onClick:y,disabled:r,sx:{borderRadius:2,textTransform:"none",px:3,py:1,fontWeight:500},children:"刷新"}),e.jsx(g,{variant:"contained",startIcon:e.jsx(R,{}),onClick:()=>C(),sx:{borderRadius:2,textTransform:"none",px:3,py:1,fontWeight:500,boxShadow:"0 2px 8px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}},children:"添加服务器"})]})]}),e.jsx(E,{elevation:0,sx:{borderRadius:3,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:e.jsx(L,{sx:{p:{xs:2,sm:3}},children:r?e.jsx(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:4},children:e.jsx(p,{color:"text.secondary",children:"加载中..."})}):t.length===0?e.jsxs(m,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:4},children:[e.jsx(p,{variant:"body1",color:"text.secondary",sx:{mb:2},children:"暂无Jenkins服务器"}),e.jsx(g,{variant:"contained",startIcon:e.jsx(R,{}),onClick:()=>C(),sx:{borderRadius:2,textTransform:"none"},children:"添加第一个服务器"})]}):e.jsx(X,{children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(A,{children:[e.jsx(d,{sx:{fontWeight:600},children:"服务器别名"}),e.jsx(d,{sx:{fontWeight:600},children:"服务器地址"}),e.jsx(d,{sx:{fontWeight:600},children:"用户名"}),e.jsx(d,{sx:{fontWeight:600},children:"描述"}),e.jsx(d,{sx:{fontWeight:600},children:"状态"}),e.jsx(d,{sx:{fontWeight:600},children:"创建时间"}),e.jsx(d,{sx:{fontWeight:600},children:"操作"})]})}),e.jsx(ee,{children:t.map(a=>e.jsxs(A,{sx:{"&:hover":{bgcolor:"#f7fafc"}},children:[e.jsx(d,{children:e.jsx(p,{variant:"body2",fontWeight:500,children:a.alias})}),e.jsx(d,{children:e.jsx(p,{variant:"body2",color:"text.secondary",children:a.url})}),e.jsx(d,{children:e.jsx(p,{variant:"body2",color:"text.secondary",children:a.username})}),e.jsx(d,{children:e.jsx(p,{variant:"body2",color:"text.secondary",children:a.description||"-"})}),e.jsx(d,{children:a.enabled?e.jsx(D,{icon:e.jsx(q,{}),label:"启用",color:"success",size:"small"}):e.jsx(D,{icon:e.jsx(H,{}),label:"禁用",color:"default",size:"small"})}),e.jsx(d,{children:e.jsx(p,{variant:"body2",color:"text.secondary",children:a.created_at?ae(new Date(a.created_at),"yyyy-MM-dd HH:mm"):"-"})}),e.jsx(d,{children:e.jsxs(M,{direction:"row",spacing:1,children:[e.jsx(W,{title:"编辑",children:e.jsx($,{size:"small",onClick:()=>C(a),sx:{"&:hover":{bgcolor:J("#667eea",.1)}},children:e.jsx(_,{fontSize:"small"})})}),e.jsx(W,{title:"删除",children:e.jsx($,{size:"small",onClick:()=>P(a),sx:{"&:hover":{bgcolor:J("#f56565",.1)}},children:e.jsx(F,{fontSize:"small"})})})]})})]},a.id))})]})})})}),e.jsxs(Q,{open:u,onClose:S,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 10px 40px rgba(0,0,0,0.15)"}},children:[e.jsx(V,{sx:{pb:1.5,fontWeight:600,color:"#1a202c"},children:h?"编辑Jenkins服务器":"添加Jenkins服务器"}),e.jsx(G,{children:e.jsxs(M,{spacing:2.5,sx:{mt:1},children:[e.jsx(b,{fullWidth:!0,label:"服务器别名",value:n.alias,onChange:a=>x({...n,alias:a.target.value}),required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}}),e.jsx(b,{fullWidth:!0,label:"服务器URL",value:n.url,onChange:a=>x({...n,url:a.target.value}),placeholder:"http://jenkins.example.com:8080",helperText:"请输入完整的Jenkins服务器URL（如 http://jenkins.example.com:8080 或 https://jenkins.example.com）",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}}),e.jsx(b,{fullWidth:!0,label:"用户名",value:n.username,onChange:a=>x({...n,username:a.target.value}),placeholder:"Jenkins 用户名",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}}),e.jsx(b,{fullWidth:!0,type:"password",label:h?"密码/API Token（留空则不修改）":"密码/API Token",value:n.password,onChange:a=>x({...n,password:a.target.value}),placeholder:"Jenkins 密码或 API Token",helperText:"可以填写密码或 API Token。如果使用 API Token，请填写生成 Token 的用户名",required:!h,sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}}),e.jsx(b,{fullWidth:!0,multiline:!0,rows:3,label:"描述（可选）",value:n.description,onChange:a=>x({...n,description:a.target.value}),sx:{"& .MuiOutlinedInput-root":{borderRadius:1.5}}}),e.jsx(K,{control:e.jsx(se,{checked:n.enabled,onChange:a=>x({...n,enabled:a.target.checked}),color:"primary"}),label:"启用"})]})}),e.jsxs(N,{sx:{px:3,pb:2.5,gap:1},children:[e.jsx(g,{onClick:S,sx:{borderRadius:1.5,textTransform:"none",px:2},children:"取消"}),e.jsx(g,{onClick:U,disabled:I,variant:"outlined",sx:{borderRadius:1.5,textTransform:"none",px:2},children:I?"测试中...":"测试连接"}),e.jsx(g,{onClick:z,variant:"contained",sx:{borderRadius:1.5,textTransform:"none",px:2,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",boxShadow:"0 2px 8px rgba(102, 126, 234, 0.3)","&:hover":{background:"linear-gradient(135deg, #5568d3 0%, #6a3d91 100%)",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.4)"}},children:h?"保存":"添加"})]})]})]})}export{ce as default};
