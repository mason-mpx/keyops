import{aj as D,ak as P,r as l,al as E,bB as M,an as U,af as z,j as e,ao as F,ag as L,ah as B,ax as V,B as n,T as x,C as $,a3 as G,a4 as Y,cg as J,w as K,x as q,dw as Q,dt as X,c6 as Z,bj as tt,dx as et,dy as st,dz as ot,dA as at}from"./index-OJNN34VQ.js";import{a as rt,t as it}from"./ticketApi-CWQtxyXM.js";import{G as W}from"./GridLegacy-CDe511SR.js";function nt(o){return P("MuiCardActionArea",o)}const I=D("MuiCardActionArea",["root","focusVisible","focusHighlight"]),ct=o=>{const{classes:r}=o;return F({root:["root"],focusHighlight:["focusHighlight"]},nt,r)},lt=z(L,{name:"MuiCardActionArea",slot:"Root"})(B(({theme:o})=>({display:"block",textAlign:"inherit",borderRadius:"inherit",width:"100%",[`&:hover .${I.focusHighlight}`]:{opacity:(o.vars||o).palette.action.hoverOpacity,"@media (hover: none)":{opacity:0}},[`&.${I.focusVisible} .${I.focusHighlight}`]:{opacity:(o.vars||o).palette.action.focusOpacity}}))),dt=z("span",{name:"MuiCardActionArea",slot:"FocusHighlight"})(B(({theme:o})=>({overflow:"hidden",pointerEvents:"none",position:"absolute",top:0,right:0,bottom:0,left:0,borderRadius:"inherit",opacity:0,backgroundColor:"currentcolor",transition:o.transitions.create("opacity",{duration:o.transitions.duration.short})}))),xt=l.forwardRef(function(r,p){const d=E({props:r,name:"MuiCardActionArea"}),{children:C,className:y,focusVisibleClassName:j,slots:i={},slotProps:A={},...u}=d,g=d,m=ct(g),b={slots:i,slotProps:A},[S,v]=M("root",{elementType:lt,externalForwardedProps:{...b,...u},shouldForwardComponentProp:!0,ownerState:g,ref:p,className:U(m.root,y),additionalProps:{focusVisibleClassName:U(j,m.focusVisible)}}),[T,w]=M("focusHighlight",{elementType:dt,externalForwardedProps:b,ownerState:g,className:m.focusHighlight});return e.jsxs(S,{...v,children:[C,e.jsx(T,{...w})]})}),R="workorder_usage_stats",h="常用入口",N=()=>{try{const o=localStorage.getItem(R);return o?JSON.parse(o):{}}catch{return{}}},ht=o=>{try{localStorage.setItem(R,JSON.stringify(o))}catch(r){console.error("保存使用统计失败:",r)}},ut=o=>{const r=N();r[o]||(r[o]={count:0,lastUsed:0}),r[o].count+=1,r[o].lastUsed=Date.now(),ht(r)};function mt(){const o=V(),[r,p]=l.useState(!1),[d,C]=l.useState([]),[y,j]=l.useState({}),[i,A]=l.useState(h);l.useEffect(()=>{(async()=>{try{p(!0);const s=await rt.list({status:"active"});if(s.data.code===0&&Array.isArray(s.data.data)){C(s.data.data);const a={};await Promise.all(s.data.data.map(async f=>{try{const c=await it.list({template_id:f.id,exclude_status:"draft",page_size:1});if(c.data.code===0&&c.data.data&&c.data.data.length>0){const k=c.data.data[0];a[f.id]=k.created_at}}catch(c){console.error(`获取模板 ${f.id} 的最后提交时间失败:`,c)}})),j(a)}}catch(s){console.error("加载日常工单模板失败:",s)}finally{p(!1)}})()},[]);const u=l.useMemo(()=>{const t={};return d.forEach(s=>{const a=s.category||"未分组";t[a]||(t[a]=[]),t[a].push(s)}),t},[d]),g=l.useMemo(()=>{const t=N();return d.map(s=>({...s,usageCount:t[s.id]?.count||0,lastUsed:t[s.id]?.lastUsed||0})).sort((s,a)=>a.usageCount!==s.usageCount?a.usageCount-s.usageCount:a.lastUsed-s.lastUsed).slice(0,9)},[d]),m=t=>{if(t===-1)return{primary:"#ff9800",light:"#fff3e0"};const s=[{primary:"#1976d2",light:"#e3f2fd"},{primary:"#ff9800",light:"#fff3e0"},{primary:"#f44336",light:"#ffebee"},{primary:"#388e3c",light:"#e8f5e9"},{primary:"#9c27b0",light:"#f3e5f5"},{primary:"#00bcd4",light:"#e0f7fa"}];return s[t%s.length]},b=t=>{const s=[Z,tt,et,st,ot,at];return s[t%s.length]},S=t=>{if(t===h)return-1;const a=Object.keys(u).indexOf(t);return a>=0?a:0},v=(t,s)=>{A(s)},T=t=>{ut(t.id),o(`/fill-ticket-form?templateId=${t.id}`)},w=(t,s)=>{const a=s===h?t.category||"未分组":s,f=S(a),c=m(f),k=b(f);return e.jsx(W,{item:!0,xs:12,sm:6,md:4,lg:2.4,sx:{"@media (min-width: 1200px)":{maxWidth:"calc(33.333% - 16px)",flexBasis:"calc(33.333% - 16px)"}},children:e.jsx(K,{sx:{height:"100%",display:"flex",flexDirection:"column",borderRadius:.5,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",boxShadow:"none",transition:"all 0.2s ease","&:hover":{boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.1)",transform:"translateY(-2px)"}},children:e.jsx(xt,{sx:{height:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start",p:3},onClick:()=>T(t),children:e.jsxs(q,{sx:{p:0,width:"100%",display:"flex",flexDirection:"column",gap:1.5},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(n,{sx:{width:48,height:48,minWidth:48,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:.5,bgcolor:c.light,color:c.primary,flexShrink:0},children:e.jsx(k,{sx:{fontSize:28}})}),e.jsxs(n,{sx:{flex:1,minWidth:0},children:[e.jsx(x,{variant:"h6",fontWeight:600,sx:{mb:.5,fontSize:"1rem",lineHeight:1.4,color:"text.primary",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.name}),t.description&&e.jsx(x,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.875rem",lineHeight:1.5,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.description})]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mt:1,pt:1.5,borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5,color:"text.secondary"},children:[e.jsx(Q,{sx:{fontSize:16}}),e.jsx(x,{variant:"caption",sx:{fontSize:"0.75rem"},children:t.version||"1.0"})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5,color:"text.secondary"},children:[e.jsx(X,{sx:{fontSize:16}}),e.jsx(x,{variant:"caption",sx:{fontSize:"0.75rem"},children:y[t.id]?new Date(y[t.id]).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"暂无提交"})]})]})]})})})},t.id)},O=Object.keys(u),H=l.useMemo(()=>i===h?g:i?u[i]||[]:[],[i,u,g]),_=[h,...O];return e.jsxs(n,{sx:{p:3},children:[e.jsx(x,{variant:"h5",fontWeight:600,gutterBottom:!0,sx:{mb:3},children:"日常工单"}),r?e.jsx(n,{sx:{display:"flex",justifyContent:"center",py:6},children:e.jsx($,{})}):d.length===0?e.jsx(x,{color:"text.secondary",children:'暂无模板，请先在"设计模版"里创建并启用。'}):e.jsxs(e.Fragment,{children:[e.jsx(n,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsx(G,{value:i,onChange:v,variant:"scrollable",scrollButtons:"auto",sx:{"& .MuiTab-root":{textTransform:"none",fontSize:"0.9375rem",fontWeight:500,minHeight:48,px:2},"& .Mui-selected":{color:"primary.main",fontWeight:600},"& .MuiTabs-indicator":{height:3,borderRadius:"3px 3px 0 0"}},children:_.map(t=>e.jsx(Y,{label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[t===h&&e.jsx(J,{sx:{fontSize:18}}),t]}),value:t},t))})}),i&&H.length>0?e.jsx(W,{container:!0,spacing:3,children:H.map(t=>w(t,i))}):e.jsx(x,{color:"text.secondary",sx:{py:4,textAlign:"center"},children:i===h?"暂无常用工单，点击任意工单卡片后会自动添加到常用入口":"该分类下暂无工单模板"})]})]})}export{mt as default};
