import{u as L,r as a,aC as z,j as s,B as r,C as $,T as i,m as _,s as A,t as E,I as N,v as B,w as C,x as w,c as H,E as D}from"./index-Cih9_E47.js";import{T as M,a as F,b as V,c as v,d as n,e as U}from"./TableRow-Bl_73t-R.js";import{C as x}from"./Chip-D6-9bdkU.js";import{T as q}from"./TablePagination-lUlKC8EY.js";import"./LastPage-BDzvmy5H.js";function X(){const{t:o}=L(),[I,u]=a.useState(!0),[P,g]=a.useState([]),[m,S]=a.useState(""),[c,p]=a.useState(0),[l,R]=a.useState(10),[y,f]=a.useState(0),[b,T]=a.useState(null),j=a.useCallback(async()=>{u(!0),T(null);try{const e=await z.getLoginRecords({page:c+1,pageSize:l});if(console.log("VM Login Records Response:",e),!e||!e.records){console.warn("No records returned from API, using empty array"),g([]),f(e?.total||0),u(!1);return}const d=(Array.isArray(e.records)?e.records:[]).map(t=>({id:t.id||t.sessionId||t.session_id||"",sessionId:t.sessionId||t.session_id||"",hostId:t.hostId||t.host_id||"",hostName:t.hostName||t.host_name||"Unknown",hostIp:t.hostIp||t.host_ip||"",username:t.username||"",connectionType:t.connectionType||t.connection_type||"webshell",loginTime:t.loginTime?new Date(t.loginTime).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"",logoutTime:t.logoutTime?new Date(t.logoutTime).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"",duration:t.duration||0,status:t.status||"unknown"}));g(d),f(e.total||0),u(!1)}catch(e){console.error("Failed to load VM login records:",e),T(o("history.loadError")+": "+(e.message||o("history.networkError"))),g([]),f(0),u(!1)}},[c,l,o]);a.useEffect(()=>{j()},[j]);const W=e=>{if(!e||e===0)return"-";const h=Math.floor(e/3600),d=Math.floor(e%3600/60),t=e%60;return h>0?`${h}${o("history.hour")} ${d}${o("history.minute")}`:d>0?`${d}${o("history.minute")} ${t}${o("history.second")}`:`${t}${o("history.second")}`},k=P.filter(e=>e.username.toLowerCase().includes(m.toLowerCase())||e.hostIp.includes(m)||e.hostName.toLowerCase().includes(m.toLowerCase()));return I?s.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:s.jsx($,{})}):s.jsxs(r,{children:[s.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[s.jsxs(r,{children:[s.jsx(i,{variant:"h4",component:"h1",children:o("history.vmLoginHistory")}),s.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:o("history.vmLoginHistoryDesc")})]}),s.jsxs(r,{display:"flex",gap:2,children:[s.jsx(_,{size:"small",placeholder:o("common.search")+"...",value:m,onChange:e=>S(e.target.value),InputProps:{startAdornment:s.jsx(A,{position:"start",children:s.jsx(E,{})})}}),s.jsx(N,{onClick:j,color:"primary",children:s.jsx(B,{})})]})]}),b&&s.jsx(C,{sx:{mb:2,backgroundColor:"#fff3e0",borderLeft:"4px solid #ff9800"},children:s.jsx(w,{children:s.jsx(i,{color:"error",variant:"body1",children:b})})}),s.jsx(C,{elevation:0,sx:{border:"1px solid #e2e8f0"},children:s.jsxs(w,{sx:{p:0},children:[s.jsxs(r,{sx:{px:3,py:2.5,borderBottom:"1px solid #e2e8f0"},children:[s.jsx(i,{variant:"h6",fontWeight:"600",color:"text.primary",children:o("history.loginRecords")}),s.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:o("common.totalRecords",{count:y})})]}),s.jsx(M,{children:s.jsxs(F,{children:[s.jsx(V,{children:s.jsxs(v,{children:[s.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.host")}),s.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.user")}),s.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.connectionType")}),s.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.startTime")}),s.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.endTime")}),s.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.duration")}),s.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("common.status")})]})}),s.jsx(U,{children:k.slice(c*l,c*l+l).map(e=>s.jsxs(v,{hover:!0,sx:{transition:"all 0.2s ease","&:hover":{backgroundColor:"rgba(102, 126, 234, 0.05)"}},children:[s.jsx(n,{children:s.jsxs(r,{children:[s.jsx(i,{variant:"body2",fontWeight:500,children:e.hostName}),s.jsx(i,{variant:"caption",color:"text.secondary",children:e.hostIp})]})}),s.jsx(n,{children:s.jsx(x,{label:e.username,size:"small",sx:{backgroundColor:"rgba(102, 126, 234, 0.1)",color:"#667eea"}})}),s.jsx(n,{children:s.jsx(x,{label:e.connectionType==="ssh_gateway"?o("sessions.sshClient"):e.connectionType==="webshell"?"WebShell":e.connectionType||"WebShell",size:"small",sx:{backgroundColor:e.connectionType==="ssh_gateway"?"rgba(76, 175, 80, 0.1)":"rgba(33, 150, 243, 0.1)",color:e.connectionType==="ssh_gateway"?"#4caf50":"#2196f3",fontWeight:500}})}),s.jsx(n,{children:s.jsx(i,{variant:"body2",color:"text.secondary",children:e.loginTime})}),s.jsx(n,{children:s.jsx(i,{variant:"body2",color:"text.secondary",children:e.logoutTime||"-"})}),s.jsx(n,{children:s.jsx(i,{variant:"body2",fontWeight:500,children:W(e.duration)})}),s.jsx(n,{children:e.status==="completed"?s.jsx(x,{icon:s.jsx(H,{style:{fontSize:16}}),label:o("history.success"),size:"small",sx:{backgroundColor:"#d4edda",color:"#155724"}}):e.status==="failed"?s.jsx(x,{icon:s.jsx(D,{style:{fontSize:16}}),label:o("history.failed"),size:"small",sx:{backgroundColor:"#f8d7da",color:"#721c24"}}):s.jsx(x,{label:o("common.inProgress"),size:"small",sx:{backgroundColor:"#ebf8ff",color:"#3182ce"}})})]},e.id))})]})}),y>0&&s.jsx(q,{component:"div",count:y,page:c,onPageChange:(e,h)=>p(h),rowsPerPage:l,onRowsPerPageChange:e=>{R(parseInt(e.target.value,10)),p(0)},labelRowsPerPage:`${o("common.rowsPerPage")}:`})]})})]})}export{X as default};
