import{u as z,r as n,bf as i,j as e,B as l,T as m,I as C,v as Y,w as b,x as S,b as B,C as D,a as E,cz as A,cA as R}from"./index-DNdAKB9f.js";import{k as L}from"./k8sClusterApi-YbI-1DRG.js";import{g as O}from"./yaml-xSLLCrpq.js";import{C as F}from"./ClusterSelector-DdN0pipT.js";import{N as H}from"./NamespaceSelector-CN3QTMlf.js";import{Y as M}from"./YamlViewerDialog-BAKs37X4.js";import{T as P,a as V,b as $,c as u,d as r,e as q}from"./TableRow-2FuGKbnY.js";import"./namespaces-BF_k4IWA.js";import"./utils-5I4TgzTo.js";function te(){const{t}=z(),[h,j]=n.useState(!1),[f,g]=n.useState([]),[a,k]=n.useState(""),[y,I]=n.useState(""),[T,w]=n.useState(null),[v,d]=n.useState(!1),[o,x]=n.useState(null);n.useEffect(()=>{a&&L.getCluster(a).then(w).catch(s=>{i(s?.response?.data?.message||"获取集群信息失败")})},[a]);const p=n.useCallback(async()=>{if(!a){i("请先选择集群");return}try{j(!0),g([])}catch(s){const c=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||"获取Secret列表失败";i(c),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&g([])}finally{j(!1)}},[a]);return n.useEffect(()=>{a&&p()},[a,y,p]),e.jsxs(l,{sx:{width:"100%",p:3},children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[e.jsxs(l,{children:[e.jsx(m,{variant:"h4",component:"h1",fontWeight:"700",children:t("k8s.secrets.title","Secrets 管理")}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:t("k8s.secrets.subtitle","管理密钥（Secret）")})]}),e.jsx(C,{onClick:p,disabled:!a||h,title:t("common.refresh"),children:e.jsx(Y,{})})]}),e.jsx(b,{sx:{mb:3},children:e.jsx(S,{children:e.jsxs(l,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(F,{value:a,onChange:k,size:"medium",fullWidth:!0,label:t("k8s.selectCluster")})}),a&&e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(H,{value:y,onChange:I,clusterId:a,defaultNamespace:T?.defaultNamespace,size:"medium",fullWidth:!0,label:t("k8s.selectNamespace")})})]})})}),a?h?e.jsx(l,{display:"flex",justifyContent:"center",p:3,children:e.jsx(D,{})}):e.jsx(b,{children:e.jsx(S,{children:e.jsx(P,{children:e.jsxs(V,{children:[e.jsx($,{children:e.jsxs(u,{children:[e.jsx(r,{children:t("k8s.secrets.name","名称")}),e.jsx(r,{children:t("k8s.secrets.namespace","命名空间")}),e.jsx(r,{children:t("k8s.secrets.type","类型")}),e.jsx(r,{children:t("k8s.secrets.dataCount","数据项数")}),e.jsx(r,{children:t("k8s.secrets.age","运行时间")}),e.jsx(r,{children:t("common.actions")})]})}),e.jsx(q,{children:f.length===0?e.jsx(u,{children:e.jsx(r,{colSpan:6,align:"center",children:e.jsx(m,{color:"textSecondary",children:t("common.noData")})})}):f.map((s,c)=>e.jsxs(u,{children:[e.jsx(r,{children:s.name}),e.jsx(r,{children:s.namespace}),e.jsx(r,{children:s.type}),e.jsx(r,{children:s.data}),e.jsx(r,{children:s.age||"N/A"}),e.jsx(r,{children:e.jsxs(l,{display:"flex",gap:.5,children:[e.jsx(E,{size:"small",variant:"outlined",startIcon:e.jsx(A,{}),onClick:()=>{if(!a){i("请先选择集群");return}x(s),d(!0)},disabled:!a,children:t("k8s.viewDetails","详情")}),e.jsx(C,{size:"small",onClick:()=>{x(s),d(!0)},title:t("k8s.viewYaml"),children:e.jsx(R,{fontSize:"small"})})]})})]},c))})]})})})}):e.jsx(B,{severity:"info",children:t("k8s.selectClusterFirst")}),o&&e.jsx(M,{open:v,onClose:()=>{d(!1),x(null)},title:`Secret - ${o.name}`,clusterId:a,namespace:o.namespace,resourceType:"secret",resourceName:o.name,onLoadYaml:async(s,c,N,W)=>await O({clusterId:s,namespace:c},N,W)})]})}export{te as default};
