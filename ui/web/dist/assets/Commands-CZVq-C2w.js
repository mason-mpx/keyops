import{u as A,r as t,ad as B,j as e,B as i,C as M,T as r,I as y,v as H,w as I,x as T,m as E,s as w,t as F}from"./index-STo1oTDL.js";import{T as D,a as N,b as K,c as P,d as a,e as O}from"./TableRow-e9fRaRV7.js";import{C as S}from"./Chip-v5QMYL72.js";import{T as _}from"./TablePagination-u_lqWu4q.js";import"./LastPage-Bb7RE8XJ.js";function U(){const{t:o}=A(),[v,d]=t.useState(!0),[R,f]=t.useState([]),[l,j]=t.useState(""),[m,b]=t.useState(""),[x,c]=t.useState(0),[h,W]=t.useState(10),[p,C]=t.useState(0),g=t.useCallback(async()=>{d(!0);try{const s=await B.getCommandRecords({page:x+1,pageSize:h,search:l}),u=s.commands.map(n=>({id:n.id,sessionId:n.sessionId||"",hostName:n.hostIp||"",hostIp:n.hostIp||"",username:n.username||"",command:n.command||"",executedAt:new Date(n.executedAt).toLocaleString("zh-CN"),status:n.status||"success"}));f(u),C(s.total),d(!1)}catch(s){console.error("Failed to load commands:",s),f([]),C(0),d(!1)}},[x,h,l]);t.useEffect(()=>{g()},[g]);const z=s=>{s.key==="Enter"&&(j(m),c(0))},L=()=>{b(""),j(""),c(0)},k=R.filter(s=>s.command.toLowerCase().includes(l.toLowerCase())||s.hostIp.toLowerCase().includes(l.toLowerCase()));return v?e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(M,{})}):e.jsxs(i,{children:[e.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(r,{variant:"h4",component:"h1",children:o("commands.title")}),e.jsx(y,{onClick:g,color:"primary",children:e.jsx(H,{})})]}),e.jsx(I,{elevation:0,sx:{mb:3,border:"1px solid #e2e8f0"},children:e.jsx(T,{children:e.jsx(E,{placeholder:o("common.search")+"...",value:m,onChange:s=>b(s.target.value),onKeyDown:z,size:"small",fullWidth:!0,InputProps:{startAdornment:e.jsx(w,{position:"start",children:e.jsx(F,{})}),endAdornment:m&&e.jsx(w,{position:"end",children:e.jsx(y,{size:"small",onClick:L,children:"âœ•"})})}})})}),e.jsx(I,{elevation:0,sx:{border:"1px solid #e2e8f0"},children:e.jsxs(T,{sx:{p:0},children:[e.jsxs(i,{sx:{px:3,py:2.5,borderBottom:"1px solid #e2e8f0"},children:[e.jsx(r,{variant:"h6",fontWeight:"600",color:"text.primary",children:o("commands.executedRecords")}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:o("commands.totalRecords",{count:p})})]}),e.jsx(D,{children:e.jsxs(N,{children:[e.jsx(K,{children:e.jsxs(P,{children:[e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("commands.executedAt")}),e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.host")}),e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.user")}),e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("commands.command")}),e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("common.status")}),e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.sessionId")})]})}),e.jsx(O,{children:k.map(s=>e.jsxs(P,{hover:!0,sx:{transition:"all 0.2s ease","&:hover":{backgroundColor:"rgba(102, 126, 234, 0.05)"}},children:[e.jsx(a,{children:e.jsx(r,{variant:"body2",color:"text.secondary",children:s.executedAt})}),e.jsx(a,{children:e.jsx(r,{variant:"body2",fontWeight:500,children:s.hostIp})}),e.jsx(a,{children:e.jsx(S,{label:s.username,size:"small",sx:{backgroundColor:"rgba(102, 126, 234, 0.1)",color:"#667eea"}})}),e.jsx(a,{children:e.jsx(i,{sx:{fontFamily:"monospace",fontSize:"0.85rem",backgroundColor:"#f7fafc",padding:"6px 10px",borderRadius:1,maxWidth:"400px",overflow:"auto",whiteSpace:"nowrap"},children:s.command})}),e.jsx(a,{children:e.jsx(S,{label:o("common.success"),size:"small",sx:{backgroundColor:"#f0fff4",color:"#38a169"}})}),e.jsx(a,{children:e.jsx(r,{variant:"caption",fontFamily:"monospace",children:s.sessionId})})]},s.id))})]})}),p>0&&e.jsx(_,{component:"div",count:p,page:x,onPageChange:(s,u)=>c(u),rowsPerPage:h,onRowsPerPageChange:s=>{W(parseInt(s.target.value,10)),c(0)},rowsPerPageOptions:[10,25,50,100],labelRowsPerPage:`${o("common.rowsPerPage")}:`,sx:{borderTop:"1px solid #e2e8f0",mt:0,width:"100%",".MuiTablePagination-toolbar":{paddingLeft:2,paddingRight:2,minHeight:"52px",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},".MuiTablePagination-spacer":{flex:"1 1 auto"},".MuiTablePagination-selectLabel":{marginRight:1,marginBottom:0,fontWeight:500,fontSize:"0.875rem",color:"text.secondary",display:"flex",alignItems:"center",lineHeight:1.5},".MuiTablePagination-displayedRows":{marginBottom:0,fontWeight:500,fontSize:"0.875rem",color:"text.secondary",display:"flex",alignItems:"center",lineHeight:1.5},".MuiTablePagination-select":{fontSize:"0.875rem",marginRight:2,marginTop:0,marginBottom:0},".MuiTablePagination-actions":{marginLeft:1,display:"flex",alignItems:"center"}}})]})})]})}export{U as default};
