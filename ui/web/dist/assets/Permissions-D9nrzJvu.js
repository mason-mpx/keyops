import{b6 as Q,j as e,m as w,B as d,r as h,d4 as Pt,u as St,ax as Tt,d5 as Mt,d6 as kt,H as Et,d7 as Wt,d8 as Dt,d9 as Lt,C as zt,ay as Rt,az as Nt,I as P,aA as Ot,aa as Ft,T as m,w as Ht,x as Bt,a3 as Gt,a4 as re,cj as Oe,bn as Fe,F as B,n as G,o as U,M as C,a as I,a5 as He,cz as Be,P as oe,W as $,X as ce,b8 as N,b9 as Ce,ba as Ie,y as we,Y as de,bb as Ae,A as Pe,g as Ge,h as Ue,i as $e,k as Ve,l as _e,_ as Ke,p as qe,b as Ut,da as $t,db as Vt,dc as _t,dd as Kt,de as qt,df as Xt,dg as Yt,dh as Jt,di as Qt,d as Zt,dj as es,dk as ts,dl as ss,dm as ns}from"./index-z51Q_M-r.js";import{A as Qe}from"./Autocomplete-DXh7XcwX.js";import{C as O}from"./Chip-BoE43uAD.js";import{T as as,a as is,b as ls,c as Se,d as S,e as rs}from"./TableRow-CKQKXB8v.js";import{T as os}from"./TablePagination-DV0GrBI0.js";import{S as Xe}from"./Switch-CFen4WHb.js";import{S as cs}from"./Snackbar-D3ARHm3x.js";import"./LastPage-BCKcUFpS.js";const ds={常用:["Dashboard","Settings","Menu","Home","Person","People","Group","Security","Lock","LockOpen","Key","Shield","Verified"],导航:["ArrowBack","ArrowForward","ArrowUpward","ArrowDownward","ChevronLeft","ChevronRight","ExpandMore","ExpandLess","Navigation","Directions","Route"],操作:["Add","Edit","Delete","Save","Cancel","Check","Close","Refresh","Search","Filter","Sort","MoreVert","MoreHoriz"],文件:["Folder","FolderOpen","InsertDriveFile","Description","FileCopy","Upload","Download","CloudUpload","CloudDownload"],"终端/服务器":["Terminal","Computer","DesktopWindows","Laptop","Storage","Cloud","Dns","Router","Hub"],网络:["Wifi","WifiOff","NetworkCheck","Lan","Cable","Hub","Router","Switch","AccessPoint"],"监控/日志":["History","Timeline","Assessment","BarChart","LineChart","ShowChart","Analytics","Insights","Monitor"],"用户/权限":["Person","People","Group","AccountCircle","AdminPanelSettings","SupervisorAccount","ManageAccounts","HowToReg","PersonAdd"],系统:["Settings","Build","Tune","Extension","Apps","Widgets","Dashboard","ViewModule","ViewList"],通知:["Notifications","NotificationsActive","NotificationsOff","NotificationImportant","Warning","Error","Info","CheckCircle"],其他:["Code","PlayCircle","Assignment","List","ViewList","GridView","TableChart","CalendarToday","Schedule","AccessTime"]},Ye=Object.values(ds).flat(),Je=p=>{const T=Pt[p];return T?e.jsx(T,{}):null};function hs({value:p,onChange:T,label:v="图标",fullWidth:M=!0,margin:E="normal"}){const[V,Z]=Q.useState(""),ee=Q.useMemo(()=>{if(!V)return Ye;const x=V.toLowerCase();return Ye.filter(y=>y.toLowerCase().includes(x))},[V]);return e.jsx(Qe,{fullWidth:M,options:ee,value:p||null,onChange:(x,y)=>{T(y||""),Z("")},onInputChange:(x,y)=>{Z(y)},getOptionLabel:x=>x,renderOption:(x,y)=>{const A=Je(y);return h.createElement(d,{component:"li",...x,key:y},e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[A&&e.jsx(d,{sx:{display:"flex",alignItems:"center",minWidth:24},children:A}),e.jsx(d,{sx:{flex:1},children:y})]}))},renderInput:x=>e.jsx(w,{...x,label:v,margin:E,placeholder:"搜索或选择图标...",InputProps:{...x.InputProps,startAdornment:p?e.jsx(d,{sx:{display:"flex",alignItems:"center",mr:1},children:Je(p)}):null}}),noOptionsText:"未找到匹配的图标",clearOnBlur:!1})}function he(p){const{children:T,value:v,index:M,...E}=p;return e.jsx("div",{role:"tabpanel",hidden:v!==M,id:`permission-tabpanel-${M}`,"aria-labelledby":`permission-tab-${M}`,...E,style:{flex:1,display:"flex",flexDirection:"column",minHeight:0,overflow:"hidden"},children:v===M&&e.jsx(d,{sx:{p:3,flex:1,display:"flex",flexDirection:"column",minHeight:0,overflow:"auto"},children:T})})}const D=(p,T="")=>p.filter(v=>v.parentId===T).sort((v,M)=>v.sort-M.sort).map(v=>({...v,children:D(p,v.id)}));function ys(){const{t:p}=St(),T=Tt(),[v,M]=h.useState("/"),[E,V]=h.useState(0),[Z,ee]=h.useState(!1),[x,y]=h.useState([]),[A,Ze]=h.useState([]),[Te,et]=h.useState([]),[u,xe]=h.useState(""),[tt,_]=h.useState(!1),[z,ue]=h.useState(null),[l,f]=h.useState({path:"",name:"",component:"",parentId:"",sort:0,hidden:!1,meta:{title:"",icon:"",keepAlive:!1,closeTab:!1,defaultMenu:!1,activeName:""}}),[st,K]=h.useState(!1),[te,pe]=h.useState(null),[k,L]=h.useState({path:"",method:"GET",group:"",description:""}),[F,H]=h.useState([]),[se,q]=h.useState([]),[Me,nt]=h.useState([]),[X,at]=h.useState(""),[ne,it]=h.useState(""),[ke,me]=h.useState(new Set),[lt,rt]=h.useState(new Set),[Y,j]=h.useState({open:!1,message:"",severity:"success"}),[fe,Ee]=h.useState(0),[ae,ot]=h.useState(10);h.useEffect(()=>{const t=sessionStorage.getItem("permissions_previous_path")||"/";M(t)},[]);const W=h.useCallback(async()=>{ee(!0);try{const[t,s,n,i]=await Promise.all([Mt(),kt(),Et.get("/api/roles"),Wt()]),a=t.data?.data||t.data||[],o=s.data?.data||s.data||[],r=n.data?.data||n.data||[],c=i.data?.data||i.data||[],g=Array.isArray(a)?a:[],b=R=>{const be=[];return R.forEach(wt=>{const{children:le,...At}=wt;be.push(At),le&&Array.isArray(le)&&le.length>0&&be.push(...b(le))}),be},J=g.length>0&&g.some(R=>R.children&&Array.isArray(R.children))?b(g):g;y(J),Ze(Array.isArray(o)?o:[]),nt(Array.isArray(c)?c:[]),D(J);const ye=(Array.isArray(r)?r:[]).map(R=>({id:R.id,name:R.name}));et(ye),u===""&&ye.length>0&&xe(ye[0].id)}catch(t){console.error("加载数据失败:",t)}finally{ee(!1)}},[u]),ge=h.useCallback(async()=>{if(u)try{const t=u.startsWith("role:")?u.replace("role:",""):u,[s,n]=await Promise.all([Dt(t),Lt(t)]);H(s.data?.data?.menuIds||[]);const i=n.data?.data?.permissions||[],a=i.some(o=>(o.path==="/*"||o.path==="*")&&(o.method===".*"||o.method==="*"));q(a?A.map(o=>({path:o.path,method:o.method})):i)}catch(t){console.error("加载角色权限失败:",t)}},[u,A]);h.useEffect(()=>{W()},[W]),h.useEffect(()=>{u&&ge()},[u,ge]);const ct=async()=>{if(!u){j({open:!0,message:"请先选择角色",severity:"error"});return}if(window.confirm("确定要保存菜单权限吗？"))try{const t=u.startsWith("role:")?u.replace("role:",""):u;await $t(t,F),j({open:!0,message:"菜单权限保存成功，左侧菜单已刷新",severity:"success"}),window.dispatchEvent(new CustomEvent("menuUpdated"))}catch(t){console.error("保存菜单权限失败:",t),j({open:!0,message:"保存失败: "+t.message,severity:"error"})}},dt=async()=>{if(!u){j({open:!0,message:"请先选择角色",severity:"error"});return}if(window.confirm("确定要保存API权限吗？"))try{const t=u.startsWith("role:")?u.replace("role:",""):u;await Vt(t,se),await ge(),j({open:!0,message:"API权限保存成功",severity:"success"})}catch(t){console.error("保存API权限失败:",t),j({open:!0,message:"保存失败: "+t.message,severity:"error"})}},ht=t=>{H(s=>s.includes(t)?s.filter(n=>n!==t):[...s,t])},We=t=>{me(s=>{const n=new Set(s);return n.has(t)?n.delete(t):n.add(t),n})},De=(t,s)=>{const n=a=>{let o=[];return a.forEach(r=>{o.push(r.id),r.children&&r.children.length>0&&(o=o.concat(n(r.children)))}),o},i=n(t);H(s?a=>[...new Set([...a,...i])]:a=>a.filter(o=>!i.includes(o)))},xt=t=>{if(!t.children||t.children.length===0)return!1;const s=t.children.filter(n=>F.includes(n.id)).length;return s>0&&s<t.children.length},ut=t=>!t.children||t.children.length===0?F.includes(t.id):t.children.every(s=>F.includes(s.id)),pt=(t,s)=>{q(n=>n.some(a=>a.path===t&&a.method===s)?n.filter(a=>!(a.path===t&&a.method===s)):[...n,{path:t,method:s}])},mt=async()=>{try{await _t(l),_(!1),f({path:"",name:"",component:"",parentId:"",sort:0,hidden:!1,meta:{title:"",icon:"",keepAlive:!1,closeTab:!1,defaultMenu:!1,activeName:""}}),W(),window.dispatchEvent(new CustomEvent("menuUpdated")),j({open:!0,message:"菜单创建成功，左侧菜单已自动刷新",severity:"success"})}catch(t){console.error("创建菜单失败:",t),j({open:!0,message:"创建失败",severity:"error"})}},ft=async()=>{if(z)try{await Kt(z.id,l),_(!1),ue(null),f({path:"",name:"",component:"",parentId:"",sort:0,hidden:!1,meta:{title:"",icon:"",keepAlive:!1,closeTab:!1,defaultMenu:!1,activeName:""}}),W(),window.dispatchEvent(new CustomEvent("menuUpdated")),j({open:!0,message:"菜单更新成功，左侧菜单已自动刷新",severity:"success"})}catch(t){console.error("更新菜单失败:",t),j({open:!0,message:"更新失败",severity:"error"})}},gt=async t=>{if(confirm("确定要删除这个菜单吗？"))try{await ss(t),W(),window.dispatchEvent(new CustomEvent("menuUpdated")),j({open:!0,message:"菜单删除成功，左侧菜单已自动刷新",severity:"success"})}catch(s){console.error("删除菜单失败:",s),j({open:!0,message:"删除失败",severity:"error"})}},jt=async()=>{try{await qt(k),K(!1),L({path:"",method:"GET",group:"",description:""}),W()}catch(t){console.error("创建API失败:",t),alert("创建失败")}},vt=async()=>{if(te)try{await Xt(te.id,k),K(!1),pe(null),L({path:"",method:"GET",group:"",description:""}),W()}catch(t){console.error("更新API失败:",t),alert("更新失败")}},yt=async t=>{if(confirm("确定要删除这个API吗？"))try{await Yt(t),W()}catch(s){console.error("删除API失败:",s),alert("删除失败")}},je=(t,s=0)=>{const n=[];return t.forEach(i=>{const a="  ".repeat(s);n.push({id:i.id,label:`${a}${i.meta?.title||i.name}`,level:s}),i.children&&i.children.length>0&&n.push(...je(i.children,s+1))}),n},ve=(t,s)=>{t?(ue(t),f({path:t.path,name:t.name,component:t.component||"",parentId:t.parentId,sort:t.sort,hidden:t.hidden,meta:{title:t.meta?.title||"",icon:t.meta?.icon||"",keepAlive:t.meta?.keepAlive||!1,closeTab:t.meta?.closeTab||!1,defaultMenu:t.meta?.defaultMenu||!1,activeName:t.meta?.activeName||""}})):(ue(null),f({path:"",name:"",component:"",parentId:s||"",sort:0,hidden:!1,meta:{title:"",icon:"",keepAlive:!1,closeTab:!1,defaultMenu:!1,activeName:""}})),_(!0)},Le=t=>{t?(pe(t),L({path:t.path,method:t.method,group:t.group,description:t.description||""})):(pe(null),L({path:"",method:"GET",group:"",description:""})),K(!0)},ie=(t,s)=>{if(!s)return t;const n=s.toLowerCase(),i=[];for(const a of t){const o=(a.meta?.title||a.name).toLowerCase().includes(n)||a.path.toLowerCase().includes(n),r=a.children?ie(a.children,s):[],c=r.length>0;(o||c)&&i.push({...a,children:r.length>0?r:a.children})}return i},bt=async(t,s="")=>{const n=x.filter(a=>a.parentId===s).sort((a,o)=>a.sort-o.sort),i=n.findIndex(a=>a.id===t);if(i>0){const a=[...x],o=a.findIndex(c=>c.id===t),r=a.findIndex(c=>c.id===n[i-1].id);if(o!==-1&&r!==-1){const c=a[o].sort;a[o].sort=a[r].sort,a[r].sort=c,y(a),await ze(a)}}},Ct=async(t,s="")=>{const n=x.filter(a=>a.parentId===s).sort((a,o)=>a.sort-o.sort),i=n.findIndex(a=>a.id===t);if(i<n.length-1){const a=[...x],o=a.findIndex(c=>c.id===t),r=a.findIndex(c=>c.id===n[i+1].id);if(o!==-1&&r!==-1){const c=a[o].sort;a[o].sort=a[r].sort,a[r].sort=c,y(a),await ze(a)}}},ze=async t=>{try{const s=t||x,n={};s.forEach(i=>{n[i.id]=i.sort}),await ns(n)}catch(s){console.error("更新排序失败:",s),alert("更新排序失败"),W()}},It=t=>{const s=new Set,n=i=>{i.forEach(a=>{a.children&&a.children.length>0&&(s.add(a.id),n(a.children))})};return n(t),s},Re=(t,s=0,n="")=>t.map((i,a)=>{const o=i.children&&i.children.length>0,r=ke.has(i.id);return e.jsxs(Q.Fragment,{children:[e.jsxs(ce,{sx:{pl:s*4},children:[e.jsx(N,{sx:{minWidth:40},children:o?e.jsx(P,{size:"small",onClick:()=>We(i.id),sx:{p:.5},children:r?e.jsx(Ce,{}):e.jsx(Ie,{})}):e.jsx(d,{sx:{width:24,height:24}})}),e.jsx(N,{sx:{minWidth:32},children:e.jsx(Jt,{sx:{color:"text.secondary"}})}),e.jsx(de,{primary:e.jsxs(d,{component:"span",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(m,{component:"span",variant:"body2",fontWeight:500,children:i.meta?.title||i.name}),o&&e.jsx(O,{label:`${i.children?.length||0} 个子菜单`,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}})]}),secondary:e.jsxs(d,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:1},children:[e.jsx(m,{component:"span",variant:"caption",color:"text.secondary",children:i.path||"分组菜单"}),e.jsxs(m,{component:"span",variant:"caption",color:"text.secondary",children:["· 排序: ",i.sort]})]})}),e.jsxs(Qt,{children:[e.jsx(Zt,{title:"添加子菜单",children:e.jsx(P,{edge:"end",onClick:()=>ve(void 0,i.id),size:"small",color:"primary",children:e.jsx(Pe,{})})}),e.jsx(P,{edge:"end",onClick:()=>bt(i.id,n),disabled:a===0,size:"small",title:"上移",children:e.jsx(es,{})}),e.jsx(P,{edge:"end",onClick:()=>Ct(i.id,n),disabled:a===t.length-1,size:"small",title:"下移",children:e.jsx(ts,{})}),e.jsx(P,{edge:"end",onClick:()=>ve(i),title:"编辑",children:e.jsx(Ge,{})}),e.jsx(P,{edge:"end",onClick:()=>gt(i.id),title:"删除",children:e.jsx(Ue,{})})]})]}),o&&e.jsx(Ae,{in:r,timeout:"auto",unmountOnExit:!0,children:e.jsx($,{component:"div",disablePadding:!0,children:Re(i.children,s+1,i.id)})})]},i.id)}),Ne=(t,s=0)=>t.map(n=>{const i=n.children&&n.children.length>0,a=ke.has(n.id),o=F.includes(n.id),r=xt(n),c=ut(n);return e.jsxs(Q.Fragment,{children:[e.jsxs(ce,{sx:{pl:s*3+1,py:.5,"&:hover":{bgcolor:"action.hover"}},children:[e.jsxs(N,{sx:{minWidth:36},children:[i&&e.jsx(P,{size:"small",onClick:()=>We(n.id),sx:{p:.5},children:a?e.jsx(Ce,{}):e.jsx(Ie,{})}),!i&&e.jsx(d,{sx:{width:24}})]}),e.jsx(N,{sx:{minWidth:40},children:e.jsx(we,{checked:o||c,indeterminate:r,onChange:()=>{if(ht(n.id),!o&&i){const g=n.children.map(b=>b.id);H(b=>[...new Set([...b,n.id,...g])])}else if(o&&i){const g=n.children.map(b=>b.id);H(b=>b.filter(J=>J!==n.id&&!g.includes(J)))}},size:"small"})}),e.jsx(de,{primary:e.jsxs(d,{component:"span",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(m,{component:"span",variant:"body2",fontWeight:i?600:400,children:n.meta?.title||n.name}),i&&e.jsx(O,{label:`${n.children.length}项`,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}})]}),secondary:n.path||"分组菜单"})]}),i&&e.jsx(Ae,{in:a,timeout:"auto",unmountOnExit:!0,children:e.jsx($,{component:"div",disablePadding:!0,children:Ne(n.children,s+1)})})]},n.id)});return Z?e.jsx(d,{sx:{height:"100vh",width:"100vw",display:"flex",justifyContent:"center",alignItems:"center",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1300,bgcolor:"background.default"},children:e.jsx(zt,{})}):e.jsxs(d,{sx:{height:"100vh",width:"100vw",display:"flex",flexDirection:"column",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1300,bgcolor:"background.default",overflow:"hidden"},children:[e.jsx(Rt,{position:"static",color:"default",elevation:1,sx:{flexShrink:0},children:e.jsxs(Nt,{children:[e.jsx(P,{edge:"start",onClick:()=>T(v),sx:{mr:2},children:e.jsx(Ot,{})}),e.jsx(Ft,{sx:{mr:2,fontSize:28}}),e.jsx(m,{variant:"h6",sx:{flexGrow:1},children:p("permissions.title","权限管理")})]})}),e.jsx(d,{sx:{flex:1,minHeight:0,width:"100%",display:"flex",flexDirection:"column",overflow:"hidden",p:2},children:e.jsx(Ht,{sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0,overflow:"hidden"},children:e.jsxs(Bt,{sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0,overflow:"hidden"},children:[e.jsxs(Gt,{value:E,onChange:(t,s)=>V(s),sx:{flexShrink:0},children:[e.jsx(re,{label:p("permissions.menuPermissions","菜单权限"),icon:e.jsx(Oe,{})}),e.jsx(re,{label:p("permissions.apiPermissions","API权限"),icon:e.jsx(Fe,{})}),e.jsx(re,{label:p("permissions.menuManagement","菜单管理"),icon:e.jsx(Oe,{})}),e.jsx(re,{label:p("permissions.apiManagement","API管理"),icon:e.jsx(Fe,{})})]}),e.jsx(he,{value:E,index:0,children:e.jsxs(d,{sx:{mt:2},children:[e.jsxs(d,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[e.jsxs(B,{sx:{minWidth:200},children:[e.jsx(G,{children:p("permissions.selectRole","选择角色")}),e.jsx(U,{value:u,onChange:t=>xe(t.target.value),label:p("permissions.selectRole","选择角色"),children:Te.map(t=>e.jsx(C,{value:t.id,children:e.jsx(m,{variant:"body2",children:t.name})},t.id))})]}),e.jsxs(d,{sx:{display:"flex",gap:1,alignItems:"center",flex:1},children:[e.jsx(w,{placeholder:"筛选菜单",value:ne,onChange:t=>it(t.target.value),size:"small",sx:{width:300}}),e.jsx(I,{variant:"outlined",size:"small",onClick:()=>{const t=ie(D(x),ne);De(t,!0)},children:"全选"}),e.jsx(I,{variant:"outlined",size:"small",onClick:()=>{const t=ie(D(x),ne);De(t,!1)},children:"全不选"}),e.jsx(O,{label:`已选择 ${F.length} 项`,color:"primary",variant:"outlined",size:"small"})]}),e.jsx(I,{variant:"contained",startIcon:e.jsx(He,{}),onClick:ct,disabled:!u,children:"保存菜单权限"})]}),u?e.jsx(oe,{variant:"outlined",sx:{maxHeight:500,overflow:"auto"},children:x.length===0?e.jsx(d,{sx:{p:4,textAlign:"center"},children:e.jsx(m,{color:"text.secondary",children:"暂无菜单数据"})}):e.jsx($,{children:Ne(ie(D(x),ne))})}):e.jsxs(d,{sx:{mt:4,textAlign:"center",py:8},children:[e.jsx(Be,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"请先选择角色"})]})]})}),e.jsx(he,{value:E,index:1,children:e.jsxs(d,{sx:{mt:2},children:[e.jsxs(d,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[e.jsxs(B,{sx:{minWidth:200},children:[e.jsx(G,{children:p("permissions.selectRole","选择角色")}),e.jsx(U,{value:u,onChange:t=>xe(t.target.value),label:p("permissions.selectRole","选择角色"),children:Te.map(t=>e.jsx(C,{value:t.id,children:e.jsx(m,{variant:"body2",children:t.name})},t.id))})]}),e.jsxs(d,{sx:{display:"flex",gap:1,alignItems:"center",flex:1},children:[e.jsx(w,{placeholder:"筛选API（路径、方法、描述）",value:X,onChange:t=>at(t.target.value),size:"small",sx:{width:300}}),e.jsx(O,{label:`已选择 ${se.length} 项`,color:"primary",variant:"outlined",size:"small"})]}),e.jsx(I,{variant:"contained",startIcon:e.jsx(He,{}),onClick:dt,disabled:!u,children:"保存API权限"})]}),u?e.jsx(oe,{variant:"outlined",sx:{maxHeight:500,overflow:"auto"},children:A.length===0?e.jsx(d,{sx:{p:4,textAlign:"center"},children:e.jsx(m,{color:"text.secondary",children:"暂无API数据"})}):e.jsx($,{children:Me.filter(t=>X?A.filter(n=>n.group===t).some(n=>{const i=X.toLowerCase();return n.path.toLowerCase().includes(i)||n.method.toLowerCase().includes(i)||n.group.toLowerCase().includes(i)||(n.description||"").toLowerCase().includes(i)}):!0).map(t=>{const s=A.filter(r=>{if(r.group!==t)return!1;if(!X)return!0;const c=X.toLowerCase();return r.path.toLowerCase().includes(c)||r.method.toLowerCase().includes(c)||r.group.toLowerCase().includes(c)||(r.description||"").toLowerCase().includes(c)}),n=lt.has(t),i=s.filter(r=>se.some(c=>c.path===r.path&&c.method===r.method)).length,a=s.length>0&&i===s.length,o=i>0&&i<s.length;return e.jsxs(Q.Fragment,{children:[e.jsxs(ce,{sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:[e.jsx(N,{sx:{minWidth:36},children:e.jsx(P,{size:"small",onClick:()=>{rt(r=>{const c=new Set(r);return c.has(t)?c.delete(t):c.add(t),c})},children:n?e.jsx(Ce,{}):e.jsx(Ie,{})})}),e.jsx(N,{sx:{minWidth:40},children:e.jsx(we,{checked:a,indeterminate:o,onChange:()=>{a?s.forEach(r=>{q(c=>c.filter(g=>!(g.path===r.path&&g.method===r.method)))}):s.forEach(r=>{q(c=>c.some(b=>b.path===r.path&&b.method===r.method)?c:[...c,{path:r.path,method:r.method}])})},size:"small"})}),e.jsx(de,{primary:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(m,{variant:"subtitle2",fontWeight:600,children:t}),e.jsx(O,{label:`${i}/${s.length}`,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.7rem"}})]})})]}),e.jsx(Ae,{in:n,timeout:"auto",unmountOnExit:!0,children:e.jsx($,{component:"div",disablePadding:!0,children:s.map(r=>{const c=se.some(g=>g.path===r.path&&g.method===r.method);return e.jsxs(ce,{sx:{pl:6},children:[e.jsx(N,{sx:{minWidth:40},children:e.jsx(we,{checked:c,onChange:()=>pt(r.path,r.method),size:"small"})}),e.jsx(de,{primary:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(m,{variant:"body2",children:r.path}),e.jsx(O,{label:r.method,size:"small",color:"primary"})]}),secondary:r.description})]},r.id)})})})]},t)})})}):e.jsxs(d,{sx:{mt:4,textAlign:"center",py:8},children:[e.jsx(Be,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"请先选择角色"})]})]})}),e.jsxs(he,{value:E,index:2,children:[e.jsxs(d,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1},children:[e.jsx(m,{variant:"body2",color:"text.secondary",children:"提示：使用上下箭头调整菜单顺序，排序会自动保存；点击展开按钮查看子菜单"}),e.jsxs(d,{sx:{display:"flex",gap:1},children:[e.jsx(I,{variant:"outlined",size:"small",onClick:()=>{const t=D(x),s=It(t);me(s)},children:"全部展开"}),e.jsx(I,{variant:"outlined",size:"small",onClick:()=>me(new Set),children:"全部折叠"}),e.jsx(I,{variant:"contained",startIcon:e.jsx(Pe,{}),onClick:()=>ve(void 0,""),children:"创建根菜单"})]})]}),e.jsx(oe,{variant:"outlined",sx:{maxHeight:600,overflow:"auto"},children:e.jsx($,{children:Re(D(x))})})]}),e.jsxs(he,{value:E,index:3,children:[e.jsx(d,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(I,{variant:"contained",startIcon:e.jsx(Pe,{}),onClick:()=>Le(),children:"创建API"})}),e.jsxs(as,{component:oe,children:[e.jsxs(is,{children:[e.jsx(ls,{children:e.jsxs(Se,{children:[e.jsx(S,{children:"路径"}),e.jsx(S,{children:"方法"}),e.jsx(S,{children:"分组"}),e.jsx(S,{children:"描述"}),e.jsx(S,{align:"right",children:"操作"})]})}),e.jsx(rs,{children:A.length===0?e.jsx(Se,{children:e.jsx(S,{colSpan:5,align:"center",children:e.jsx(m,{color:"text.secondary",sx:{py:4},children:"暂无API数据"})})}):A.slice(fe*ae,fe*ae+ae).map(t=>e.jsxs(Se,{children:[e.jsx(S,{children:t.path}),e.jsx(S,{children:e.jsx(O,{label:t.method,size:"small",color:"primary"})}),e.jsx(S,{children:t.group}),e.jsx(S,{children:t.description}),e.jsxs(S,{align:"right",children:[e.jsx(P,{onClick:()=>Le(t),children:e.jsx(Ge,{})}),e.jsx(P,{onClick:()=>yt(t.id),children:e.jsx(Ue,{})})]})]},t.id))})]}),e.jsx(os,{component:"div",count:A.length,page:fe,onPageChange:(t,s)=>Ee(s),rowsPerPage:ae,onRowsPerPageChange:t=>{ot(parseInt(t.target.value,10)),Ee(0)},rowsPerPageOptions:[10,25,50,100],labelRowsPerPage:"每页显示:",labelDisplayedRows:({from:t,to:s,count:n})=>`${t}-${s} 共 ${n} 条`,sx:{borderTop:"1px solid #e2e8f0",mt:0,width:"100%",".MuiTablePagination-toolbar":{paddingLeft:2,paddingRight:2,minHeight:"52px",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},".MuiTablePagination-spacer":{flex:"1 1 auto"},".MuiTablePagination-selectLabel":{marginRight:1,marginBottom:0,fontWeight:500,fontSize:"0.875rem",color:"text.secondary",display:"flex",alignItems:"center",lineHeight:1.5},".MuiTablePagination-displayedRows":{marginBottom:0,fontWeight:500,fontSize:"0.875rem",color:"text.secondary",display:"flex",alignItems:"center",lineHeight:1.5},".MuiTablePagination-select":{fontSize:"0.875rem",marginRight:2,marginTop:0,marginBottom:0},".MuiTablePagination-actions":{marginLeft:1,display:"flex",alignItems:"center"}}})]})]})]})})}),e.jsxs($e,{open:tt,onClose:()=>_(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ve,{children:z?"编辑菜单":"创建菜单"}),e.jsxs(_e,{children:[e.jsx(w,{fullWidth:!0,label:"路由路径",value:l.path,onChange:t=>f({...l,path:t.target.value}),margin:"normal",placeholder:"/assets, /terminal, /users",helperText:"前端路由路径，如：/assets, /terminal"}),e.jsx(w,{fullWidth:!0,label:"路由名称",value:l.name,onChange:t=>f({...l,name:t.target.value}),margin:"normal",placeholder:"唯一标识符，如：assets, terminal",helperText:"路由的唯一标识符，用于前端路由匹配"}),e.jsx(w,{fullWidth:!0,label:"文件路径",value:l.component||"",onChange:t=>f({...l,component:t.target.value}),margin:"normal",placeholder:"pages/Assets.tsx, pages/Terminal.tsx",helperText:"前端组件文件路径（可选），如：pages/Assets.tsx"}),e.jsx(w,{fullWidth:!0,label:"展示名称",value:l.meta?.title||"",onChange:t=>f({...l,meta:{title:t.target.value||"",icon:l.meta?.icon||"",keepAlive:l.meta?.keepAlive||!1,closeTab:l.meta?.closeTab||!1,defaultMenu:l.meta?.defaultMenu||!1,activeName:l.meta?.activeName||""}}),margin:"normal",placeholder:"显示在菜单中的名称"}),e.jsx(hs,{value:l.meta?.icon||"",onChange:t=>f({...l,meta:{title:l.meta?.title||"",icon:t||"",keepAlive:l.meta?.keepAlive||!1,closeTab:l.meta?.closeTab||!1,defaultMenu:l.meta?.defaultMenu||!1,activeName:l.meta?.activeName||""}}),label:"图标",margin:"normal"}),e.jsx(w,{fullWidth:!0,label:"高亮菜单",value:l.meta?.activeName||"",onChange:t=>f({...l,meta:{title:l.meta?.title||"",icon:l.meta?.icon||"",keepAlive:l.meta?.keepAlive||!1,closeTab:l.meta?.closeTab||!1,defaultMenu:l.meta?.defaultMenu||!1,activeName:t.target.value||""}}),margin:"normal",placeholder:l.name||"路由名称",helperText:"到达此路由时，指定左侧菜单的name会处于活跃状态（留空则使用路由名称）"}),e.jsx(Qe,{fullWidth:!0,options:[{id:"",label:"根菜单（顶级菜单）"},...je(D(x)).filter(t=>!z||t.id!==z.id)],getOptionLabel:t=>t.label,isOptionEqualToValue:(t,s)=>t.id===s.id,value:l.parentId===""?{id:"",label:"根菜单（顶级菜单）"}:je(D(x)).find(t=>t.id===l.parentId)||null,onChange:(t,s)=>{f({...l,parentId:s?.id||""})},renderInput:t=>e.jsx(w,{...t,label:"父菜单",margin:"normal",placeholder:"选择父菜单，留空表示顶级菜单"}),disabled:!!z}),e.jsx(w,{fullWidth:!0,type:"number",label:"排序标记",value:l.sort,onChange:t=>f({...l,sort:parseInt(t.target.value)||0}),margin:"normal",helperText:"数字越小越靠前"}),e.jsxs(B,{fullWidth:!0,margin:"normal",children:[e.jsx(G,{children:"是否隐藏"}),e.jsxs(U,{value:l.hidden?"true":"false",onChange:t=>f({...l,hidden:t.target.value==="true"}),label:"是否隐藏",children:[e.jsx(C,{value:"false",children:"否"}),e.jsx(C,{value:"true",children:"是"})]})]}),e.jsxs(B,{fullWidth:!0,margin:"normal",children:[e.jsx(G,{children:"KeepAlive"}),e.jsxs(U,{value:l.meta?.keepAlive?"true":"false",onChange:t=>f({...l,meta:{title:l.meta?.title||"",icon:l.meta?.icon||"",keepAlive:t.target.value==="true",closeTab:l.meta?.closeTab||!1,defaultMenu:l.meta?.defaultMenu||!1,activeName:l.meta?.activeName||""}}),label:"KeepAlive",children:[e.jsx(C,{value:"false",children:"否"}),e.jsx(C,{value:"true",children:"是"})]})]}),e.jsx(Ke,{control:e.jsx(Xe,{checked:l.meta?.closeTab||!1,onChange:t=>f({...l,meta:{title:l.meta?.title||"",icon:l.meta?.icon||"",keepAlive:l.meta?.keepAlive||!1,closeTab:t.target.checked,defaultMenu:l.meta?.defaultMenu||!1,activeName:l.meta?.activeName||""}})}),label:"自动关闭标签页"}),e.jsx(d,{sx:{mt:2},children:e.jsx(Ke,{control:e.jsx(Xe,{checked:l.meta?.defaultMenu||!1,onChange:t=>f({...l,meta:{title:l.meta?.title||"",icon:l.meta?.icon||"",keepAlive:l.meta?.keepAlive||!1,closeTab:l.meta?.closeTab||!1,defaultMenu:t.target.checked,activeName:l.meta?.activeName||""}})}),label:e.jsxs(d,{children:[e.jsx(m,{variant:"body1",fontWeight:"medium",children:"设为默认首页"}),e.jsx(m,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:"设置为默认首页后，该菜单将作为用户登录后的首页，且该菜单的标签页不可关闭"})]})})})]}),e.jsxs(qe,{children:[e.jsx(I,{onClick:()=>_(!1),children:"取消"}),e.jsx(I,{onClick:z?ft:mt,variant:"contained",children:"保存"})]})]}),e.jsxs($e,{open:st,onClose:()=>K(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ve,{children:te?"编辑API":"创建API"}),e.jsxs(_e,{children:[e.jsx(w,{fullWidth:!0,label:"路径",value:k.path,onChange:t=>L({...k,path:t.target.value}),margin:"normal",placeholder:"/api/users"}),e.jsxs(B,{fullWidth:!0,margin:"normal",children:[e.jsx(G,{children:"方法"}),e.jsxs(U,{value:k.method,onChange:t=>L({...k,method:t.target.value}),children:[e.jsx(C,{value:"GET",children:"GET"}),e.jsx(C,{value:"POST",children:"POST"}),e.jsx(C,{value:"PUT",children:"PUT"}),e.jsx(C,{value:"DELETE",children:"DELETE"}),e.jsx(C,{value:"PATCH",children:"PATCH"})]})]}),e.jsxs(B,{fullWidth:!0,margin:"normal",children:[e.jsx(G,{children:"分组"}),e.jsx(U,{value:k.group,onChange:t=>L({...k,group:t.target.value}),children:Me.map(t=>e.jsx(C,{value:t,children:t},t))})]}),e.jsx(w,{fullWidth:!0,label:"描述",value:k.description,onChange:t=>L({...k,description:t.target.value}),margin:"normal",multiline:!0,rows:3})]}),e.jsxs(qe,{children:[e.jsx(I,{onClick:()=>K(!1),children:"取消"}),e.jsx(I,{onClick:te?vt:jt,variant:"contained",children:"保存"})]})]}),e.jsx(cs,{open:Y.open,autoHideDuration:3e3,onClose:()=>j({...Y,open:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ut,{onClose:()=>j({...Y,open:!1}),severity:Y.severity,sx:{width:"100%"},children:Y.message})})]})}export{ys as default};
