import{u as z,r as a,aC as k,j as e,B as r,C as $,T as i,m as M,s as _,t as A,I as B,v as E,w as C,x as w,c as H,E as N}from"./index-DNdAKB9f.js";import{T as D,a as F,b as V,c as I,d as n,e as O}from"./TableRow-2FuGKbnY.js";import{C as g}from"./Chip-B8lB6W_F.js";import{T as U}from"./TablePagination-CykxsR0-.js";import"./LastPage-v7sA_Lnn.js";function X(){const{t:o}=z(),[P,x]=a.useState(!0),[v,u]=a.useState([]),[m,R]=a.useState(""),[c,j]=a.useState(0),[l,S]=a.useState(10),[f,p]=a.useState(0),[b,T]=a.useState(null),y=a.useCallback(async()=>{x(!0),T(null);try{const s=await k.getLoginRecords({page:c+1,pageSize:l});if(console.log("VM Login Records Response:",s),!s||!s.records){console.warn("No records returned from API, using empty array"),u([]),p(s?.total||0),x(!1);return}const h=(Array.isArray(s.records)?s.records:[]).map(t=>({id:t.id||t.sessionId||t.session_id||"",sessionId:t.sessionId||t.session_id||"",hostId:t.hostId||t.host_id||"",hostName:t.hostName||t.host_name||"Unknown",hostIp:t.hostIp||t.host_ip||"",username:t.username||"",connectionType:t.connectionType||t.connection_type||"webshell",loginTime:t.loginTime?new Date(t.loginTime).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"",logoutTime:t.logoutTime?new Date(t.logoutTime).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"",duration:t.duration||0,status:t.status||"unknown"}));u(h),p(s.total||0),x(!1)}catch(s){console.error("Failed to load VM login records:",s),T(o("history.loadError")+": "+(s.message||o("history.networkError"))),u([]),p(0),x(!1)}},[c,l,o]);a.useEffect(()=>{y()},[y]);const W=s=>{if(!s||s===0)return"-";const d=Math.floor(s/3600),h=Math.floor(s%3600/60),t=s%60;return d>0?`${d}${o("history.hour")} ${h}${o("history.minute")}`:h>0?`${h}${o("history.minute")} ${t}${o("history.second")}`:`${t}${o("history.second")}`},L=v.filter(s=>s.username.toLowerCase().includes(m.toLowerCase())||s.hostIp.includes(m)||s.hostName.toLowerCase().includes(m.toLowerCase()));return P?e.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx($,{})}):e.jsxs(r,{children:[e.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(r,{children:[e.jsx(i,{variant:"h4",component:"h1",children:o("history.vmLoginHistory")}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:o("history.vmLoginHistoryDesc")})]}),e.jsxs(r,{display:"flex",gap:2,children:[e.jsx(M,{size:"small",placeholder:o("common.search")+"...",value:m,onChange:s=>R(s.target.value),InputProps:{startAdornment:e.jsx(_,{position:"start",children:e.jsx(A,{})})}}),e.jsx(B,{onClick:y,color:"primary",children:e.jsx(E,{})})]})]}),b&&e.jsx(C,{sx:{mb:2,backgroundColor:"#fff3e0",borderLeft:"4px solid #ff9800"},children:e.jsx(w,{children:e.jsx(i,{color:"error",variant:"body1",children:b})})}),e.jsx(C,{elevation:0,sx:{border:"1px solid #e2e8f0"},children:e.jsxs(w,{sx:{p:0},children:[e.jsxs(r,{sx:{px:3,py:2.5,borderBottom:"1px solid #e2e8f0"},children:[e.jsx(i,{variant:"h6",fontWeight:"600",color:"text.primary",children:o("history.loginRecords")}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:o("common.totalRecords",{count:f})})]}),e.jsx(D,{children:e.jsxs(F,{children:[e.jsx(V,{children:e.jsxs(I,{children:[e.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.host")}),e.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.user")}),e.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.connectionType")}),e.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.startTime")}),e.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.endTime")}),e.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.duration")}),e.jsx(n,{sx:{fontWeight:700,color:"#667eea"},children:o("common.status")})]})}),e.jsx(O,{children:L.slice(c*l,c*l+l).map(s=>e.jsxs(I,{hover:!0,sx:{transition:"all 0.2s ease","&:hover":{backgroundColor:"rgba(102, 126, 234, 0.05)"}},children:[e.jsx(n,{children:e.jsxs(r,{children:[e.jsx(i,{variant:"body2",fontWeight:500,children:s.hostName}),e.jsx(i,{variant:"caption",color:"text.secondary",children:s.hostIp})]})}),e.jsx(n,{children:e.jsx(g,{label:s.username,size:"small",sx:{backgroundColor:"rgba(102, 126, 234, 0.1)",color:"#667eea"}})}),e.jsx(n,{children:e.jsx(g,{label:s.connectionType==="ssh_gateway"?o("sessions.sshClient"):s.connectionType==="webshell"?"WebShell":s.connectionType||"WebShell",size:"small",sx:{backgroundColor:s.connectionType==="ssh_gateway"?"rgba(76, 175, 80, 0.1)":"rgba(33, 150, 243, 0.1)",color:s.connectionType==="ssh_gateway"?"#4caf50":"#2196f3",fontWeight:500}})}),e.jsx(n,{children:e.jsx(i,{variant:"body2",color:"text.secondary",children:s.loginTime})}),e.jsx(n,{children:e.jsx(i,{variant:"body2",color:"text.secondary",children:s.logoutTime||"-"})}),e.jsx(n,{children:e.jsx(i,{variant:"body2",fontWeight:500,children:W(s.duration)})}),e.jsx(n,{children:s.status==="completed"?e.jsx(g,{icon:e.jsx(H,{style:{fontSize:16}}),label:o("history.success"),size:"small",sx:{backgroundColor:"#d4edda",color:"#155724"}}):s.status==="failed"?e.jsx(g,{icon:e.jsx(N,{style:{fontSize:16}}),label:o("history.failed"),size:"small",sx:{backgroundColor:"#f8d7da",color:"#721c24"}}):e.jsx(g,{label:o("common.inProgress"),size:"small",sx:{backgroundColor:"#ebf8ff",color:"#3182ce"}})})]},s.id))})]})}),f>0&&e.jsx(U,{component:"div",count:f,page:c,onPageChange:(s,d)=>j(d),rowsPerPage:l,onRowsPerPageChange:s=>{S(parseInt(s.target.value,10)),j(0)},rowsPerPageOptions:[10,25,50,100],labelRowsPerPage:`${o("common.rowsPerPage")}:`,sx:{borderTop:"1px solid #e2e8f0",mt:0,width:"100%",".MuiTablePagination-toolbar":{paddingLeft:2,paddingRight:2,minHeight:"52px",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},".MuiTablePagination-spacer":{flex:"1 1 auto"},".MuiTablePagination-selectLabel":{marginRight:1,marginBottom:0,fontWeight:500,fontSize:"0.875rem",color:"text.secondary",display:"flex",alignItems:"center",lineHeight:1.5},".MuiTablePagination-displayedRows":{marginBottom:0,fontWeight:500,fontSize:"0.875rem",color:"text.secondary",display:"flex",alignItems:"center",lineHeight:1.5},".MuiTablePagination-select":{fontSize:"0.875rem",marginRight:2,marginTop:0,marginBottom:0},".MuiTablePagination-actions":{marginLeft:1,display:"flex",alignItems:"center"}}})]})})]})}export{X as default};
