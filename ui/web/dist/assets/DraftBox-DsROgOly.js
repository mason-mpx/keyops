import{ax as z,r as a,j as e,B as c,T as d,a as h,v as B,w as L,x as A,C as E,b as R,I as x,g as N,h as O,dt as W,i as _,k as H,l as P,p as V}from"./index-wVs8DYHr.js";import{t as p}from"./ticketDraftApi-D-zyJD9D.js";import{T as q,a as F,b as G,c as m,d as s,e as J}from"./TableRow-17IyVPm2.js";import{C as K}from"./Chip-DzNpApxT.js";function Y(){const D=z(),[i,C]=a.useState([]),[j,l]=a.useState(!1),[b,n]=a.useState(!1),[r,u]=a.useState(null),y=t=>({draft:"待提交",cancelled:"已作废",void:"已作废"})[t]||t,v=t=>{switch(t){case"draft":return"default";case"cancelled":case"void":return"error";default:return"default"}},f=t=>t.status==="cancelled"||t.status==="void",S=t=>{T(t)};a.useEffect(()=>{o()},[]);const o=async()=>{try{l(!0);const t=await p.list();t.data.code===0&&C(t.data.data||[])}catch(t){console.error("加载草稿失败:",t)}finally{l(!1)}},T=t=>{D("/create-ticket",{state:{draftId:t.id,draftData:t,action:"edit"}})},k=t=>{u(t),n(!0)},I=async()=>{if(r)try{l(!0),(await p.delete(r.id)).data.code===0&&(await o(),n(!1),u(null))}catch(t){console.error("删除草稿失败:",t)}finally{l(!1)}},g=t=>new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return e.jsxs(c,{sx:{p:3},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(d,{variant:"h4",component:"h1",children:"草稿箱"}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(B,{}),onClick:o,disabled:j,children:"刷新"})]}),e.jsx(L,{children:e.jsx(A,{children:j&&i.length===0?e.jsx(c,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(E,{})}):i.length===0?e.jsx(R,{severity:"info",children:"草稿箱为空"}):e.jsx(q,{children:e.jsxs(F,{children:[e.jsx(G,{children:e.jsxs(m,{children:[e.jsx(s,{children:"创建时间"}),e.jsx(s,{children:"工单标题"}),e.jsx(s,{children:"状态"}),e.jsx(s,{children:"修改时间"}),e.jsx(s,{align:"right",children:"操作"})]})}),e.jsx(J,{children:i.map(t=>e.jsxs(m,{children:[e.jsx(s,{children:g(t.created_at)}),e.jsx(s,{children:e.jsx(d,{variant:"body2",fontWeight:500,children:t.title||"未命名工单"})}),e.jsx(s,{children:e.jsx(K,{label:y(t.status),color:v(t.status),size:"small",variant:"outlined"})}),e.jsx(s,{children:g(t.updated_at)}),e.jsxs(s,{align:"right",children:[e.jsx(x,{size:"small",onClick:()=>S(t),title:"继续编辑",disabled:f(t),children:e.jsx(N,{fontSize:"small"})}),e.jsx(x,{size:"small",onClick:()=>k(t),color:"error",title:"作废草稿",children:e.jsx(O,{fontSize:"small"})}),f(t)&&e.jsx(x,{size:"small",disabled:!0,title:"已作废",children:e.jsx(W,{fontSize:"small"})})]})]},t.id))})]})})})}),e.jsxs(_,{open:b,onClose:()=>n(!1),children:[e.jsx(H,{children:"确认作废"}),e.jsx(P,{children:e.jsxs(d,{children:['确定要作废草稿 "',r?.title||"未命名工单",'" 吗？此操作不可恢复。']})}),e.jsxs(V,{children:[e.jsx(h,{onClick:()=>n(!1),children:"取消"}),e.jsx(h,{onClick:I,color:"error",variant:"contained",children:"作废"})]})]})]})}export{Y as default};
