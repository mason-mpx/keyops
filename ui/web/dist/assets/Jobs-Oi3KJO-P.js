import{u as J,ax as Y,r as l,bf as c,j as e,B as r,T as p,w as b,x as g,b as B,C as D,a as E,cz as A,I as F,cA as L}from"./index-STo1oTDL.js";import{k as C}from"./index-BY4k-vmZ.js";import{k as R}from"./k8sClusterApi-7xlxICBp.js";import{C as O}from"./ClusterSelector-D_9vFdZX.js";import{N as H}from"./NamespaceSelector-4s1JeenR.js";import{Y as M}from"./YamlViewerDialog-NxVah2E0.js";import{T as P,a as V,b as q,c as m,d as n,e as G}from"./TableRow-e9fRaRV7.js";import{C as K}from"./Chip-v5QMYL72.js";import"./utils-Bf2w_ouu.js";import"./yaml-CjebJvkV.js";import"./namespaces-ClIDLtp_.js";function re(){const{t:a}=J(),y=Y(),[k,x]=l.useState(!1),[u,h]=l.useState([]),[t,S]=l.useState(""),[d,I]=l.useState(""),[w,T]=l.useState(null),[v,j]=l.useState(!1),[i,f]=l.useState(null);l.useEffect(()=>{t&&R.getCluster(t).then(T).catch(s=>{c(s?.response?.data?.message||"获取集群信息失败")})},[t]);const N=async()=>{if(!t){c(a("k8s.selectClusterFirst"));return}try{x(!0);const s={clusterId:t,namespace:d||void 0},o=await C.getJobList(s);h(o)}catch(s){const o=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||a("k8s.jobs.loadFailed");c(o),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&h([])}finally{x(!1)}};return l.useEffect(()=>{t&&N()},[t,d]),e.jsxs(r,{sx:{width:"100%",p:3},children:[e.jsx(r,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:e.jsxs(r,{children:[e.jsx(p,{variant:"h4",component:"h1",fontWeight:"700",children:a("k8s.jobs.title")}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:a("k8s.jobs.subtitle")})]})}),e.jsx(b,{sx:{mb:3},children:e.jsx(g,{children:e.jsxs(r,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(r,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(O,{value:t,onChange:S,size:"medium",fullWidth:!0,label:a("k8s.selectCluster")})}),t&&e.jsx(r,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(H,{value:d,onChange:I,clusterId:t,defaultNamespace:w?.defaultNamespace,size:"medium",fullWidth:!0,label:a("k8s.selectNamespace")})})]})})}),t?k?e.jsx(r,{display:"flex",justifyContent:"center",p:3,children:e.jsx(D,{})}):e.jsx(b,{children:e.jsx(g,{children:e.jsx(P,{children:e.jsxs(V,{children:[e.jsx(q,{children:e.jsxs(m,{children:[e.jsx(n,{children:a("k8s.jobs.name")}),e.jsx(n,{children:a("k8s.jobs.namespace")}),e.jsx(n,{children:a("k8s.jobs.completions")}),e.jsx(n,{children:a("k8s.jobs.duration")}),e.jsx(n,{children:a("k8s.jobs.age")}),e.jsx(n,{children:a("common.actions")})]})}),e.jsx(G,{children:u.length===0?e.jsx(m,{children:e.jsx(n,{colSpan:6,align:"center",children:e.jsx(p,{color:"textSecondary",children:a("common.noData")})})}):u.map(s=>e.jsxs(m,{children:[e.jsx(n,{children:s.name}),e.jsx(n,{children:s.namespace}),e.jsx(n,{children:e.jsx(K,{label:s.completions,color:s.completions>0?"success":"default",size:"small"})}),e.jsx(n,{children:s.duration||"-"}),e.jsx(n,{children:s.age}),e.jsx(n,{children:e.jsxs(r,{sx:{display:"flex",gap:.5},children:[e.jsx(E,{size:"small",variant:"outlined",startIcon:e.jsx(A,{}),onClick:()=>{if(!t){c("请先选择集群");return}const o=`/k8s/jobs/${t}/${s.namespace}/${s.name}`;y(o)},disabled:!t,children:a("k8s.viewDetails","详情")}),e.jsx(F,{size:"small",onClick:()=>{f(s),j(!0)},title:a("k8s.viewYaml"),children:e.jsx(L,{fontSize:"small"})})]})})]},`${s.namespace}-${s.name}`))})]})})})}):e.jsx(B,{severity:"info",children:a("k8s.selectClusterFirst")}),i&&e.jsx(M,{open:v,onClose:()=>{j(!1),f(null)},title:`${a("k8s.jobs.title")} - ${i.name}`,clusterId:t,namespace:i.namespace,resourceType:"job",resourceName:i.name,onLoadYaml:async(s,o,W,z)=>{const $={clusterId:s,namespace:o};return await C.getResourceYaml($,W,z)}})]})}export{re as default};
