import{r as s,j as e,B as u,T as S,w as P,x as W,a as C,A as M,C as F,b as z,W as N,X as R,Y as _,di as q,I as w,g as O,h as X,i as Y,k as $,l as G,m as D,p as H}from"./index-DNdAKB9f.js";import{f as x}from"./ticketApi-DZP3lA1o.js";import{P as J}from"./Pagination-LCTmwsmm.js";import"./LastPage-v7sA_Lnn.js";function Z(){const[y,I]=s.useState([]),[b,n]=s.useState(!1),[k,i]=s.useState(!1),[h,v]=s.useState(null),[r,m]=s.useState(""),[g,f]=s.useState(""),[o,j]=s.useState(1),[l]=s.useState(10),[p,A]=s.useState(0),c=s.useCallback(async()=>{try{n(!0);const t=await x.list({page:o,page_size:l});if(t.data.code===0){const a=t.data.data||[],d=t.data.total??a.length;I(a),A(d)}}catch(t){console.error("加载分类失败:",t)}finally{n(!1)}},[o,l]);s.useEffect(()=>{c()},[c]);const T=()=>{v(null),m(""),f(""),i(!0)},E=t=>{v(t),m(t.name),f(t.description||""),i(!0)},B=async()=>{if(r.trim())try{n(!0),h?await x.update(h.id,{name:r.trim(),description:g.trim()}):(await x.create({name:r.trim(),description:g.trim()}),j(1)),await c(),i(!1)}catch(t){console.error("保存分类失败:",t)}finally{n(!1)}},L=async t=>{if(window.confirm(`确定要删除分类"${t.name}"吗？删除后该分类下的模板将变为未分类。`))try{n(!0),await x.remove(t.id);const a=p-1,d=a>0?Math.min(o,Math.ceil(a/l)):1;d!==o?j(d):await c()}catch(a){console.error("删除分类失败:",a)}finally{n(!1)}};return e.jsxs(u,{sx:{p:3},children:[e.jsx(S,{variant:"h4",gutterBottom:!0,children:"分类管理"}),e.jsx(P,{sx:{mt:3},children:e.jsxs(W,{children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(S,{variant:"h6",children:"模板分类"}),e.jsx(C,{variant:"contained",startIcon:e.jsx(M,{}),onClick:T,children:"新建分类"})]}),b?e.jsx(u,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(F,{})}):y.length===0?e.jsx(z,{severity:"info",children:'暂无分类，点击"新建分类"创建第一个分类'}):e.jsxs(e.Fragment,{children:[e.jsx(N,{children:y.map(t=>e.jsxs(R,{divider:!0,children:[e.jsx(_,{primary:t.name,secondary:t.description}),e.jsxs(q,{children:[e.jsx(w,{edge:"end",onClick:()=>E(t),children:e.jsx(O,{})}),e.jsx(w,{edge:"end",onClick:()=>L(t),color:"error",children:e.jsx(X,{})})]})]},t.id))}),p>l&&e.jsx(u,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(J,{color:"primary",page:o,count:Math.ceil(p/l),onChange:(t,a)=>j(a)})})]})]})}),e.jsxs(Y,{open:k,onClose:()=>i(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx($,{children:h?"编辑分类":"新建分类"}),e.jsxs(G,{children:[e.jsx(D,{label:"分类名称",value:r,onChange:t=>m(t.target.value),fullWidth:!0,required:!0,sx:{mt:2},autoFocus:!0}),e.jsx(D,{label:"分类描述",value:g,onChange:t=>f(t.target.value),fullWidth:!0,multiline:!0,minRows:2,sx:{mt:2}})]}),e.jsxs(H,{children:[e.jsx(C,{onClick:()=>i(!1),children:"取消"}),e.jsx(C,{onClick:B,variant:"contained",disabled:!r.trim(),children:"保存"})]})]})]})}export{Z as default};
