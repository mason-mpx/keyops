import{ae as wt,j as t,aj as Dt,ak as Ot,r as o,al as qt,bB as Ke,an as Mt,af as it,aO as Oe,ao as Pt,ag as Gt,ah as ct,u as Ft,cd as Z,B as A,w as Ce,x as Ie,T as h,D as Ye,F as Ne,n as Ae,o as Le,M as j,b as ne,Z as Ze,b9 as Ht,C as Xe,W as me,X as xe,b7 as ve,b8 as je,Y as be,I as k,cf as ke,m as Ve,s as Te,t as Qe,cg as Je,bm as Ut,ch as Bt,d as F,ci as _t,cj as zt,ck as et,_ as Wt,a as fe,v as Kt,f as Yt,P as we,cl as Zt,cm as tt,i as nt,k as st,l as at,cn as Xt,p as ot,bf as C,a7 as se,co as Vt}from"./index-z51Q_M-r.js";import{F as Qt}from"./index-B39DLDJr.js";import{A as Jt,a as en,b as tn}from"./AccordionSummary-RvMSMAlN.js";import{S as H}from"./Stack-07-bXrzl.js";import{S as nn}from"./Switch-CFen4WHb.js";import{C as X}from"./Chip-BoE43uAD.js";import{P as sn}from"./Pagination-B8N1aUB7.js";import{T as an,a as on,b as rn,c as rt,d as lt,e as ln}from"./TableRow-CKQKXB8v.js";import{D as cn}from"./DialogContentText-Cbxw_6rS.js";import"./LastPage-BCKcUFpS.js";const dn=wt(t.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}));function un(s){return Ot("MuiTableSortLabel",s)}const De=Dt("MuiTableSortLabel",["root","active","icon","iconDirectionDesc","iconDirectionAsc","directionDesc","directionAsc"]),mn=s=>{const{classes:y,direction:R,active:u}=s,M={root:["root",u&&"active",`direction${Oe(R)}`],icon:["icon",`iconDirection${Oe(R)}`]};return Pt(M,un,y)},xn=it(Gt,{name:"MuiTableSortLabel",slot:"Root",overridesResolver:(s,y)=>{const{ownerState:R}=s;return[y.root,R.active&&y.active]}})(ct(({theme:s})=>({cursor:"pointer",display:"inline-flex",justifyContent:"flex-start",flexDirection:"inherit",alignItems:"center","&:focus":{color:(s.vars||s).palette.text.secondary},"&:hover":{color:(s.vars||s).palette.text.secondary,[`& .${De.icon}`]:{opacity:.5}},[`&.${De.active}`]:{color:(s.vars||s).palette.text.primary,[`& .${De.icon}`]:{opacity:1,color:(s.vars||s).palette.text.secondary}}}))),bn=it("span",{name:"MuiTableSortLabel",slot:"Icon",overridesResolver:(s,y)=>{const{ownerState:R}=s;return[y.icon,y[`iconDirection${Oe(R.direction)}`]]}})(ct(({theme:s})=>({fontSize:18,marginRight:4,marginLeft:4,opacity:0,transition:s.transitions.create(["opacity","transform"],{duration:s.transitions.duration.shorter}),userSelect:"none",variants:[{props:{direction:"desc"},style:{transform:"rotate(0deg)"}},{props:{direction:"asc"},style:{transform:"rotate(180deg)"}}]}))),Tn=o.forwardRef(function(y,R){const u=qt({props:y,name:"MuiTableSortLabel"}),{active:M=!1,children:m,className:p,direction:I="asc",hideSortIcon:U=!1,IconComponent:V=dn,slots:ae={},slotProps:c={},...Q}=u,T={...u,active:M,direction:I,hideSortIcon:U,IconComponent:V},q=mn(T),w={slots:ae,slotProps:c},[L,B]=Ke("root",{elementType:xn,externalForwardedProps:w,ownerState:T,className:Mt(q.root,p),ref:R}),[_,Ee]=Ke("icon",{elementType:bn,externalForwardedProps:w,ownerState:T,className:q.icon});return t.jsxs(L,{disableRipple:!0,component:"span",...B,...Q,children:[m,U&&!M?null:t.jsx(_,{as:V,...Ee})]})});function Nn(){const{t:s}=Ft(),[y,R]=o.useState([]),[u,M]=o.useState(0),[m,p]=o.useState(""),[I,U]=o.useState(""),[V,ae]=o.useState(!1),[c,Q]=o.useState(null),[T,q]=o.useState([]),[w,L]=o.useState([]),[B,_]=o.useState(!1),[Ee,qe]=o.useState(!1),[z,dt]=o.useState([]),[P,oe]=o.useState([]),[ut,mt]=o.useState([]),[N,pe]=o.useState(""),[xt,he]=o.useState(!1),[bt,re]=o.useState(!1),[Me,Tt]=o.useState(!1),[W,ye]=o.useState(1),[D,ft]=o.useState(100),[O,Se]=o.useState(null),[J,Pe]=o.useState(""),[Ge,Fe]=o.useState(new Set),S=o.useRef(null),ee=o.useRef(null),f=y.find(e=>e.id===u)?.dbType||"mysql",Et=e=>({mysql:"sql",postgresql:"sql",mongodb:"javascript",redis:"plaintext",sqlserver:"sql",oracle:"sql"})[e.toLowerCase()]||"sql",ge=o.useCallback((e,n)=>{if(!e||!n)return;const a=()=>T,r=()=>w,d=()=>f,l=e.languages.registerCompletionItemProvider("sql",{provideCompletionItems:()=>{const E=[],v=a(),de=r(),K=d(),Y=["SELECT","FROM","WHERE","INSERT","UPDATE","DELETE","CREATE","DROP","ALTER","TABLE","DATABASE","INDEX","VIEW","TRIGGER","PROCEDURE","FUNCTION","JOIN","INNER","LEFT","RIGHT","FULL","OUTER","ON","AS","AND","OR","NOT","ORDER","BY","GROUP","HAVING","LIMIT","OFFSET","UNION","DISTINCT","COUNT","SUM","AVG","MAX","MIN","CASE","WHEN","THEN","ELSE","END","LIKE","IN","EXISTS","BETWEEN","IS","NULL","TRUE","FALSE"],ue=["RETURNING","RETURN","RETURNS","LANGUAGE","PLPGSQL","DECLARE","RAISE","EXCEPTION","BEGIN","END","IF","ELSEIF","LOOP","WHILE","FOR","FOREACH","CONTINUE","EXIT","PERFORM","EXECUTE","USING"],b=["ARRAY_AGG","STRING_AGG","JSON_AGG","JSONB_AGG","ARRAY_TO_STRING","TO_TSVECTOR","TO_TSQUERY","TS_RANK","TS_RANK_CD","TS_MATCHES","GENERATE_SERIES","UNNEST","ARRAY","ARRAY_LENGTH","ARRAY_APPEND","JSON_BUILD_OBJECT","JSON_BUILD_ARRAY","JSON_EXTRACT_PATH","JSONB_EXTRACT_PATH","JSON_POPULATE_RECORD","JSONB_POPULATE_RECORD","REGEXP_REPLACE","REGEXP_MATCH","REGEXP_SPLIT_TO_ARRAY","WINDOW","OVER","PARTITION","RANK","DENSE_RANK","ROW_NUMBER","LAG","LEAD","FIRST_VALUE","LAST_VALUE","NTILE","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","NOW","EXTRACT","AGE","DATE_TRUNC","TO_CHAR","TO_DATE","TO_TIMESTAMP","COALESCE","NULLIF","GREATEST","LEAST"],$e=["AUTO_INCREMENT","ENGINE","CHARSET","COLLATE","IFNULL","ON DUPLICATE KEY UPDATE","REPLACE","LOAD DATA","INFILE"],Re=["IFNULL","COALESCE","CONCAT","CONCAT_WS","SUBSTRING","SUBSTR","LEFT","RIGHT","LENGTH","CHAR_LENGTH","UPPER","LOWER","DATE_FORMAT","STR_TO_DATE","DATEDIFF","TIMESTAMPDIFF","GROUP_CONCAT","FIND_IN_SET","FIELD"];K==="postgresql"?(Y.forEach(i=>{E.push({label:i,kind:e.languages.CompletionItemKind.Keyword,insertText:i,documentation:`SQL keyword: ${i}`})}),ue.forEach(i=>{E.push({label:i,kind:e.languages.CompletionItemKind.Keyword,insertText:i,documentation:`PostgreSQL keyword: ${i}`})}),b.forEach(i=>{E.push({label:i,kind:e.languages.CompletionItemKind.Function,insertText:`${i}(`,documentation:`PostgreSQL function: ${i}`})})):K==="mysql"?(Y.forEach(i=>{E.push({label:i,kind:e.languages.CompletionItemKind.Keyword,insertText:i,documentation:`SQL keyword: ${i}`})}),$e.forEach(i=>{E.push({label:i,kind:e.languages.CompletionItemKind.Keyword,insertText:i,documentation:`MySQL keyword: ${i}`})}),Re.forEach(i=>{E.push({label:i,kind:e.languages.CompletionItemKind.Function,insertText:`${i}(`,documentation:`MySQL function: ${i}`})})):Y.forEach(i=>{E.push({label:i,kind:e.languages.CompletionItemKind.Keyword,insertText:i,documentation:`SQL keyword: ${i}`})});const te=K==="postgresql"?'"':"`";return v.forEach(i=>{E.push({label:i,kind:e.languages.CompletionItemKind.Module,insertText:`${te}${i}${te}`,documentation:`Database: ${i}`})}),de.forEach(i=>{E.push({label:i,kind:e.languages.CompletionItemKind.Class,insertText:`${te}${i}${te}`,documentation:`Table: ${i}`})}),{suggestions:E}},triggerCharacters:[".","`",'"'," "]});let x=null;d()==="mongodb"&&(x=e.languages.registerCompletionItemProvider("javascript",{provideCompletionItems:()=>{const E=r(),v=[{label:"db",kind:e.languages.CompletionItemKind.Variable,insertText:"db",documentation:"MongoDB database object"}];return E.forEach(b=>{v.push({label:b,kind:e.languages.CompletionItemKind.Class,insertText:`db.${b}`,documentation:`Collection: ${b}`})}),[{label:"find",insertText:"find(${1:query}, ${2:projection})",documentation:"Find documents matching query"},{label:"findOne",insertText:"findOne(${1:query}, ${2:projection})",documentation:"Find one document matching query"},{label:"findOneAndUpdate",insertText:"findOneAndUpdate(${1:filter}, ${2:update}, ${3:options})",documentation:"Find and update one document"},{label:"findOneAndReplace",insertText:"findOneAndReplace(${1:filter}, ${2:replacement}, ${3:options})",documentation:"Find and replace one document"},{label:"findOneAndDelete",insertText:"findOneAndDelete(${1:filter}, ${2:options})",documentation:"Find and delete one document"},{label:"insertOne",insertText:"insertOne(${1:document})",documentation:"Insert one document"},{label:"insertMany",insertText:"insertMany(${1:documents})",documentation:"Insert multiple documents"},{label:"updateOne",insertText:"updateOne(${1:filter}, ${2:update}, ${3:options})",documentation:"Update one document"},{label:"updateMany",insertText:"updateMany(${1:filter}, ${2:update}, ${3:options})",documentation:"Update multiple documents"},{label:"replaceOne",insertText:"replaceOne(${1:filter}, ${2:replacement}, ${3:options})",documentation:"Replace one document"},{label:"deleteOne",insertText:"deleteOne(${1:filter})",documentation:"Delete one document"},{label:"deleteMany",insertText:"deleteMany(${1:filter})",documentation:"Delete multiple documents"},{label:"aggregate",insertText:"aggregate(${1:pipeline})",documentation:"Perform aggregation pipeline"},{label:"countDocuments",insertText:"countDocuments(${1:filter})",documentation:"Count documents matching filter"},{label:"estimatedDocumentCount",insertText:"estimatedDocumentCount()",documentation:"Get estimated document count"},{label:"distinct",insertText:"distinct(${1:field}, ${2:query})",documentation:"Get distinct values for field"},{label:"createIndex",insertText:"createIndex(${1:keys}, ${2:options})",documentation:"Create an index"},{label:"createIndexes",insertText:"createIndexes(${1:indexes})",documentation:"Create multiple indexes"},{label:"dropIndex",insertText:"dropIndex(${1:index})",documentation:"Drop an index"},{label:"dropIndexes",insertText:"dropIndexes()",documentation:"Drop all indexes"},{label:"listIndexes",insertText:"listIndexes()",documentation:"List all indexes"}].forEach(b=>{v.push({label:b.label,kind:e.languages.CompletionItemKind.Method,insertText:b.insertText,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,documentation:b.documentation})}),[{label:"$eq",insertText:"$eq: ",documentation:"Equal to"},{label:"$ne",insertText:"$ne: ",documentation:"Not equal to"},{label:"$gt",insertText:"$gt: ",documentation:"Greater than"},{label:"$gte",insertText:"$gte: ",documentation:"Greater than or equal"},{label:"$lt",insertText:"$lt: ",documentation:"Less than"},{label:"$lte",insertText:"$lte: ",documentation:"Less than or equal"},{label:"$in",insertText:"$in: []",documentation:"In array"},{label:"$nin",insertText:"$nin: []",documentation:"Not in array"},{label:"$and",insertText:"$and: []",documentation:"Logical AND"},{label:"$or",insertText:"$or: []",documentation:"Logical OR"},{label:"$not",insertText:"$not: ",documentation:"Logical NOT"},{label:"$nor",insertText:"$nor: []",documentation:"Logical NOR"},{label:"$exists",insertText:"$exists: true",documentation:"Field exists"},{label:"$type",insertText:"$type: ",documentation:"Field type"},{label:"$regex",insertText:"$regex: ",documentation:"Regular expression"},{label:"$text",insertText:'$text: { $search: "" }',documentation:"Text search"},{label:"$where",insertText:"$where: ",documentation:"JavaScript expression"}].forEach(b=>{v.push({label:b.label,kind:e.languages.CompletionItemKind.Operator,insertText:b.insertText,documentation:b.documentation})}),[{label:"$set",insertText:"$set: {}",documentation:"Set field value"},{label:"$unset",insertText:"$unset: {}",documentation:"Remove field"},{label:"$inc",insertText:"$inc: {}",documentation:"Increment field"},{label:"$mul",insertText:"$mul: {}",documentation:"Multiply field"},{label:"$min",insertText:"$min: {}",documentation:"Minimum value"},{label:"$max",insertText:"$max: {}",documentation:"Maximum value"},{label:"$rename",insertText:"$rename: {}",documentation:"Rename field"},{label:"$setOnInsert",insertText:"$setOnInsert: {}",documentation:"Set on insert"},{label:"$push",insertText:"$push: {}",documentation:"Push to array"},{label:"$pull",insertText:"$pull: {}",documentation:"Pull from array"},{label:"$addToSet",insertText:"$addToSet: {}",documentation:"Add to set"},{label:"$pop",insertText:"$pop: {}",documentation:"Pop from array"},{label:"$pullAll",insertText:"$pullAll: {}",documentation:"Pull all from array"}].forEach(b=>{v.push({label:b.label,kind:e.languages.CompletionItemKind.Operator,insertText:b.insertText,documentation:b.documentation})}),[{label:"$match",insertText:"{ $match: {} }",documentation:"Filter documents"},{label:"$group",insertText:'{ $group: { _id: "$field" } }',documentation:"Group documents"},{label:"$project",insertText:"{ $project: {} }",documentation:"Select fields"},{label:"$sort",insertText:"{ $sort: {} }",documentation:"Sort documents"},{label:"$limit",insertText:"{ $limit: 10 }",documentation:"Limit documents"},{label:"$skip",insertText:"{ $skip: 0 }",documentation:"Skip documents"},{label:"$unwind",insertText:'{ $unwind: "$field" }',documentation:"Unwind array"},{label:"$lookup",insertText:'{ $lookup: { from: "", localField: "", foreignField: "", as: "" } }',documentation:"Join collections"},{label:"$facet",insertText:"{ $facet: {} }",documentation:"Multiple pipelines"},{label:"$count",insertText:'{ $count: "total" }',documentation:"Count documents"},{label:"$addFields",insertText:"{ $addFields: {} }",documentation:"Add fields"},{label:"$replaceRoot",insertText:"{ $replaceRoot: { newRoot: {} } }",documentation:"Replace root"}].forEach(b=>{v.push({label:b.label,kind:e.languages.CompletionItemKind.Module,insertText:b.insertText,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,documentation:b.documentation})}),{suggestions:v}},triggerCharacters:[".","(","{","[",'"',"'"]}));let $=null;return d()==="redis"&&($=e.languages.registerCompletionItemProvider("plaintext",{provideCompletionItems:()=>{const E=[],v=[{label:"SET",insertText:"SET ${1:key} ${2:value}",documentation:"Set key to hold string value"},{label:"GET",insertText:"GET ${1:key}",documentation:"Get value of key"},{label:"MGET",insertText:"MGET ${1:key1} ${2:key2}",documentation:"Get values of multiple keys"},{label:"MSET",insertText:"MSET ${1:key1} ${2:value1} ${3:key2} ${4:value2}",documentation:"Set multiple keys to multiple values"},{label:"SETEX",insertText:"SETEX ${1:key} ${2:seconds} ${3:value}",documentation:"Set key with expiration time"},{label:"SETNX",insertText:"SETNX ${1:key} ${2:value}",documentation:"Set key if not exists"},{label:"GETSET",insertText:"GETSET ${1:key} ${2:value}",documentation:"Get old value and set new value"},{label:"INCR",insertText:"INCR ${1:key}",documentation:"Increment integer value"},{label:"INCRBY",insertText:"INCRBY ${1:key} ${2:increment}",documentation:"Increment by integer"},{label:"DECR",insertText:"DECR ${1:key}",documentation:"Decrement integer value"},{label:"DECRBY",insertText:"DECRBY ${1:key} ${2:decrement}",documentation:"Decrement by integer"},{label:"APPEND",insertText:"APPEND ${1:key} ${2:value}",documentation:"Append value to string"},{label:"STRLEN",insertText:"STRLEN ${1:key}",documentation:"Get string length"},{label:"GETRANGE",insertText:"GETRANGE ${1:key} ${2:start} ${3:end}",documentation:"Get substring"},{label:"SETRANGE",insertText:"SETRANGE ${1:key} ${2:offset} ${3:value}",documentation:"Overwrite part of string"}],de=[{label:"HSET",insertText:"HSET ${1:key} ${2:field} ${3:value}",documentation:"Set field in hash"},{label:"HGET",insertText:"HGET ${1:key} ${2:field}",documentation:"Get field value from hash"},{label:"HMSET",insertText:"HMSET ${1:key} ${2:field1} ${3:value1} ${4:field2} ${5:value2}",documentation:"Set multiple fields in hash"},{label:"HMGET",insertText:"HMGET ${1:key} ${2:field1} ${3:field2}",documentation:"Get multiple field values"},{label:"HGETALL",insertText:"HGETALL ${1:key}",documentation:"Get all fields and values"},{label:"HDEL",insertText:"HDEL ${1:key} ${2:field1} ${3:field2}",documentation:"Delete fields from hash"},{label:"HEXISTS",insertText:"HEXISTS ${1:key} ${2:field}",documentation:"Check if field exists"},{label:"HKEYS",insertText:"HKEYS ${1:key}",documentation:"Get all field names"},{label:"HVALS",insertText:"HVALS ${1:key}",documentation:"Get all field values"},{label:"HLEN",insertText:"HLEN ${1:key}",documentation:"Get number of fields"},{label:"HINCRBY",insertText:"HINCRBY ${1:key} ${2:field} ${3:increment}",documentation:"Increment hash field"},{label:"HINCRBYFLOAT",insertText:"HINCRBYFLOAT ${1:key} ${2:field} ${3:increment}",documentation:"Increment hash field by float"}],K=[{label:"LPUSH",insertText:"LPUSH ${1:key} ${2:value1} ${3:value2}",documentation:"Push values to left of list"},{label:"RPUSH",insertText:"RPUSH ${1:key} ${2:value1} ${3:value2}",documentation:"Push values to right of list"},{label:"LPOP",insertText:"LPOP ${1:key}",documentation:"Pop value from left"},{label:"RPOP",insertText:"RPOP ${1:key}",documentation:"Pop value from right"},{label:"LLEN",insertText:"LLEN ${1:key}",documentation:"Get list length"},{label:"LRANGE",insertText:"LRANGE ${1:key} ${2:start} ${3:stop}",documentation:"Get range of elements"},{label:"LINDEX",insertText:"LINDEX ${1:key} ${2:index}",documentation:"Get element by index"},{label:"LSET",insertText:"LSET ${1:key} ${2:index} ${3:value}",documentation:"Set element by index"},{label:"LINSERT",insertText:"LINSERT ${1:key} BEFORE|AFTER ${2:pivot} ${3:value}",documentation:"Insert element before/after pivot"},{label:"LREM",insertText:"LREM ${1:key} ${2:count} ${3:value}",documentation:"Remove elements from list"},{label:"LTRIM",insertText:"LTRIM ${1:key} ${2:start} ${3:stop}",documentation:"Trim list to range"},{label:"RPOPLPUSH",insertText:"RPOPLPUSH ${1:source} ${2:destination}",documentation:"Pop from right, push to left"}],Y=[{label:"SADD",insertText:"SADD ${1:key} ${2:member1} ${3:member2}",documentation:"Add members to set"},{label:"SREM",insertText:"SREM ${1:key} ${2:member1} ${3:member2}",documentation:"Remove members from set"},{label:"SMEMBERS",insertText:"SMEMBERS ${1:key}",documentation:"Get all members"},{label:"SISMEMBER",insertText:"SISMEMBER ${1:key} ${2:member}",documentation:"Check if member exists"},{label:"SCARD",insertText:"SCARD ${1:key}",documentation:"Get set cardinality"},{label:"SPOP",insertText:"SPOP ${1:key} ${2:count}",documentation:"Remove and return random members"},{label:"SRANDMEMBER",insertText:"SRANDMEMBER ${1:key} ${2:count}",documentation:"Get random members"},{label:"SINTER",insertText:"SINTER ${1:key1} ${2:key2}",documentation:"Intersection of sets"},{label:"SUNION",insertText:"SUNION ${1:key1} ${2:key2}",documentation:"Union of sets"},{label:"SDIFF",insertText:"SDIFF ${1:key1} ${2:key2}",documentation:"Difference of sets"},{label:"SMOVE",insertText:"SMOVE ${1:source} ${2:destination} ${3:member}",documentation:"Move member between sets"}],ue=[{label:"ZADD",insertText:"ZADD ${1:key} ${2:score} ${3:member}",documentation:"Add member with score"},{label:"ZREM",insertText:"ZREM ${1:key} ${2:member1} ${3:member2}",documentation:"Remove members"},{label:"ZRANGE",insertText:"ZRANGE ${1:key} ${2:start} ${3:stop} [WITHSCORES]",documentation:"Get range by rank"},{label:"ZREVRANGE",insertText:"ZREVRANGE ${1:key} ${2:start} ${3:stop} [WITHSCORES]",documentation:"Get range by rank (reverse)"},{label:"ZRANGEBYSCORE",insertText:"ZRANGEBYSCORE ${1:key} ${2:min} ${3:max} [WITHSCORES]",documentation:"Get range by score"},{label:"ZREVRANGEBYSCORE",insertText:"ZREVRANGEBYSCORE ${1:key} ${2:max} ${3:min} [WITHSCORES]",documentation:"Get range by score (reverse)"},{label:"ZSCORE",insertText:"ZSCORE ${1:key} ${2:member}",documentation:"Get member score"},{label:"ZRANK",insertText:"ZRANK ${1:key} ${2:member}",documentation:"Get member rank"},{label:"ZREVRANK",insertText:"ZREVRANK ${1:key} ${2:member}",documentation:"Get member rank (reverse)"},{label:"ZCARD",insertText:"ZCARD ${1:key}",documentation:"Get sorted set cardinality"},{label:"ZCOUNT",insertText:"ZCOUNT ${1:key} ${2:min} ${3:max}",documentation:"Count members in score range"},{label:"ZINCRBY",insertText:"ZINCRBY ${1:key} ${2:increment} ${3:member}",documentation:"Increment member score"},{label:"ZREM",insertText:"ZREM ${1:key} ${2:member}",documentation:"Remove member"},{label:"ZREMRANGEBYRANK",insertText:"ZREMRANGEBYRANK ${1:key} ${2:start} ${3:stop}",documentation:"Remove by rank range"},{label:"ZREMRANGEBYSCORE",insertText:"ZREMRANGEBYSCORE ${1:key} ${2:min} ${3:max}",documentation:"Remove by score range"}],b=[{label:"KEYS",insertText:"KEYS ${1:pattern}",documentation:"Find keys matching pattern"},{label:"SCAN",insertText:"SCAN ${1:cursor} [MATCH pattern] [COUNT count]",documentation:"Incrementally iterate keys"},{label:"EXISTS",insertText:"EXISTS ${1:key1} ${2:key2}",documentation:"Check if keys exist"},{label:"DEL",insertText:"DEL ${1:key1} ${2:key2}",documentation:"Delete keys"},{label:"EXPIRE",insertText:"EXPIRE ${1:key} ${2:seconds}",documentation:"Set expiration time"},{label:"TTL",insertText:"TTL ${1:key}",documentation:"Get time to live"},{label:"PTTL",insertText:"PTTL ${1:key}",documentation:"Get time to live in milliseconds"},{label:"PERSIST",insertText:"PERSIST ${1:key}",documentation:"Remove expiration"},{label:"TYPE",insertText:"TYPE ${1:key}",documentation:"Get key type"},{label:"RENAME",insertText:"RENAME ${1:key} ${2:newkey}",documentation:"Rename key"},{label:"RENAMENX",insertText:"RENAMENX ${1:key} ${2:newkey}",documentation:"Rename key if newkey does not exist"},{label:"MOVE",insertText:"MOVE ${1:key} ${2:db}",documentation:"Move key to another database"},{label:"DUMP",insertText:"DUMP ${1:key}",documentation:"Serialize key value"},{label:"RESTORE",insertText:"RESTORE ${1:key} ${2:ttl} ${3:serialized-value}",documentation:"Restore serialized value"}],$e=[{label:"INFO",insertText:"INFO [section]",documentation:"Get server information"},{label:"CONFIG GET",insertText:"CONFIG GET ${1:parameter}",documentation:"Get configuration parameter"},{label:"CONFIG SET",insertText:"CONFIG SET ${1:parameter} ${2:value}",documentation:"Set configuration parameter"},{label:"DBSIZE",insertText:"DBSIZE",documentation:"Get number of keys"},{label:"FLUSHDB",insertText:"FLUSHDB",documentation:"Remove all keys from current database"},{label:"FLUSHALL",insertText:"FLUSHALL",documentation:"Remove all keys from all databases"},{label:"SELECT",insertText:"SELECT ${1:index}",documentation:"Select database by index"},{label:"PING",insertText:"PING [message]",documentation:"Ping server"},{label:"ECHO",insertText:"ECHO ${1:message}",documentation:"Echo message"},{label:"TIME",insertText:"TIME",documentation:"Get server time"},{label:"CLIENT LIST",insertText:"CLIENT LIST",documentation:"List connected clients"},{label:"CLIENT GETNAME",insertText:"CLIENT GETNAME",documentation:"Get client name"},{label:"CLIENT SETNAME",insertText:"CLIENT SETNAME ${1:name}",documentation:"Set client name"}],Re=[{label:"PUBLISH",insertText:"PUBLISH ${1:channel} ${2:message}",documentation:"Publish message to channel"},{label:"SUBSCRIBE",insertText:"SUBSCRIBE ${1:channel1} ${2:channel2}",documentation:"Subscribe to channels"},{label:"PSUBSCRIBE",insertText:"PSUBSCRIBE ${1:pattern1} ${2:pattern2}",documentation:"Subscribe to channel patterns"},{label:"UNSUBSCRIBE",insertText:"UNSUBSCRIBE [channel1] [channel2]",documentation:"Unsubscribe from channels"},{label:"PUNSUBSCRIBE",insertText:"PUNSUBSCRIBE [pattern1] [pattern2]",documentation:"Unsubscribe from patterns"}],We=[{label:"MULTI",insertText:"MULTI",documentation:"Start transaction"},{label:"EXEC",insertText:"EXEC",documentation:"Execute transaction"},{label:"DISCARD",insertText:"DISCARD",documentation:"Discard transaction"},{label:"WATCH",insertText:"WATCH ${1:key1} ${2:key2}",documentation:"Watch keys for changes"},{label:"UNWATCH",insertText:"UNWATCH",documentation:"Unwatch all keys"}];return[...v,...de,...K,...Y,...ue,...b,...$e,...Re,...We].forEach(i=>{E.push({label:i.label,kind:e.languages.CompletionItemKind.Function,insertText:i.insertText,insertTextRules:e.languages.CompletionItemInsertTextRule.InsertAsSnippet,documentation:i.documentation})}),{suggestions:E}},triggerCharacters:[" ",`
`]})),()=>{l.dispose(),x&&x.dispose(),$&&$.dispose()}},[T,w,f]),le=o.useCallback(async()=>{try{const e=await Z.getMyPermissions(),n=e?.data||e;let a=[];if(Array.isArray(n))a=n;else if(n&&typeof n=="object"&&"list"in n){const l=n;a=Array.isArray(l.list)?l.list:[]}const r=a.map(l=>({instanceId:Number(l.instanceId||l.instance_id||0),databaseName:l.databaseName,tableName:l.tableName||l.table}));dt(r);const d=new Set;return r.forEach(l=>{l.instanceId&&d.add(l.instanceId)}),d}catch(e){return console.error("Failed to load authorized permissions:",e),new Set}},[]),ie=o.useCallback(async()=>{try{const e=await le();if(e.size===0){R([]);return}const n=await Z.listInstances({page:1,page_size:1e3}),r=(n?.list||n?.data?.list||[]).filter(d=>e.has(d.id));R(r)}catch(e){console.error("Failed to load instances:",e),R([])}},[le]),ce=o.useCallback(e=>`dms_query_history_${e.toLowerCase()}`,[]),He=o.useCallback(()=>{const e=ce(f),n=localStorage.getItem(e);if(n)try{oe(JSON.parse(n))}catch(a){console.error("Failed to parse query history:",a)}else oe([])},[f,ce]),pt=o.useCallback(async()=>{if(u){_(!0);try{const e=await Z.getDatabases(u);let n=[];Array.isArray(e)?n=e:e?.data&&Array.isArray(e.data)&&(n=e.data);const a=z.filter(l=>l.instanceId===u),r=a.some(l=>!l.databaseName);let d=[];if(r)d=n;else{const l=new Set;a.forEach(x=>{x.databaseName&&l.add(x.databaseName)}),d=n.filter(x=>l.has(x))}q(d)}catch(e){console.error("Failed to load databases:",e),q([])}finally{_(!1)}}},[u,z]),Ue=o.useCallback(async()=>{if(!(!u||!m)){qe(!0);try{const e=await Z.getTables(u,m);let n=[];Array.isArray(e)?n=e:e?.data&&Array.isArray(e.data)&&(n=e.data),z.filter(r=>r.instanceId===u&&(!r.databaseName||r.databaseName===m)).length>0?L(n):L([])}catch(e){console.error("Failed to load tables:",e),L([])}finally{qe(!1)}}},[u,m,z]);o.useEffect(()=>{ie()},[ie]),o.useEffect(()=>{He()},[He]),o.useEffect(()=>{const e=()=>{le().then(()=>{ie()})};return window.addEventListener("dmsPermissionUpdated",e),()=>{window.removeEventListener("dmsPermissionUpdated",e)}},[le,ie]),o.useEffect(()=>{u>0?(p(""),L([]),pt()):(q([]),p(""),L([]))},[u]),o.useEffect(()=>{!B&&T.length>0&&m&&!T.includes(m)&&(console.log(`[Query] 清空无效的数据库选择: ${m}, 可用数据库:`,T),p(""),L([]))},[T,m,B]),o.useEffect(()=>{u>0&&m?Ue():L([])},[u,m]),o.useEffect(()=>{if(ee.current&&S.current){const e=ge(ee.current,S.current);return()=>{e&&e()}}},[T,w,f,ge]);const ht=(e,n,a)=>{const d=[{query:e,timestamp:Date.now(),instanceId:n,databaseName:a,dbType:f},...P.filter(x=>x.query!==e)].slice(0,50);oe(d);const l=ce(f);localStorage.setItem(l,JSON.stringify(d))},Be=async()=>{if(!u||!m||!I.trim()){C(s("dms.query.selectInstanceDatabase"));return}if(B){C(s("dms.query.loadingDatabases"));return}if(T.length>0&&!T.includes(m)){console.log(`[Query] 执行查询前验证失败: 数据库 "${m}" 不在列表中`,T),C(s("dms.query.invalidDatabase",{database:m})),p("");return}ae(!0),Q(null),pe(""),ye(1),Se(null);try{let e=I.trim();Me&&!e.toUpperCase().startsWith("EXPLAIN")&&(e=`EXPLAIN ${e}`);const n=await Z.executeQuery({instanceId:u,databaseName:m,query:e});Q(n),n.success?(ht(I,u,m),se(s("dms.query.queryExecuted",{count:n.resultCount||0}))):n.error&&C(n.error)}catch(e){let n=s("dms.query.queryFailed");if(e instanceof Vt&&e.response){const a=e.response.data;n=a?.message||a?.error||e.message||n}else e instanceof Error&&(n=e.message||n);Q({success:!1,error:n}),C(n)}finally{ae(!1)}},yt=o.useCallback(async e=>{if(U(e.query),e.instanceId!==u){M(e.instanceId),_(!0);try{const n=await Z.getDatabases(e.instanceId);let a=[];Array.isArray(n)?a=n:n?.data&&Array.isArray(n.data)&&(a=n.data);const r=z.filter(x=>x.instanceId===e.instanceId),d=r.some(x=>!x.databaseName);let l=[];if(d)l=a;else{const x=new Set;r.forEach($=>{$.databaseName&&x.add($.databaseName)}),l=a.filter($=>x.has($))}q(l),e.databaseName?(l.length>0&&l.includes(e.databaseName)||l.length===0||console.warn(`[Query] 历史记录中的数据库 "${e.databaseName}" 不在当前实例的数据库中`),p(e.databaseName)):p("")}catch(n){console.error("加载数据库列表失败:",n),q([]),e.databaseName&&p(e.databaseName)}finally{_(!1)}}else e.databaseName?(T.length>0&&T.includes(e.databaseName)||T.length,p(e.databaseName)):p("")},[u,T,z]),St=o.useCallback(e=>{let n="";if(f==="mongodb")n=`db.${e}.find({});`;else{const a=f==="postgresql"?'"':"`";n=`SELECT * FROM ${a}${e}${a} LIMIT 100;`}U(n),S.current&&S.current.focus()},[f]),gt=o.useCallback(()=>{mt(e=>e.includes("tables")?e.filter(n=>n!=="tables"):[...e,"tables"])},[]),$t=()=>{if(!c?.rows)return;const e=N?G:c.rows;if(e.length===0){C(s("dms.query.noDataToCopy"));return}const n=[c.columns?.join("	"),...e.map(a=>a.join("	"))].join(`
`);navigator.clipboard.writeText(n).catch(()=>{C(s("dms.query.copyFailed"))}),se(s("dms.query.resultCopied"))},Rt=()=>{if(!c?.rows)return;const e=g.length>0?g:N?G:c.rows;if(e.length===0){C(s("dms.query.noDataToExport"));return}const n=[c.columns?.join(","),...e.map(a=>a.map(r=>`"${String(r||"").replace(/"/g,'""')}"`).join(","))].join(`
`);try{const a=new Blob(["\uFEFF"+n],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=`query_result_${new Date().getTime()}.csv`,r.click(),setTimeout(()=>URL.revokeObjectURL(r.href),100),se(s("dms.query.resultExported"))}catch(a){console.error("Failed to export CSV:",a),C(s("dms.query.exportFailed"))}},Ct=()=>{if(!c?.rows)return;const e=g.length>0?g:N?G:c.rows;if(e.length===0){C(s("dms.query.noDataToExport"));return}const n=e.map(a=>{const r={};return c.columns?.forEach((d,l)=>{r[d]=a[l]}),r});try{const a=JSON.stringify(n,null,2),r=new Blob([a],{type:"application/json"}),d=document.createElement("a");d.href=URL.createObjectURL(r),d.download=`query_result_${new Date().getTime()}.json`,d.click(),setTimeout(()=>URL.revokeObjectURL(d.href),100),se(s("dms.query.resultExported"))}catch(a){console.error("Failed to export JSON:",a),C(s("dms.query.exportFailed"))}},It=()=>{if(confirm(s("dms.query.clearHistoryConfirm"))){oe([]);const e=ce(f);localStorage.removeItem(e),se(s("dms.query.historyCleared"))}},Nt=o.useMemo(()=>f==="mongodb"?[{name:"查询所有文档",sql:"db.collection.find({})"},{name:"查询单个文档",sql:"db.collection.findOne({})"},{name:"条件查询",sql:'db.collection.find({ field: "value" })'},{name:"插入单个文档",sql:'db.collection.insertOne({ field: "value" })'},{name:"插入多个文档",sql:'db.collection.insertMany([{ field: "value1" }, { field: "value2" }])'},{name:"更新单个文档",sql:'db.collection.updateOne({ filter: {} }, { $set: { field: "value" } })'},{name:"更新多个文档",sql:'db.collection.updateMany({ filter: {} }, { $set: { field: "value" } })'},{name:"删除单个文档",sql:"db.collection.deleteOne({ filter: {} })"},{name:"删除多个文档",sql:"db.collection.deleteMany({ filter: {} })"},{name:"聚合查询",sql:'db.collection.aggregate([{ $match: {} }, { $group: { _id: "$field" } }])'}]:f==="redis"?[{name:"获取键值",sql:"GET key"},{name:"设置键值",sql:"SET key value"},{name:"获取哈希字段",sql:"HGET key field"},{name:"设置哈希字段",sql:"HSET key field value"},{name:"获取列表元素",sql:"LRANGE key 0 -1"},{name:"获取集合成员",sql:"SMEMBERS key"},{name:"获取有序集合",sql:"ZRANGE key 0 -1 WITHSCORES"}]:[{name:"SELECT * FROM table",sql:"SELECT * FROM `table_name` LIMIT 100;"},{name:"SELECT with WHERE",sql:"SELECT * FROM `table_name` WHERE `column` = 'value' LIMIT 100;"},{name:"SELECT with JOIN",sql:"SELECT t1.*, t2.* FROM `table1` t1 JOIN `table2` t2 ON t1.id = t2.id LIMIT 100;"},{name:"INSERT",sql:"INSERT INTO `table_name` (`col1`, `col2`) VALUES ('value1', 'value2');"},{name:"UPDATE",sql:"UPDATE `table_name` SET `col1` = 'value' WHERE `id` = 1;"},{name:"DELETE",sql:"DELETE FROM `table_name` WHERE `id` = 1;"},{name:"CREATE TABLE",sql:"CREATE TABLE `table_name` (\n  `id` INT PRIMARY KEY AUTO_INCREMENT,\n  `name` VARCHAR(255),\n  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);"},{name:"SHOW TABLES",sql:"SHOW TABLES;"},{name:"DESCRIBE TABLE",sql:"DESCRIBE `table_name`;"},{name:"EXPLAIN",sql:"EXPLAIN SELECT * FROM `table_name` WHERE `id` = 1;"}],[f]),At=e=>{if(S.current&&ee.current)try{let n=e;f==="postgresql"&&(n=e.replace(/`([^`]+)`/g,'"$1"'));const a=S.current.getPosition(),r=new ee.current.Range(a?.lineNumber||1,a?.column||1,a?.lineNumber||1,a?.column||1);S.current.executeEdits("insert-template",[{range:r,text:n+`
`}]),S.current.focus(),re(!1)}catch(n){console.error("Failed to insert template:",n),C(s("dms.query.templateInsertFailed"))}},G=o.useMemo(()=>c?.rows?.filter(e=>{if(!N)return!0;const n=N.toLowerCase();return e.some(a=>String(a||"").toLowerCase().includes(n))})||[],[c?.rows,N]),g=o.useMemo(()=>!O||G.length===0?G:[...G].sort((n,a)=>{const r=n[O.column],d=a[O.column];if(r==null&&d==null)return 0;if(r==null)return 1;if(d==null)return-1;const l=Number(r),x=Number(d);if(!isNaN(l)&&!isNaN(x))return O.direction==="asc"?l-x:x-l;const $=String(r).toLowerCase(),E=String(d).toLowerCase();return O.direction==="asc"?$.localeCompare(E):E.localeCompare($)}),[G,O]),_e=o.useMemo(()=>{const e=(W-1)*D;return g.slice(e,e+D)},[g,W,D]),Lt=e=>{Se(n=>n?.column===e?n.direction==="asc"?{column:e,direction:"desc"}:null:{column:e,direction:"asc"})},vt=()=>{if(S.current){const e=S.current.getSelection();e&&e.isEmpty(),S.current.getAction("editor.action.commentLine")?.run()}},jt=e=>{const n=new Set(Ge);n.has(e)?n.delete(e):n.add(e),Fe(n),localStorage.setItem("dms_favorite_queries",JSON.stringify(Array.from(n)))};o.useEffect(()=>{const e=localStorage.getItem("dms_favorite_queries");if(e)try{Fe(new Set(JSON.parse(e)))}catch(n){console.error("Failed to load favorite queries:",n)}},[]);const ze=o.useMemo(()=>{if(!J)return P;const e=J.toLowerCase();return P.filter(n=>n.query.toLowerCase().includes(e)||n.databaseName.toLowerCase().includes(e))},[P,J]),kt=[{key:"Ctrl/Cmd + Enter",desc:s("dms.query.shortcutExecute")},{key:"Ctrl/Cmd + /",desc:s("dms.query.shortcutComment")},{key:"Ctrl/Cmd + F",desc:s("dms.query.shortcutFind")},{key:"Ctrl/Cmd + H",desc:s("dms.query.shortcutReplace")}];return t.jsxs(A,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:"column",overflow:"hidden",width:"100%",m:0,p:0},children:[t.jsxs(A,{sx:{height:"100%",display:"flex",width:"100%",overflow:"hidden"},children:[t.jsx(A,{sx:{height:"100%",width:"30%",display:"flex",flexDirection:"column",borderRight:"1px solid",borderColor:"divider",flexShrink:0},children:t.jsx(Ce,{elevation:0,sx:{borderRadius:0,height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:t.jsxs(Ie,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",p:2},children:[t.jsx(h,{variant:"h6",fontWeight:600,gutterBottom:!0,children:s("dms.query.databaseNav")}),t.jsx(Ye,{sx:{mb:2}}),t.jsxs(Ne,{fullWidth:!0,sx:{mb:2},size:"small",children:[t.jsx(Ae,{children:s("dms.query.selectInstance")}),t.jsxs(Le,{value:u,label:s("dms.query.selectInstance"),onChange:e=>{const n=Number(e.target.value);M(n),p(""),L([])},children:[t.jsx(j,{value:0,children:s("dms.query.selectInstance")}),y.length===0?t.jsx(j,{value:-1,disabled:!0,children:s("dms.query.noAuthorizedInstances")}):y.map(e=>t.jsxs(j,{value:e.id,children:[e.name," (",e.dbType,")"]},e.id))]})]}),y.length===0&&t.jsx(ne,{severity:"info",sx:{mb:2},children:s("dms.query.noInstancePermission")}),t.jsxs(Ne,{fullWidth:!0,sx:{mb:2},size:"small",children:[t.jsx(Ae,{children:s("dms.query.selectDatabase")}),t.jsxs(Le,{value:m,label:s("dms.query.selectDatabase"),onChange:e=>p(e.target.value),disabled:!u||B,children:[t.jsx(j,{value:"",children:s("dms.query.selectDatabase")}),T.map(e=>t.jsxs(j,{value:e,children:[t.jsx(Ze,{sx:{fontSize:16,mr:1,verticalAlign:"middle"}}),e]},e))]})]}),m&&f!=="redis"&&f!=="mongodb"&&t.jsxs(Jt,{expanded:ut.includes("tables"),onChange:gt,sx:{mb:2},children:[t.jsx(en,{expandIcon:t.jsx(Ht,{}),children:t.jsxs(h,{variant:"subtitle2",fontWeight:500,children:[s("dms.query.tableList")," (",w.length,")"]})}),t.jsx(tn,{sx:{p:1},children:Ee?t.jsx(Xe,{size:20}):w.length===0?t.jsx(h,{variant:"body2",color:"text.secondary",children:s("common.noData")}):t.jsx(me,{dense:!0,sx:{maxHeight:200,overflow:"auto"},children:w.map(e=>t.jsx(xe,{disablePadding:!0,sx:{borderRadius:1,mb:.5},children:t.jsxs(ve,{onClick:()=>St(e),sx:{borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:[t.jsx(je,{sx:{minWidth:32},children:t.jsx(Ze,{fontSize:"small"})}),t.jsx(be,{primary:e,primaryTypographyProps:{variant:"body2",fontFamily:"monospace"}})]})},e))})})]}),t.jsx(Ye,{sx:{my:1}}),t.jsxs(A,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",minHeight:0},children:[t.jsxs(A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[t.jsx(h,{variant:"subtitle2",fontWeight:500,children:s("dms.query.queryHistory")}),t.jsx(H,{direction:"row",spacing:.5,children:P.length>0&&t.jsx(k,{size:"small",onClick:It,children:t.jsx(ke,{fontSize:"small"})})})]}),P.length>0&&t.jsx(Ve,{size:"small",placeholder:s("dms.query.searchHistory"),value:J,onChange:e=>Pe(e.target.value),InputProps:{startAdornment:t.jsx(Te,{position:"start",children:t.jsx(Qe,{fontSize:"small"})}),endAdornment:J&&t.jsx(Te,{position:"end",children:t.jsx(k,{size:"small",onClick:()=>Pe(""),children:t.jsx(ke,{fontSize:"small"})})})},sx:{mb:1}}),ze.length===0?t.jsx(h,{variant:"body2",color:"text.secondary",children:P.length===0?s("dms.query.noHistory"):s("dms.query.noMatchingHistory")}):t.jsx(me,{dense:!0,sx:{flex:1,overflow:"auto",minHeight:0},children:ze.slice(0,10).map((e,n)=>{const a=Ge.has(e.query);return t.jsx(xe,{disablePadding:!0,sx:{borderRadius:1,mb:.5},children:t.jsxs(ve,{onClick:()=>yt(e),sx:{borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:[t.jsx(je,{sx:{minWidth:32},children:a?t.jsx(Je,{fontSize:"small",sx:{color:"warning.main"}}):t.jsx(Ut,{fontSize:"small"})}),t.jsx(be,{primary:t.jsx(h,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.75rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.query}),secondary:new Date(e.timestamp).toLocaleString()}),t.jsx(k,{size:"small",onClick:r=>{r.stopPropagation(),jt(e.query)},sx:{ml:1},children:a?t.jsx(Je,{fontSize:"small",sx:{color:"warning.main"}}):t.jsx(Bt,{fontSize:"small"})})]})},n)})})]})]})})}),t.jsxs(A,{sx:{height:"100%",width:"70%",display:"flex",flexDirection:"column",flexShrink:0,gap:0},children:[t.jsx(Ce,{elevation:0,sx:{borderRadius:0,borderBottom:"1px solid",borderColor:"divider",flex:"0 0 auto",display:"flex",flexDirection:"column"},children:t.jsxs(Ie,{sx:{display:"flex",flexDirection:"column",p:2},children:[t.jsxs(A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[t.jsx(h,{variant:"h6",fontWeight:600,children:s("dms.query.title")}),t.jsxs(H,{direction:"row",spacing:1,flexWrap:"wrap",alignItems:"center",children:[t.jsx(F,{title:s("dms.query.toggleComment"),children:t.jsx(k,{size:"small",onClick:vt,disabled:!I.trim(),children:t.jsx(_t,{fontSize:"small"})})}),t.jsx(F,{title:s("dms.query.sqlTemplates"),children:t.jsx(k,{size:"small",onClick:()=>re(!0),disabled:!m,children:t.jsx(zt,{fontSize:"small"})})}),t.jsx(F,{title:s("dms.query.keyboardShortcuts"),children:t.jsx(k,{size:"small",onClick:()=>he(!0),children:t.jsx(et,{fontSize:"small"})})}),t.jsx(Wt,{control:t.jsx(nn,{size:"small",checked:Me,onChange:e=>Tt(e.target.checked)}),label:t.jsx(F,{title:s("dms.query.explainModeDesc"),children:t.jsx(h,{variant:"caption",children:s("dms.query.explainMode")})}),sx:{m:0}}),t.jsx(fe,{variant:"outlined",startIcon:t.jsx(Kt,{}),onClick:()=>{u&&m&&Ue()},size:"small",children:s("common.refresh")}),t.jsx(fe,{variant:"contained",startIcon:V?t.jsx(Xe,{size:16,color:"inherit"}):t.jsx(Yt,{}),onClick:Be,disabled:!u||!m||!I.trim()||V,sx:{borderRadius:1},children:s("dms.query.executeQuery")})]})]}),I&&(()=>{const e=new Blob([I]).size,n=(e/(1024*1024)).toFixed(2),a=(e/1024).toFixed(2),r=e>1024*1024?`${n} MB`:`${a} KB`;return e>100*1024?t.jsx(ne,{severity:"info",sx:{mb:1,fontSize:"0.75rem"},children:s("dms.query.largeSQLWarning",{size:r})}):null})(),t.jsx(A,{sx:{height:c?"200px":"300px",border:"1px solid",borderColor:"divider",borderRadius:1,overflow:"hidden",transition:"height 0.3s ease-in-out"},children:t.jsx(Qt,{height:"100%",language:Et(f),value:I,onChange:e=>U(e||""),theme:"vs",onMount:(e,n)=>{S.current=e,ee.current=n,ge(n,e),e.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.Enter,()=>{u&&m&&I.trim()&&Be()}),e.focus()},options:{minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:14,fontFamily:'Monaco, Menlo, "Courier New", monospace',wordWrap:"on",automaticLayout:!0,tabSize:2,insertSpaces:!0,formatOnPaste:!0,formatOnType:!0,suggestOnTriggerCharacters:!0,quickSuggestions:!0,acceptSuggestionOnEnter:"on",acceptSuggestionOnCommitCharacter:!0,snippetSuggestions:"top",tabCompletion:"on",wordBasedSuggestions:"matchingDocuments",suggestSelection:"first"}})})]})}),t.jsx(Ce,{elevation:0,sx:{borderRadius:0,flex:1,display:"flex",flexDirection:"column",overflow:"hidden",minHeight:c?"400px":0},children:t.jsx(Ie,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",p:2,minHeight:0},children:c?t.jsx(A,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",minHeight:0},children:c.success?t.jsxs(A,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",minHeight:0},children:[t.jsx(we,{elevation:0,sx:{p:2,mb:2,bgcolor:e=>e.palette.mode==="dark"?"rgba(127, 160, 116, 0.1)":"rgba(82, 196, 26, 0.1)",borderRadius:2,flex:"0 0 auto",border:"1px solid",borderColor:e=>e.palette.mode==="dark"?"rgba(127, 160, 116, 0.3)":"rgba(82, 196, 26, 0.3)"},children:t.jsxs(H,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",spacing:2,children:[t.jsxs(H,{direction:"row",spacing:2,flexWrap:"wrap",alignItems:"center",children:[t.jsx(h,{variant:"body2",fontWeight:500,children:s("dms.query.querySuccess")}),t.jsx(X,{label:s("dms.query.returnRows",{count:c.resultCount||0}),size:"small"}),c.affectedRows!==void 0&&c.affectedRows>0&&t.jsx(X,{label:s("dms.query.affectedRows",{count:c.affectedRows}),size:"small"}),c.executionTimeMs!==void 0&&t.jsx(X,{label:s("dms.query.executionTime",{time:c.executionTimeMs}),size:"small",color:"info"}),N&&c.rows&&g.length!==c.rows.length&&t.jsx(X,{label:`${s("dms.query.filtered")}: ${g.length} / ${c.rows.length}`,size:"small",color:"warning"}),O&&t.jsx(X,{label:s("dms.query.sorted"),size:"small",color:"info",onDelete:()=>Se(null)})]}),t.jsxs(H,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx(Ve,{size:"small",placeholder:s("dms.query.searchResults"),value:N,onChange:e=>pe(e.target.value),InputProps:{startAdornment:t.jsx(Te,{position:"start",children:t.jsx(Qe,{fontSize:"small"})}),endAdornment:N&&t.jsx(Te,{position:"end",children:t.jsx(k,{size:"small",onClick:()=>pe(""),children:t.jsx(ke,{fontSize:"small"})})})},sx:{width:200}}),t.jsx(F,{title:s("dms.query.copyResult"),children:t.jsx(k,{size:"small",onClick:$t,children:t.jsx(Zt,{fontSize:"small"})})}),t.jsx(F,{title:s("dms.query.exportCSV"),children:t.jsx(k,{size:"small",onClick:Rt,children:t.jsx(tt,{fontSize:"small"})})}),t.jsx(F,{title:s("dms.query.exportJSON"),children:t.jsx(k,{size:"small",onClick:Ct,children:t.jsx(tt,{fontSize:"small"})})})]})]})}),g.length>D&&t.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,px:1},children:[t.jsxs(Ne,{size:"small",sx:{minWidth:120},children:[t.jsx(Ae,{children:s("dms.query.rowsPerPage")}),t.jsxs(Le,{value:D,label:s("dms.query.rowsPerPage"),onChange:e=>{ft(Number(e.target.value)),ye(1)},children:[t.jsx(j,{value:50,children:"50"}),t.jsx(j,{value:100,children:"100"}),t.jsx(j,{value:200,children:"200"}),t.jsx(j,{value:500,children:"500"}),t.jsx(j,{value:1e3,children:"1000"})]})]}),t.jsx(sn,{count:Math.ceil(g.length/D),page:W,onChange:(e,n)=>ye(n),color:"primary",size:"small",showFirstButton:!0,showLastButton:!0}),t.jsx(h,{variant:"body2",color:"text.secondary",children:s("dms.query.showingRows",{from:(W-1)*D+1,to:Math.min(W*D,g.length),total:g.length})})]}),c.columns&&_e.length>0?t.jsx(an,{component:we,sx:{flex:1,overflow:"auto",borderRadius:2,minHeight:0},children:t.jsxs(on,{stickyHeader:!0,size:"small",children:[t.jsx(rn,{children:t.jsx(rt,{children:c.columns.map((e,n)=>{const a=O?.column===n;return t.jsx(lt,{sx:{fontWeight:600,bgcolor:"background.default",fontFamily:"monospace",whiteSpace:"nowrap",cursor:"pointer",userSelect:"none"},onClick:()=>Lt(n),children:t.jsx(Tn,{active:a,direction:a?O.direction:"asc",children:e})},n)})})}),t.jsx(ln,{children:_e.map((e,n)=>{const a=(W-1)*D+n;return t.jsx(rt,{hover:!0,children:e.map((r,d)=>{const l=String(r??""),x=N&&l.toLowerCase().includes(N.toLowerCase());return t.jsx(lt,{sx:{fontFamily:"monospace",fontSize:"0.875rem",bgcolor:x?$=>$.palette.mode==="dark"?"rgba(201, 167, 107, 0.2)":"rgba(250, 173, 20, 0.2)":"transparent",maxWidth:300,overflow:"hidden",textOverflow:"ellipsis"},title:l,children:r==null?t.jsx(h,{component:"span",color:"text.secondary",fontStyle:"italic",children:"NULL"}):l},d)})},`row-${a}`)})})]})}):c.rows&&c.rows.length>0&&g.length===0?t.jsx(ne,{severity:"info",sx:{borderRadius:2},children:s("dms.query.noMatchingResults")}):t.jsx(ne,{severity:"info",sx:{borderRadius:2},children:s("dms.query.noData")})]}):t.jsxs(ne,{severity:"error",sx:{borderRadius:2,border:"1px solid",borderColor:"error.main",bgcolor:e=>e.palette.mode==="dark"?"rgba(192, 117, 117, 0.1)":"rgba(255, 77, 79, 0.1)"},children:[t.jsx(h,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,sx:{color:"error.main"},children:s("dms.query.queryFailed")}),t.jsx(h,{variant:"body2",component:"pre",sx:{whiteSpace:"pre-wrap",mb:0,color:"error.main",fontFamily:"monospace",fontSize:"0.875rem",mt:1},children:c.error||s("common.unknown")})]})}):t.jsx(we,{elevation:0,sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default",borderRadius:2},children:t.jsx(h,{variant:"body2",color:"text.secondary",children:s("dms.query.executeHint")})})})})]})]}),t.jsxs(nt,{open:bt,onClose:()=>re(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(st,{children:s("dms.query.sqlTemplates")}),t.jsxs(at,{children:[t.jsx(cn,{sx:{mb:2},children:s("dms.query.selectTemplate")}),t.jsx(me,{children:Nt.map((e,n)=>t.jsx(xe,{disablePadding:!0,sx:{borderRadius:1,mb:1},children:t.jsxs(ve,{onClick:()=>At(e.sql),sx:{borderRadius:1,"&:hover":{bgcolor:"action.hover"}},children:[t.jsx(je,{children:t.jsx(Xt,{})}),t.jsx(be,{primary:e.name,secondary:t.jsx(h,{component:"pre",sx:{fontFamily:"monospace",fontSize:"0.75rem",mt:1,whiteSpace:"pre-wrap",overflow:"hidden",textOverflow:"ellipsis",maxHeight:60},children:e.sql})})]})},n))})]}),t.jsx(ot,{children:t.jsx(fe,{onClick:()=>re(!1),children:s("common.close")})})]}),t.jsxs(nt,{open:xt,onClose:()=>he(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(st,{children:t.jsxs(H,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx(et,{}),t.jsx(h,{children:s("dms.query.keyboardShortcuts")})]})}),t.jsx(at,{children:t.jsx(me,{children:kt.map((e,n)=>t.jsx(xe,{children:t.jsx(be,{primary:t.jsxs(H,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[t.jsx(h,{variant:"body2",fontWeight:500,children:e.desc}),t.jsx(X,{label:e.key,size:"small",sx:{fontFamily:"monospace",fontWeight:600}})]})})},n))})}),t.jsx(ot,{children:t.jsx(fe,{onClick:()=>he(!1),children:s("common.close")})})]})]})}export{Nn as default};
