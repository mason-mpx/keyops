import{r as n,j as s,B as d,T as x,w as u,x as y,C as b,b as g,I as i,be as C,c as T,V as w}from"./index-CJIrazW8.js";import{t}from"./ticketApi-CCnZQOPl.js";import{T as z,a as v,b as S,c as h,d as r,e as A}from"./TableRow-JrGpygSA.js";import{C as B}from"./Chip-Bh8gAKTq.js";function D(){const[c,j]=n.useState([]),[m,o]=n.useState(!1);n.useEffect(()=>{a()},[]);const a=async()=>{try{o(!0);const e=await t.list({status:"submitted"});e.data.code===0&&j(e.data.data||[])}catch(e){console.error("加载待审批工单失败:",e)}finally{o(!1)}},p=async e=>{try{await t.submit(e),await a()}catch(l){console.error("审批失败:",l)}},f=async e=>{try{await t.cancel(e),await a()}catch(l){console.error("拒绝失败:",l)}};return s.jsxs(d,{sx:{p:3},children:[s.jsx(x,{variant:"h4",gutterBottom:!0,children:"待我审批"}),s.jsx(u,{sx:{mt:3},children:s.jsxs(y,{children:[s.jsx(x,{variant:"h6",sx:{mb:2},children:"待审批工单"}),m?s.jsx(d,{sx:{display:"flex",justifyContent:"center",p:3},children:s.jsx(b,{})}):c.length===0?s.jsx(g,{severity:"info",children:"暂无待审批的工单"}):s.jsx(z,{children:s.jsxs(v,{children:[s.jsx(S,{children:s.jsxs(h,{children:[s.jsx(r,{children:"工单编号"}),s.jsx(r,{children:"标题"}),s.jsx(r,{children:"申请人"}),s.jsx(r,{children:"模板"}),s.jsx(r,{children:"优先级"}),s.jsx(r,{children:"创建时间"}),s.jsx(r,{align:"right",children:"操作"})]})}),s.jsx(A,{children:c.map(e=>s.jsxs(h,{children:[s.jsx(r,{children:e.ticket_number}),s.jsx(r,{children:e.title}),s.jsx(r,{children:e.applicant_name}),s.jsx(r,{children:e.template?.name||"-"}),s.jsx(r,{children:s.jsx(B,{label:e.priority,size:"small"})}),s.jsx(r,{children:new Date(e.created_at).toLocaleDateString()}),s.jsxs(r,{align:"right",children:[s.jsx(i,{size:"small",color:"primary",children:s.jsx(C,{fontSize:"small"})}),s.jsx(i,{size:"small",color:"success",onClick:()=>p(e.id),children:s.jsx(T,{fontSize:"small"})}),s.jsx(i,{size:"small",color:"error",onClick:()=>f(e.id),children:s.jsx(w,{fontSize:"small"})})]})]},e.id))})]})})]})})]})}export{D as default};
