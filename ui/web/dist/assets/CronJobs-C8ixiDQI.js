import{u as z,ax as Y,r as o,bf as i,j as e,B as r,T as p,w as b,x as C,b as B,C as D,a as E,ci as A,I as F,cj as L}from"./index-wVs8DYHr.js";import{k as g}from"./index-BIq8ZW4m.js";import{k as R}from"./k8sClusterApi-Bz6qMnao.js";import{C as O}from"./ClusterSelector-DqWR8dyY.js";import{N as H}from"./NamespaceSelector-BppKItkw.js";import{Y as M}from"./YamlViewerDialog-B73aV8Jq.js";import{T as P,a as V,b as q,c as m,d as n,e as G}from"./TableRow-17IyVPm2.js";import{C as K}from"./Chip-DzNpApxT.js";import"./utils-DifSMk6h.js";import"./yaml-B1Nq9-gN.js";import"./namespaces-Biqx1aVY.js";function re(){const{t:a}=z(),y=Y(),[k,x]=o.useState(!1),[u,h]=o.useState([]),[t,J]=o.useState(""),[d,S]=o.useState(""),[v,w]=o.useState(null),[I,f]=o.useState(!1),[c,j]=o.useState(null);o.useEffect(()=>{t&&R.getCluster(t).then(w).catch(s=>{i(s?.response?.data?.message||"获取集群信息失败")})},[t]);const T=async()=>{if(!t){i(a("k8s.selectClusterFirst"));return}try{x(!0);const s={clusterId:t,namespace:d||void 0},l=await g.getCronJobList(s);h(l)}catch(s){const l=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||a("k8s.cronJobs.loadFailed");i(l),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&h([])}finally{x(!1)}};return o.useEffect(()=>{t&&T()},[t,d]),e.jsxs(r,{sx:{width:"100%",p:3},children:[e.jsx(r,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:e.jsxs(r,{children:[e.jsx(p,{variant:"h4",component:"h1",fontWeight:"700",children:a("k8s.cronJobs.title")}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:a("k8s.cronJobs.subtitle")})]})}),e.jsx(b,{sx:{mb:3},children:e.jsx(C,{children:e.jsxs(r,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(r,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(O,{value:t,onChange:J,size:"medium",fullWidth:!0,label:a("k8s.selectCluster")})}),t&&e.jsx(r,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(H,{value:d,onChange:S,clusterId:t,defaultNamespace:v?.defaultNamespace,size:"medium",fullWidth:!0,label:a("k8s.selectNamespace")})})]})})}),t?k?e.jsx(r,{display:"flex",justifyContent:"center",p:3,children:e.jsx(D,{})}):e.jsx(b,{children:e.jsx(C,{children:e.jsx(P,{children:e.jsxs(V,{children:[e.jsx(q,{children:e.jsxs(m,{children:[e.jsx(n,{children:a("k8s.cronJobs.name")}),e.jsx(n,{children:a("k8s.cronJobs.namespace")}),e.jsx(n,{children:a("k8s.cronJobs.schedule")}),e.jsx(n,{children:a("k8s.cronJobs.suspend")}),e.jsx(n,{children:a("k8s.cronJobs.active")}),e.jsx(n,{children:a("k8s.cronJobs.lastSchedule")}),e.jsx(n,{children:a("k8s.cronJobs.age")}),e.jsx(n,{children:a("common.actions")})]})}),e.jsx(G,{children:u.length===0?e.jsx(m,{children:e.jsx(n,{colSpan:8,align:"center",children:e.jsx(p,{color:"textSecondary",children:a("common.noData")})})}):u.map(s=>e.jsxs(m,{children:[e.jsx(n,{children:s.name}),e.jsx(n,{children:s.namespace}),e.jsx(n,{children:s.schedule}),e.jsx(n,{children:e.jsx(K,{label:s.suspend?a("common.yes"):a("common.no"),color:s.suspend?"warning":"success",size:"small"})}),e.jsx(n,{children:s.active}),e.jsx(n,{children:s.lastSchedule||"-"}),e.jsx(n,{children:s.age}),e.jsx(n,{children:e.jsxs(r,{sx:{display:"flex",gap:.5},children:[e.jsx(E,{size:"small",variant:"outlined",startIcon:e.jsx(A,{}),onClick:()=>{if(!t){i("请先选择集群");return}const l=`/k8s/cronjobs/${t}/${s.namespace}/${s.name}`;y(l)},disabled:!t,children:a("k8s.viewDetails","详情")}),e.jsx(F,{size:"small",onClick:()=>{j(s),f(!0)},title:a("k8s.viewYaml"),children:e.jsx(L,{fontSize:"small"})})]})})]},`${s.namespace}-${s.name}`))})]})})})}):e.jsx(B,{severity:"info",children:a("k8s.selectClusterFirst")}),c&&e.jsx(M,{open:I,onClose:()=>{f(!1),j(null)},title:`${a("k8s.cronJobs.title")} - ${c.name}`,clusterId:t,namespace:c.namespace,resourceType:"cronjob",resourceName:c.name,onLoadYaml:async(s,l,N,W)=>{const $={clusterId:s,namespace:l};return await g.getResourceYaml($,N,W)}})]})}export{re as default};
