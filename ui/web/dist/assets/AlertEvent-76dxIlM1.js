import{bt as Le,cP as ke,cQ as Ee,r as l,ak as k,aj as z,aO as ne,j as e,af as E,an as P,ao as U,T as a,cF as Pe,u as Ue,B as u,w as $e,x as Ne,a as te,v as Be,a3 as ge,a4 as _,F as se,n as re,o as oe,M as y,m as Fe,P as Oe,d as I,I as B,be as We,c as Ve,V as Ge,aB as He,cR as Ke,i as Qe,k as qe,l as Je,D as H,p as Xe,b4 as je,a7 as K,E as Ye,ab as Ze,cz as et}from"./index-DNdAKB9f.js";import{a as A}from"./alertApi-DA6IzLde.js";import{T as tt,a as st,b as rt,c as Q,d as m,e as ot}from"./TableRow-2FuGKbnY.js";import{C}from"./Chip-B8lB6W_F.js";import{S as ie}from"./Stack-6rKlDBQM.js";import{P as it}from"./Pagination-LCTmwsmm.js";import"./LastPage-v7sA_Lnn.js";function $({props:t,name:r}){return Le({props:t,name:r,defaultTheme:ke,themeId:Ee})}const q=l.createContext({});function nt(t){return k("MuiTimeline",t)}z("MuiTimeline",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function N(t){return t==="alternate-reverse"?"positionAlternateReverse":`position${ne(t)}`}const at=t=>{const{position:r,classes:i}=t,n={root:["root",r&&N(r)]};return U(n,nt,i)},lt=E("ul",{name:"MuiTimeline",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:i}=t;return[r.root,i.position&&r[N(i.position)]]}})({display:"flex",flexDirection:"column",padding:"6px 16px",flexGrow:1}),ct=l.forwardRef(function(r,i){const n=$({props:r,name:"MuiTimeline"}),{position:x="right",className:f,...j}=n,h={...n,position:x},v=at(h),b=l.useMemo(()=>({position:x}),[x]);return e.jsx(q.Provider,{value:b,children:e.jsx(lt,{className:P(v.root,f),ownerState:h,ref:i,...j})})});function dt(t){return k("MuiTimelineContent",t)}const ut=z("MuiTimelineContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),xt=t=>{const{position:r,classes:i}=t,n={root:["root",N(r)]};return U(n,dt,i)},pt=E(a,{name:"MuiTimelineContent",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:i}=t;return[r.root,r[N(i.position)]]}})(({ownerState:t})=>({flex:1,padding:"6px 16px",textAlign:"left",...t.position==="left"&&{textAlign:"right"}})),mt=l.forwardRef(function(r,i){const n=$({props:r,name:"MuiTimelineContent"}),{className:x,...f}=n,{position:j}=l.useContext(q),h={...n,position:j||"right"},v=xt(h);return e.jsx(pt,{component:"div",className:P(v.root,x),ownerState:h,ref:i,...f})}),ht=z("MuiTimelineOppositeContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function gt(t){return k("MuiTimelineItem",t)}z("MuiTimelineItem",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse","missingOppositeContent"]);const jt=t=>{const{position:r,classes:i,hasOppositeContent:n}=t,x={root:["root",N(r),!n&&"missingOppositeContent"]};return U(x,gt,i)},ft=E("li",{name:"MuiTimelineItem",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:i}=t;return[r.root,r[N(i.position)]]}})(({ownerState:t})=>({listStyle:"none",display:"flex",position:"relative",minHeight:70,...t.position==="left"&&{flexDirection:"row-reverse"},...(t.position==="alternate"||t.position==="alternate-reverse")&&{[`&:nth-of-type(${t.position==="alternate"?"even":"odd"})`]:{flexDirection:"row-reverse",[`& .${ut.root}`]:{textAlign:"right"},[`& .${ht.root}`]:{textAlign:"left"}}},...!t.hasOppositeContent&&{"&::before":{content:'""',flex:1,padding:"6px 16px"}}})),yt=l.forwardRef(function(r,i){const n=$({props:r,name:"MuiTimelineItem"}),{position:x,className:f,...j}=n,{position:h}=l.useContext(q);let v=!1;l.Children.forEach(n.children,S=>{Pe(S,["TimelineOppositeContent"])&&(v=!0)});const b={...n,position:x||h||"right",hasOppositeContent:v},F=jt(b),J=l.useMemo(()=>({position:b.position}),[b.position]);return e.jsx(q.Provider,{value:J,children:e.jsx(ft,{className:P(F.root,f),ownerState:b,ref:i,...j})})});function vt(t){return k("MuiTimelineSeparator",t)}z("MuiTimelineSeparator",["root"]);const bt=t=>{const{classes:r}=t;return U({root:["root"]},vt,r)},Ct=E("div",{name:"MuiTimelineSeparator",slot:"Root"})({display:"flex",flexDirection:"column",flex:0,alignItems:"center"}),Tt=l.forwardRef(function(r,i){const n=$({props:r,name:"MuiTimelineSeparator"}),{className:x,...f}=n,j=n,h=bt(j);return e.jsx(Ct,{className:P(h.root,x),ownerState:j,ref:i,...f})});function wt(t){return k("MuiTimelineConnector",t)}z("MuiTimelineConnector",["root"]);const St=t=>{const{classes:r}=t;return U({root:["root"]},wt,r)},Rt=E("span",{name:"MuiTimelineConnector",slot:"Root"})(({theme:t})=>({width:2,backgroundColor:(t.vars||t).palette.grey[400],flexGrow:1})),Mt=l.forwardRef(function(r,i){const n=$({props:r,name:"MuiTimelineConnector"}),{className:x,...f}=n,j=n,h=St(j);return e.jsx(Rt,{className:P(h.root,x),ownerState:j,ref:i,...f})});function At(t){return k("MuiTimelineDot",t)}z("MuiTimelineDot",["root","filled","outlined","filledGrey","outlinedGrey","filledPrimary","outlinedPrimary","filledSecondary","outlinedSecondary"]);const _t=t=>{const{color:r,variant:i,classes:n}=t,x={root:["root",i,r!=="inherit"&&`${i}${ne(r)}`]};return U(x,At,n)},It=E("span",{name:"MuiTimelineDot",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:i}=t;return[r.root,r[i.color!=="inherit"&&`${i.variant}${ne(i.color)}`],r[i.variant]]}})(({ownerState:t,theme:r})=>({display:"flex",alignSelf:"baseline",borderStyle:"solid",borderWidth:2,padding:4,borderRadius:"50%",boxShadow:(r.vars||r).shadows[1],margin:"11.5px 0",...t.variant==="filled"&&{borderColor:"transparent",...t.color!=="inherit"&&{...t.color==="grey"?{color:(r.vars||r).palette.grey[50],backgroundColor:(r.vars||r).palette.grey[400]}:{color:(r.vars||r).palette[t.color].contrastText,backgroundColor:(r.vars||r).palette[t.color].main}}},...t.variant==="outlined"&&{boxShadow:"none",backgroundColor:"transparent",...t.color!=="inherit"&&{...t.color==="grey"?{borderColor:(r.vars||r).palette.grey[400]}:{borderColor:(r.vars||r).palette[t.color].main}}}})),zt=l.forwardRef(function(r,i){const n=$({props:r,name:"MuiTimelineDot"}),{className:x,color:f="grey",variant:j="filled",...h}=n,v={...n,color:f,variant:j},b=_t(v);return e.jsx(It,{className:P(b.root,x),ownerState:v,ref:i,...h})});function fe(t){const{children:r,value:i,index:n,...x}=t;return e.jsx("div",{role:"tabpanel",hidden:i!==n,id:`event-tabpanel-${n}`,"aria-labelledby":`event-tab-${n}`,...x,children:i===n&&e.jsx(u,{sx:{p:3},children:r})})}function Nt(){const{t}=Ue(),[r,i]=l.useState([]),[n,x]=l.useState([]),[f,j]=l.useState(!1),[h,v]=l.useState(1),[b]=l.useState(10),[F,J]=l.useState(0),[S,ye]=l.useState(0),[c,ve]=l.useState(null),[be,O]=l.useState(!1),[X,ae]=l.useState(0),[Y,Z]=l.useState([]),[Ce,le]=l.useState(!1),[w,W]=l.useState(new Map),[D,ce]=l.useState(""),[V,Te]=l.useState(""),[G,we]=l.useState(""),[ee,Se]=l.useState("24h");l.useEffect(()=>{Re()},[]);const M=l.useCallback(async()=>{try{j(!0);const s={page:h,page_size:b,time_range:ee};S===0||(S===1?s.progress=1:S===2?s.progress=2:S===3?s.progress=3:S===4&&(s.progress=4)),D&&(s.source_id=D),V&&(s.level=V),G&&(s.alert_title=G);const o=await A.getEvents(s);(o.data.code===0||o.data.code===200)&&(i(o.data.data||[]),J(o.data.total||0))}catch(s){console.error("获取告警事件失败:",s),i([])}finally{j(!1)}},[h,b,S,D,V,G,ee]);l.useEffect(()=>{M()},[M]),l.useEffect(()=>{const s=async()=>{const o=new Set;if(r.forEach(p=>{p.uid&&p.uid.trim()!==""&&o.add(p.uid)}),o.size===0)return;const d=Array.from(o).filter(p=>!w.has(p));if(d.length!==0)try{const p=await je.getUsersWithPagination({page:1,pageSize:1e3}),g=new Map(w),R=new Set;p.users.forEach(T=>{d.includes(T.id)&&(g.set(T.id,T),R.add(T.id))}),d.forEach(T=>{R.has(T)||g.set(T,{id:T,username:`用户 ${T}`,fullName:"",email:"",role:"user",status:"active",createdAt:"",updatedAt:""})}),W(g)}catch(p){console.error("Failed to load users:",p);const g=new Map(w);d.forEach(R=>{g.set(R,{id:R,username:`用户 ${R}`,fullName:"",email:"",role:"user",status:"active",createdAt:"",updatedAt:""})}),W(g)}};r.length>0&&s()},[r]),l.useEffect(()=>{n.length>0&&!D&&ce(n[0].id)},[n,D]);const Re=async()=>{try{const o=(await A.getRuleSources({page:1,page_size:1e3})).data;(o.code===0||o.code===200)&&x(o.data||[])}catch(s){console.error("获取数据源失败:",s)}},Me=(s,o)=>{ye(o),v(1)},de=async s=>{try{await A.claimEvent(s),K("认领成功"),M()}catch(o){console.error("认领失败:",o)}},Ae=async s=>{try{await A.cancelClaimEvent(s),K("取消认领成功"),M()}catch(o){console.error("取消认领失败:",o)}},_e=async s=>{if(confirm(t("Are you sure you want to close this alert?")||"确定要关闭这条告警吗？"))try{await A.closeEvent(s),K("关闭成功"),M()}catch(o){console.error("关闭失败:",o)}},Ie=async s=>{try{await A.openEvent(s),K("打开成功"),M()}catch(o){console.error("打开失败:",o)}},ze=async s=>{try{const o=await A.getEvent(s);if(o.data.code===0||o.data.code===200){const d=o.data.data;if(ve(d),O(!0),ae(0),De(s),d.uid&&d.uid.trim()!==""&&!w.has(d.uid))try{const p=await je.getUsersWithPagination({page:1,pageSize:1e3}),g=new Map(w),R=p.users.find(T=>T.id===d.uid);R?g.set(d.uid,R):g.set(d.uid,{id:d.uid,username:`用户 ${d.uid}`,fullName:"",email:"",role:"user",status:"active",createdAt:"",updatedAt:""}),W(g)}catch(p){console.error("Failed to load user info:",p);const g=new Map(w);g.set(d.uid,{id:d.uid,username:`用户 ${d.uid}`,fullName:"",email:"",role:"user",status:"active",createdAt:"",updatedAt:""}),W(g)}}}catch(o){console.error("获取详情失败:",o)}},De=async s=>{try{le(!0);const o=await A.getStrategyLogs({alert_id:s,page:1,page_size:100});if(o.data.code===0||o.data.code===200){const d=o.data.data||[];console.log(`[通知日志] 告警ID ${s} 的通知日志:`,d),console.log(`[通知日志] 总数: ${o.data.total||0}`),Z(d),d.length===0&&console.warn(`[通知日志] 告警ID ${s} 没有通知日志记录`)}else console.error("[通知日志] 获取失败:",o.data.message||"Unknown error"),Z([])}catch(o){console.error("[通知日志] 请求失败:",o),console.error("[通知日志] 错误详情:",o?.response?.data),Z([])}finally{le(!1)}},ue=s=>s<=1?"error":s<=3?"warning":"info",xe=s=>s<=1?e.jsx(Ye,{}):s<=3?e.jsx(Ze,{}):e.jsx(et,{}),pe=s=>`P${s}`,me=s=>{switch(s){case 1:return t("Unclaimed")||"未认领";case 2:return t("Claimed")||"已认领";case 3:return t("Closed")||"已关闭";default:return t("Unknown")||"未知"}},he=s=>{switch(s){case 1:return"warning";case 2:return"info";case 3:return"default";default:return"default"}},L=s=>s?new Date(s).toLocaleString("zh-CN"):"-";return e.jsxs(u,{sx:{p:3},children:[e.jsx($e,{children:e.jsxs(Ne,{children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(a,{variant:"h5",gutterBottom:!0,children:t("menu.monitorAlertEvent")||"告警事件"}),e.jsx(te,{variant:"outlined",startIcon:e.jsx(Be,{}),onClick:M,disabled:f,children:t("common.refresh")})]}),e.jsx(u,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(ge,{value:S,onChange:Me,children:[e.jsx(_,{label:t("All")||"全部"}),e.jsx(_,{label:t("Unclaimed")||"未认领"}),e.jsx(_,{label:t("Claimed")||"已认领"}),e.jsx(_,{label:t("Closed")||"已关闭"}),e.jsx(_,{label:t("Pending")||"待处理"})]})}),e.jsxs(u,{sx:{mb:2,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsxs(se,{size:"small",sx:{minWidth:200},children:[e.jsx(re,{children:t("DataSource")||"数据源"}),e.jsx(oe,{value:D||"",label:t("DataSource")||"数据源",onChange:s=>ce(s.target.value?s.target.value:""),children:n.length===0?e.jsx(y,{value:"",disabled:!0,children:t("No data sources")||"暂无数据源"}):n.map(s=>e.jsx(y,{value:s.id,children:s.source_name},s.id))})]}),e.jsxs(se,{size:"small",sx:{minWidth:150},children:[e.jsx(re,{children:t("Alert Level")||"告警等级"}),e.jsxs(oe,{value:V,label:t("Alert Level")||"告警等级",onChange:s=>Te(s.target.value),children:[e.jsx(y,{value:"",children:t("All")||"全部"}),e.jsx(y,{value:0,children:"P0"}),e.jsx(y,{value:1,children:"P1"}),e.jsx(y,{value:2,children:"P2"}),e.jsx(y,{value:3,children:"P3"}),e.jsx(y,{value:4,children:"P4"})]})]}),e.jsxs(se,{size:"small",sx:{minWidth:150},children:[e.jsx(re,{children:t("Time Range")||"时间范围"}),e.jsxs(oe,{value:ee,label:t("Time Range")||"时间范围",onChange:s=>Se(s.target.value),children:[e.jsx(y,{value:"1h",children:t("Last 1 hour")||"最近1小时"}),e.jsx(y,{value:"6h",children:t("Last 6 hours")||"最近6小时"}),e.jsx(y,{value:"24h",children:t("Last 24 hours")||"最近24小时"}),e.jsx(y,{value:"7d",children:t("Last 7 days")||"最近7天"}),e.jsx(y,{value:"30d",children:t("Last 30 days")||"最近30天"})]})]}),e.jsx(Fe,{size:"small",label:t("Alert Title")||"告警标题",value:G,onChange:s=>we(s.target.value),sx:{minWidth:200},onKeyPress:s=>{s.key==="Enter"&&M()}})]}),e.jsx(tt,{component:Oe,children:e.jsxs(st,{children:[e.jsx(rt,{children:e.jsxs(Q,{children:[e.jsx(m,{children:t("Alert Title")||"告警标题"}),e.jsx(m,{children:t("DataSource")||"数据源"}),e.jsx(m,{children:t("Level")||"等级"}),e.jsx(m,{children:t("Status")||"状态"}),e.jsx(m,{children:t("Handler")||"处理人"}),e.jsx(m,{children:t("First Trigger Time")||"首次触发"}),e.jsx(m,{children:t("Latest Trigger Time")||"最新触发"}),e.jsx(m,{children:t("Recover Time")||"恢复时间"}),e.jsx(m,{align:"right",children:t("common.actions")})]})}),e.jsx(ot,{children:f?e.jsx(Q,{children:e.jsx(m,{colSpan:9,align:"center",children:t("common.loading")})}):r.length===0?e.jsx(Q,{children:e.jsx(m,{colSpan:9,align:"center",children:t("common.noData")})}):r.map(s=>e.jsxs(Q,{hover:!0,children:[e.jsxs(m,{children:[e.jsx(I,{title:s.alert_title||"",arrow:!0,children:e.jsx(a,{variant:"body2",fontWeight:"medium",sx:{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"},children:s.alert_title})}),s.description&&e.jsx(I,{title:s.description,arrow:!0,children:e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",cursor:"pointer"},children:[s.description.substring(0,50),s.description.length>50?"...":""]})})]}),e.jsx(m,{children:n.find(o=>o.id===s.source_id)?.source_name||"-"}),e.jsx(m,{children:e.jsx(C,{icon:xe(s.level),label:pe(s.level),color:ue(s.level),size:"small"})}),e.jsxs(m,{children:[e.jsx(C,{label:me(s.progress),color:he(s.progress),size:"small"}),s.is_recovered&&e.jsx(C,{label:t("Recovered")||"已恢复",color:"success",size:"small",sx:{ml:1}})]}),e.jsx(m,{children:s.uid&&s.uid.trim()!==""&&w.get(s.uid)?.username?e.jsx(a,{variant:"body2",children:w.get(s.uid)?.username}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(m,{children:L(s.first_trigger_time)}),e.jsx(m,{children:L(s.trigger_time)}),e.jsx(m,{children:s.recover_time?L(s.recover_time):e.jsx(a,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(m,{align:"right",children:e.jsxs(ie,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e.jsx(I,{title:t("View Details")||"查看详情",children:e.jsx(B,{size:"small",onClick:()=>ze(s.id),children:e.jsx(We,{fontSize:"small"})})}),s.progress===1&&e.jsx(I,{title:t("Claim")||"认领",children:e.jsx(B,{size:"small",color:"primary",onClick:()=>de(s.id),children:e.jsx(Ve,{fontSize:"small"})})}),s.progress===2&&e.jsxs(e.Fragment,{children:[e.jsx(I,{title:t("Cancel Claim")||"取消认领",children:e.jsx(B,{size:"small",onClick:()=>Ae(s.id),children:e.jsx(Ge,{fontSize:"small"})})}),e.jsx(I,{title:t("Close")||"关闭",children:e.jsx(B,{size:"small",color:"error",onClick:()=>_e(s.id),children:e.jsx(He,{fontSize:"small"})})})]}),s.progress===3&&e.jsx(I,{title:t("Open")||"打开",children:e.jsx(B,{size:"small",onClick:()=>Ie(s.id),children:e.jsx(Ke,{fontSize:"small"})})})]})})]},s.id))})]})}),F>0&&e.jsx(u,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(it,{count:Math.ceil(F/b),page:h,onChange:(s,o)=>v(o),color:"primary"})})]})}),e.jsxs(Qe,{open:be,onClose:()=>O(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(qe,{children:t("Alert Details")||"告警详情"}),e.jsx(Je,{children:c&&e.jsxs(e.Fragment,{children:[e.jsx(u,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(ge,{value:X,onChange:(s,o)=>ae(o),children:[e.jsx(_,{label:t("Basic Info")||"基本信息"}),e.jsx(_,{label:t("Strategy Logs")||"通知日志"})]})}),e.jsx(fe,{value:X,index:0,children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(u,{children:[e.jsx(a,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:c.alert_title}),e.jsxs(ie,{direction:"row",spacing:1,sx:{mt:1},children:[e.jsx(C,{icon:xe(c.level),label:pe(c.level),color:ue(c.level),size:"small"}),e.jsx(C,{label:me(c.progress),color:he(c.progress),size:"small"}),c.is_recovered&&e.jsx(C,{label:t("Recovered")||"已恢复",color:"success",size:"small"})]})]}),e.jsx(H,{}),e.jsxs(u,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:t("DataSource")||"数据源"}),e.jsx(a,{variant:"body1",children:n.find(s=>s.id===c.source_id)?.source_name||"-"})]}),c.source_ip&&e.jsxs(u,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:t("Source IP")||"来源IP"}),e.jsx(a,{variant:"body1",children:c.source_ip})]}),e.jsxs(u,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:t("First Trigger Time")||"首次触发时间"}),e.jsx(a,{variant:"body1",children:L(c.first_trigger_time)})]}),e.jsxs(u,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:t("Latest Trigger Time")||"最新触发时间"}),e.jsx(a,{variant:"body1",children:L(c.trigger_time)})]}),c.recover_time&&e.jsxs(u,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:t("Recover Time")||"恢复时间"}),e.jsx(a,{variant:"body1",children:L(c.recover_time)})]}),e.jsxs(u,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:t("Handler")||"处理人"}),e.jsx(a,{variant:"body1",children:c.uid&&c.uid.trim()!==""&&w.get(c.uid)?.username?w.get(c.uid)?.username:e.jsx(a,{variant:"body2",color:"text.secondary",children:"-"})})]}),c.description&&e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsxs(u,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:t("Description")||"描述"}),e.jsx(a,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:c.description})]})]}),c.tags&&Object.keys(c.tags).length>0&&e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsxs(u,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:t("Tags")||"标签"}),e.jsx(ie,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,sx:{mt:1},children:Object.entries(c.tags).map(([s,o])=>e.jsx(C,{label:`${s}: ${o}`,size:"small",variant:"outlined"},s))})]})]}),c.annotations&&Object.keys(c.annotations).length>0&&e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsxs(u,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",display:"block",gutterBottom:!0,children:t("Annotations")||"注解"}),e.jsx(u,{sx:{mt:1},children:Object.entries(c.annotations).map(([s,o])=>{const d=p=>{const g=p.toLowerCase();return g==="message"?t("Message")||"消息":g==="summary"?t("Summary")||"摘要":g==="description"?t("Description")||"描述":s};return e.jsxs(u,{sx:{mb:2},children:[e.jsx(a,{variant:"caption",color:"text.secondary",fontWeight:"bold",display:"block",gutterBottom:!0,children:d(s)}),e.jsx(a,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:String(o)})]},s)})})]})]})]})}),e.jsx(fe,{value:X,index:1,children:Ce?e.jsx(u,{sx:{textAlign:"center",py:4},children:e.jsx(a,{color:"text.secondary",children:t("common.loading")})}):Y.length===0?e.jsx(u,{sx:{textAlign:"center",py:4},children:e.jsx(a,{color:"text.secondary",children:t("No strategy logs")||"暂无策略日志"})}):e.jsx(u,{sx:{width:"100%"},children:e.jsx(ct,{position:"left",sx:{width:"100%",textAlign:"left",p:0,m:0},children:Y.map((s,o)=>e.jsxs(yt,{sx:{width:"100%"},children:[e.jsxs(Tt,{children:[e.jsx(zt,{color:s.notify_type===2?"success":"error",variant:"filled"}),o<Y.length-1&&e.jsx(Mt,{})]}),e.jsx(mt,{sx:{textAlign:"left",width:"100%",flex:"1 1 auto",px:2},children:e.jsxs(u,{sx:{mb:2},children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:(()=>{const d=s.createdAt||s.created_at;if(!d)return"-";try{const p=new Date(d);return isNaN(p.getTime())?"-":p.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"-"}})()}),e.jsxs(u,{sx:{mt:1},children:[e.jsxs(a,{variant:"body2",component:"span",sx:{mr:1},children:[t("Matched Strategy")||"匹配策略",":"]}),e.jsx(C,{label:s.strategy_name||`${t("Strategy ID")}: ${s.strategy_id}`,size:"small",sx:{mr:1}})]}),s.channels&&Array.isArray(s.channels)&&s.channels.length>0&&e.jsxs(u,{sx:{mt:1},children:[e.jsxs(a,{variant:"body2",component:"span",sx:{mr:1},children:[t("Notification Channels")||"通知渠道",":"]}),s.channels.map((d,p)=>e.jsx(C,{label:d,size:"small",color:"info",variant:"outlined",sx:{mr:.5}},p))]}),e.jsxs(u,{sx:{mt:1,display:"flex",alignItems:"center",gap:1},children:[e.jsxs(a,{variant:"body2",component:"span",children:[t("Notification Status")||"通知状态",":"]}),e.jsx(C,{label:s.is_notify?t("Success")||"成功":t("Failed")||"失败",size:"small",color:s.is_notify?"success":"error"}),s.notify_type===1?e.jsx(C,{label:t("Alert")||"告警",size:"small",color:"error"}):e.jsx(C,{label:t("Recovery")||"恢复",size:"small",color:"success"})]}),s.err_message&&e.jsx(u,{sx:{mt:1},children:e.jsxs(a,{variant:"body2",color:"error",children:[t("Error Message")||"错误信息",": ",s.err_message]})})]})})]},s.id))})})})]})}),e.jsxs(Xe,{children:[e.jsx(te,{onClick:()=>O(!1),children:t("common.close")||"关闭"}),c&&c.progress===1&&e.jsx(te,{variant:"contained",onClick:()=>{de(c.id),O(!1)},children:t("Claim")||"认领"})]})]})]})}export{Nt as default};
