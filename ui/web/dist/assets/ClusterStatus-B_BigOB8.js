import{u as Z,bg as q,ax as J,r as o,bf as E,j as s,B as l,C as g,b as v,a as F,aA as Q,T as a,v as _,w as x,x as u,bi as ss,Z as es,bj as ts,bk as as,K as ns,bl as rs}from"./index-DNdAKB9f.js";import{k as A}from"./k8sClusterApi-YbI-1DRG.js";import{k as S}from"./index-CR_954yY.js";import{C as h}from"./Chip-B8lB6W_F.js";import{T as K,a as L,b as B,c as j,d as r,e as H}from"./TableRow-2FuGKbnY.js";import{R as ls,C as is,X as os,Y as cs,T as ds,L as xs}from"./CartesianChart-Z4MMshd-.js";import{B as us,a as c}from"./BarChart-DDbHMHFj.js";import"./utils-5I4TgzTo.js";import"./yaml-xSLLCrpq.js";import"./value-DEjY8fVb.js";import"./tooltipContext-n4LvpGKP.js";function Cs(){const{t:e}=Z(),{clusterId:i}=q(),$=J(),[b,k]=o.useState(!1),[t,M]=o.useState(null),[C,O]=o.useState(null),[w,I]=o.useState([]),[V,W]=o.useState(!1),[P,N]=o.useState([]),[X,T]=o.useState(!1),D=o.useCallback(async()=>{if(i)try{W(!0);const n={clusterId:i},d=await S.getNodeList(n);I(d)}catch(n){console.error("Failed to load nodes:",n),I([])}finally{W(!1)}},[i]),R=o.useCallback(async()=>{if(i)try{T(!0);const n={clusterId:i},d=await S.getNodeList(n),z=[];for(const m of d.slice(0,3))try{const p=await S.getEventList(n,m.name,"Node");z.push(...p.filter(U=>U.type==="Warning"))}catch(p){console.error(`Failed to load events for node ${m.name}:`,p)}const G=z.sort((m,p)=>new Date(p.lastSeen).getTime()-new Date(m.lastSeen).getTime()).slice(0,10);N(G)}catch(n){console.error("Failed to load events:",n),N([])}finally{T(!1)}},[i]),f=o.useCallback(async()=>{if(!i){E(e("cluster.status.loadFailed"));return}try{k(!0);const[n,d]=await Promise.all([A.getCluster(i),A.getClusterSummary(i)]);O(n),M(d),await Promise.all([D(),R()])}catch(n){const d=n?.response?.data?.message||e("cluster.status.loadFailed");E(d)}finally{k(!1)}},[i,D,R,e]);o.useEffect(()=>{i&&f()},[i,f]);const Y=n=>{switch(n){case"active":return"success";case"inactive":return"default";case"error":return"error";default:return"default"}},y=t?.k8sStatus?{running:t.k8sStatus.runningPods||0,pending:t.k8sStatus.pendingPods||0,failed:t.k8sStatus.failedPods||0}:{running:0,pending:0,failed:0};return b&&!t?s.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:s.jsx(g,{})}):t?s.jsxs(l,{sx:{width:"100%",p:3},children:[s.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[s.jsxs(l,{display:"flex",alignItems:"center",gap:2,children:[s.jsx(F,{startIcon:s.jsx(Q,{}),onClick:()=>$("/clusters"),variant:"outlined",size:"small",children:e("cluster.status.back")}),s.jsxs(l,{children:[s.jsx(a,{variant:"h4",component:"h1",fontWeight:"700",children:t.clusterName}),s.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:e("cluster.status.subtitle")})]})]}),s.jsxs(l,{display:"flex",gap:2,alignItems:"center",flexWrap:"wrap",children:[s.jsx(h,{label:e(`cluster.status.status.${t.status}`,t.status),size:"small",color:Y(t.status)}),t.environment&&s.jsx(h,{label:e(`cluster.status.environment.${t.environment}`,t.environment),size:"small",color:t.environment==="prod"?"error":t.environment==="test"?"warning":"info"}),s.jsx(F,{variant:"outlined",startIcon:s.jsx(_,{}),onClick:f,disabled:b,children:e("cluster.status.refresh")})]})]}),s.jsx(x,{sx:{mb:3},children:s.jsxs(u,{children:[s.jsx(a,{variant:"h6",gutterBottom:!0,sx:{mb:3},children:e("cluster.status.clusterInfo")}),s.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:{xs:2,md:3},width:"100%"},children:[C?.apiServer&&s.jsxs(l,{sx:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:[s.jsx(a,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1,fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px"},children:e("cluster.status.apiServer")}),s.jsx(a,{variant:"body1",sx:{fontFamily:"monospace",wordBreak:"break-all",fontWeight:500,color:"text.primary"},children:C.apiServer})]}),t.version&&s.jsxs(l,{sx:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:[s.jsx(a,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1,fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px"},children:e("cluster.status.kubernetesVersion")}),s.jsx(a,{variant:"body1",sx:{fontWeight:500,color:"text.primary"},children:t.version})]}),t.region&&s.jsxs(l,{sx:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:[s.jsx(a,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1,fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px"},children:e("cluster.status.region")}),s.jsx(a,{variant:"body1",sx:{fontWeight:500,color:"text.primary"},children:t.region})]}),t.lastCheckedAt&&s.jsxs(l,{sx:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:[s.jsx(a,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1,fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px"},children:e("cluster.status.lastCheckedAt")}),s.jsx(a,{variant:"body1",sx:{fontWeight:500,color:"text.primary"},children:t.lastCheckedAt})]})]})]})}),s.jsxs(l,{display:"flex",gap:2,sx:{mb:3,flexWrap:{xs:"wrap",sm:"nowrap"},alignItems:"stretch","& > *":{flex:{xs:"1 1 100%",sm:"1 1 auto"},minWidth:{xs:"100%",sm:0},height:{xs:"auto",sm:"140px"}}},children:[s.jsx(x,{sx:{flex:1,height:"100%",display:"flex",flexDirection:"column"},children:s.jsxs(u,{sx:{flex:1,display:"flex",flexDirection:"column",pb:"16px !important"},children:[s.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:1,children:[s.jsx(ss,{color:"primary"}),s.jsx(a,{color:"textSecondary",variant:"body2",children:e("cluster.status.totalNodes")})]}),s.jsx(a,{variant:"h4",sx:{mb:1},children:t.k8sStatus?.nodeCount||0}),s.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:"auto",minHeight:"20px"},children:t.k8sStatus?s.jsxs(s.Fragment,{children:[s.jsxs(a,{variant:"caption",color:"text.secondary",component:"span",children:[e("cluster.status.ready"),": ",t.k8sStatus.readyNodes]}),s.jsx(a,{variant:"caption",color:"text.secondary",component:"span",children:"|"}),s.jsxs(a,{variant:"caption",color:"text.secondary",component:"span",children:[e("cluster.status.notReadyNodes"),": ",t.k8sStatus.notReadyNodes]})]}):s.jsx(a,{variant:"caption",color:"text.secondary",component:"span",children:" "})})]})}),s.jsx(x,{sx:{flex:1,height:"100%",display:"flex",flexDirection:"column"},children:s.jsxs(u,{sx:{flex:1,display:"flex",flexDirection:"column",pb:"16px !important"},children:[s.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:1,children:[s.jsx(es,{color:"primary"}),s.jsx(a,{color:"textSecondary",variant:"body2",children:e("cluster.status.totalPods")})]}),s.jsx(a,{variant:"h4",sx:{mb:1},children:t.k8sStatus?.totalPods||0}),s.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:"auto",minHeight:"20px"},children:t.k8sStatus?s.jsxs(s.Fragment,{children:[s.jsxs(a,{variant:"caption",color:"text.secondary",component:"span",children:[e("cluster.status.runningPods"),": ",t.k8sStatus.runningPods]}),s.jsx(a,{variant:"caption",color:"text.secondary",component:"span",children:"|"}),s.jsxs(a,{variant:"caption",color:"text.secondary",component:"span",children:[e("cluster.status.pendingPods"),": ",t.k8sStatus.pendingPods]}),s.jsx(a,{variant:"caption",color:"text.secondary",component:"span",children:"|"}),s.jsxs(a,{variant:"caption",color:"text.secondary",component:"span",children:[e("cluster.status.failedPods"),": ",t.k8sStatus.failedPods]})]}):s.jsx(a,{variant:"caption",color:"text.secondary",component:"span",children:" "})})]})}),s.jsx(x,{sx:{flex:1,height:"100%",display:"flex",flexDirection:"column"},children:s.jsxs(u,{sx:{flex:1,display:"flex",flexDirection:"column",pb:"16px !important"},children:[s.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:1,children:[s.jsx(ts,{color:"primary"}),s.jsx(a,{color:"textSecondary",variant:"body2",children:e("cluster.status.workloads")})]}),s.jsx(a,{variant:"h4",sx:{mb:1},children:(t.k8sStatus?.deploymentCount||0)+(t.k8sStatus?.statefulSetCount||0)+(t.k8sStatus?.daemonSetCount||0)}),s.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:"auto",minHeight:"20px",alignItems:"center"},children:t.k8sStatus?s.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem",lineHeight:1.4},children:[e("cluster.status.deployment"),": ",t.k8sStatus.deploymentCount," | ",e("cluster.status.statefulSet"),": ",t.k8sStatus.statefulSetCount," | ",e("cluster.status.daemonSet"),": ",t.k8sStatus.daemonSetCount]}):s.jsx(a,{variant:"caption",color:"text.secondary",component:"span",children:" "})})]})}),s.jsx(x,{sx:{flex:1,height:"100%",display:"flex",flexDirection:"column"},children:s.jsxs(u,{sx:{flex:1,display:"flex",flexDirection:"column",pb:"16px !important"},children:[s.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:1,children:[s.jsx(as,{color:"primary"}),s.jsx(a,{color:"textSecondary",variant:"body2",children:e("cluster.status.totalServices")})]}),s.jsx(a,{variant:"h4",sx:{mb:1},children:(t.k8sStatus?.serviceCount||0)+(t.k8sStatus?.ingressCount||0)}),s.jsx(l,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:"auto",minHeight:"20px"},children:t.k8sStatus?s.jsxs(s.Fragment,{children:[s.jsxs(a,{variant:"caption",color:"text.secondary",component:"span",children:[e("cluster.status.service"),": ",t.k8sStatus.serviceCount]}),s.jsx(a,{variant:"caption",color:"text.secondary",component:"span",children:"|"}),s.jsxs(a,{variant:"caption",color:"text.secondary",component:"span",children:[e("cluster.status.ingress"),": ",t.k8sStatus.ingressCount]})]}):s.jsx(a,{variant:"caption",color:"text.secondary",component:"span",children:" "})})]})})]}),s.jsx(x,{sx:{mb:3},children:s.jsxs(u,{children:[s.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:2,children:[s.jsx(ns,{color:"primary"}),s.jsx(a,{variant:"h6",children:e("cluster.status.nodes")})]}),V?s.jsx(l,{display:"flex",justifyContent:"center",p:3,children:s.jsx(g,{size:24})}):w.length===0?s.jsx(v,{severity:"info",children:e("cluster.status.noNodes")}):s.jsx(K,{children:s.jsxs(L,{size:"small",children:[s.jsx(B,{children:s.jsxs(j,{children:[s.jsx(r,{children:e("cluster.status.nodeName")}),s.jsx(r,{children:e("cluster.status.nodeStatus")}),s.jsx(r,{children:e("cluster.status.nodeRoles")}),s.jsx(r,{children:e("cluster.status.nodeVersion")}),s.jsx(r,{children:e("cluster.status.nodeInternalIP")}),s.jsx(r,{children:e("cluster.status.nodeCPU")}),s.jsx(r,{children:e("cluster.status.nodeMemory")}),s.jsx(r,{children:e("cluster.status.nodePods")}),s.jsx(r,{children:e("cluster.status.nodeAge")})]})}),s.jsx(H,{children:w.map(n=>s.jsxs(j,{children:[s.jsx(r,{children:s.jsx(a,{variant:"body2",sx:{fontFamily:"monospace",fontWeight:500},children:n.name})}),s.jsx(r,{children:s.jsx(h,{label:n.status,size:"small",color:n.status==="Ready"?"success":n.status==="NotReady"?"error":"default"})}),s.jsx(r,{children:s.jsx(a,{variant:"body2",color:"text.secondary",children:n.roles||"-"})}),s.jsx(r,{children:s.jsx(a,{variant:"body2",sx:{fontFamily:"monospace"},children:n.version||"-"})}),s.jsx(r,{children:s.jsx(a,{variant:"body2",sx:{fontFamily:"monospace"},children:n.internalIP||"-"})}),s.jsx(r,{children:s.jsx(a,{variant:"body2",children:n.cpu||"-"})}),s.jsx(r,{children:s.jsx(a,{variant:"body2",children:n.memory||"-"})}),s.jsx(r,{children:s.jsx(a,{variant:"body2",children:n.pods||"-"})}),s.jsx(r,{children:s.jsx(a,{variant:"body2",color:"text.secondary",children:n.age||"-"})})]},n.name))})]})})]})}),s.jsx(x,{sx:{mb:3},children:s.jsxs(u,{children:[s.jsxs(l,{display:"flex",alignItems:"center",gap:1,mb:2,children:[s.jsx(rs,{color:"primary"}),s.jsx(a,{variant:"h6",children:e("cluster.status.recentEvents","最近事件")})]}),X?s.jsx(l,{display:"flex",justifyContent:"center",p:3,children:s.jsx(g,{size:24})}):P.length===0?s.jsx(v,{severity:"info",children:e("cluster.status.noEvents","暂无事件")}):s.jsx(K,{children:s.jsxs(L,{size:"small",children:[s.jsx(B,{children:s.jsxs(j,{children:[s.jsx(r,{children:e("k8s.events.type","类型")}),s.jsx(r,{children:e("k8s.events.reason","原因")}),s.jsx(r,{children:e("k8s.events.object","对象")}),s.jsx(r,{children:e("k8s.events.message","消息")}),s.jsx(r,{children:e("k8s.events.lastSeen","最后时间")}),s.jsx(r,{children:e("k8s.events.count","次数")})]})}),s.jsx(H,{children:P.map((n,d)=>s.jsxs(j,{children:[s.jsx(r,{children:s.jsx(h,{label:n.type,color:n.type==="Warning"?"warning":"default",size:"small"})}),s.jsx(r,{children:n.reason}),s.jsx(r,{children:s.jsx(a,{variant:"body2",sx:{fontFamily:"monospace"},children:n.object})}),s.jsx(r,{children:s.jsx(a,{variant:"body2",sx:{maxWidth:400,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.message})}),s.jsx(r,{children:n.lastSeen}),s.jsx(r,{children:n.count})]},d))})]})})]})}),s.jsx(x,{sx:{mb:3},children:s.jsxs(u,{children:[s.jsx(a,{variant:"h6",gutterBottom:!0,sx:{mb:3},children:e("cluster.status.clusterStatusOverview")}),s.jsx(ls,{width:"100%",height:400,children:s.jsxs(us,{data:[{name:e("cluster.status.totalNodes"),ready:t.k8sStatus?.readyNodes||0,notReady:t.k8sStatus?.notReadyNodes||0},{name:e("cluster.status.totalPods"),running:y.running,pending:y.pending,failed:y.failed},{name:e("cluster.status.workloads"),deployments:t.k8sStatus?.deploymentCount||0,statefulSets:t.k8sStatus?.statefulSetCount||0,daemonSets:t.k8sStatus?.daemonSetCount||0},{name:e("cluster.status.totalServices"),services:t.k8sStatus?.serviceCount||0,ingress:t.k8sStatus?.ingressCount||0}],margin:{top:20,right:30,left:20,bottom:5},children:[s.jsx(is,{strokeDasharray:"3 3"}),s.jsx(os,{dataKey:"name"}),s.jsx(cs,{}),s.jsx(ds,{}),s.jsx(xs,{}),s.jsx(c,{dataKey:"ready",stackId:"nodes",fill:"#4caf50",name:e("cluster.status.ready")}),s.jsx(c,{dataKey:"notReady",stackId:"nodes",fill:"#f44336",name:e("cluster.status.notReady")}),s.jsx(c,{dataKey:"running",stackId:"pods",fill:"#4caf50",name:e("cluster.status.runningPods")}),s.jsx(c,{dataKey:"pending",stackId:"pods",fill:"#2196f3",name:e("cluster.status.pendingPods")}),s.jsx(c,{dataKey:"failed",stackId:"pods",fill:"#f44336",name:e("cluster.status.failedPods")}),s.jsx(c,{dataKey:"deployments",stackId:"workloads",fill:"#2196f3",name:e("cluster.status.deployment")}),s.jsx(c,{dataKey:"statefulSets",stackId:"workloads",fill:"#ff9800",name:e("cluster.status.statefulSet")}),s.jsx(c,{dataKey:"daemonSets",stackId:"workloads",fill:"#9c27b0",name:e("cluster.status.daemonSet")}),s.jsx(c,{dataKey:"services",stackId:"services",fill:"#00bcd4",name:e("cluster.status.service")}),s.jsx(c,{dataKey:"ingress",stackId:"services",fill:"#009688",name:e("cluster.status.ingress")})]})})]})})]}):s.jsx(l,{sx:{width:"100%",p:3},children:s.jsx(v,{severity:"error",children:e("cluster.status.loadFailed")})})}export{Cs as default};
