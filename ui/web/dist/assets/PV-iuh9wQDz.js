import{u as v,r as l,bf as p,j as e,B as t,T as j,I as g,v as I,w as y,x as b,b as V,C as L,a as z,cz as W,cA as Y}from"./index-z51Q_M-r.js";import{g as B}from"./yaml-DVsj5t0_.js";import{C as D}from"./ClusterSelector-Dd4BzwIs.js";import{Y as E}from"./YamlViewerDialog-HEoiJXOr.js";import{T as R,a as A,b as M,c as m,d as a,e as N}from"./TableRow-CKQKXB8v.js";import{C as O}from"./Chip-BoE43uAD.js";import"./k8sClusterApi-D8d3s8iX.js";function Q(){const{t:r}=v(),[h,u]=l.useState(!1),[f,C]=l.useState([]),[n,k]=l.useState(""),[w,i]=l.useState(!1),[c,d]=l.useState(null),x=l.useCallback(async()=>{if(!n){p("请先选择集群");return}try{u(!0),C([])}catch(s){const o=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||"获取PV列表失败";p(o),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&C([])}finally{u(!1)}},[n]);l.useEffect(()=>{n&&x()},[n,x]);const P=s=>s?.toLowerCase().includes("bound")||s?.toLowerCase().includes("available")?"success":s?.toLowerCase().includes("pending")||s?.toLowerCase().includes("released")?"warning":s?.toLowerCase().includes("failed")||s?.toLowerCase().includes("error")?"error":"default";return e.jsxs(t,{sx:{width:"100%",p:3},children:[e.jsxs(t,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[e.jsxs(t,{children:[e.jsx(j,{variant:"h4",component:"h1",fontWeight:"700",children:r("k8s.pv.title","PV 管理")}),e.jsx(j,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:r("k8s.pv.subtitle","管理持久卷（Persistent Volume）")})]}),e.jsx(g,{onClick:x,disabled:!n||h,title:r("common.refresh"),children:e.jsx(I,{})})]}),e.jsx(y,{sx:{mb:3},children:e.jsx(b,{children:e.jsx(t,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:e.jsx(t,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(D,{value:n,onChange:k,size:"medium",fullWidth:!0,label:r("k8s.selectCluster")})})})})}),n?h?e.jsx(t,{display:"flex",justifyContent:"center",p:3,children:e.jsx(L,{})}):e.jsx(y,{children:e.jsx(b,{children:e.jsx(R,{children:e.jsxs(A,{children:[e.jsx(M,{children:e.jsxs(m,{children:[e.jsx(a,{children:r("k8s.pv.name","名称")}),e.jsx(a,{children:r("k8s.pv.capacity","容量")}),e.jsx(a,{children:r("k8s.pv.accessModes","访问模式")}),e.jsx(a,{children:r("k8s.pv.reclaimPolicy","回收策略")}),e.jsx(a,{children:r("k8s.pv.status","状态")}),e.jsx(a,{children:r("k8s.pv.storageClass","存储类")}),e.jsx(a,{children:r("k8s.pv.claim","声明")}),e.jsx(a,{children:r("k8s.pv.age","运行时间")}),e.jsx(a,{children:r("common.actions")})]})}),e.jsx(N,{children:f.length===0?e.jsx(m,{children:e.jsx(a,{colSpan:9,align:"center",children:e.jsx(j,{color:"textSecondary",children:r("common.noData")})})}):f.map((s,o)=>e.jsxs(m,{children:[e.jsx(a,{children:s.name}),e.jsx(a,{children:s.capacity}),e.jsx(a,{children:s.accessModes.join(", ")}),e.jsx(a,{children:s.reclaimPolicy}),e.jsx(a,{children:e.jsx(O,{label:s.status,color:P(s.status),size:"small"})}),e.jsx(a,{children:s.storageClass||"-"}),e.jsx(a,{children:s.claim||"-"}),e.jsx(a,{children:s.age||"N/A"}),e.jsx(a,{children:e.jsxs(t,{display:"flex",gap:.5,children:[e.jsx(z,{size:"small",variant:"outlined",startIcon:e.jsx(W,{}),onClick:()=>{if(!n){p("请先选择集群");return}d(s),i(!0)},disabled:!n,children:r("k8s.viewDetails","详情")}),e.jsx(g,{size:"small",onClick:()=>{d(s),i(!0)},title:r("k8s.viewYaml"),children:e.jsx(Y,{fontSize:"small"})})]})})]},o))})]})})})}):e.jsx(V,{severity:"info",children:r("k8s.selectClusterFirst")}),c&&e.jsx(E,{open:w,onClose:()=>{i(!1),d(null)},title:`PV - ${c.name}`,clusterId:n,namespace:"",resourceType:"pv",resourceName:c.name,onLoadYaml:async(s,o,S,T)=>await B({clusterId:s,namespace:""},S,T)})]})}export{Q as default};
