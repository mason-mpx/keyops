import{r as s,b6 as Z,u as ke,bf as U,j as i,i as Fe,k as Ye,B as O,T as z,I as ne,aB as He,l as qe,C as ce,b as ue,a3 as Ne,a4 as me,g as Ue,cm as _e,f as Q,a as de,p as Ke,d as ie,v as Je,ck as Ge,a5 as Qe,a7 as ye,bp as Xe,cn as Ze}from"./index-Cih9_E47.js";import{a as Oe}from"./k8sClusterApi-B1gmk072.js";import{P as et,a as tt}from"./PodLogsDialog-BloZXkqn.js";function Se(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function rt(e){if(Array.isArray(e))return e}function nt(e,t,r){return(t=ut(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function it(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,o,l,h=[],g=!0,p=!1;try{if(o=(r=r.call(e)).next,t!==0)for(;!(g=(n=o.call(r)).done)&&(h.push(n.value),h.length!==t);g=!0);}catch(c){p=!0,a=c}finally{try{if(!g&&r.return!=null&&(l=r.return(),Object(l)!==l))return}finally{if(p)throw a}}return h}}function at(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Pe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Me(Object(r),!0).forEach(function(n){nt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Me(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ot(e,t){if(e==null)return{};var r,n,a=st(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function st(e,t){if(e==null)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.indexOf(n)!==-1)continue;r[n]=e[n]}return r}function lt(e,t){return rt(e)||it(e,t)||dt(e,t)||at()}function ct(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ut(e){var t=ct(e,"string");return typeof t=="symbol"?t:t+""}function dt(e,t){if(e){if(typeof e=="string")return Se(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Se(e,t):void 0}}function ft(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ee(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ce(Object(r),!0).forEach(function(n){ft(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ce(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ht(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return t.reduceRight(function(a,o){return o(a)},n)}}function re(e){return function t(){for(var r=this,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return a.length>=e.length?e.apply(this,a):function(){for(var l=arguments.length,h=new Array(l),g=0;g<l;g++)h[g]=arguments[g];return t.apply(r,[].concat(a,h))}}}function ge(e){return{}.toString.call(e).includes("Object")}function gt(e){return!Object.keys(e).length}function oe(e){return typeof e=="function"}function pt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function mt(e,t){return ge(t)||N("changeType"),Object.keys(t).some(function(r){return!pt(e,r)})&&N("changeField"),t}function yt(e){oe(e)||N("selectorType")}function vt(e){oe(e)||ge(e)||N("handlerType"),ge(e)&&Object.values(e).some(function(t){return!oe(t)})&&N("handlersType")}function xt(e){e||N("initialIsRequired"),ge(e)||N("initialType"),gt(e)&&N("initialContent")}function jt(e,t){throw new Error(e[t]||e.default)}var bt={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},N=re(jt)(bt),fe={changes:mt,selector:yt,handler:vt,initial:xt};function wt(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};fe.initial(e),fe.handler(t);var r={current:e},n=re(Mt)(r,t),a=re(St)(r),o=re(fe.changes)(e),l=re(Ot)(r);function h(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(c){return c};return fe.selector(p),p(r.current)}function g(p){ht(n,a,o,l)(p)}return[h,g]}function Ot(e,t){return oe(t)?t(e.current):t}function St(e,t){return e.current=Ee(Ee({},e.current),t),t}function Mt(e,t,r){return oe(t)?t(e.current):Object.keys(r).forEach(function(n){var a;return(a=t[n])===null||a===void 0?void 0:a.call(t,e.current[n])}),r}var Pt={create:wt},Ct={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.55.1/min/vs"}};function Et(e){return function t(){for(var r=this,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return a.length>=e.length?e.apply(this,a):function(){for(var l=arguments.length,h=new Array(l),g=0;g<l;g++)h[g]=arguments[g];return t.apply(r,[].concat(a,h))}}}function Rt(e){return{}.toString.call(e).includes("Object")}function Dt(e){return e||Re("configIsRequired"),Rt(e)||Re("configType"),e.urls?(kt(),{paths:{vs:e.urls.monacoBase}}):e}function kt(){console.warn(Le.deprecation)}function Lt(e,t){throw new Error(e[t]||e.default)}var Le={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},Re=Et(Lt)(Le),At={config:Dt},Tt=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(a){return r.reduceRight(function(o,l){return l(o)},a)}};function Ae(e,t){return Object.keys(t).forEach(function(r){t[r]instanceof Object&&e[r]&&Object.assign(t[r],Ae(e[r],t[r]))}),Pe(Pe({},e),t)}var It={type:"cancelation",msg:"operation is manually canceled"};function ve(e){var t=!1,r=new Promise(function(n,a){e.then(function(o){return t?a(It):n(o)}),e.catch(a)});return r.cancel=function(){return t=!0},r}var $t=["monaco"],zt=Pt.create({config:Ct,isInitialized:!1,resolve:null,reject:null,monaco:null}),Te=lt(zt,2),se=Te[0],pe=Te[1];function Vt(e){var t=At.config(e),r=t.monaco,n=ot(t,$t);pe(function(a){return{config:Ae(a.config,n),monaco:r}})}function Wt(){var e=se(function(t){var r=t.monaco,n=t.isInitialized,a=t.resolve;return{monaco:r,isInitialized:n,resolve:a}});if(!e.isInitialized){if(pe({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),ve(xe);if(window.monaco&&window.monaco.editor)return Ie(window.monaco),e.resolve(window.monaco),ve(xe);Tt(Bt,Yt)(Ht)}return ve(xe)}function Bt(e){return document.body.appendChild(e)}function Ft(e){var t=document.createElement("script");return e&&(t.src=e),t}function Yt(e){var t=se(function(n){var a=n.config,o=n.reject;return{config:a,reject:o}}),r=Ft("".concat(t.config.paths.vs,"/loader.js"));return r.onload=function(){return e()},r.onerror=t.reject,r}function Ht(){var e=se(function(r){var n=r.config,a=r.resolve,o=r.reject;return{config:n,resolve:a,reject:o}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(r){var n=r.m||r;Ie(n),e.resolve(n)},function(r){e.reject(r)})}function Ie(e){se().monaco||pe({monaco:e})}function qt(){return se(function(e){var t=e.monaco;return t})}var xe=new Promise(function(e,t){return pe({resolve:e,reject:t})}),$e={config:Vt,init:Wt,__getMonacoInstance:qt},Nt={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},je=Nt,Ut={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},_t=Ut;function Kt({children:e}){return Z.createElement("div",{style:_t.container},e)}var Jt=Kt,Gt=Jt;function Qt({width:e,height:t,isEditorReady:r,loading:n,_ref:a,className:o,wrapperProps:l}){return Z.createElement("section",{style:{...je.wrapper,width:e,height:t},...l},!r&&Z.createElement(Gt,null,n),Z.createElement("div",{ref:a,style:{...je.fullWidth,...!r&&je.hide},className:o}))}var Xt=Qt,ze=s.memo(Xt);function Zt(e){s.useEffect(e,[])}var Ve=Zt;function er(e,t,r=!0){let n=s.useRef(!0);s.useEffect(n.current||!r?()=>{n.current=!1}:e,t)}var R=er;function ae(){}function X(e,t,r,n){return tr(e,n)||rr(e,t,r,n)}function tr(e,t){return e.editor.getModel(We(e,t))}function rr(e,t,r,n){return e.editor.createModel(t,r,n?We(e,n):void 0)}function We(e,t){return e.Uri.parse(t)}function nr({original:e,modified:t,language:r,originalLanguage:n,modifiedLanguage:a,originalModelPath:o,modifiedModelPath:l,keepCurrentOriginalModel:h=!1,keepCurrentModifiedModel:g=!1,theme:p="light",loading:c="Loading...",options:j={},height:V="100%",width:W="100%",className:_,wrapperProps:T={},beforeMount:K=ae,onMount:B=ae}){let[S,P]=s.useState(!1),[I,b]=s.useState(!0),m=s.useRef(null),x=s.useRef(null),$=s.useRef(null),M=s.useRef(B),u=s.useRef(K),E=s.useRef(!1);Ve(()=>{let d=$e.init();return d.then(v=>(x.current=v)&&b(!1)).catch(v=>v?.type!=="cancelation"&&console.error("Monaco initialization: error:",v)),()=>m.current?L():d.cancel()}),R(()=>{if(m.current&&x.current){let d=m.current.getOriginalEditor(),v=X(x.current,e||"",n||r||"text",o||"");v!==d.getModel()&&d.setModel(v)}},[o],S),R(()=>{if(m.current&&x.current){let d=m.current.getModifiedEditor(),v=X(x.current,t||"",a||r||"text",l||"");v!==d.getModel()&&d.setModel(v)}},[l],S),R(()=>{let d=m.current.getModifiedEditor();d.getOption(x.current.editor.EditorOption.readOnly)?d.setValue(t||""):t!==d.getValue()&&(d.executeEdits("",[{range:d.getModel().getFullModelRange(),text:t||"",forceMoveMarkers:!0}]),d.pushUndoStop())},[t],S),R(()=>{m.current?.getModel()?.original.setValue(e||"")},[e],S),R(()=>{let{original:d,modified:v}=m.current.getModel();x.current.editor.setModelLanguage(d,n||r||"text"),x.current.editor.setModelLanguage(v,a||r||"text")},[r,n,a],S),R(()=>{x.current?.editor.setTheme(p)},[p],S),R(()=>{m.current?.updateOptions(j)},[j],S);let F=s.useCallback(()=>{if(!x.current)return;u.current(x.current);let d=X(x.current,e||"",n||r||"text",o||""),v=X(x.current,t||"",a||r||"text",l||"");m.current?.setModel({original:d,modified:v})},[r,t,a,e,n,o,l]),k=s.useCallback(()=>{!E.current&&$.current&&(m.current=x.current.editor.createDiffEditor($.current,{automaticLayout:!0,...j}),F(),x.current?.editor.setTheme(p),P(!0),E.current=!0)},[j,p,F]);s.useEffect(()=>{S&&M.current(m.current,x.current)},[S]),s.useEffect(()=>{!I&&!S&&k()},[I,S,k]);function L(){let d=m.current?.getModel();h||d?.original?.dispose(),g||d?.modified?.dispose(),m.current?.dispose()}return Z.createElement(ze,{width:W,height:V,isEditorReady:S,loading:c,_ref:$,className:_,wrapperProps:T})}var ir=nr,ar=s.memo(ir);function or(e){let t=s.useRef();return s.useEffect(()=>{t.current=e},[e]),t.current}var sr=or,he=new Map;function lr({defaultValue:e,defaultLanguage:t,defaultPath:r,value:n,language:a,path:o,theme:l="light",line:h,loading:g="Loading...",options:p={},overrideServices:c={},saveViewState:j=!0,keepCurrentModel:V=!1,width:W="100%",height:_="100%",className:T,wrapperProps:K={},beforeMount:B=ae,onMount:S=ae,onChange:P,onValidate:I=ae}){let[b,m]=s.useState(!1),[x,$]=s.useState(!0),M=s.useRef(null),u=s.useRef(null),E=s.useRef(null),F=s.useRef(S),k=s.useRef(B),L=s.useRef(),d=s.useRef(n),v=sr(o),le=s.useRef(!1),Y=s.useRef(!1);Ve(()=>{let C=$e.init();return C.then(A=>(M.current=A)&&$(!1)).catch(A=>A?.type!=="cancelation"&&console.error("Monaco initialization: error:",A)),()=>u.current?J():C.cancel()}),R(()=>{let C=X(M.current,e||n||"",t||a||"",o||r||"");C!==u.current?.getModel()&&(j&&he.set(v,u.current?.saveViewState()),u.current?.setModel(C),j&&u.current?.restoreViewState(he.get(o)))},[o],b),R(()=>{u.current?.updateOptions(p)},[p],b),R(()=>{!u.current||n===void 0||(u.current.getOption(M.current.editor.EditorOption.readOnly)?u.current.setValue(n):n!==u.current.getValue()&&(Y.current=!0,u.current.executeEdits("",[{range:u.current.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),u.current.pushUndoStop(),Y.current=!1))},[n],b),R(()=>{let C=u.current?.getModel();C&&a&&M.current?.editor.setModelLanguage(C,a)},[a],b),R(()=>{h!==void 0&&u.current?.revealLine(h)},[h],b),R(()=>{M.current?.editor.setTheme(l)},[l],b);let ee=s.useCallback(()=>{if(!(!E.current||!M.current)&&!le.current){k.current(M.current);let C=o||r,A=X(M.current,n||e||"",t||a||"",C||"");u.current=M.current?.editor.create(E.current,{model:A,automaticLayout:!0,...p},c),j&&u.current.restoreViewState(he.get(C)),M.current.editor.setTheme(l),h!==void 0&&u.current.revealLine(h),m(!0),le.current=!0}},[e,t,r,n,a,o,p,c,j,l,h]);s.useEffect(()=>{b&&F.current(u.current,M.current)},[b]),s.useEffect(()=>{!x&&!b&&ee()},[x,b,ee]),d.current=n,s.useEffect(()=>{b&&P&&(L.current?.dispose(),L.current=u.current?.onDidChangeModelContent(C=>{Y.current||P(u.current.getValue(),C)}))},[b,P]),s.useEffect(()=>{if(b){let C=M.current.editor.onDidChangeMarkers(A=>{let G=u.current.getModel()?.uri;if(G&&A.find(te=>te.path===G.path)){let te=M.current.editor.getModelMarkers({resource:G});I?.(te)}});return()=>{C?.dispose()}}return()=>{}},[b,I]);function J(){L.current?.dispose(),V?j&&he.set(o,u.current.saveViewState()):u.current.getModel()?.dispose(),u.current.dispose()}return Z.createElement(ze,{width:W,height:_,isEditorReady:b,loading:g,_ref:E,className:T,wrapperProps:K})}var cr=lr,ur=s.memo(cr),De=ur;function be(e){const{children:t,value:r,index:n,...a}=e;return r!==n?null:i.jsx("div",{role:"tabpanel",id:`yaml-editor-tabpanel-${n}`,"aria-labelledby":`yaml-editor-tab-${n}`,...a,children:i.jsx(O,{sx:{p:0},children:t})})}function gr({open:e,onClose:t,title:r,clusterId:n,namespace:a,resourceType:o,resourceName:l,onLoadYaml:h,onSaveYaml:g,onDryRun:p}){const{t:c}=ke(),[j,V]=s.useState(!1),[W,_]=s.useState(!1),[T,K]=s.useState(!1),[B,S]=s.useState(""),[P,I]=s.useState(""),[b,m]=s.useState(null),[x,$]=s.useState(""),[M,u]=s.useState(null),[E,F]=s.useState(0),[k,L]=s.useState(!1),[d,v]=s.useState(null),[le,Y]=s.useState(!1),ee=s.useCallback(async()=>{if(!!["pv","storageclass","sc"].includes(o.toLowerCase())){v(!0);return}if(!n||!a||!o||!l){v(!1);return}try{if(await Oe.checkPermission({cluster_id:n,namespace:a,resource_type:o,resource_name:l,action:"write"})){v(!0);return}const D=await Oe.checkPermission({cluster_id:n,namespace:a,resource_type:o,resource_name:l,action:"admin"});v(D)}catch(y){console.error("检查权限失败:",y),v(!1)}},[n,a,o,l]),J=s.useCallback(async(w=!0)=>{const y=!["pv","storageclass","sc"].includes(o.toLowerCase());if(!(!e||!n||!o||!l)){if(y&&!a){m("该资源类型需要 namespace 参数");return}await ee();try{V(!0),m(null);const D=await h(n,a||"",o,l);S(D),I(D),L(!1),w&&($(""),u(null))}catch(D){const H=D;let q=c("k8s.yaml.loadFailed");if(H?.response?.data)if(typeof H.response.data=="string")try{const we=JSON.parse(H.response.data);q=we.message||we.msg||q}catch{q=H.response.data}else q=H.response.data.message||H.response.data.msg||q;else H?.message&&(q=H.message);m(q),U(q)}finally{V(!1)}}},[e,n,a,o,l,h,c,ee]);s.useEffect(()=>{const f=!["pv","storageclass","sc"].includes(o.toLowerCase());e&&n&&o&&l&&(!f||a)?J(!1):(S(""),I(""),m(null),L(!1),$(""),u(null),F(0),v(null),Y(!1))},[e,n,a,o,l,J]);const C=w=>{if(d===!1)return;const f=w||"";I(f),L(f!==B)},A=async()=>{if(!g){U("保存功能未实现");return}try{_(!0),m(null),await g(n,a||"",o,l,P),S(P),L(!1),ye(c("k8s.yaml.saveSuccess","保存成功"))}catch(w){const f=w;let y=c("k8s.yaml.saveFailed","保存失败");if(f?.response?.data)if(typeof f.response.data=="string")try{const D=JSON.parse(f.response.data);y=D.message||D.msg||y}catch{y=f.response.data}else y=f.response.data.message||f.response.data.msg||y;else f?.message&&(y=f.message);m(y),U(y)}finally{_(!1)}},G=async()=>{if(!p){U("Dry-run 功能未实现");return}if(!P||!P.trim()){U("YAML 内容不能为空");return}try{K(!0),m(null),u(null);const w=await p(n,a||"",o,l,P);if(!w||!w.trim())throw new Error("Dry-run 返回结果为空，请检查 YAML 格式是否正确或查看控制台错误信息");$(w),u(null),F(2),ye(c("k8s.yaml.dryRunSuccess","Dry-run 验证成功！已切换到 Dry-run 标签页查看结果"))}catch(w){const f=w;let y=c("k8s.yaml.dryRunFailed","Dry-run 失败");if("response"in f&&f.response?.data)if(typeof f.response.data=="string")try{const D=JSON.parse(f.response.data);y=D.message||D.msg||y}catch{y=f.response.data}else y=f.response.data.message||f.response.data.msg||y;else f?.message&&(y=f.message);u(y),m(y),U(y)}finally{K(!1)}},te=()=>{const w=E===1?B:P;navigator.clipboard.writeText(w).then(()=>{ye(c("k8s.yaml.copied"))}).catch(()=>{U(c("k8s.yaml.copyFailed"))})},Be=s.useCallback(()=>{J(!0)},[J]);return s.useEffect(()=>{if(!e){Y(!1);return}if(E===1){const w=setTimeout(()=>{Y(!0)},50);return()=>clearTimeout(w)}else{const w=setTimeout(()=>{Y(!1)},150);return()=>clearTimeout(w)}},[E,e]),i.jsxs(Fe,{open:e,onClose:t,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"90vh",maxHeight:"1200px",maxWidth:"1000px",display:"flex",flexDirection:"column"}},children:[i.jsx(Ye,{sx:{flexShrink:0,pb:1.5},children:i.jsxs(O,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsxs(O,{display:"flex",alignItems:"center",gap:1,children:[i.jsx(z,{variant:"h6",sx:{fontWeight:600},children:r}),k&&i.jsxs(z,{variant:"caption",color:"warning.main",sx:{ml:1},children:["(",c("k8s.yaml.modified","已修改"),")"]})]}),i.jsx(ne,{onClick:t,size:"small",sx:{ml:2},children:i.jsx(He,{})})]})}),i.jsx(qe,{dividers:!0,sx:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",minHeight:0,p:0},children:j?i.jsx(O,{display:"flex",justifyContent:"center",alignItems:"center",sx:{flex:1,minHeight:300},children:i.jsx(ce,{})}):b&&!P?i.jsx(ue,{severity:"error",sx:{m:2},children:b}):i.jsxs(O,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[i.jsx(O,{sx:{borderBottom:1,borderColor:"divider",px:2},children:i.jsxs(Ne,{value:E,onChange:(w,f)=>F(f),children:[i.jsx(me,{icon:i.jsx(Ue,{}),iconPosition:"start",label:c("k8s.yaml.edit","编辑")}),i.jsx(me,{icon:i.jsx(_e,{}),iconPosition:"start",label:c("k8s.yaml.diff","对比"),disabled:!k||j}),p&&i.jsx(me,{icon:i.jsx(Q,{}),iconPosition:"start",label:c("k8s.yaml.dryRun","Dry-run"),disabled:j||T||!k})]})}),i.jsxs(O,{sx:{flex:1,overflow:"hidden",position:"relative"},children:[i.jsx(be,{value:E,index:0,children:i.jsxs(O,{sx:{height:"100%",position:"absolute",width:"100%",top:0,left:0},children:[d===!1&&i.jsx(ue,{severity:"warning",sx:{m:2,position:"absolute",top:0,left:0,right:0,zIndex:1},children:c("k8s.yaml.noPermission","没有编辑权限，需要 write 或 admin 权限才能编辑和保存 YAML")}),i.jsx(De,{height:"100%",language:"yaml",value:P,onChange:C,theme:"vs-dark",options:{readOnly:d===!1,minimap:{enabled:!0},scrollBeyondLastLine:!1,fontSize:13,wordWrap:"on",automaticLayout:!0,tabSize:2,insertSpaces:!0,formatOnPaste:!0,formatOnType:!0}})]})}),i.jsx(be,{value:E,index:1,children:i.jsx(O,{sx:{height:"100%",position:"absolute",width:"100%",top:0,left:0},children:le?i.jsx(ar,{height:"100%",language:"yaml",original:B,modified:P,theme:"vs-dark",loading:i.jsx(O,{display:"flex",justifyContent:"center",alignItems:"center",sx:{height:"100%"},children:i.jsx(ce,{})}),options:{minimap:{enabled:!0},scrollBeyondLastLine:!1,fontSize:13,readOnly:!0,automaticLayout:!0,renderSideBySide:!0}},`diff-${B.length}-${P.length}`):i.jsx(O,{display:"flex",justifyContent:"center",alignItems:"center",sx:{height:"100%"},children:i.jsx(ce,{})})})}),p&&i.jsx(be,{value:E,index:2,children:i.jsx(O,{sx:{height:"100%",position:"absolute",width:"100%",top:0,left:0,display:"flex",flexDirection:"column"},children:T?i.jsxs(O,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",sx:{height:"100%"},children:[i.jsx(ce,{sx:{mb:2}}),i.jsx(z,{variant:"body2",color:"text.secondary",children:c("k8s.yaml.dryRunning","正在验证 YAML 配置...")})]}):M?i.jsxs(i.Fragment,{children:[i.jsxs(ue,{severity:"error",sx:{m:2,mb:1},icon:i.jsx(Q,{}),children:[i.jsx(z,{variant:"body2",sx:{fontWeight:500,mb:.5},children:"Dry-run 验证失败"}),i.jsx(z,{variant:"body2",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:M})]}),i.jsx(O,{display:"flex",justifyContent:"center",sx:{px:2,pb:2},children:i.jsx(de,{onClick:G,disabled:j||T||!k,variant:"contained",color:"info",startIcon:i.jsx(Q,{}),children:c("k8s.yaml.dryRun","重新执行 Dry-run")})})]}):x?i.jsxs(i.Fragment,{children:[i.jsxs(ue,{severity:"success",sx:{m:2,mb:1},icon:i.jsx(Q,{}),children:[i.jsx(z,{variant:"body2",sx:{fontWeight:500,mb:.5},children:"Dry-run 验证成功"}),i.jsx(z,{variant:"caption",color:"text.secondary",children:"这是 Kubernetes 处理后的最终 YAML，包含默认值和自动生成的字段。此操作不会实际修改资源。"})]}),i.jsx(O,{sx:{flex:1,overflow:"hidden",position:"relative"},children:i.jsx(De,{height:"100%",language:"yaml",value:x,theme:"vs-dark",options:{minimap:{enabled:!0},scrollBeyondLastLine:!1,fontSize:13,readOnly:!0,automaticLayout:!0}})})]}):i.jsxs(O,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",sx:{height:"100%",px:3},children:[i.jsx(Q,{sx:{fontSize:48,color:"text.secondary",mb:2,opacity:.5}}),i.jsx(z,{variant:"h6",color:"text.secondary",sx:{mb:1,textAlign:"center"},children:"Dry-run 预览"}),i.jsx(z,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",maxWidth:500,mb:3},children:c("k8s.yaml.dryRunHint","点击下面的按钮可以验证 YAML 配置是否正确，并预览 Kubernetes 处理后的最终资源定义（包含默认值和自动生成的字段）。此操作不会实际修改资源。")}),i.jsx(de,{onClick:G,disabled:j||T||!k,variant:"contained",color:"info",startIcon:i.jsx(Q,{}),size:"large",children:T?c("k8s.yaml.dryRunning","Dry-running..."):c("k8s.yaml.dryRun","执行 Dry-run")})]})})})]})]})}),i.jsxs(Ke,{sx:{flexShrink:0,px:2,py:1.5},children:[i.jsxs(O,{sx:{display:"flex",gap:1,flex:1},children:[i.jsx(ie,{title:c("k8s.yaml.reload","重新加载"),children:i.jsx(ne,{onClick:Be,disabled:j,children:i.jsx(Je,{})})}),i.jsx(ie,{title:c("k8s.yaml.copy","复制"),children:i.jsx(ne,{onClick:te,disabled:!P||j,children:i.jsx(Ge,{})})})]}),i.jsxs(O,{sx:{display:"flex",gap:1},children:[g&&i.jsx(ie,{title:d===!1?c("k8s.yaml.noPermission","没有编辑权限，需要 write 或 admin 权限"):"",children:i.jsx("span",{children:i.jsx(de,{onClick:A,disabled:!k||j||W||d===!1,startIcon:i.jsx(Qe,{}),variant:"contained",color:"primary",children:W?c("k8s.yaml.saving","保存中..."):c("k8s.yaml.save","保存")})})}),i.jsx(de,{onClick:t,variant:"outlined",children:c("common.close")})]})]})]})}function pr({pod:e,clusterId:t,namespace:r}){const{t:n}=ke(),[a,o]=s.useState(!1),[l,h]=s.useState(!1),[g,p]=s.useState(""),c=()=>{o(!0)},j=()=>{o(!1),p("")},V=()=>{h(!0)},W=()=>{h(!1),p("")};return i.jsxs(i.Fragment,{children:[i.jsxs(O,{sx:{display:"flex",gap:.5},children:[i.jsx(ie,{title:n("k8s.pods.terminal","终端"),children:i.jsx(ne,{size:"small",onClick:c,disabled:e.status!=="Running",children:i.jsx(Xe,{fontSize:"small"})})}),i.jsx(ie,{title:n("k8s.pods.logs","日志"),children:i.jsx(ne,{size:"small",onClick:V,children:i.jsx(Ze,{fontSize:"small"})})})]}),t&&r&&i.jsx(et,{open:a,onClose:j,clusterId:t,namespace:r,podName:e.name,container:g}),t&&r&&i.jsx(tt,{open:l,onClose:W,clusterId:t,namespace:r,podName:e.name,container:g})]})}export{pr as P,gr as Y};
