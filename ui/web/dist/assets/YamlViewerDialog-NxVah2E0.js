import{u as P,r as c,bf as w,j as s,i as B,k as E,B as m,T as R,I as H,aB as q,l as F,C as W,b as I,p as Y,a as S,cl as z,a7 as A}from"./index-STo1oTDL.js";function J({open:o,onClose:f,title:L,clusterId:l,namespace:r,resourceType:e,resourceName:n,onLoadYaml:p}){const{t:i}=P(),[b,v]=c.useState(!1),[g,C]=c.useState(""),[k,h]=c.useState(null),u=c.useCallback(async()=>{const d=!["pv","storageclass","sc"].includes(e.toLowerCase());if(!(!o||!l||!e||!n)){if(d&&!r){h("该资源类型需要 namespace 参数");return}try{v(!0),h(null);const x=await p(l,r||"",e,n);C(x)}catch(x){const a=x;let t=i("k8s.yaml.loadFailed");if(a?.response?.data)if(typeof a.response.data=="string")try{const y=JSON.parse(a.response.data);t=y.message||y.msg||t}catch{t=a.response.data}else t=a.response.data.message||a.response.data.msg||t;else a?.message&&(t=a.message);h(t),w(t)}finally{v(!1)}}},[o,l,r,e,n,p,i]);c.useEffect(()=>{const d=!["pv","storageclass","sc"].includes(e.toLowerCase());o&&l&&e&&n&&(!d||r)?u():(C(""),h(null))},[o,l,r,e,n,u]),c.useEffect(()=>{const d=!["pv","storageclass","sc"].includes(e.toLowerCase());if(!(o&&l&&e&&n&&(!d||r)))return;const a=setInterval(()=>{u()},6e5);return()=>{clearInterval(a)}},[o,l,r,e,n,u]);const D=()=>{navigator.clipboard.writeText(g).then(()=>{A(i("k8s.yaml.copied"))}).catch(()=>{w(i("k8s.yaml.copyFailed"))})};return s.jsxs(B,{open:o,onClose:f,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"85vh",maxHeight:"1000px",maxWidth:"1000px",display:"flex",flexDirection:"column"}},children:[s.jsx(E,{sx:{flexShrink:0,pb:1.5},children:s.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[s.jsx(R,{variant:"h6",sx:{fontWeight:600},children:L}),s.jsx(H,{onClick:f,size:"small",sx:{ml:2},children:s.jsx(q,{})})]})}),s.jsx(F,{dividers:!0,sx:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",minHeight:0,px:2,py:2},children:b?s.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",sx:{flex:1,minHeight:300},children:s.jsx(W,{})}):k?s.jsx(I,{severity:"error",sx:{mb:2},children:k}):s.jsx(m,{sx:{flex:1,backgroundColor:"#1e1e1e",color:"#d4d4d4",fontFamily:'"Fira Code", "Consolas", "Monaco", "Courier New", monospace',fontSize:"13px",lineHeight:1.6,padding:2.5,borderRadius:1,overflow:"auto",minHeight:0,whiteSpace:"pre",wordBreak:"normal","&::-webkit-scrollbar":{width:"10px",height:"10px"},"&::-webkit-scrollbar-track":{backgroundColor:"#2d2d2d",borderRadius:"5px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#555",borderRadius:"5px","&:hover":{backgroundColor:"#666"}}},children:g||s.jsx(R,{variant:"body2",sx:{color:"#888",fontStyle:"italic"},children:i("k8s.yaml.noContent")})})}),s.jsxs(Y,{sx:{flexShrink:0,px:2,py:1.5},children:[s.jsx(S,{onClick:D,disabled:!g||b,startIcon:s.jsx(z,{}),variant:"outlined",children:i("k8s.yaml.copy")}),s.jsx(S,{onClick:f,variant:"contained",children:i("common.close")})]})]})}export{J as Y};
