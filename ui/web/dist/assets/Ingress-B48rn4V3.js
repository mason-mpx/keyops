import{u as A,r,bf as d,j as e,B as l,T as h,I as y,v as B,w as b,x as k,b as D,C as E,a as R,cz as F,cA as L}from"./index-z51Q_M-r.js";import{k as I}from"./index-BJBlvgn8.js";import{k as O}from"./k8sClusterApi-D8d3s8iX.js";import{C as P}from"./ClusterSelector-Dd4BzwIs.js";import{N as $}from"./NamespaceSelector-Bjx9WpEH.js";import{Y as H}from"./YamlViewerDialog-HEoiJXOr.js";import{T as M,a as V,b as q,c as u,d as n,e as G}from"./TableRow-CKQKXB8v.js";import"./utils-BrE-8RSA.js";import"./yaml-DVsj5t0_.js";import"./namespaces-2nWtIEhA.js";function ae(){const{t}=A(),[j,f]=r.useState(!1),[g,C]=r.useState([]),[a,S]=r.useState(""),[o,w]=r.useState(""),[T,v]=r.useState(null),[N,p]=r.useState(!1),[c,x]=r.useState(null);r.useEffect(()=>{a&&O.getCluster(a).then(v).catch(s=>{d(s?.response?.data?.message||"获取集群信息失败")})},[a]);const m=r.useCallback(async()=>{if(!a){d(t("k8s.selectClusterFirst"));return}try{f(!0);const s={clusterId:a,namespace:o||void 0},i=await I.getIngressList(s);C(i)}catch(s){const i=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||t("k8s.ingress.loadFailed");d(i),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&C([])}finally{f(!1)}},[a,o,t]);return r.useEffect(()=>{a&&m()},[a,o,m]),e.jsxs(l,{sx:{width:"100%",p:3},children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[e.jsxs(l,{children:[e.jsx(h,{variant:"h4",component:"h1",fontWeight:"700",children:t("k8s.ingress.title")}),e.jsx(h,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:t("k8s.ingress.subtitle")})]}),e.jsx(y,{onClick:m,disabled:!a||j,title:t("common.refresh"),children:e.jsx(B,{})})]}),e.jsx(b,{sx:{mb:3},children:e.jsx(k,{children:e.jsxs(l,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(P,{value:a,onChange:S,size:"medium",fullWidth:!0,label:t("k8s.selectCluster")})}),a&&e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx($,{value:o,onChange:w,clusterId:a,defaultNamespace:T?.defaultNamespace,size:"medium",fullWidth:!0,label:t("k8s.selectNamespace")})})]})})}),a?j?e.jsx(l,{display:"flex",justifyContent:"center",p:3,children:e.jsx(E,{})}):e.jsx(b,{children:e.jsx(k,{children:e.jsx(M,{children:e.jsxs(V,{children:[e.jsx(q,{children:e.jsxs(u,{children:[e.jsx(n,{children:t("k8s.ingress.name")}),e.jsx(n,{children:t("k8s.ingress.namespace")}),e.jsx(n,{children:t("k8s.ingress.address")}),e.jsx(n,{children:t("k8s.ingress.hosts")}),e.jsx(n,{children:t("k8s.ingress.age")}),e.jsx(n,{children:t("common.actions")})]})}),e.jsx(G,{children:g.length===0?e.jsx(u,{children:e.jsx(n,{colSpan:6,align:"center",children:e.jsx(h,{color:"textSecondary",children:t("common.noData")})})}):g.map((s,i)=>e.jsxs(u,{children:[e.jsx(n,{children:s.name}),e.jsx(n,{children:s.namespace}),e.jsx(n,{children:s.address}),e.jsx(n,{children:s.hosts}),e.jsx(n,{children:s.age||"N/A"}),e.jsx(n,{children:e.jsxs(l,{display:"flex",gap:.5,children:[e.jsx(R,{size:"small",variant:"outlined",startIcon:e.jsx(F,{}),onClick:()=>{if(!a){d("请先选择集群");return}x(s),p(!0)},disabled:!a,children:t("k8s.viewDetails","详情")}),e.jsx(y,{size:"small",onClick:()=>{x(s),p(!0)},title:t("k8s.viewYaml"),children:e.jsx(L,{fontSize:"small"})})]})})]},i))})]})})})}):e.jsx(D,{severity:"info",children:t("k8s.selectClusterFirst")}),c&&e.jsx(H,{open:N,onClose:()=>{p(!1),x(null)},title:`${t("k8s.ingress.title")} - ${c.name}`,clusterId:a,namespace:c.namespace,resourceType:"ingress",resourceName:c.name,onLoadYaml:async(s,i,W,z)=>{const Y={clusterId:s,namespace:i};return await I.getResourceYaml(Y,W,z)}})]})}export{ae as default};
