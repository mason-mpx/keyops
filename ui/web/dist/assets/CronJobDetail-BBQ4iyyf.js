import{u as z,bg as H,ax as L,r as x,j as e,B as r,C as N,b,a as W,aA as B,I as $,T as i,d as O,v as X,cj as F,w as g,x as k,a3 as G,a4 as v,a2 as K,Z as M,cl as V,bl as Z,bf as _}from"./index-Cih9_E47.js";import{k as w,g as q}from"./index-89ZNOb4O.js";import{P as Q,Y as U}from"./PodActions-ahaUJDHR.js";import{C as f}from"./Chip-D6-9bdkU.js";import{G as D}from"./GridLegacy-D_BkVMfw.js";import"./utils-DfbPgXsB.js";import"./yaml-QAtnNmSC.js";import"./k8sClusterApi-B1gmk072.js";import"./PodLogsDialog-BloZXkqn.js";import"./xterm-BqYE0GQX.js";import"./Switch-B8rvS-m9.js";function S(s){const{children:c,value:o,index:a,...u}=s;return e.jsx("div",{role:"tabpanel",hidden:o!==a,id:`cronjob-tabpanel-${a}`,"aria-labelledby":`cronjob-tab-${a}`,...u,children:o===a&&e.jsx(r,{sx:{p:3},children:c})})}function xe(){const{t:s}=z(),{clusterId:c,namespace:o,name:a}=H(),u=L(),[P,I]=x.useState(!0),[n,Y]=x.useState(null),[A,J]=x.useState(null),[h,E]=x.useState(0),[R,T]=x.useState(!1),y=async()=>{if(!(!c||!o||!a))try{I(!0),J(null);const l=await q({clusterId:c,namespace:o},a);Y(l)}catch(t){const l=t?.response?.data?.message||s("k8s.cronJobs.loadDetailFailed","获取CronJob详情失败");J(l),_(l)}finally{I(!1)}};x.useEffect(()=>{c&&o&&a&&y()},[c,o,a]),x.useEffect(()=>{if(!c||!o||!a)return;const t=setInterval(()=>{y()},3e4);return()=>clearInterval(t)},[c,o,a]);const d=(t,l)=>l==null||l===""?null:e.jsxs(r,{sx:{mb:2},children:[e.jsx(i,{variant:"caption",color:"text.secondary",display:"block",children:t}),e.jsx(i,{variant:"body1",fontWeight:500,children:String(l)})]});return P&&!n?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(N,{})}):A&&!n?e.jsxs(r,{sx:{p:3},children:[e.jsx(b,{severity:"error",children:A}),e.jsx(W,{startIcon:e.jsx(B,{}),onClick:()=>u("/k8s/cronjobs"),sx:{mt:2},children:s("common.back")})]}):e.jsxs(r,{sx:{width:"100%",p:3},children:[e.jsxs(r,{sx:{mb:3,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx($,{onClick:()=>u("/k8s/cronjobs"),children:e.jsx(B,{})}),e.jsxs(r,{children:[e.jsx(i,{variant:"h4",component:"h1",fontWeight:"700",children:a}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[o," / ",c]})]})]}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(O,{title:s("common.refresh"),children:e.jsx($,{onClick:y,children:e.jsx(X,{})})}),e.jsx(W,{variant:"outlined",startIcon:e.jsx(F,{}),onClick:()=>T(!0),children:s("k8s.viewYaml")})]})]}),e.jsxs(r,{sx:{display:"flex",gap:2,mb:3,width:"100%",flexWrap:{xs:"wrap",sm:"nowrap"}},children:[e.jsx(g,{sx:{flex:1,minWidth:{xs:"100%",sm:0},display:"flex",flexDirection:"column"},children:e.jsxs(k,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",minHeight:120},children:[e.jsx(i,{variant:"caption",color:"text.secondary",sx:{mb:1},children:s("k8s.cronJobs.schedule","调度")}),e.jsx(i,{variant:"h6",fontWeight:"600",sx:{fontFamily:"monospace"},children:n?.schedule||"-"})]})}),e.jsx(g,{sx:{flex:1,minWidth:{xs:"100%",sm:0},display:"flex",flexDirection:"column"},children:e.jsxs(k,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",minHeight:120},children:[e.jsx(i,{variant:"caption",color:"text.secondary",sx:{mb:1},children:s("k8s.cronJobs.suspend","暂停")}),e.jsx(i,{variant:"h4",fontWeight:"600",children:e.jsx(f,{label:n?.suspend?s("common.yes"):s("common.no"),color:n?.suspend?"warning":"success",size:"small"})})]})}),e.jsx(g,{sx:{flex:1,minWidth:{xs:"100%",sm:0},display:"flex",flexDirection:"column"},children:e.jsxs(k,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",minHeight:120},children:[e.jsx(i,{variant:"caption",color:"text.secondary",sx:{mb:1},children:s("k8s.cronJobs.active","活跃")}),e.jsx(i,{variant:"h4",fontWeight:"600",color:"info.main",children:n?.active||0})]})}),e.jsx(g,{sx:{flex:1,minWidth:{xs:"100%",sm:0},display:"flex",flexDirection:"column"},children:e.jsxs(k,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",minHeight:120},children:[e.jsx(i,{variant:"caption",color:"text.secondary",sx:{mb:1},children:s("k8s.cronJobs.lastSchedule","最后调度")}),e.jsx(i,{variant:"h4",fontWeight:"600",children:n?.lastSchedule||"-"})]})})]}),e.jsxs(g,{children:[e.jsx(r,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(G,{value:h,onChange:(t,l)=>E(l),children:[e.jsx(v,{icon:e.jsx(K,{}),iconPosition:"start",label:s("k8s.basicInfo")}),e.jsx(v,{icon:e.jsx(M,{}),iconPosition:"start",label:`${s("k8s.pods.title")} (${n?.pods?.length||0})`}),e.jsx(v,{icon:e.jsx(V,{}),iconPosition:"start",label:`${s("k8s.cronJobs.recentJobs","最近执行")} (${n?.recentJobs?.length||0})`}),e.jsx(v,{icon:e.jsx(Z,{}),iconPosition:"start",label:`${s("k8s.events.title")} (${n?.events?.length||0})`})]})}),e.jsx(S,{value:h,index:0,children:e.jsxs(D,{container:!0,spacing:3,children:[e.jsxs(D,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"h6",sx:{mb:2},children:s("k8s.basicInfo")}),d(s("k8s.name"),n?.name),d(s("k8s.namespace"),n?.namespace),d(s("k8s.age"),n?.age),d(s("k8s.cronJobs.schedule","调度表达式"),n?.schedule),d(s("k8s.cronJobs.concurrencyPolicy","并发策略"),n?.concurrencyPolicy||"Allow"),d(s("k8s.cronJobs.lastScheduleTime","最后调度时间"),n?.lastScheduleTime&&typeof n.lastScheduleTime=="string"?new Date(n.lastScheduleTime).toLocaleString("zh-CN"):"-"),d(s("k8s.cronJobs.lastSuccessfulTime","最后成功时间"),n?.lastSuccessfulTime&&typeof n.lastSuccessfulTime=="string"?new Date(n.lastSuccessfulTime).toLocaleString("zh-CN"):"-")]}),e.jsxs(D,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"h6",sx:{mb:2},children:s("k8s.labels")}),n?.labels&&Object.keys(n.labels).length>0?e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Object.entries(n.labels).map(([t,l])=>e.jsx(f,{label:`${t}=${l}`,size:"small"},t))}):e.jsx(i,{variant:"body2",color:"text.secondary",children:s("common.noData")})]})]})}),e.jsx(S,{value:h,index:1,children:n?.pods&&n.pods.length>0?e.jsxs(r,{children:[e.jsx(i,{variant:"h6",sx:{mb:2},children:s("k8s.pods.title")}),e.jsx(r,{sx:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #e0e0e0"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.name")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.status")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.node")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.restarts")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.age")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("common.actions")})]})}),e.jsx("tbody",{children:n.pods.map((t,l)=>e.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[e.jsx("td",{style:{padding:"12px"},children:t.name}),e.jsx("td",{style:{padding:"12px"},children:e.jsx(f,{label:String(t.status||""),color:t.status==="Running"?"success":"default",size:"small"})}),e.jsx("td",{style:{padding:"12px"},children:t.node||"-"}),e.jsx("td",{style:{padding:"12px"},children:t.restarts||0}),e.jsx("td",{style:{padding:"12px"},children:t.age||"-"}),e.jsx("td",{style:{padding:"12px"},children:e.jsx(Q,{pod:t,clusterId:c||"",namespace:o||""})})]},l))})]})})]}):e.jsx(b,{severity:"info",children:s("common.noData")})}),e.jsx(S,{value:h,index:2,children:n?.recentJobs&&n.recentJobs.length>0?e.jsxs(r,{children:[e.jsx(i,{variant:"h6",sx:{mb:2},children:s("k8s.cronJobs.recentJobs","最近执行的 Jobs")}),e.jsx(r,{sx:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #e0e0e0"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.name")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.jobs.completions","完成数")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.jobs.duration","持续时间")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.age")})]})}),e.jsx("tbody",{children:n.recentJobs.map((t,l)=>e.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[e.jsx("td",{style:{padding:"12px"},children:t.name}),e.jsx("td",{style:{padding:"12px"},children:e.jsx(f,{label:String(t.completions),color:t.completions>0?"success":"default",size:"small"})}),e.jsx("td",{style:{padding:"12px"},children:t.duration||"-"}),e.jsx("td",{style:{padding:"12px"},children:t.age||"-"})]},l))})]})})]}):e.jsx(b,{severity:"info",children:s("common.noData")})}),e.jsx(S,{value:h,index:3,children:n?.events&&n.events.length>0?e.jsxs(r,{children:[e.jsx(i,{variant:"h6",sx:{mb:2},children:s("k8s.events.title")}),e.jsx(r,{sx:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #e0e0e0"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.type")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.reason")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.message")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.count")}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:s("k8s.lastSeen")})]})}),e.jsx("tbody",{children:n.events.map((t,l)=>e.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0"},children:[e.jsx("td",{style:{padding:"12px"},children:e.jsx(f,{label:String(t.type),color:t.type==="Warning"?"warning":"info",size:"small"})}),e.jsx("td",{style:{padding:"12px"},children:String(t.reason)}),e.jsx("td",{style:{padding:"12px"},children:String(t.message)}),e.jsx("td",{style:{padding:"12px"},children:String(t.count)}),e.jsx("td",{style:{padding:"12px"},children:String(t.lastSeen)})]},l))})]})})]}):e.jsx(b,{severity:"info",children:s("common.noData")})})]}),c&&o&&a&&e.jsx(U,{open:R,onClose:()=>T(!1),title:`${s("k8s.cronJobs.title")} - ${a}`,clusterId:c,namespace:o,resourceType:"cronjob",resourceName:a,onLoadYaml:async(t,l,p,j)=>{const m={clusterId:t,namespace:l};return await w.getResourceYaml(m,p,j)},onSaveYaml:async(t,l,p,j,m)=>{const C={clusterId:t,namespace:l};await w.updateResourceYaml(C,p,j,m),y()},onDryRun:async(t,l,p,j,m)=>{const C={clusterId:t,namespace:l};return await w.dryRunResourceYaml(C,p,j,m)}})]})}export{xe as default};
