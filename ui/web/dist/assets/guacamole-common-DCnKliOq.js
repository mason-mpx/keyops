var t=t||{};t.ArrayBufferReader=function(s){var e=this;s.onblob=function(n){for(var i=window.atob(n),u=new ArrayBuffer(i.length),c=new Uint8Array(u),y=0;y<i.length;y++)c[y]=i.charCodeAt(y);e.ondata&&e.ondata(u)},s.onend=function(){e.onend&&e.onend()},this.ondata=null,this.onend=null};var t=t||{};t.ArrayBufferWriter=function(s){var e=this;s.onack=function(i){e.onack&&e.onack(i)};function n(i){for(var u="",c=0;c<i.byteLength;c++)u+=String.fromCharCode(i[c]);s.sendBlob(window.btoa(u))}this.blobLength=t.ArrayBufferWriter.DEFAULT_BLOB_LENGTH,this.sendData=function(i){var u=new Uint8Array(i);if(u.length<=e.blobLength)n(u);else for(var c=0;c<u.length;c+=e.blobLength)n(u.subarray(c,c+e.blobLength))},this.sendEnd=function(){s.sendEnd()},this.onack=null};t.ArrayBufferWriter.DEFAULT_BLOB_LENGTH=6048;var t=t||{};t.AudioContextFactory={singleton:null,getAudioContext:function(){var e=window.AudioContext||window.webkitAudioContext;if(e)try{return t.AudioContextFactory.singleton||(t.AudioContextFactory.singleton=new e),t.AudioContextFactory.singleton}catch{}return null}};var t=t||{};t.AudioPlayer=function(){this.sync=function(){}};t.AudioPlayer.isSupportedType=function(e){return t.RawAudioPlayer.isSupportedType(e)};t.AudioPlayer.getSupportedTypes=function(){return t.RawAudioPlayer.getSupportedTypes()};t.AudioPlayer.getInstance=function(e,n){return t.RawAudioPlayer.isSupportedType(n)?new t.RawAudioPlayer(e,n):null};t.RawAudioPlayer=function(e,n){var i=t.RawAudioFormat.parse(n),u=t.AudioContextFactory.getAudioContext(),c=u.currentTime,y=new t.ArrayBufferReader(e),g=.02,p=.3,l=i.bytesPerSample===1?window.Int8Array:window.Int16Array,m=i.bytesPerSample===1?128:32768,b=[],w=function(E){if(E.length<=1)return E[0];var o=0;E.forEach(function(C){o+=C.length});var f=0,h=new l(o);return E.forEach(function(C){h.set(C,f),f+=C.length}),h},T=function(E){for(var o=Number.MAX_VALUE,f=E.length,h=Math.floor(E.length/i.channels),I=Math.floor(i.rate*g),C=Math.max(i.channels*I,i.channels*(h-I)),L=C;L<E.length;L+=i.channels){for(var k=0,F=0;F<i.channels;F++)k+=Math.abs(E[L+F]);k<=o&&(f=L+i.channels,o=k)}return f===E.length?[E]:[new l(E.buffer.slice(0,f*i.bytesPerSample)),new l(E.buffer.slice(f*i.bytesPerSample))]},O=function(E){b.push(new l(E))},N=function(){var E=w(b);return E?(b=T(E),E=b.shift(),E):null},D=function(E){var o=E.length/i.channels,f=u.currentTime;c<f&&(c=f);for(var h=u.createBuffer(i.channels,o,i.rate),I=0;I<i.channels;I++)for(var C=h.getChannelData(I),L=I,k=0;k<o;k++)C[k]=E[L]/m,L+=i.channels;return h};y.ondata=function(E){O(new l(E));var o=N();if(o){var f=u.currentTime;c<f&&(c=f);var h=u.createBufferSource();h.connect(u.destination),h.start||(h.start=h.noteOn),h.buffer=D(o),h.start(c),c+=o.length/i.channels/i.rate}},this.sync=function(){var E=u.currentTime;c=Math.min(c,E+p)}};t.RawAudioPlayer.prototype=new t.AudioPlayer;t.RawAudioPlayer.isSupportedType=function(e){return t.AudioContextFactory.getAudioContext()?t.RawAudioFormat.parse(e)!==null:!1};t.RawAudioPlayer.getSupportedTypes=function(){return t.AudioContextFactory.getAudioContext()?["audio/L8","audio/L16"]:[]};var t=t||{};t.AudioRecorder=function(){this.onclose=null,this.onerror=null};t.AudioRecorder.isSupportedType=function(e){return t.RawAudioRecorder.isSupportedType(e)};t.AudioRecorder.getSupportedTypes=function(){return t.RawAudioRecorder.getSupportedTypes()};t.AudioRecorder.getInstance=function(e,n){return t.RawAudioRecorder.isSupportedType(n)?new t.RawAudioRecorder(e,n):null};t.RawAudioRecorder=function(e,n){var i=this,u=2048,c=3,y=t.RawAudioFormat.parse(n),g=t.AudioContextFactory.getAudioContext();navigator.mediaDevices||(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia).bind(navigator));var p=new t.ArrayBufferWriter(e),l=y.bytesPerSample===1?window.Int8Array:window.Int16Array,m=y.bytesPerSample===1?128:32768,b=0,w=0,T=null,O=null,N=null,D=function(k){if(k===0)return 1;var F=Math.PI*k;return Math.sin(F)/F},P=function(k,F){return-F<k&&k<F?D(k)*D(k/F):0},E=function(k,F){for(var r=(k.length-1)*F,a=Math.floor(r)-c+1,d=Math.floor(r)+c,S=0,R=a;R<=d;R++)S+=(k[R]||0)*P(r-R,c);return S},o=function(k){var F=k.length;b+=F;var r=Math.round(b*y.rate/k.sampleRate),a=r-w;w+=a;for(var d=new l(a*y.channels),S=0;S<y.channels;S++)for(var R=k.getChannelData(S),A=S,M=0;M<a;M++)d[A]=E(R,M/(a-1))*m,A+=y.channels;return d},f=function(k){N=g.createScriptProcessor(u,y.channels,y.channels),N.connect(g.destination),N.onaudioprocess=function(r){p.sendData(o(r.inputBuffer).buffer)},O=g.createMediaStreamSource(k),O.connect(N),g.state==="suspended"&&g.resume(),T=k},h=function(){p.sendEnd(),i.onerror&&i.onerror()},I=function(){var k=navigator.mediaDevices.getUserMedia({audio:!0},f,h);k&&k.then&&k.then(f,h)},C=function(){if(O&&O.disconnect(),N&&N.disconnect(),T)for(var k=T.getTracks(),F=0;F<k.length;F++)k[F].stop();N=null,O=null,T=null,p.sendEnd()};p.onack=function(k){k.code===t.Status.Code.SUCCESS&&!T?I():(C(),p.onack=null,k.code===t.Status.Code.RESOURCE_CLOSED?i.onclose&&i.onclose():i.onerror&&i.onerror())}};t.RawAudioRecorder.prototype=new t.AudioRecorder;t.RawAudioRecorder.isSupportedType=function(e){return t.AudioContextFactory.getAudioContext()?t.RawAudioFormat.parse(e)!==null:!1};t.RawAudioRecorder.getSupportedTypes=function(){return t.AudioContextFactory.getAudioContext()?["audio/L8","audio/L16"]:[]};var t=t||{};t.BlobReader=function(s,e){var n=this,i=0,u;window.BlobBuilder?u=new BlobBuilder:window.WebKitBlobBuilder?u=new WebKitBlobBuilder:window.MozBlobBuilder?u=new MozBlobBuilder:u=new(function(){var c=[];this.append=function(y){c.push(new Blob([y],{type:e}))},this.getBlob=function(){return new Blob(c,{type:e})}}),s.onblob=function(c){for(var y=window.atob(c),g=new ArrayBuffer(y.length),p=new Uint8Array(g),l=0;l<y.length;l++)p[l]=y.charCodeAt(l);u.append(g),i+=g.byteLength,n.onprogress&&n.onprogress(g.byteLength),s.sendAck("OK",0)},s.onend=function(){n.onend&&n.onend()},this.getLength=function(){return i},this.getBlob=function(){return u.getBlob()},this.onprogress=null,this.onend=null};var t=t||{};t.BlobWriter=function(e){var n=this,i=new t.ArrayBufferWriter(e);i.onack=function(c){n.onack&&n.onack(c)};var u=function(y,g,p){var l=(y.slice||y.webkitSlice||y.mozSlice).bind(y),m=p-g;if(m!==p){var b=l(g,m);if(b.size===m)return b}return l(g,p)};this.sendBlob=function(y){var g=0,p=new FileReader,l=function(){if(g>=y.size){n.oncomplete&&n.oncomplete(y);return}var b=u(y,g,g+i.blobLength);g+=i.blobLength,p.readAsArrayBuffer(b)};p.onload=function(){i.sendData(p.result),i.onack=function(w){n.onack&&n.onack(w),!w.isError()&&(n.onprogress&&n.onprogress(y,g-i.blobLength),l())}},p.onerror=function(){n.onerror&&n.onerror(y,g,p.error)},l()},this.sendEnd=function(){i.sendEnd()},this.onack=null,this.onerror=null,this.onprogress=null,this.oncomplete=null};var t=t||{};t.Client=function(s){var e=this,n=t.Client.State.IDLE,i=0,u=5e3,c=null,y=0,g={0:"butt",1:"round",2:"square"},p={0:"bevel",1:"miter",2:"round"},l=new t.Display,m={},b={},w=[],T=[],O=[],N=new t.IntegerPool,D=[];function P(r){r!=n&&(n=r,e.onstatechange&&e.onstatechange(n))}function E(){return n==t.Client.State.CONNECTED||n==t.Client.State.WAITING}this.exportState=function(a){var d={currentState:n,currentTimestamp:i,layers:{}},S={};for(var R in m)S[R]=m[R];l.flush(function(){for(var M in S){var _=parseInt(M),v=S[M],U=v.toCanvas(),x={width:v.width,height:v.height};v.width&&v.height&&(x.url=U.toDataURL("image/png")),_>0&&(x.x=v.x,x.y=v.y,x.z=v.z,x.alpha=v.alpha,x.matrix=v.matrix,x.parent=f(v.parent)),d.layers[M]=x}a(d)})},this.importState=function(a,d){var S,R;n=a.currentState,i=a.currentTimestamp,l.cancel();for(S in m)R=parseInt(S),R>0&&m[S].dispose();m={};for(S in a.layers){R=parseInt(S);var A=a.layers[S],M=o(R);if(l.resize(M,A.width,A.height),A.url&&(l.setChannelMask(M,t.Layer.SRC),l.draw(M,0,0,A.url)),R>0&&A.parent>=0){var _=o(A.parent);l.move(M,_,A.x,A.y,A.z),l.shade(M,A.alpha);var v=A.matrix;l.distort(M,v[0],v[1],v[2],v[3],v[4],v[5])}}l.flush(d)},this.getDisplay=function(){return l},this.sendSize=function(r,a){E()&&s.sendMessage("size",r,a)},this.sendKeyEvent=function(r,a){E()&&s.sendMessage("key",a,r)},this.sendMouseState=function(a,d){if(E()){var S=a.x,R=a.y;d&&(S/=l.getScale(),R/=l.getScale()),l.moveCursor(Math.floor(S),Math.floor(R));var A=0;a.left&&(A|=1),a.middle&&(A|=2),a.right&&(A|=4),a.up&&(A|=8),a.down&&(A|=16),s.sendMessage("mouse",Math.floor(S),Math.floor(R),A)}},this.sendTouchState=function(a,d){if(E()){var S=a.x,R=a.y;d&&(S/=l.getScale(),R/=l.getScale()),s.sendMessage("touch",a.id,Math.floor(S),Math.floor(R),Math.floor(a.radiusX),Math.floor(a.radiusY),a.angle,a.force)}},this.createOutputStream=function(){var a=N.next(),d=D[a]=new t.OutputStream(e,a);return d},this.createAudioStream=function(r){var a=e.createOutputStream();return s.sendMessage("audio",a.index,r),a},this.createFileStream=function(r,a){var d=e.createOutputStream();return s.sendMessage("file",d.index,r,a),d},this.createPipeStream=function(r,a){var d=e.createOutputStream();return s.sendMessage("pipe",d.index,r,a),d},this.createClipboardStream=function(r){var a=e.createOutputStream();return s.sendMessage("clipboard",a.index,r),a},this.createArgumentValueStream=function(a,d){var S=e.createOutputStream();return s.sendMessage("argv",S.index,a,d),S},this.createObjectOutputStream=function(a,d,S){var R=e.createOutputStream();return s.sendMessage("put",a,R.index,d,S),R},this.requestObjectInputStream=function(a,d){E()&&s.sendMessage("get",a,d)},this.sendAck=function(r,a,d){E()&&s.sendMessage("ack",r,a,d)},this.sendBlob=function(r,a){E()&&s.sendMessage("blob",r,a)},this.endStream=function(r){E()&&(s.sendMessage("end",r),D[r]&&(N.free(r),delete D[r]))},this.onstatechange=null,this.onname=null,this.onerror=null,this.onmsg=null,this.onjoin=null,this.onleave=null,this.onaudio=null,this.onvideo=null,this.onmultitouch=null,this.onargv=null,this.onclipboard=null,this.onfile=null,this.onfilesystem=null,this.onpipe=null,this.onrequired=null,this.onsync=null;var o=function(a){var d=m[a];return d||(a===0?d=l.getDefaultLayer():a>0?d=l.createLayer():d=l.createBuffer(),m[a]=d),d},f=function(a){if(!a)return null;for(var d in m)if(a===m[d])return parseInt(d);return null};function h(r){var a=w[r];return a==null&&(a=w[r]=new t.Parser,a.oninstruction=s.oninstruction),a}var I={"miter-limit":function(r,a){l.setMiterLimit(r,parseFloat(a))},"multi-touch":function(a,d){e.onmultitouch&&a instanceof t.Display.VisibleLayer&&e.onmultitouch(a,parseInt(d))}},C={ack:function(r){var a=parseInt(r[0]),d=r[1],S=parseInt(r[2]),R=D[a];R&&(R.onack&&R.onack(new t.Status(S,d)),S>=256&&D[a]===R&&(N.free(a),delete D[a]))},arc:function(r){var a=o(parseInt(r[0])),d=parseInt(r[1]),S=parseInt(r[2]),R=parseInt(r[3]),A=parseFloat(r[4]),M=parseFloat(r[5]),_=parseInt(r[6]);l.arc(a,d,S,R,A,M,_!=0)},argv:function(r){var a=parseInt(r[0]),d=r[1],S=r[2];if(e.onargv){var R=T[a]=new t.InputStream(e,a);e.onargv(R,d,S)}else e.sendAck(a,"Receiving argument values unsupported",256)},audio:function(r){var a=parseInt(r[0]),d=r[1],S=T[a]=new t.InputStream(e,a),R=null;e.onaudio&&(R=e.onaudio(S,d)),R||(R=t.AudioPlayer.getInstance(S,d)),R?(b[a]=R,e.sendAck(a,"OK",0)):e.sendAck(a,"BAD TYPE",783)},blob:function(r){var a=parseInt(r[0]),d=r[1],S=T[a];S&&S.onblob&&S.onblob(d)},body:function(a){var d=parseInt(a[0]),S=O[d],R=parseInt(a[1]),A=a[2],M=a[3];if(S&&S.onbody){var _=T[R]=new t.InputStream(e,R);S.onbody(_,A,M)}else e.sendAck(R,"Receipt of body unsupported",256)},cfill:function(r){var a=parseInt(r[0]),d=o(parseInt(r[1])),S=parseInt(r[2]),R=parseInt(r[3]),A=parseInt(r[4]),M=parseInt(r[5]);l.setChannelMask(d,a),l.fillColor(d,S,R,A,M)},clip:function(r){var a=o(parseInt(r[0]));l.clip(a)},clipboard:function(r){var a=parseInt(r[0]),d=r[1];if(e.onclipboard){var S=T[a]=new t.InputStream(e,a);e.onclipboard(S,d)}else e.sendAck(a,"Clipboard unsupported",256)},close:function(r){var a=o(parseInt(r[0]));l.close(a)},copy:function(r){var a=o(parseInt(r[0])),d=parseInt(r[1]),S=parseInt(r[2]),R=parseInt(r[3]),A=parseInt(r[4]),M=parseInt(r[5]),_=o(parseInt(r[6])),v=parseInt(r[7]),U=parseInt(r[8]);l.setChannelMask(_,M),l.copy(a,d,S,R,A,_,v,U)},cstroke:function(r){var a=parseInt(r[0]),d=o(parseInt(r[1])),S=g[parseInt(r[2])],R=p[parseInt(r[3])],A=parseInt(r[4]),M=parseInt(r[5]),_=parseInt(r[6]),v=parseInt(r[7]),U=parseInt(r[8]);l.setChannelMask(d,a),l.strokeColor(d,S,R,A,M,_,v,U)},cursor:function(r){var a=parseInt(r[0]),d=parseInt(r[1]),S=o(parseInt(r[2])),R=parseInt(r[3]),A=parseInt(r[4]),M=parseInt(r[5]),_=parseInt(r[6]);l.setCursor(a,d,S,R,A,M,_)},curve:function(r){var a=o(parseInt(r[0])),d=parseInt(r[1]),S=parseInt(r[2]),R=parseInt(r[3]),A=parseInt(r[4]),M=parseInt(r[5]),_=parseInt(r[6]);l.curveTo(a,d,S,R,A,M,_)},disconnect:function(a){e.disconnect()},dispose:function(r){var a=parseInt(r[0]);if(a>0){var d=o(a);l.dispose(d),delete m[a]}else a<0&&delete m[a]},distort:function(r){var a=parseInt(r[0]),d=parseFloat(r[1]),S=parseFloat(r[2]),R=parseFloat(r[3]),A=parseFloat(r[4]),M=parseFloat(r[5]),_=parseFloat(r[6]);if(a>=0){var v=o(a);l.distort(v,d,S,R,A,M,_)}},error:function(r){var a=r[0],d=parseInt(r[1]);e.onerror&&e.onerror(new t.Status(d,a)),e.disconnect()},end:function(r){var a=parseInt(r[0]),d=T[a];d&&(d.onend&&d.onend(),delete T[a])},file:function(r){var a=parseInt(r[0]),d=r[1],S=r[2];if(e.onfile){var R=T[a]=new t.InputStream(e,a);e.onfile(R,d,S)}else e.sendAck(a,"File transfer unsupported",256)},filesystem:function(a){var d=parseInt(a[0]),S=a[1];if(e.onfilesystem){var R=O[d]=new t.Object(e,d);e.onfilesystem(R,S)}},identity:function(r){var a=o(parseInt(r[0]));l.setTransform(a,1,0,0,1,0,0)},img:function(r){var a=parseInt(r[0]),d=parseInt(r[1]),S=o(parseInt(r[2])),R=r[3],A=parseInt(r[4]),M=parseInt(r[5]),_=T[a]=new t.InputStream(e,a);l.setChannelMask(S,d),l.drawStream(S,A,M,_,R)},jpeg:function(r){var a=parseInt(r[0]),d=o(parseInt(r[1])),S=parseInt(r[2]),R=parseInt(r[3]),A=r[4];l.setChannelMask(d,a),l.draw(d,S,R,"data:image/jpeg;base64,"+A)},lfill:function(r){var a=parseInt(r[0]),d=o(parseInt(r[1])),S=o(parseInt(r[2]));l.setChannelMask(d,a),l.fillLayer(d,S)},line:function(r){var a=o(parseInt(r[0])),d=parseInt(r[1]),S=parseInt(r[2]);l.lineTo(a,d,S)},lstroke:function(r){var a=parseInt(r[0]),d=o(parseInt(r[1])),S=o(parseInt(r[2]));l.setChannelMask(d,a),l.strokeLayer(d,S)},mouse:function(a){var d=parseInt(a[0]),S=parseInt(a[1]);l.showCursor(!0),l.moveCursor(d,S)},move:function(r){var a=parseInt(r[0]),d=parseInt(r[1]),S=parseInt(r[2]),R=parseInt(r[3]),A=parseInt(r[4]);if(a>0&&d>=0){var M=o(a),_=o(d);l.move(M,_,S,R,A)}},msg:function(r){var a,d,S=!0,R=parseInt(r[0]);if(e.onmsg&&(S=e.onmsg(R,r.slice(1)),S===void 0&&(S=!0)),S)switch(R){case t.Client.Message.USER_JOINED:a=r[1],d=r[2],e.onjoin&&e.onjoin(a,d);break;case t.Client.Message.USER_LEFT:a=r[1],d=r[2],e.onleave&&e.onleave(a,d);break}},name:function(r){e.onname&&e.onname(r[0])},nest:function(r){var a=h(parseInt(r[0]));a.receive(r[1])},pipe:function(r){var a=parseInt(r[0]),d=r[1],S=r[2];if(e.onpipe){var R=T[a]=new t.InputStream(e,a);e.onpipe(R,d,S)}else e.sendAck(a,"Named pipes unsupported",256)},png:function(r){var a=parseInt(r[0]),d=o(parseInt(r[1])),S=parseInt(r[2]),R=parseInt(r[3]),A=r[4];l.setChannelMask(d,a),l.draw(d,S,R,"data:image/png;base64,"+A)},pop:function(r){var a=o(parseInt(r[0]));l.pop(a)},push:function(r){var a=o(parseInt(r[0]));l.push(a)},rect:function(r){var a=o(parseInt(r[0])),d=parseInt(r[1]),S=parseInt(r[2]),R=parseInt(r[3]),A=parseInt(r[4]);l.rect(a,d,S,R,A)},required:function(a){e.onrequired&&e.onrequired(a)},reset:function(r){var a=o(parseInt(r[0]));l.reset(a)},set:function(r){var a=o(parseInt(r[0])),d=r[1],S=r[2],R=I[d];R&&R(a,S)},shade:function(r){var a=parseInt(r[0]),d=parseInt(r[1]);if(a>=0){var S=o(a);l.shade(S,d)}},size:function(r){var a=parseInt(r[0]),d=o(a),S=parseInt(r[1]),R=parseInt(r[2]);l.resize(d,S,R)},start:function(r){var a=o(parseInt(r[0])),d=parseInt(r[1]),S=parseInt(r[2]);l.moveTo(a,d,S)},sync:function(r){var a=parseInt(r[0]),d=r[1]?parseInt(r[1]):0;l.flush(function(){for(var R in b){var A=b[R];A&&A.sync()}a!==i&&(s.sendMessage("sync",a),i=a)},a,d),n===t.Client.State.WAITING&&P(t.Client.State.CONNECTED),e.onsync&&e.onsync(a,d)},transfer:function(r){var a=o(parseInt(r[0])),d=parseInt(r[1]),S=parseInt(r[2]),R=parseInt(r[3]),A=parseInt(r[4]),M=parseInt(r[5]),_=o(parseInt(r[6])),v=parseInt(r[7]),U=parseInt(r[8]);M===3?l.put(a,d,S,R,A,_,v,U):M!==5&&l.transfer(a,d,S,R,A,_,v,U,t.Client.DefaultTransferFunction[M])},transform:function(r){var a=o(parseInt(r[0])),d=parseFloat(r[1]),S=parseFloat(r[2]),R=parseFloat(r[3]),A=parseFloat(r[4]),M=parseFloat(r[5]),_=parseFloat(r[6]);l.transform(a,d,S,R,A,M,_)},undefine:function(a){var d=parseInt(a[0]),S=O[d];S&&S.onundefine&&S.onundefine()},video:function(r){var a=parseInt(r[0]),d=o(parseInt(r[1])),S=r[2],R=T[a]=new t.InputStream(e,a),A=null;e.onvideo&&(A=e.onvideo(R,d,S)),A||(A=t.VideoPlayer.getInstance(R,d,S)),A?e.sendAck(a,"OK",0):e.sendAck(a,"BAD TYPE",783)}},L=function(){s.sendMessage("nop"),y=new Date().getTime()},k=function(){window.clearTimeout(c);var a=new Date().getTime(),d=Math.max(y+u-a,0);d>0?c=window.setTimeout(L,d):L()},F=function(){window.clearTimeout(c)};s.oninstruction=function(r,a){var d=C[r];d&&d(a),k()},this.disconnect=function(){n!=t.Client.State.DISCONNECTED&&n!=t.Client.State.DISCONNECTING&&(P(t.Client.State.DISCONNECTING),F(),s.sendMessage("disconnect"),s.disconnect(),P(t.Client.State.DISCONNECTED))},this.connect=function(r){P(t.Client.State.CONNECTING);try{s.connect(r)}catch(a){throw P(t.Client.State.IDLE),a}k(),P(t.Client.State.WAITING)}};t.Client.State={IDLE:0,CONNECTING:1,WAITING:2,CONNECTED:3,DISCONNECTING:4,DISCONNECTED:5};t.Client.DefaultTransferFunction={0:function(s,e){e.red=e.green=e.blue=0},15:function(s,e){e.red=e.green=e.blue=255},3:function(s,e){e.red=s.red,e.green=s.green,e.blue=s.blue,e.alpha=s.alpha},5:function(s,e){},12:function(s,e){e.red=255&~s.red,e.green=255&~s.green,e.blue=255&~s.blue,e.alpha=s.alpha},10:function(s,e){e.red=255&~e.red,e.green=255&~e.green,e.blue=255&~e.blue},1:function(s,e){e.red=s.red&e.red,e.green=s.green&e.green,e.blue=s.blue&e.blue},14:function(s,e){e.red=255&~(s.red&e.red),e.green=255&~(s.green&e.green),e.blue=255&~(s.blue&e.blue)},7:function(s,e){e.red=s.red|e.red,e.green=s.green|e.green,e.blue=s.blue|e.blue},8:function(s,e){e.red=255&~(s.red|e.red),e.green=255&~(s.green|e.green),e.blue=255&~(s.blue|e.blue)},6:function(s,e){e.red=s.red^e.red,e.green=s.green^e.green,e.blue=s.blue^e.blue},9:function(s,e){e.red=255&~(s.red^e.red),e.green=255&~(s.green^e.green),e.blue=255&~(s.blue^e.blue)},4:function(s,e){e.red=255&(~s.red&e.red),e.green=255&(~s.green&e.green),e.blue=255&(~s.blue&e.blue)},13:function(s,e){e.red=255&(~s.red|e.red),e.green=255&(~s.green|e.green),e.blue=255&(~s.blue|e.blue)},2:function(s,e){e.red=255&(s.red&~e.red),e.green=255&(s.green&~e.green),e.blue=255&(s.blue&~e.blue)},11:function(s,e){e.red=255&(s.red|~e.red),e.green=255&(s.green|~e.green),e.blue=255&(s.blue|~e.blue)}};t.Client.Message={USER_JOINED:1,USER_LEFT:2};var t=t||{};t.DataURIReader=function(s,e){var n=this,i="data:"+e+";base64,";s.onblob=function(c){i+=c},s.onend=function(){n.onend&&n.onend()},this.getURI=function(){return i},this.onend=null};var t=t||{};t.Display=function(){var s=this,e=0,n=0,i=1,u=document.createElement("div");u.style.position="relative",u.style.width=e+"px",u.style.height=n+"px",u.style.transformOrigin=u.style.webkitTransformOrigin=u.style.MozTransformOrigin=u.style.OTransformOrigin=u.style.msTransformOrigin="0 0";var c=new t.Display.VisibleLayer(e,n),y=new t.Display.VisibleLayer(0,0);y.setChannelMask(t.Layer.SRC),u.appendChild(c.getElement()),u.appendChild(y.getElement());var g=document.createElement("div");g.style.position="relative",g.style.width=e*i+"px",g.style.height=n*i+"px",g.appendChild(u),this.cursorHotspotX=0,this.cursorHotspotY=0,this.cursorX=0,this.cursorY=0,this.statisticWindow=0,this.onresize=null,this.oncursor=null,this.onstatistics=null;var p=[],l=[],m=null,b=function(){for(var f=0,h=0,I=0,C=0;C<l.length;){var L=l[C];if(!L.isReady())break;L.flush(),f=L.localTimestamp,h=L.remoteTimestamp,I+=L.logicalFrames,C++}l.splice(0,C),C&&O(f,h,I)},w=function(){var f=function h(){if(m=null,!!l.length){if(l[0].isReady()){var I=l.shift();I.flush(),O(I.localTimestamp,I.remoteTimestamp,I.logicalFrames)}l.length&&(m=window.requestAnimationFrame(h))}};m||(m=window.requestAnimationFrame(f))},T=[],O=function(f,h,I){if(s.statisticWindow){for(var C=new Date().getTime(),L=0;L<T.length&&!(C-T[L].timestamp<=s.statisticWindow);L++);T.splice(0,L-1),T.push({localTimestamp:f,remoteTimestamp:h,timestamp:C,frames:I});var k=(T[T.length-1].timestamp-T[0].timestamp)/1e3,F=(T[T.length-1].remoteTimestamp-T[0].remoteTimestamp)/1e3,r=T.length,a=T.reduce(function(A,M){return A+M.frames},0),d=T.reduce(function(A,M){return A+Math.max(0,M.frames-1)},0),S=new t.Display.Statistics({processingLag:C-f,desktopFps:F&&a?a/F:null,clientFps:k?r/k:null,serverFps:F?r/F:null,dropRate:F?d/F:null});s.onstatistics&&s.onstatistics(S)}};window.addEventListener("blur",function(){m&&!document.hasFocus()&&(window.cancelAnimationFrame(m),m=null,b())},!0);function N(){window.requestAnimationFrame&&document.hasFocus()?w():b()}var D=function(f,h,I,C){this.localTimestamp=new Date().getTime(),this.remoteTimestamp=I||this.localTimestamp,this.logicalFrames=C||0,this.cancel=function(){f=null,h.forEach(function(F){F.cancel()}),h=[]},this.isReady=function(){for(var L=0;L<h.length;L++)if(h[L].blocked)return!1;return!0},this.flush=function(){for(var L=0;L<h.length;L++)h[L].execute();f&&f()}};function P(o,f){var h=this;this.blocked=f,this.cancel=function(){h.blocked=!1,o=null},this.unblock=function(){h.blocked&&(h.blocked=!1,N())},this.execute=function(){o&&o()}}function E(o,f){var h=new P(o,f);return p.push(h),h}this.getElement=function(){return g},this.getWidth=function(){return e},this.getHeight=function(){return n},this.getDefaultLayer=function(){return c},this.getCursorLayer=function(){return y},this.createLayer=function(){var o=new t.Display.VisibleLayer(e,n);return o.move(c,0,0,0),o},this.createBuffer=function(){var o=new t.Layer(0,0);return o.autosize=1,o},this.flush=function(o,f,h){l.push(new D(o,p,f,h)),p=[],N()},this.cancel=function(){l.forEach(function(h){h.cancel()}),l=[],p.forEach(function(h){h.cancel()}),p=[]},this.setCursor=function(o,f,h,I,C,L,k){E(function(){s.cursorHotspotX=o,s.cursorHotspotY=f,y.resize(L,k),y.copy(h,I,C,L,k,0,0),s.moveCursor(s.cursorX,s.cursorY),s.oncursor&&s.oncursor(y.toCanvas(),o,f)})},this.showCursor=function(o){var f=y.getElement(),h=f.parentNode;o===!1?h&&h.removeChild(f):h!==u&&u.appendChild(f)},this.moveCursor=function(o,f){y.translate(o-s.cursorHotspotX,f-s.cursorHotspotY),s.cursorX=o,s.cursorY=f},this.resize=function(o,f,h){E(function(){o.resize(f,h),o===c&&(e=f,n=h,u.style.width=e+"px",u.style.height=n+"px",g.style.width=e*i+"px",g.style.height=n*i+"px",s.onresize&&s.onresize(f,h))})},this.drawImage=function(o,f,h,I){E(function(){o.drawImage(f,h,I)})},this.drawBlob=function(o,f,h,I){var C;if(window.createImageBitmap){var L;C=E(function(){o.drawImage(f,h,L)},!0),window.createImageBitmap(I).then(function(a){L=a,C.unblock()})}else{var k=URL.createObjectURL(I);C=E(function(){F.width&&F.height&&o.drawImage(f,h,F),URL.revokeObjectURL(k)},!0);var F=new Image;F.onload=C.unblock,F.onerror=C.unblock,F.src=k}},this.drawStream=function(f,h,I,C,L){if(window.createImageBitmap){var k=new t.BlobReader(C,L);k.onend=function(){s.drawBlob(f,h,I,k.getBlob())}}else{var k=new t.DataURIReader(C,L);k.onend=function(){s.draw(f,h,I,k.getURI())}}},this.draw=function(o,f,h,I){var C=E(function(){L.width&&L.height&&o.drawImage(f,h,L)},!0),L=new Image;L.onload=C.unblock,L.onerror=C.unblock,L.src=I},this.play=function(o,f,h,I){var C=document.createElement("video");C.type=f,C.src=I,C.addEventListener("play",function(){function L(){o.drawImage(0,0,C),C.ended||window.setTimeout(L,20)}L()},!1),E(C.play)},this.transfer=function(o,f,h,I,C,L,k,F,r){E(function(){L.transfer(o,f,h,I,C,k,F,r)})},this.put=function(o,f,h,I,C,L,k,F){E(function(){L.put(o,f,h,I,C,k,F)})},this.copy=function(o,f,h,I,C,L,k,F){E(function(){L.copy(o,f,h,I,C,k,F)})},this.moveTo=function(o,f,h){E(function(){o.moveTo(f,h)})},this.lineTo=function(o,f,h){E(function(){o.lineTo(f,h)})},this.arc=function(o,f,h,I,C,L,k){E(function(){o.arc(f,h,I,C,L,k)})},this.curveTo=function(o,f,h,I,C,L,k){E(function(){o.curveTo(f,h,I,C,L,k)})},this.close=function(o){E(function(){o.close()})},this.rect=function(o,f,h,I,C){E(function(){o.rect(f,h,I,C)})},this.clip=function(o){E(function(){o.clip()})},this.strokeColor=function(o,f,h,I,C,L,k,F){E(function(){o.strokeColor(f,h,I,C,L,k,F)})},this.fillColor=function(o,f,h,I,C){E(function(){o.fillColor(f,h,I,C)})},this.strokeLayer=function(o,f,h,I,C){E(function(){o.strokeLayer(f,h,I,C)})},this.fillLayer=function(o,f){E(function(){o.fillLayer(f)})},this.push=function(o){E(function(){o.push()})},this.pop=function(o){E(function(){o.pop()})},this.reset=function(o){E(function(){o.reset()})},this.setTransform=function(o,f,h,I,C,L,k){E(function(){o.setTransform(f,h,I,C,L,k)})},this.transform=function(o,f,h,I,C,L,k){E(function(){o.transform(f,h,I,C,L,k)})},this.setChannelMask=function(o,f){E(function(){o.setChannelMask(f)})},this.setMiterLimit=function(o,f){E(function(){o.setMiterLimit(f)})},this.dispose=function(f){E(function(){f.dispose()})},this.distort=function(f,h,I,C,L,k,F){E(function(){f.distort(h,I,C,L,k,F)})},this.move=function(f,h,I,C,L){E(function(){f.move(h,I,C,L)})},this.shade=function(f,h){E(function(){f.shade(h)})},this.scale=function(o){u.style.transform=u.style.WebkitTransform=u.style.MozTransform=u.style.OTransform=u.style.msTransform="scale("+o+","+o+")",i=o,g.style.width=e*i+"px",g.style.height=n*i+"px"},this.getScale=function(){return i},this.flatten=function(){var o=document.createElement("canvas");o.width=c.width,o.height=c.height;var f=o.getContext("2d");function h(C){var L=[];for(var k in C.children)L.push(C.children[k]);return L.sort(function(r,a){var d=r.z-a.z;if(d!==0)return d;var S=r.getElement(),R=a.getElement(),A=R.compareDocumentPosition(S);return A&Node.DOCUMENT_POSITION_PRECEDING?-1:A&Node.DOCUMENT_POSITION_FOLLOWING?1:0}),L}function I(C,L,k){if(C.width>0&&C.height>0){var F=f.globalAlpha;f.globalAlpha*=C.alpha/255,f.drawImage(C.getCanvas(),L,k);for(var r=h(C),a=0;a<r.length;a++){var d=r[a];I(d,L+d.x,k+d.y)}f.globalAlpha=F}}return I(c,0,0),o}};t.Display.VisibleLayer=function(s,e){t.Layer.apply(this,[s,e]);var n=this;this.__unique_id=t.Display.VisibleLayer.__next_id++,this.alpha=255,this.x=0,this.y=0,this.z=0,this.matrix=[1,0,0,1,0,0],this.parent=null,this.children={};var i=n.getCanvas();i.style.position="absolute",i.style.left="0px",i.style.top="0px";var u=document.createElement("div");u.appendChild(i),u.style.width=s+"px",u.style.height=e+"px",u.style.position="absolute",u.style.left="0px",u.style.top="0px",u.style.overflow="hidden";var c=this.resize;this.resize=function(p,l){u.style.width=p+"px",u.style.height=l+"px",c(p,l)},this.getElement=function(){return u};var y="translate(0px, 0px)",g="matrix(1, 0, 0, 1, 0, 0)";this.translate=function(p,l){n.x=p,n.y=l,y="translate("+p+"px,"+l+"px)",u.style.transform=u.style.WebkitTransform=u.style.MozTransform=u.style.OTransform=u.style.msTransform=y+" "+g},this.move=function(p,l,m,b){if(n.parent!==p){n.parent&&delete n.parent.children[n.__unique_id],n.parent=p,p.children[n.__unique_id]=n;var w=p.getElement();w.appendChild(u)}n.translate(l,m),n.z=b,u.style.zIndex=b},this.shade=function(p){n.alpha=p,u.style.opacity=p/255},this.dispose=function(){n.parent&&(delete n.parent.children[n.__unique_id],n.parent=null),u.parentNode&&u.parentNode.removeChild(u)},this.distort=function(p,l,m,b,w,T){n.matrix=[p,l,m,b,w,T],g="matrix("+p+","+l+","+m+","+b+","+w+","+T+")",u.style.transform=u.style.WebkitTransform=u.style.MozTransform=u.style.OTransform=u.style.msTransform=y+" "+g}};t.Display.VisibleLayer.__next_id=0;t.Display.Statistics=function(e){e=e||{},this.processingLag=e.processingLag,this.desktopFps=e.desktopFps,this.serverFps=e.serverFps,this.clientFps=e.clientFps,this.dropRate=e.dropRate};var t=t||{};t.Event=function(e){this.type=e,this.timestamp=new Date().getTime(),this.getAge=function(){return new Date().getTime()-this.timestamp},this.invokeLegacyHandler=function(i){}};t.Event.DOMEvent=function(e,n){t.Event.call(this,e),n=n||[],Array.isArray(n)||(n=[n]),this.preventDefault=function(){n.forEach(function(c){c.preventDefault&&c.preventDefault(),c.returnValue=!1})},this.stopPropagation=function(){n.forEach(function(c){c.stopPropagation()})}};t.Event.DOMEvent.cancelEvent=function(e){e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1};t.Event.Target=function(){var e={};this.on=function(i,u){var c=e[i];c||(e[i]=c=[]),c.push(u)},this.onEach=function(i,u){i.forEach(function(y){this.on(y,u)},this)},this.dispatch=function(i){i.invokeLegacyHandler(this);var u=e[i.type];if(u)for(var c=0;c<u.length;c++)u[c](i,this)},this.off=function(i,u){var c=e[i];if(!c)return!1;for(var y=0;y<c.length;y++)if(c[y]===u)return c.splice(y,1),!0;return!1},this.offEach=function(i,u){var c=!1;return i.forEach(function(g){c|=this.off(g,u)},this),c}};var t=t||{};t.InputSink=function(){var e=this,n=document.createElement("textarea");n.style.position="fixed",n.style.outline="none",n.style.border="none",n.style.margin="0",n.style.padding="0",n.style.height="0",n.style.width="0",n.style.left="0",n.style.bottom="0",n.style.resize="none",n.style.background="transparent",n.style.color="transparent",n.addEventListener("keypress",function(u){n.value=""},!1),n.addEventListener("compositionend",function(u){u.data&&(n.value="")},!1),n.addEventListener("input",function(u){u.data&&!u.isComposing&&(n.value="")},!1),n.addEventListener("focus",function(){window.setTimeout(function(){n.click(),n.select()},0)},!0),this.focus=function(){window.setTimeout(function(){n.focus()},0)},this.getElement=function(){return n},document.addEventListener("keydown",function(u){var c=document.activeElement;if(c&&c!==document.body){var y=c.getBoundingClientRect();if(y.left+y.width>0&&y.top+y.height>0)return}e.focus()},!0)};var t=t||{};t.InputStream=function(s,e){var n=this;this.index=e,this.onblob=null,this.onend=null,this.sendAck=function(i,u){s.sendAck(n.index,i,u)}};var t=t||{};t.IntegerPool=function(){var s=this,e=[];this.next_int=0,this.next=function(){return e.length>0?e.shift():s.next_int++},this.free=function(n){e.push(n)}};var t=t||{};t.JSONReader=function(e){var n=this,i=new t.StringReader(e),u="";this.getLength=function(){return u.length},this.getJSON=function(){return JSON.parse(u)},i.ontext=function(y){u+=y,n.onprogress&&n.onprogress(y.length)},i.onend=function(){n.onend&&n.onend()},this.onprogress=null,this.onend=null};var t=t||{};t.Keyboard=function(e){var n=this,i=t.Keyboard._nextID++,u="_GUAC_KEYBOARD_HANDLED_BY_"+i;this.onkeydown=null,this.onkeyup=null;var c={keyupUnreliable:!1,altIsTypableOnly:!1,capsLockKeyupUnreliable:!1};navigator&&navigator.platform&&(navigator.platform.match(/ipad|iphone|ipod/i)?c.keyupUnreliable=!0:navigator.platform.match(/^mac/i)&&(c.altIsTypableOnly=!0,c.capsLockKeyupUnreliable=!0));var y=function(v){var U=this;this.keyCode=v?v.which||v.keyCode:0,this.keyIdentifier=v&&v.keyIdentifier,this.key=v&&v.key,this.location=v?A(v):0,this.modifiers=v?t.Keyboard.ModifierState.fromKeyboardEvent(v):new t.Keyboard.ModifierState,this.timestamp=new Date().getTime(),this.defaultPrevented=!1,this.keysym=null,this.reliable=!1,this.getAge=function(){return new Date().getTime()-U.timestamp}},g=function(v){y.call(this,v),this.keysym=h(this.key,this.location)||L(this.keyCode,this.location),this.keyupReliable=!c.keyupUnreliable,this.keysym&&!f(this.keysym)&&(this.reliable=!0),!this.keysym&&k(this.keyCode,this.keyIdentifier)&&(this.keysym=h(this.keyIdentifier,this.location,this.modifiers.shift)),this.modifiers.meta&&this.keysym!==65511&&this.keysym!==65512?this.keyupReliable=!1:this.keysym===65509&&c.capsLockKeyupUnreliable&&(this.keyupReliable=!1);var U=!this.modifiers.ctrl&&!c.altIsTypableOnly,x=!this.modifiers.alt;(x&&this.modifiers.ctrl||U&&this.modifiers.alt||this.modifiers.meta||this.modifiers.hyper)&&(this.reliable=!0),D[this.keyCode]=this.keysym};g.prototype=new y;var p=function(v){y.call(this,v),this.keysym=C(this.keyCode),this.reliable=!0};p.prototype=new y;var l=function(v){y.call(this,v),this.keysym=L(this.keyCode,this.location)||h(this.key,this.location),n.pressed[this.keysym]||(this.keysym=D[this.keyCode]||this.keysym),this.reliable=!0};l.prototype=new y;var m=[],b={8:[65288],9:[65289],12:[65291,65291,65291,65461],13:[65293],16:[65505,65505,65506],17:[65507,65507,65508],18:[65513,65513,65027],19:[65299],20:[65509],27:[65307],32:[32],33:[65365,65365,65365,65465],34:[65366,65366,65366,65459],35:[65367,65367,65367,65457],36:[65360,65360,65360,65463],37:[65361,65361,65361,65460],38:[65362,65362,65362,65464],39:[65363,65363,65363,65462],40:[65364,65364,65364,65458],45:[65379,65379,65379,65456],46:[65535,65535,65535,65454],91:[65511],92:[65512],93:[65383],96:[65456],97:[65457],98:[65458],99:[65459],100:[65460],101:[65461],102:[65462],103:[65463],104:[65464],105:[65465],106:[65450],107:[65451],109:[65453],110:[65454],111:[65455],112:[65470],113:[65471],114:[65472],115:[65473],116:[65474],117:[65475],118:[65476],119:[65477],120:[65478],121:[65479],122:[65480],123:[65481],144:[65407],145:[65300],225:[65027]},w={Again:[65382],AllCandidates:[65341],Alphanumeric:[65328],Alt:[65513,65513,65027],Attn:[64782],AltGraph:[65027],ArrowDown:[65364],ArrowLeft:[65361],ArrowRight:[65363],ArrowUp:[65362],Backspace:[65288],CapsLock:[65509],Cancel:[65385],Clear:[65291],Convert:[65313],Copy:[64789],Crsel:[64796],CrSel:[64796],CodeInput:[65335],Compose:[65312],Control:[65507,65507,65508],ContextMenu:[65383],Delete:[65535],Down:[65364],End:[65367],Enter:[65293],EraseEof:[64774],Escape:[65307],Execute:[65378],Exsel:[64797],ExSel:[64797],F1:[65470],F2:[65471],F3:[65472],F4:[65473],F5:[65474],F6:[65475],F7:[65476],F8:[65477],F9:[65478],F10:[65479],F11:[65480],F12:[65481],F13:[65482],F14:[65483],F15:[65484],F16:[65485],F17:[65486],F18:[65487],F19:[65488],F20:[65489],F21:[65490],F22:[65491],F23:[65492],F24:[65493],Find:[65384],GroupFirst:[65036],GroupLast:[65038],GroupNext:[65032],GroupPrevious:[65034],FullWidth:null,HalfWidth:null,HangulMode:[65329],Hankaku:[65321],HanjaMode:[65332],Help:[65386],Hiragana:[65317],HiraganaKatakana:[65319],Home:[65360],Hyper:[65517,65517,65518],Insert:[65379],JapaneseHiragana:[65317],JapaneseKatakana:[65318],JapaneseRomaji:[65316],JunjaMode:[65336],KanaMode:[65325],KanjiMode:[65313],Katakana:[65318],Left:[65361],Meta:[65511,65511,65512],ModeChange:[65406],NumLock:[65407],PageDown:[65366],PageUp:[65365],Pause:[65299],Play:[64790],PreviousCandidate:[65342],PrintScreen:[65377],Redo:[65382],Right:[65363],RomanCharacters:null,Scroll:[65300],Select:[65376],Separator:[65452],Shift:[65505,65505,65506],SingleCandidate:[65340],Super:[65515,65515,65516],Tab:[65289],UIKeyInputDownArrow:[65364],UIKeyInputEscape:[65307],UIKeyInputLeftArrow:[65361],UIKeyInputRightArrow:[65363],UIKeyInputUpArrow:[65362],Up:[65362],Undo:[65381],Win:[65511,65511,65512],Zenkaku:[65320],ZenkakuHankaku:[65322]},T={65027:!0,65505:!0,65506:!0,65507:!0,65508:!0,65509:!0,65511:!0,65512:!0,65513:!0,65514:!0,65515:!0,65516:!0};this.modifiers=new t.Keyboard.ModifierState,this.pressed={};var O={},N={},D={},P=null,E=null,o=function(v,U){return v?v[U]||v[0]:null},f=function(v){return v>=0&&v<=255||(v&4294901760)===16777216};function h(_,v,U){if(!_)return null;var x,B=_.indexOf("U+");if(B>=0){var K=_.substring(B+2);x=String.fromCharCode(parseInt(K,16))}else if(_.length===1&&v!==3)x=_;else return o(w[_],v);U===!0?x=x.toUpperCase():U===!1&&(x=x.toLowerCase());var G=x.charCodeAt(0);return C(G)}function I(_){return _<=31||_>=127&&_<=159}function C(_){return I(_)?65280|_:_>=0&&_<=255?_:_>=256&&_<=1114111?16777216|_:null}function L(_,v){return o(b[_],v)}var k=function(v,U){if(!U)return!1;var x=U.indexOf("U+");if(x===-1)return!0;var B=parseInt(U.substring(x+2),16);return v!==B||v>=65&&v<=90||v>=48&&v<=57};this.press=function(_){if(_!==null){if(!n.pressed[_]&&(n.pressed[_]=!0,n.onkeydown)){var v=n.onkeydown(_);return N[_]=v,window.clearTimeout(P),window.clearInterval(E),T[_]||(P=window.setTimeout(function(){E=window.setInterval(function(){n.onkeyup(_),n.onkeydown(_)},50)},500)),v}return N[_]||!1}},this.release=function(_){n.pressed[_]&&(delete n.pressed[_],delete O[_],window.clearTimeout(P),window.clearInterval(E),_!==null&&n.onkeyup&&n.onkeyup(_))},this.type=function(v){for(var U=0;U<v.length;U++){var x=v.codePointAt?v.codePointAt(U):v.charCodeAt(U),B=C(x);n.press(B),n.release(B)}},this.reset=function(){for(var _ in n.pressed)n.release(parseInt(_));m=[]};var F=function(v,U,x){var B=x.modifiers[v],K=n.modifiers[v],G;if(U.indexOf(x.keysym)===-1){if(K&&B===!1)for(G=0;G<U.length;G++)n.release(U[G]);else if(!K&&B){for(G=0;G<U.length;G++)if(n.pressed[U[G]])return;var z=U[0];x.keysym&&(O[z]=!0),n.press(z)}}},r=function(v){F("alt",[65513,65514,65027],v),F("shift",[65505,65506],v),F("ctrl",[65507,65508],v),F("meta",[65511,65512],v),F("hyper",[65515,65516],v),n.modifiers=v.modifiers},a=function(){for(var v in n.pressed)if(!O[v])return!1;return!0};function d(){var _=R();if(!_)return!1;var v;do v=_,_=R();while(_!==null);return a()&&n.reset(),v.defaultPrevented}var S=function(v){!n.modifiers.ctrl||!n.modifiers.alt||v>=65&&v<=90||v>=97&&v<=122||(v<=255||(v&4278190080)===16777216)&&(n.release(65507),n.release(65508),n.release(65513),n.release(65514))},R=function(){var v=m[0];if(!v)return null;if(v instanceof g){var U=null,x=[];if(v.keysym===65511||v.keysym===65512){if(m.length===1)return null;if(m[1].keysym!==v.keysym){if(!m[1].modifiers.meta)return m.shift()}else if(m[1]instanceof g)return m.shift()}if(v.reliable?(U=v.keysym,x=m.splice(0,1)):m[1]instanceof p?(U=m[1].keysym,x=m.splice(0,2)):m[1]&&(U=v.keysym,x=m.splice(0,1)),x.length>0){if(r(v),U){S(U);var B=!n.press(U);D[v.keyCode]=U,v.keyupReliable||n.release(U);for(var K=0;K<x.length;K++)x[K].defaultPrevented=B}return v}}else if(v instanceof l&&!c.keyupUnreliable){var U=v.keysym;if(U)n.release(U),delete D[v.keyCode],v.defaultPrevented=!0;else return n.reset(),v;return r(v),m.shift()}else return m.shift();return null},A=function(v){return"location"in v?v.location:"keyLocation"in v?v.keyLocation:0},M=function(v){return v[u]?!1:(v[u]=!0,!0)};this.listenTo=function(v){v.addEventListener("keydown",function(B){if(n.onkeydown&&M(B)){var K=new g(B);K.keyCode!==229&&(m.push(K),d()&&B.preventDefault())}},!0),v.addEventListener("keypress",function(B){!n.onkeydown&&!n.onkeyup||M(B)&&(m.push(new p(B)),d()&&B.preventDefault())},!0),v.addEventListener("keyup",function(B){n.onkeyup&&M(B)&&(B.preventDefault(),m.push(new l(B)),d())},!0);var U=function(K){!n.onkeydown&&!n.onkeyup||M(K)&&K.data&&!K.isComposing&&(v.removeEventListener("compositionend",x,!1),n.type(K.data))},x=function(K){!n.onkeydown&&!n.onkeyup||M(K)&&K.data&&(v.removeEventListener("input",U,!1),n.type(K.data))};v.addEventListener("input",U,!1),v.addEventListener("compositionend",x,!1)},e&&n.listenTo(e)};t.Keyboard._nextID=0;t.Keyboard.ModifierState=function(){this.shift=!1,this.ctrl=!1,this.alt=!1,this.meta=!1,this.hyper=!1};t.Keyboard.ModifierState.fromKeyboardEvent=function(s){var e=new t.Keyboard.ModifierState;return e.shift=s.shiftKey,e.ctrl=s.ctrlKey,e.alt=s.altKey,e.meta=s.metaKey,s.getModifierState&&(e.hyper=s.getModifierState("OS")||s.getModifierState("Super")||s.getModifierState("Hyper")||s.getModifierState("Win")),e};var t=t||{};t.Layer=function(s,e){var n=this,i=64,u=document.createElement("canvas"),c=u.getContext("2d");c.save();var y=!0,g=!0,p=0,l={1:"destination-in",2:"destination-out",4:"source-in",6:"source-atop",8:"source-out",9:"destination-atop",10:"xor",11:"destination-over",12:"copy",14:"source-over",15:"lighter"},m=function(T,O){T=T||0,O=O||0;var N=Math.ceil(T/i)*i,D=Math.ceil(O/i)*i;if(u.width!==N||u.height!==D){var P=null;if(!y&&u.width!==0&&u.height!==0){P=document.createElement("canvas"),P.width=Math.min(n.width,T),P.height=Math.min(n.height,O);var E=P.getContext("2d");E.drawImage(u,0,0,P.width,P.height,0,0,P.width,P.height)}var o=c.globalCompositeOperation;u.width=N,u.height=D,P&&c.drawImage(P,0,0,P.width,P.height,0,0,P.width,P.height),c.globalCompositeOperation=o,p=0,c.save()}else n.reset();n.width=T,n.height=O};function b(w,T,O,N){var D=O+w,P=N+T,E;D>n.width?E=D:E=n.width;var o;P>n.height?o=P:o=n.height,n.resize(E,o)}this.autosize=!1,this.width=s,this.height=e,this.getCanvas=function(){return u},this.toCanvas=function(){var T=document.createElement("canvas");T.width=n.width,T.height=n.height;var O=T.getContext("2d");return O.drawImage(n.getCanvas(),0,0),T},this.resize=function(w,T){(w!==n.width||T!==n.height)&&m(w,T)},this.drawImage=function(w,T,O){n.autosize&&b(w,T,O.width,O.height),c.drawImage(O,w,T),y=!1},this.transfer=function(w,T,O,N,D,P,E,o){var f=w.getCanvas();if(!(T>=f.width||O>=f.height)&&(T+N>f.width&&(N=f.width-T),O+D>f.height&&(D=f.height-O),!(N===0||D===0))){n.autosize&&b(P,E,N,D);for(var h=w.getCanvas().getContext("2d").getImageData(T,O,N,D),I=c.getImageData(P,E,N,D),C=0;C<N*D*4;C+=4){var L=new t.Layer.Pixel(h.data[C],h.data[C+1],h.data[C+2],h.data[C+3]),k=new t.Layer.Pixel(I.data[C],I.data[C+1],I.data[C+2],I.data[C+3]);o(L,k),I.data[C]=k.red,I.data[C+1]=k.green,I.data[C+2]=k.blue,I.data[C+3]=k.alpha}c.putImageData(I,P,E),y=!1}},this.put=function(w,T,O,N,D,P,E){var o=w.getCanvas();if(!(T>=o.width||O>=o.height)&&(T+N>o.width&&(N=o.width-T),O+D>o.height&&(D=o.height-O),!(N===0||D===0))){n.autosize&&b(P,E,N,D);var f=w.getCanvas().getContext("2d").getImageData(T,O,N,D);c.putImageData(f,P,E),y=!1}},this.copy=function(w,T,O,N,D,P,E){var o=w.getCanvas();T>=o.width||O>=o.height||(T+N>o.width&&(N=o.width-T),O+D>o.height&&(D=o.height-O),!(N===0||D===0)&&(n.autosize&&b(P,E,N,D),c.drawImage(o,T,O,N,D,P,E,N,D),y=!1))},this.moveTo=function(w,T){g&&(c.beginPath(),g=!1),n.autosize&&b(w,T,0,0),c.moveTo(w,T)},this.lineTo=function(w,T){g&&(c.beginPath(),g=!1),n.autosize&&b(w,T,0,0),c.lineTo(w,T)},this.arc=function(w,T,O,N,D,P){g&&(c.beginPath(),g=!1),n.autosize&&b(w,T,0,0),c.arc(w,T,O,N,D,P)},this.curveTo=function(w,T,O,N,D,P){g&&(c.beginPath(),g=!1),n.autosize&&b(D,P,0,0),c.bezierCurveTo(w,T,O,N,D,P)},this.close=function(){c.closePath(),g=!0},this.rect=function(w,T,O,N){g&&(c.beginPath(),g=!1),n.autosize&&b(w,T,O,N),c.rect(w,T,O,N)},this.clip=function(){c.clip(),g=!0},this.strokeColor=function(w,T,O,N,D,P,E){c.lineCap=w,c.lineJoin=T,c.lineWidth=O,c.strokeStyle="rgba("+N+","+D+","+P+","+E/255+")",c.stroke(),y=!1,g=!0},this.fillColor=function(w,T,O,N){c.fillStyle="rgba("+w+","+T+","+O+","+N/255+")",c.fill(),y=!1,g=!0},this.strokeLayer=function(w,T,O,N){c.lineCap=w,c.lineJoin=T,c.lineWidth=O,c.strokeStyle=c.createPattern(N.getCanvas(),"repeat"),c.stroke(),y=!1,g=!0},this.fillLayer=function(w){c.fillStyle=c.createPattern(w.getCanvas(),"repeat"),c.fill(),y=!1,g=!0},this.push=function(){c.save(),p++},this.pop=function(){p>0&&(c.restore(),p--)},this.reset=function(){for(;p>0;)c.restore(),p--;c.restore(),c.save(),c.beginPath(),g=!1},this.setTransform=function(w,T,O,N,D,P){c.setTransform(w,T,O,N,D,P)},this.transform=function(w,T,O,N,D,P){c.transform(w,T,O,N,D,P)},this.setChannelMask=function(w){c.globalCompositeOperation=l[w]},this.setMiterLimit=function(w){c.miterLimit=w},m(s,e),u.style.zIndex=-1};t.Layer.ROUT=2;t.Layer.ATOP=6;t.Layer.XOR=10;t.Layer.ROVER=11;t.Layer.OVER=14;t.Layer.PLUS=15;t.Layer.RIN=1;t.Layer.IN=4;t.Layer.OUT=8;t.Layer.RATOP=9;t.Layer.SRC=12;t.Layer.Pixel=function(s,e,n,i){this.red=s,this.green=e,this.blue=n,this.alpha=i};var t=t||{};t.Mouse=function(e){t.Mouse.Event.Target.call(this);var n=this;this.touchMouseThreshold=3,this.scrollThreshold=53,this.PIXELS_PER_LINE=18,this.PIXELS_PER_PAGE=this.PIXELS_PER_LINE*16;var i=[t.Mouse.State.Buttons.LEFT,t.Mouse.State.Buttons.MIDDLE,t.Mouse.State.Buttons.RIGHT],u=0,c=0;e.addEventListener("contextmenu",function(l){t.Event.DOMEvent.cancelEvent(l)},!1),e.addEventListener("mousemove",function(l){if(u){t.Event.DOMEvent.cancelEvent(l),u--;return}n.move(t.Position.fromClientPosition(e,l.clientX,l.clientY),l)},!1),e.addEventListener("mousedown",function(l){if(u){t.Event.DOMEvent.cancelEvent(l);return}var m=i[l.button];m&&n.press(m,l)},!1),e.addEventListener("mouseup",function(l){if(u){t.Event.DOMEvent.cancelEvent(l);return}var m=i[l.button];m&&n.release(m,l)},!1),e.addEventListener("mouseout",function(l){l||(l=window.event);for(var m=l.relatedTarget||l.toElement;m;){if(m===e)return;m=m.parentNode}n.reset(l),n.out(l)},!1),e.addEventListener("selectstart",function(l){t.Event.DOMEvent.cancelEvent(l)},!1);function y(){u=n.touchMouseThreshold}e.addEventListener("touchmove",y,!1),e.addEventListener("touchstart",y,!1),e.addEventListener("touchend",y,!1);function g(l){var m=l.deltaY||-l.wheelDeltaY||-l.wheelDelta;if(m?l.deltaMode===1?m=l.deltaY*n.PIXELS_PER_LINE:l.deltaMode===2&&(m=l.deltaY*n.PIXELS_PER_PAGE):m=l.detail*n.PIXELS_PER_LINE,c+=m,c<=-n.scrollThreshold){do n.click(t.Mouse.State.Buttons.UP),c+=n.scrollThreshold;while(c<=-n.scrollThreshold);c=0}if(c>=n.scrollThreshold){do n.click(t.Mouse.State.Buttons.DOWN),c-=n.scrollThreshold;while(c>=n.scrollThreshold);c=0}t.Event.DOMEvent.cancelEvent(l)}e.addEventListener("DOMMouseScroll",g,!1),e.addEventListener("mousewheel",g,!1),e.addEventListener("wheel",g,!1);var p=(function(){var l=document.createElement("div");if(!("cursor"in l.style))return!1;try{l.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX///+nxBvIAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==) 0 0, auto"}catch{return!1}return/\burl\([^()]*\)\s+0\s+0\b/.test(l.style.cursor||"")})();this.setCursor=function(l,m,b){if(p){var w=l.toDataURL("image/png");return e.style.cursor="url("+w+") "+m+" "+b+", auto",!0}return!1}};t.Mouse.State=function(e){var n=function(u,c,y,g,p,l,m){return{x:u,y:c,left:y,middle:g,right:p,up:l,down:m}};arguments.length>1?e=n.apply(this,arguments):e=e||{},t.Position.call(this,e),this.left=e.left||!1,this.middle=e.middle||!1,this.right=e.right||!1,this.up=e.up||!1,this.down=e.down||!1};t.Mouse.State.Buttons={LEFT:"left",MIDDLE:"middle",RIGHT:"right",UP:"up",DOWN:"down"};t.Mouse.Event=function(e,n,i){t.Event.DOMEvent.call(this,e,i);var u="on"+this.type;this.state=n,this.invokeLegacyHandler=function(y){y[u]&&(this.preventDefault(),this.stopPropagation(),y[u](this.state))}};t.Mouse.Event.Target=function(){t.Event.Target.call(this),this.currentState=new t.Mouse.State,this.press=function(n,i){this.currentState[n]||(this.currentState[n]=!0,this.dispatch(new t.Mouse.Event("mousedown",this.currentState,i)))},this.release=function(n,i){this.currentState[n]&&(this.currentState[n]=!1,this.dispatch(new t.Mouse.Event("mouseup",this.currentState,i)))},this.click=function(n,i){this.press(n,i),this.release(n,i)},this.move=function(n,i){(this.currentState.x!==n.x||this.currentState.y!==n.y)&&(this.currentState.x=n.x,this.currentState.y=n.y,this.dispatch(new t.Mouse.Event("mousemove",this.currentState,i)))},this.out=function(n){this.dispatch(new t.Mouse.Event("mouseout",this.currentState,n))},this.reset=function(n){for(var i in t.Mouse.State.Buttons)this.release(t.Mouse.State.Buttons[i],n)}};t.Mouse.Touchpad=function(e){t.Mouse.Event.Target.call(this);var n=this;this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=10*(window.devicePixelRatio||1),this.currentState=new t.Mouse.State;var i=0,u=0,c=0,y=0,g=0,p={1:"left",2:"right",3:"middle"},l=!1,m=null;e.addEventListener("touchend",function(b){if(b.preventDefault(),l&&b.touches.length===0){var w=new Date().getTime(),T=p[i];n.currentState[T]&&(n.release(T,b),m&&(window.clearTimeout(m),m=null)),w-y<=n.clickTimingThreshold&&g<n.clickMoveThreshold&&(n.press(T,b),m=window.setTimeout(function(){n.release(T,b),l=!1},n.clickTimingThreshold)),m||(l=!1)}},!1),e.addEventListener("touchstart",function(b){if(b.preventDefault(),i=Math.min(b.touches.length,3),m&&(window.clearTimeout(m),m=null),!l){l=!0;var w=b.touches[0];u=w.clientX,c=w.clientY,y=new Date().getTime(),g=0}},!1),e.addEventListener("touchmove",function(b){b.preventDefault();var w=b.touches[0],T=w.clientX-u,O=w.clientY-c;if(g+=Math.abs(T)+Math.abs(O),i===1){var N=g/(new Date().getTime()-y),D=1+N,P=new t.Position(n.currentState);P.x+=T*D,P.y+=O*D,P.x=Math.min(Math.max(0,P.x),e.offsetWidth-1),P.y=Math.min(Math.max(0,P.y),e.offsetHeight-1),n.move(P,b),u=w.clientX,c=w.clientY}else if(i===2&&Math.abs(O)>=n.scrollThreshold){var E;O>0?E="down":E="up",n.click(E,b),u=w.clientX,c=w.clientY}},!1)};t.Mouse.Touchscreen=function(e){t.Mouse.Event.Target.call(this);var n=this,i=!1,u=null,c=null,y=null,g=null;this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=16*(window.devicePixelRatio||1),this.longPressThreshold=500;function p(b){var w=b.touches[0]||b.changedTouches[0],T=w.clientX-u,O=w.clientY-c;return Math.sqrt(T*T+O*O)>=n.clickMoveThreshold}function l(b){var w=b.touches[0];i=!0,u=w.clientX,c=w.clientY}function m(){window.clearTimeout(y),window.clearTimeout(g),i=!1}e.addEventListener("touchend",function(b){if(i){if(b.touches.length!==0||b.changedTouches.length!==1){m();return}if(window.clearTimeout(g),n.release(t.Mouse.State.Buttons.LEFT,b),!p(b)&&(b.preventDefault(),!n.currentState.left)){var w=b.changedTouches[0];n.move(t.Position.fromClientPosition(e,w.clientX,w.clientY)),n.press(t.Mouse.State.Buttons.LEFT,b),y=window.setTimeout(function(){n.release(t.Mouse.State.Buttons.LEFT,b),m()},n.clickTimingThreshold)}}},!1),e.addEventListener("touchstart",function(b){if(b.touches.length!==1){m();return}b.preventDefault(),l(b),window.clearTimeout(y),g=window.setTimeout(function(){var w=b.touches[0];n.move(t.Position.fromClientPosition(e,w.clientX,w.clientY)),n.click(t.Mouse.State.Buttons.RIGHT,b),m()},n.longPressThreshold)},!1),e.addEventListener("touchmove",function(b){if(i){if(p(b)&&window.clearTimeout(g),b.touches.length!==1){m();return}if(n.currentState.left){b.preventDefault();var w=b.touches[0];n.move(t.Position.fromClientPosition(e,w.clientX,w.clientY),b)}}},!1)};var t=t||{},t=t||{};t.Object=function(e,n){var i=this,u={},c=function(p){var l=u[p];if(!l)return null;var m=l.shift();return l.length===0&&delete u[p],m},y=function(p,l){var m=u[p];m||(m=[],u[p]=m),m.push(l)};this.index=n,this.onbody=function(p,l,m){var b=c(m);b&&b(p,l)},this.onundefine=null,this.requestInputStream=function(p,l){l&&y(p,l),e.requestObjectInputStream(i.index,p)},this.createOutputStream=function(p,l){return e.createObjectOutputStream(i.index,p,l)}};t.Object.ROOT_STREAM="/";t.Object.STREAM_INDEX_MIMETYPE="application/vnd.glyptodon.guacamole.stream-index+json";var t=t||{};t.OnScreenKeyboard=function(s){var e=this,n={},i={},u=[],c=function(o,f){o.classList?o.classList.add(f):o.className+=" "+f},y=function(o,f){o.classList?o.classList.remove(f):o.className=o.className.replace(/([^ ]+)[ ]*/g,function(I,C){return C===f?"":I})},g=0,p=function(o,f,h,I){this.width=f,this.height=h,this.scale=function(C){o.style.width=f*C+"px",o.style.height=h*C+"px",I&&(o.style.lineHeight=h*C+"px",o.style.fontSize=C+"px")}},l=function(o){for(var f=0;f<o.length;f++){var h=o[f];if(!(h in n))return!1}return!0},m=function(o){var f=e.keys[o];if(!f)return null;for(var h=f.length-1;h>=0;h--){var I=f[h];if(l(I.requires))return I}return null},b=function(o,f){if(!i[o]){c(f,"guac-keyboard-pressed");var h=m(o);if(h.modifier){var I="guac-keyboard-modifier-"+D(h.modifier),C=n[h.modifier];C===void 0?(c(T,I),n[h.modifier]=h.keysym,h.keysym&&e.onkeydown&&e.onkeydown(h.keysym)):(y(T,I),delete n[h.modifier],C&&e.onkeyup&&e.onkeyup(C))}else e.onkeydown&&e.onkeydown(h.keysym);i[o]=!0}},w=function(o,f){if(i[o]){y(f,"guac-keyboard-pressed");var h=m(o);!h.modifier&&e.onkeyup&&e.onkeyup(h.keysym),i[o]=!1}},T=document.createElement("div");T.className="guac-keyboard",T.onselectstart=T.onmousemove=T.onmouseup=T.onmousedown=function(o){return g&&g--,o.stopPropagation(),!1},this.touchMouseThreshold=3,this.onkeydown=null,this.onkeyup=null,this.layout=new t.OnScreenKeyboard.Layout(s),this.getElement=function(){return T},this.resize=function(E){for(var o=Math.floor(E*10/e.layout.width)/10,f=0;f<u.length;f++){var h=u[f];h.scale(o)}};var O=function(o,f){if(f instanceof Array){for(var h=[],I=0;I<f.length;I++)h.push(new t.OnScreenKeyboard.Key(f[I],o));return h}return typeof f=="number"?[new t.OnScreenKeyboard.Key({name:o,keysym:f})]:typeof f=="string"?[new t.OnScreenKeyboard.Key({name:o,title:f})]:[new t.OnScreenKeyboard.Key(f,o)]},N=function(o){var f={};for(var h in s.keys)f[h]=O(h,o[h]);return f};this.keys=N(s.keys);var D=function(o){var f=o.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[^A-Za-z0-9]+/g,"-").toLowerCase();return f},P=function E(o,f,h){var I,C=document.createElement("div");if(h&&c(C,"guac-keyboard-"+D(h)),f instanceof Array)for(c(C,"guac-keyboard-group"),I=0;I<f.length;I++)E(C,f[I]);else if(f instanceof Object){c(C,"guac-keyboard-group");var L=Object.keys(f).sort();for(I=0;I<L.length;I++){var h=L[I];E(C,f[h],h)}}else if(typeof f=="number")c(C,"guac-keyboard-gap"),u.push(new p(C,f,f));else if(typeof f=="string"){var k=f;k.length===1&&(k="0x"+k.charCodeAt(0).toString(16)),c(C,"guac-keyboard-key-container");var F=document.createElement("div");F.className="guac-keyboard-key guac-keyboard-key-"+D(k);var r=e.keys[f];if(r)for(I=0;I<r.length;I++){var a=r[I],d=document.createElement("div");d.className="guac-keyboard-cap",d.textContent=a.title;for(var S=0;S<a.requires.length;S++){var R=a.requires[S];c(d,"guac-keyboard-requires-"+D(R)),c(F,"guac-keyboard-uses-"+D(R))}F.appendChild(d)}C.appendChild(F),u.push(new p(C,e.layout.keyWidths[f]||1,1,!0));var A=function(x){x.preventDefault(),g=e.touchMouseThreshold,b(f,F)},M=function(x){x.preventDefault(),g=e.touchMouseThreshold,w(f,F)},_=function(x){x.preventDefault(),g===0&&b(f,F)},v=function(x){x.preventDefault(),g===0&&w(f,F)};F.addEventListener("touchstart",A,!0),F.addEventListener("touchend",M,!0),F.addEventListener("mousedown",_,!0),F.addEventListener("mouseup",v,!0),F.addEventListener("mouseout",v,!0)}o.appendChild(C)};P(T,s.layout)};t.OnScreenKeyboard.Layout=function(s){this.language=s.language,this.type=s.type,this.keys=s.keys,this.layout=s.layout,this.width=s.width,this.keyWidths=s.keyWidths||{}};t.OnScreenKeyboard.Key=function(s,e){this.name=e||s.name,this.title=s.title||this.name,this.keysym=s.keysym||(function(i){if(!i||i.length!==1)return null;var u=i.charCodeAt(0);return u>=0&&u<=255?u:u>=256&&u<=1114111?16777216|u:null})(this.title),this.modifier=s.modifier,this.requires=s.requires||[]};var t=t||{};t.OutputStream=function(s,e){var n=this;this.index=e,this.onack=null,this.sendBlob=function(i){s.sendBlob(n.index,i)},this.sendEnd=function(){s.endStream(n.index)}};var t=t||{};t.Parser=function(){var s=this,e="",n=[],i=-1,u=0;this.receive=function(c){for(u>4096&&i>=u&&(e=e.substring(u),i-=u,u=0),e+=c;i<e.length;){if(i>=u){var y=e.substring(u,i),g=e.substring(i,i+1);if(n.push(y),g==";"){var p=n.shift();s.oninstruction!=null&&s.oninstruction(p,n),n.length=0}else if(g!=",")throw new Error("Illegal terminator.");u=i+1}var l=e.indexOf(".",u);if(l!=-1){var m=parseInt(e.substring(i+1,l));if(isNaN(m))throw new Error("Non-numeric character in element length.");u=l+1,i=u+m}else{u=e.length;break}}},this.oninstruction=null};var t=t||{};t.Position=function(e){e=e||{},this.x=e.x||0,this.y=e.y||0,this.fromClientPosition=function(i,u,c){this.x=u-i.offsetLeft,this.y=c-i.offsetTop;for(var y=i.offsetParent;y&&y!==document.body;)this.x-=y.offsetLeft-y.scrollLeft,this.y-=y.offsetTop-y.scrollTop,y=y.offsetParent;if(y){var g=document.body.scrollLeft||document.documentElement.scrollLeft,p=document.body.scrollTop||document.documentElement.scrollTop;this.x-=y.offsetLeft-g,this.y-=y.offsetTop-p}}};t.Position.fromClientPosition=function(e,n,i){var u=new t.Position;return u.fromClientPosition(e,n,i),u};var t=t||{};t.RawAudioFormat=function(e){this.bytesPerSample=e.bytesPerSample,this.channels=e.channels,this.rate=e.rate};t.RawAudioFormat.parse=function(e){var n,i=null,u=1;if(e.substring(0,9)==="audio/L8;")e=e.substring(9),n=1;else if(e.substring(0,10)==="audio/L16;")e=e.substring(10),n=2;else return null;for(var c=e.split(","),y=0;y<c.length;y++){var g=c[y],p=g.indexOf("=");if(p===-1)return null;var l=g.substring(0,p),m=g.substring(p+1);switch(l){case"channels":u=parseInt(m);break;case"rate":i=parseInt(m);break;default:return null}}return i===null?null:new t.RawAudioFormat({bytesPerSample:n,channels:u,rate:i})};var t=t||{};t.SessionRecording=function(e){var n=this,i,u=null,c=262144,y=16384,g=5e3,p=[],l=0,m=new t.SessionRecording._PlaybackTunnel,b=new t.Client(m),w=-1,T=null,O=null,N=null,D=0,P=0,E=!1,o=null,f=function(M,_,v){if(!(E&&M===i)){var U=new t.Parser;U.oninstruction=_;var x=0,B=new FileReader,K=function(){if(!(E&&M===i)){if(B.readyState===2)try{U.receive(B.result)}catch(H){n.onerror&&n.onerror(H.message);return}if(x>=M.size)v&&v();else{var z=M.slice(x,x+c);x+=z.size,B.readAsText(z)}}};B.onload=K,K()}},h=function(M){for(var _=M.length,v=_+3;_>=10;)v++,_=Math.floor(_/10);return v};b.connect(),b.getDisplay().showCursor(!1);var I=function(M,_){P+=h(M);for(var v=0;v<_.length;v++)P+=h(_[v]);if(M==="sync"){var U=parseInt(_[0]),x=new t.SessionRecording._Frame(U,D,P);p.push(x),D=P,(p.length===1||P-p[l].start>=y&&U-p[l].timestamp>=g)&&(x.keyframe=!0,l=p.length-1),n.onprogress&&n.onprogress(n.getDuration(),P)}},C=function(){n.onload&&n.onload()};if(e instanceof Blob)f(i,I,C);else{u=e,i=new Blob;var L=!1,k="";u.oninstruction=function(M,_){k+=M.length+"."+M,_.forEach(function(U){k+=","+U.length+"."+U}),k+=";",k.length>=c&&(i=new Blob([i,k]),k=""),I(M,_)},u.onerror=function(M){L=!0,n.onerror&&n.onerror(M.message)},u.onstatechange=function(M){M===t.Tunnel.State.CLOSED&&(k.length&&(i=new Blob([i,k]),k=""),L||C())}}var F=function(M){return p.length===0?0:M-p[0].timestamp},r=function A(M,_,v){if(M===_)return M;var U=Math.floor((M+_)/2),x=F(p[U].timestamp);return v<x&&U>M?A(M,U-1,v):v>x&&U<_?A(U+1,_,v):U},a=function(M,_){var v=p[M];f(i.slice(v.start,v.end),function(x,B){m.receiveInstruction(x,B)},function(){v.keyframe&&!v.clientState&&b.exportState(function(B){v.clientState=new Blob([JSON.stringify(B)])}),w=M,_&&_()})},d=function(M,_,v){S();for(var U=N={aborted:!1},x=M,B=function z(){n.onseek&&w>x&&n.onseek(F(p[w].timestamp),w-x,M-x),!U.aborted&&(w<M?a(w+1,z):_())},K=function(){var H=v?Math.max(v-new Date().getTime(),0):0;H?window.setTimeout(B,H):B()};x>=0;x--){var G=p[x];if(x===w)break;if(G.clientState){G.clientState.text().then(function(H){b.importState(JSON.parse(H)),w=x,K()});return}}K()},S=function(){N&&(N.aborted=!0,N=null)},R=function A(){if(w+1<p.length){var M=p[w+1],_=M.timestamp-T+O;d(w+1,function(){A()},_)}else n.pause()};this.onload=null,this.onerror=null,this.onabort=null,this.onprogress=null,this.onplay=null,this.onpause=null,this.onseek=null,this.connect=function(M){u&&u.connect(M)},this.disconnect=function(){u&&u.disconnect()},this.abort=function(){E||(E=!0,n.onabort&&n.onabort(),u&&u.disconnect())},this.getDisplay=function(){return b.getDisplay()},this.isPlaying=function(){return!!T},this.getPosition=function(){return w===-1?0:F(p[w].timestamp)},this.getDuration=function(){return p.length===0?0:F(p[p.length-1].timestamp)},this.play=function(){if(!n.isPlaying()&&w+1<p.length){n.onplay&&n.onplay();var M=p[w+1];T=M.timestamp,O=new Date().getTime(),R()}},this.seek=function(M,_){if(p.length!==0){n.cancel();var v=n.isPlaying();n.pause(),o=function(){o=null,v&&(n.play(),v=null),_&&_()},d(r(0,p.length-1,M),o)}},this.cancel=function(){o&&(S(),o())},this.pause=function(){S(),n.isPlaying()&&(n.onpause&&n.onpause(),T=null,O=null)}};t.SessionRecording._Frame=function(e,n,i){this.keyframe=!1,this.timestamp=e,this.start=n,this.end=i,this.clientState=null};t.SessionRecording._PlaybackTunnel=function(){var e=this;this.connect=function(i){},this.sendMessage=function(i){},this.disconnect=function(){},this.receiveInstruction=function(i,u){e.oninstruction&&e.oninstruction(i,u)}};var t=t||{};t.Status=function(s,e){var n=this;this.code=s,this.message=e,this.isError=function(){return n.code<0||n.code>255}};t.Status.Code={SUCCESS:0,UNSUPPORTED:256,SERVER_ERROR:512,SERVER_BUSY:513,UPSTREAM_TIMEOUT:514,UPSTREAM_ERROR:515,RESOURCE_NOT_FOUND:516,RESOURCE_CONFLICT:517,RESOURCE_CLOSED:518,UPSTREAM_NOT_FOUND:519,UPSTREAM_UNAVAILABLE:520,SESSION_CONFLICT:521,SESSION_TIMEOUT:522,SESSION_CLOSED:523,CLIENT_BAD_REQUEST:768,CLIENT_UNAUTHORIZED:769,CLIENT_FORBIDDEN:771,CLIENT_TIMEOUT:776,CLIENT_OVERRUN:781,CLIENT_BAD_TYPE:783,CLIENT_TOO_MANY:797};t.Status.Code.fromHTTPCode=function(e){switch(e){case 400:return t.Status.Code.CLIENT_BAD_REQUEST;case 403:return t.Status.Code.CLIENT_FORBIDDEN;case 404:return t.Status.Code.RESOURCE_NOT_FOUND;case 429:return t.Status.Code.CLIENT_TOO_MANY;case 503:return t.Status.Code.SERVER_BUSY}return t.Status.Code.SERVER_ERROR};t.Status.Code.fromWebSocketCode=function(e){switch(e){case 1e3:return t.Status.Code.SUCCESS;case 1006:case 1015:return t.Status.Code.UPSTREAM_NOT_FOUND;case 1001:case 1012:case 1013:case 1014:return t.Status.Code.UPSTREAM_UNAVAILABLE}return t.Status.Code.SERVER_ERROR};var t=t||{};t.StringReader=function(s){var e=this,n=new t.UTF8Parser,i=new t.ArrayBufferReader(s);i.ondata=function(u){var c=n.decode(u);e.ontext&&e.ontext(c)},i.onend=function(){e.onend&&e.onend()},this.ontext=null,this.onend=null};var t=t||{};t.StringWriter=function(s){var e=this,n=new t.ArrayBufferWriter(s),i=new Uint8Array(8192),u=0;n.onack=function(p){e.onack&&e.onack(p)};function c(p){if(u+p>=i.length){var l=new Uint8Array((u+p)*2);l.set(i),i=l}u+=p}function y(p){var l,m;if(p<=127)l=0,m=1;else if(p<=2047)l=192,m=2;else if(p<=65535)l=224,m=3;else if(p<=2097151)l=240,m=4;else{y(65533);return}c(m);for(var b=u-1,w=1;w<m;w++)i[b--]=128|p&63,p>>=6;i[b]=l|p}function g(p){for(var l=0;l<p.length;l++){var m=p.charCodeAt(l);y(m)}if(u>0){var b=i.subarray(0,u);return u=0,b}}this.sendText=function(p){p.length&&n.sendData(g(p))},this.sendEnd=function(){n.sendEnd()},this.onack=null};var t=t||{};t.Touch=function(e){t.Event.Target.call(this);var n=this,i=Math.floor(16*window.devicePixelRatio);this.touches={},this.activeTouches=0,e.addEventListener("touchstart",function(c){for(var y=0;y<c.changedTouches.length;y++){var g=c.changedTouches[y],p=g.identifier;if(!n.touches[p]){var l=n.touches[p]=new t.Touch.State({id:p,radiusX:g.radiusX||i,radiusY:g.radiusY||i,angle:g.angle||0,force:g.force||1});n.activeTouches++,l.fromClientPosition(e,g.clientX,g.clientY),n.dispatch(new t.Touch.Event("touchmove",c,l))}}},!1),e.addEventListener("touchmove",function(c){for(var y=0;y<c.changedTouches.length;y++){var g=c.changedTouches[y],p=g.identifier,l=n.touches[p];l&&(g.force&&(l.force=g.force),l.angle=g.angle||0,l.radiusX=g.radiusX||i,l.radiusY=g.radiusY||i,l.fromClientPosition(e,g.clientX,g.clientY),n.dispatch(new t.Touch.Event("touchmove",c,l)))}},!1),e.addEventListener("touchend",function(c){for(var y=0;y<c.changedTouches.length;y++){var g=c.changedTouches[y],p=g.identifier,l=n.touches[p];l&&(delete n.touches[p],n.activeTouches--,l.force=0,l.fromClientPosition(e,g.clientX,g.clientY),n.dispatch(new t.Touch.Event("touchend",c,l)))}},!1)};t.Touch.State=function(e){e=e||{},t.Position.call(this,e),this.id=e.id||0,this.radiusX=e.radiusX||0,this.radiusY=e.radiusY||0,this.angle=e.angle||0,this.force=e.force||1};t.Touch.Event=function(e,n,i){t.Event.DOMEvent.call(this,e,[n]),this.state=i};var t=t||{};t.Tunnel=function(){this.connect=function(s){},this.disconnect=function(){},this.sendMessage=function(s){},this.setState=function(s){s!==this.state&&(this.state=s,this.onstatechange&&this.onstatechange(s))},this.setUUID=function(e){this.uuid=e,this.onuuid&&this.onuuid(e)},this.isConnected=function(){return this.state===t.Tunnel.State.OPEN||this.state===t.Tunnel.State.UNSTABLE},this.state=t.Tunnel.State.CLOSED,this.receiveTimeout=15e3,this.unstableThreshold=1500,this.uuid=null,this.onuuid=null,this.onerror=null,this.onstatechange=null,this.oninstruction=null};t.Tunnel.INTERNAL_DATA_OPCODE="";t.Tunnel.State={CONNECTING:0,OPEN:1,CLOSED:2,UNSTABLE:3};t.HTTPTunnel=function(s,e,n){var i=this,u=s+"?connect",c=s+"?read:",y=s+"?write:",g=1,p=0,l=g,m=!1,b="",w=!!e,T=null,O=null,N=null,D=500,P=n||{},E="Guacamole-Tunnel-Token",o=null;function f(a,d){for(var S in d)a.setRequestHeader(S,d[S])}var h=function(){window.clearTimeout(T),window.clearTimeout(O),i.state===t.Tunnel.State.UNSTABLE&&i.setState(t.Tunnel.State.OPEN),T=window.setTimeout(function(){I(new t.Status(t.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))},i.receiveTimeout),O=window.setTimeout(function(){i.setState(t.Tunnel.State.UNSTABLE)},i.unstableThreshold)};function I(a){window.clearTimeout(T),window.clearTimeout(O),window.clearInterval(N),i.state!==t.Tunnel.State.CLOSED&&(a.code!==t.Status.Code.SUCCESS&&i.onerror&&(i.state===t.Tunnel.State.CONNECTING||a.code!==t.Status.Code.RESOURCE_NOT_FOUND)&&i.onerror(a),m=!1,i.setState(t.Tunnel.State.CLOSED))}this.sendMessage=function(){if(!i.isConnected()||arguments.length===0)return;function a(R){var A=new String(R);return A.length+"."+A}for(var d=a(arguments[0]),S=1;S<arguments.length;S++)d+=","+a(arguments[S]);d+=";",b+=d,m||C()};function C(){if(i.isConnected())if(b.length>0){m=!0;var a=new XMLHttpRequest;a.open("POST",y+i.uuid),a.withCredentials=w,f(a,P),a.setRequestHeader("Content-type","application/octet-stream"),a.setRequestHeader(E,o),a.onreadystatechange=function(){a.readyState===4&&(h(),a.status!==200?L(a):C())},a.send(b),b=""}else m=!1}function L(a){var d=parseInt(a.getResponseHeader("Guacamole-Status-Code"));if(d){var S=a.getResponseHeader("Guacamole-Error-Message");I(new t.Status(d,S))}else a.status?I(new t.Status(t.Status.Code.fromHTTPCode(a.status),a.statusText)):I(new t.Status(t.Status.Code.UPSTREAM_NOT_FOUND))}function k(a){var d=null,S=null,R=0,A=-1,M=0,_=new Array;function v(){if(!i.isConnected()){d!==null&&clearInterval(d);return}if(!(a.readyState<2)){var U;try{U=a.status}catch{U=200}if(!S&&U===200&&(S=r()),a.readyState===3||a.readyState===4){if(h(),l===g&&(a.readyState===3&&!d?d=setInterval(v,30):a.readyState===4&&d&&clearInterval(d)),a.status===0){i.disconnect();return}else if(a.status!==200){L(a);return}var x;try{x=a.responseText}catch{return}for(;A<x.length;){if(A>=M){var B=x.substring(M,A),K=x.substring(A,A+1);if(_.push(B),K===";"){var G=_.shift();i.oninstruction&&i.oninstruction(G,_),_.length=0}M=A+1}var z=x.indexOf(".",M);if(z!==-1){var H=parseInt(x.substring(A+1,z));if(H===0){d&&clearInterval(d),a.onreadystatechange=null,a.abort(),S&&k(S);break}M=z+1,A=M+H}else{M=x.length;break}}}}}l===g?a.onreadystatechange=function(){a.readyState===3&&(R++,R>=2&&(l=p,a.onreadystatechange=v)),v()}:a.onreadystatechange=v,v()}var F=0;function r(){var a=new XMLHttpRequest;return a.open("GET",c+i.uuid+":"+F++),a.setRequestHeader(E,o),a.withCredentials=w,f(a,P),a.send(null),a}this.connect=function(a){h(),i.setState(t.Tunnel.State.CONNECTING);var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState===4){if(d.status!==200){L(d);return}if(h(),i.setUUID(d.responseText),o=d.getResponseHeader(E),!o){I(new t.Status(t.Status.Code.UPSTREAM_NOT_FOUND));return}i.setState(t.Tunnel.State.OPEN),N=setInterval(function(){i.sendMessage("nop")},D),k(r())}},d.open("POST",u,!0),d.withCredentials=w,f(d,P),d.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),d.send(a)},this.disconnect=function(){I(new t.Status(t.Status.Code.SUCCESS,"Manually closed."))}};t.HTTPTunnel.prototype=new t.Tunnel;t.WebSocketTunnel=function(s){var e=this,n=null,i=null,u=null,c=null,y={"http:":"ws:","https:":"wss:"},g=500,p=0;if(s.substring(0,3)!=="ws:"&&s.substring(0,4)!=="wss:"){var l=y[window.location.protocol];if(s.substring(0,1)==="/")s=l+"//"+window.location.host+s;else{var m=window.location.pathname.lastIndexOf("/"),b=window.location.pathname.substring(0,m+1);s=l+"//"+window.location.host+b+s}}var w=function(){var D=new Date().getTime();e.sendMessage(t.Tunnel.INTERNAL_DATA_OPCODE,"ping",D),p=D},T=function(){window.clearTimeout(i),window.clearTimeout(u),window.clearTimeout(c),e.state===t.Tunnel.State.UNSTABLE&&e.setState(t.Tunnel.State.OPEN),i=window.setTimeout(function(){O(new t.Status(t.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))},e.receiveTimeout),u=window.setTimeout(function(){e.setState(t.Tunnel.State.UNSTABLE)},e.unstableThreshold);var D=new Date().getTime(),P=Math.max(p+g-D,0);P>0?c=window.setTimeout(w,P):w()};function O(N){window.clearTimeout(i),window.clearTimeout(u),window.clearTimeout(c),e.state!==t.Tunnel.State.CLOSED&&(N.code!==t.Status.Code.SUCCESS&&e.onerror&&e.onerror(N),e.setState(t.Tunnel.State.CLOSED),n.close())}this.sendMessage=function(N){if(!e.isConnected()||arguments.length===0)return;function D(o){var f=new String(o);return f.length+"."+f}for(var P=D(arguments[0]),E=1;E<arguments.length;E++)P+=","+D(arguments[E]);P+=";",n.send(P)},this.connect=function(N){T(),e.setState(t.Tunnel.State.CONNECTING),n=new WebSocket(s+"?"+N,"guacamole"),n.onopen=function(D){T()},n.onclose=function(D){D.reason?O(new t.Status(parseInt(D.reason),D.reason)):D.code?O(new t.Status(t.Status.Code.fromWebSocketCode(D.code))):O(new t.Status(t.Status.Code.UPSTREAM_NOT_FOUND))},n.onmessage=function(D){T();var P=D.data,E=0,o,f=[];do{var h=P.indexOf(".",E);if(h!==-1){var I=parseInt(P.substring(o+1,h));E=h+1,o=E+I}else O(new t.Status(t.Status.Code.SERVER_ERROR,"Incomplete instruction."));var C=P.substring(E,o),L=P.substring(o,o+1);if(f.push(C),L===";"){var k=f.shift();e.uuid===null&&(k===t.Tunnel.INTERNAL_DATA_OPCODE&&f.length===1&&e.setUUID(f[0]),e.setState(t.Tunnel.State.OPEN)),k!==t.Tunnel.INTERNAL_DATA_OPCODE&&e.oninstruction&&e.oninstruction(k,f),f.length=0}E=o+1}while(E<P.length)}},this.disconnect=function(){O(new t.Status(t.Status.Code.SUCCESS,"Manually closed."))}};t.WebSocketTunnel.prototype=new t.Tunnel;t.ChainedTunnel=function(s){for(var e=this,n,i=[],u=null,c=0;c<arguments.length;c++)i.push(arguments[c]);function y(g){e.disconnect=g.disconnect,e.sendMessage=g.sendMessage;var p=function(b){if(b&&b.code===t.Status.Code.UPSTREAM_TIMEOUT)return i=[],null;var w=i.shift();return w&&(g.onerror=null,g.oninstruction=null,g.onstatechange=null,y(w)),w};function l(){g.onstatechange=e.onstatechange,g.oninstruction=e.oninstruction,g.onerror=e.onerror,g.uuid&&e.setUUID(g.uuid),g.onuuid=function(b){e.setUUID(b)},u=g}g.onstatechange=function(m){switch(m){case t.Tunnel.State.OPEN:l(),e.onstatechange&&e.onstatechange(m);break;case t.Tunnel.State.CLOSED:!p()&&e.onstatechange&&e.onstatechange(m);break}},g.oninstruction=function(m,b){l(),e.oninstruction&&e.oninstruction(m,b)},g.onerror=function(m){!p(m)&&e.onerror&&e.onerror(m)},g.connect(n)}this.connect=function(g){n=g;var p=u||i.shift();p?y(p):e.onerror&&e.onerror(t.Status.Code.SERVER_ERROR,"No tunnels to try.")}};t.ChainedTunnel.prototype=new t.Tunnel;t.StaticHTTPTunnel=function(e,n,i){var u=this,c=null,y=i||{};this.size=null,this.sendMessage=function(p){},this.connect=function(p){u.disconnect(),u.setState(t.Tunnel.State.CONNECTING);var l=new t.Parser,m=new t.UTF8Parser;l.oninstruction=function(w,T){u.oninstruction&&u.oninstruction(w,T)},c=new AbortController,fetch(e,{headers:y,credentials:n?"include":"same-origin",signal:c.signal}).then(function(w){if(!w.ok){u.onerror&&u.onerror(new t.Status(t.Status.Code.fromHTTPCode(w.status),w.statusText)),u.disconnect();return}u.size=w.headers.get("Content-Length"),u.setState(t.Tunnel.State.OPEN);var T=w.body.getReader(),O=function N(D){if(D.done){u.disconnect();return}l.receive(m.decode(D.value)),T.read().then(N)};T.read().then(O)})},this.disconnect=function(){c&&(c.abort(),c=null),u.setState(t.Tunnel.State.CLOSED)}};t.StaticHTTPTunnel.prototype=new t.Tunnel;var t=t||{};t.UTF8Parser=function(){var e=0,n=0;this.decode=function(u){for(var c="",y=new Uint8Array(u),g=0;g<y.length;g++){var p=y[g];e===0?(p|127)===127?c+=String.fromCharCode(p):(p|31)===223?(n=p&31,e=1):(p|15)===239?(n=p&15,e=2):(p|7)===247?(n=p&7,e=3):c+="":(p|63)===191?(n=n<<6|p&63,e--,e===0&&(c+=String.fromCharCode(n))):(e=0,c+="")}return c}};var t=t||{};t.API_VERSION="1.5.0";var t=t||{};t.VideoPlayer=function(){this.sync=function(){}};t.VideoPlayer.isSupportedType=function(e){return!1};t.VideoPlayer.getSupportedTypes=function(){return[]};t.VideoPlayer.getInstance=function(e,n,i){return null};const W=t;export{W as G};
