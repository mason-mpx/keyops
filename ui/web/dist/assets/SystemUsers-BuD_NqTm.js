import{u as R,r as o,H as j,j as s,B as c,w as v,x as g,T as n,ac as I,P as H,a as b,A as P,b0 as M,I as D,g as L,h as V,i as $,k as G,l as J,m as d,F as C,n as T,o as S,M as u,p as N,b as O}from"./index-Cih9_E47.js";import{T as Q,a as X,b as Y,c as K,d as r,e as Z}from"./TableRow-Bl_73t-R.js";import{C as f}from"./Chip-D6-9bdkU.js";import{S as _}from"./Snackbar-Dmj-hhun.js";const rs=()=>{const{t}=R(),[h,k]=o.useState([]),[,W]=o.useState(!1),[B,p]=o.useState(!1),[U,A]=o.useState(null),[m,l]=o.useState({open:!1,message:"",severity:"success"}),[a,i]=o.useState({name:"",username:"",authType:"password",password:"",privateKey:"",passphrase:"",protocol:"ssh",priority:0,description:"",status:"active"});o.useEffect(()=>{w()},[]);const w=async()=>{W(!0);try{const e=await j.get("/api/system-users"),x=e.data?.data||e.data;k(Array.isArray(x)?x:[])}catch(e){l({open:!0,message:e.message||t("systemUsers.loadSystemUsersFailed"),severity:"error"}),k([])}finally{W(!1)}},F=()=>{A(null),i({name:"",username:"",authType:"password",password:"",privateKey:"",passphrase:"",protocol:"ssh",priority:0,description:"",status:"active"}),p(!0)},q=e=>{A(e),i({name:e.name,username:e.username,authType:e.authType,password:e.password||"",privateKey:e.privateKey||"",passphrase:e.passphrase||"",protocol:e.protocol,priority:e.priority,description:e.description||"",status:e.status}),p(!0)},z=async e=>{if(window.confirm(t("systemUsers.deleteConfirm")))try{await j.delete(`/api/system-users/${e}`),l({open:!0,message:t("systemUsers.deleteSuccess"),severity:"success"}),w()}catch(x){l({open:!0,message:x.message||t("systemUsers.deleteFailed"),severity:"error"})}},E=async()=>{if(!a.name||!a.username){l({open:!0,message:t("systemUsers.requiredFields"),severity:"error"});return}if(a.authType==="password"&&!a.password){l({open:!0,message:t("systemUsers.passwordRequired"),severity:"error"});return}if(a.authType==="key"&&!a.privateKey){l({open:!0,message:t("systemUsers.privateKeyRequired"),severity:"error"});return}try{U?(await j.put(`/api/system-users/${U.id}`,a),l({open:!0,message:t("systemUsers.updateSuccess"),severity:"success"})):(await j.post("/api/system-users",a),l({open:!0,message:t("systemUsers.createSuccess"),severity:"success"})),p(!1),w()}catch(e){l({open:!0,message:e.message||t("common.error"),severity:"error"})}},y={total:h.length,active:h.filter(e=>e.status==="active").length,byAuth:{password:h.filter(e=>e.authType==="password").length,key:h.filter(e=>e.authType==="key").length}};return s.jsxs(c,{sx:{p:3},children:[s.jsxs(c,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:[s.jsx(v,{sx:{flex:"1 1 0",minWidth:200},children:s.jsxs(g,{children:[s.jsx(n,{color:"textSecondary",gutterBottom:!0,children:t("systemUsers.total")}),s.jsxs(n,{variant:"h4",children:[s.jsx(I,{sx:{mr:1,verticalAlign:"middle"}}),y.total]})]})}),s.jsx(v,{sx:{flex:"1 1 0",minWidth:200},children:s.jsxs(g,{children:[s.jsx(n,{color:"textSecondary",gutterBottom:!0,children:t("systemUsers.activeCount")}),s.jsx(n,{variant:"h4",color:"success.main",children:y.active})]})}),s.jsx(v,{sx:{flex:"1 1 0",minWidth:200},children:s.jsxs(g,{children:[s.jsx(n,{color:"textSecondary",gutterBottom:!0,children:t("systemUsers.passwordAuth")}),s.jsx(n,{variant:"h4",children:y.byAuth.password})]})}),s.jsx(v,{sx:{flex:"1 1 0",minWidth:200},children:s.jsxs(g,{children:[s.jsx(n,{color:"textSecondary",gutterBottom:!0,children:t("systemUsers.keyAuth")}),s.jsx(n,{variant:"h4",children:y.byAuth.key})]})})]}),s.jsxs(H,{sx:{p:2},children:[s.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[s.jsx(n,{variant:"h6",children:t("systemUsers.title")}),s.jsx(b,{variant:"contained",startIcon:s.jsx(P,{}),onClick:F,children:t("systemUsers.addUser")})]}),s.jsx(Q,{children:s.jsxs(X,{children:[s.jsx(Y,{children:s.jsxs(K,{children:[s.jsx(r,{children:t("systemUsers.name")}),s.jsx(r,{children:t("systemUsers.username")}),s.jsx(r,{children:t("systemUsers.authType")}),s.jsx(r,{children:t("systemUsers.protocol")}),s.jsx(r,{children:t("systemUsers.status")}),s.jsx(r,{children:t("systemUsers.description")}),s.jsx(r,{children:t("common.actions")})]})}),s.jsx(Z,{children:h.map(e=>s.jsxs(K,{children:[s.jsx(r,{children:s.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(I,{}),e.name]})}),s.jsx(r,{children:s.jsx(f,{label:e.username,size:"small",color:"info"})}),s.jsx(r,{children:s.jsx(f,{icon:s.jsx(M,{}),label:e.authType==="password"?t("systemUsers.password"):t("systemUsers.key"),size:"small",color:e.authType==="password"?"success":"primary"})}),s.jsx(r,{children:s.jsx(f,{label:e.protocol.toUpperCase(),size:"small"})}),s.jsx(r,{children:s.jsx(f,{label:e.status==="active"?t("systemUsers.active"):t("systemUsers.inactive"),size:"small",color:e.status==="active"?"success":"default"})}),s.jsx(r,{children:e.description}),s.jsxs(r,{children:[s.jsx(D,{size:"small",color:"primary",onClick:()=>q(e),children:s.jsx(L,{})}),s.jsx(D,{size:"small",color:"error",onClick:()=>z(e.id),children:s.jsx(V,{})})]})]},e.id))})]})})]}),s.jsxs($,{open:B,onClose:()=>p(!1),maxWidth:"md",fullWidth:!0,children:[s.jsx(G,{children:t(U?"systemUsers.editUser":"systemUsers.addUser")}),s.jsx(J,{children:s.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:2.5,pt:2},children:[s.jsxs(c,{sx:{display:"flex",gap:2},children:[s.jsx(d,{fullWidth:!0,label:t("systemUsers.name"),value:a.name,onChange:e=>i({...a,name:e.target.value}),required:!0}),s.jsx(d,{fullWidth:!0,label:t("systemUsers.username"),value:a.username,onChange:e=>i({...a,username:e.target.value}),required:!0})]}),s.jsxs(c,{sx:{display:"flex",gap:2},children:[s.jsxs(C,{fullWidth:!0,required:!0,children:[s.jsx(T,{children:t("systemUsers.authType")}),s.jsxs(S,{value:a.authType,onChange:e=>i({...a,authType:e.target.value}),label:t("systemUsers.authType"),children:[s.jsx(u,{value:"password",children:t("systemUsers.password")}),s.jsx(u,{value:"key",children:t("systemUsers.key")})]})]}),s.jsxs(C,{fullWidth:!0,children:[s.jsx(T,{children:t("systemUsers.protocol")}),s.jsxs(S,{value:a.protocol,onChange:e=>i({...a,protocol:e.target.value}),label:t("systemUsers.protocol"),children:[s.jsx(u,{value:"ssh",children:"SSH"}),s.jsx(u,{value:"rdp",children:"RDP"})]})]})]}),a.authType==="password"&&s.jsx(d,{fullWidth:!0,type:"password",label:t("systemUsers.password"),value:a.password,onChange:e=>i({...a,password:e.target.value})}),a.authType==="key"&&s.jsxs(s.Fragment,{children:[s.jsx(d,{fullWidth:!0,multiline:!0,rows:4,label:t("systemUsers.privateKey"),value:a.privateKey,onChange:e=>i({...a,privateKey:e.target.value})}),s.jsx(d,{fullWidth:!0,type:"password",label:t("systemUsers.passphrase"),value:a.passphrase,onChange:e=>i({...a,passphrase:e.target.value})})]}),s.jsxs(C,{fullWidth:!0,children:[s.jsx(T,{children:t("systemUsers.status")}),s.jsxs(S,{value:a.status,onChange:e=>i({...a,status:e.target.value}),label:t("systemUsers.status"),children:[s.jsx(u,{value:"active",children:t("systemUsers.active")}),s.jsx(u,{value:"inactive",children:t("systemUsers.inactive")})]})]}),s.jsx(d,{fullWidth:!0,multiline:!0,rows:3,label:t("systemUsers.description"),value:a.description,onChange:e=>i({...a,description:e.target.value})})]})}),s.jsxs(N,{children:[s.jsx(b,{onClick:()=>p(!1),children:t("common.cancel")}),s.jsx(b,{variant:"contained",onClick:E,children:t("common.confirm")})]})]}),s.jsx(_,{open:m.open,autoHideDuration:3e3,onClose:()=>l({...m,open:!1}),children:s.jsx(O,{severity:m.severity,onClose:()=>l({...m,open:!1}),children:m.message})})]})};export{rs as default};
