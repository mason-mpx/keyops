import{u as We,r as l,j as e,B as c,C as B,T as W,m as p,s as Ie,t as Pe,a as w,A as ke,v as Re,w as Ae,x as Ge,d as q,I as Z,g as Me,h as Oe,b as ze,i as ee,k as se,l as te,F as I,n as P,o as k,M as o,y as ae,p as re,z as D,G as y}from"./index-z51Q_M-r.js";import{useMockData as De}from"./mockData-C1akHryx.js";import{g as Ee}from"./websocket-BS3fvhOg.js";import{T as Fe,a as Le,b as Ne,c as oe,d,e as $e}from"./TableRow-CKQKXB8v.js";import{C as R}from"./Chip-BoE43uAD.js";import{T as Be}from"./TablePagination-DV0GrBI0.js";import{S as qe}from"./Snackbar-D3ARHm3x.js";import"./LastPage-BCKcUFpS.js";function ss(){const{t}=We(),[ne,E]=l.useState(!0),[ie,le]=l.useState([]),[A,de]=l.useState(""),[ce,x]=l.useState(""),[ue,u]=l.useState(!1),[he,g]=l.useState("error"),[F,J]=l.useState(0),[G,pe]=l.useState(10),[M,xe]=l.useState([]),[C,L]=l.useState([]),[ge,V]=l.useState(!1),[f,v]=l.useState(!1),[i,j]=l.useState({name:"",ip:"",port:22,protocol:"ssh",deviceType:"server",username:"root",tags:""}),[me,X]=l.useState(!1),[b,_]=l.useState(null),[O,T]=l.useState([]),[n,m]=l.useState({name:"",ip:"",port:22,protocol:"ssh",deviceType:"server",status:"offline",tags:""}),K=localStorage.getItem("user"),Q=(K?JSON.parse(K):null)?.role==="admin",H=async()=>{E(!0);try{if(!De){const a=(await D.getHosts({pageSize:1e4})).hosts.map(r=>({...r,tags:typeof r.tags=="string"?JSON.parse(r.tags||"[]"):r.tags||[]}));le(a),E(!1)}}catch(s){console.error("Failed to load hosts:",s),E(!1)}},S=async()=>{try{const s=await y.listGroups({stats:!0});console.log("Âä†ËΩΩÁöÑ‰∏ªÊú∫ÁªÑÂàóË°®:",s),xe(s.groups||[])}catch(s){console.error("Failed to load host groups:",s)}};l.useEffect(()=>{H(),S()},[]);const U=()=>{u(!1)},fe=async()=>{j({name:"",ip:"",port:22,protocol:"ssh",deviceType:"server",username:"root",tags:""}),L([]),await S(),V(!0)},N=()=>{V(!1),j({name:"",ip:"",port:22,protocol:"ssh",deviceType:"server",username:"root",tags:""}),L([])},je=async()=>{if(!i.name||!i.ip){g("error"),x("ËØ∑Â°´ÂÜôÊâÄÊúâÂøÖÂ°´Â≠óÊÆµ"),u(!0);return}v(!0);try{const s=i.tags.split(",").map(r=>r.trim()).filter(r=>r!==""),a=await D.createHost({name:i.name,ip:i.ip,port:i.port,protocol:i.protocol,deviceType:i.deviceType,username:i.username,tags:JSON.stringify(s),status:"unknown",os:""});if(C.length>0&&a.id)try{for(const r of C)await y.addHostsToGroup(r,[a.id])}catch(r){console.error("Failed to add host to groups:",r)}await H(),await S(),N(),g("success"),x(C.length>0?t("assets.addHostSuccessWithGroups"):t("assets.addHostSuccess")),u(!0)}catch(s){console.error("Failed to add host:",s),g("error"),x(s instanceof Error?s.message:t("assets.addHostFailed")),u(!0)}finally{v(!1)}},be=async s=>{_(s),m({name:s.name,ip:s.ip,port:s.port,protocol:s.protocol,deviceType:s.deviceType,status:s.status,tags:Array.isArray(s.tags)?s.tags.join(", "):""}),await S();try{const a=await y.getHostGroups(s.id);if(console.log("Ëé∑ÂèñÂà∞ÁöÑ‰∏ªÊú∫ÁªÑÊï∞ÊçÆ:",a),console.log("‰∏ªÊú∫ID:",s.id),a&&Array.isArray(a)&&a.length>0){const r=a.map(z=>z.id);console.log("ËÆæÁΩÆÁöÑ‰∏ªÊú∫ÁªÑIDs:",r),T(r)}else console.log("Êú™ÊâæÂà∞‰∏ªÊú∫ÁªÑÊàñËøîÂõûÊï∞ÊçÆ‰∏∫Á©∫"),T([])}catch(a){console.error("Failed to load host groups:",a),T([])}X(!0)},$=()=>{X(!1),_(null),m({name:"",ip:"",port:22,protocol:"ssh",deviceType:"server",status:"offline",tags:""}),T([])},ve=async()=>{if(b){if(!n.name||!n.ip){g("error"),x("ËØ∑Â°´ÂÜôÊâÄÊúâÂøÖÂ°´Â≠óÊÆµ"),u(!0);return}v(!0);try{const s=n.tags.split(",").map(r=>r.trim()).filter(r=>r!==""),a={name:n.name,ip:n.ip,port:n.port,deviceType:n.deviceType,status:n.status,tags:JSON.stringify(s)};await D.updateHost(b.id,a);try{const r=await y.getHostGroups(b.id),z=r?r.map(h=>h.id):[],He=z.filter(h=>!O.includes(h)),Se=O.filter(h=>!z.includes(h));for(const h of He)await y.removeHostsFromGroup(h,[b.id]);for(const h of Se)await y.addHostsToGroup(h,[b.id])}catch(r){console.error("Failed to update host groups:",r)}await H(),await S(),$(),g("success"),x("‰∏ªÊú∫Êõ¥Êñ∞ÊàêÂäüÔºÅ"),u(!0)}catch(s){console.error("Failed to update host:",s),g("error"),x(s instanceof Error?s.message:"Êõ¥Êñ∞‰∏ªÊú∫Â§±Ë¥•"),u(!0)}finally{v(!1)}}},we=async s=>{if(window.confirm(t("assets.deleteHostConfirm",{name:s.name,ip:s.ip}))){v(!0);try{await D.deleteHost(s.id),await H(),g("success"),x(t("assets.deleteHostSuccess")),u(!0)}catch(r){console.error("Failed to delete host:",r),g("error"),x(r instanceof Error?r.message:t("assets.deleteHostFailed")),u(!0)}finally{v(!1)}}},Y=ie.filter(s=>s.name.toLowerCase().includes(A.toLowerCase())||s.ip.includes(A)||s.tags.some(a=>a.toLowerCase().includes(A.toLowerCase()))),ye=(s,a)=>{J(a)},Ce=s=>{pe(parseInt(s.target.value,10)),J(0)},Te=Y.slice(F*G,F*G+G);return ne?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(B,{})}):e.jsxs(c,{children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(c,{children:[e.jsxs(W,{variant:"h4",component:"h1",fontWeight:"700",gutterBottom:!0,children:["üíª ",t("assets.title")]}),e.jsx(W,{variant:"body2",color:"text.secondary",children:t("assets.description")})]}),e.jsxs(c,{display:"flex",gap:2,children:[e.jsx(p,{size:"small",placeholder:t("common.search")+"...",value:A,onChange:s=>de(s.target.value),sx:{width:280,"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"white"}},InputProps:{startAdornment:e.jsx(Ie,{position:"start",children:e.jsx(Pe,{color:"action"})})}}),Q&&e.jsx(w,{variant:"contained",startIcon:e.jsx(ke,{}),onClick:fe,sx:{borderRadius:2,textTransform:"none",fontWeight:600,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)","&:hover":{background:"linear-gradient(135deg, #764ba2 0%, #667eea 100%)"}},children:t("assets.addHost")}),e.jsx(w,{variant:"outlined",startIcon:e.jsx(Re,{}),onClick:H,sx:{borderRadius:2,textTransform:"none",fontWeight:600},children:t("common.refresh")})]})]}),e.jsx(Ae,{sx:{borderRadius:3,boxShadow:"0 4px 12px rgba(0,0,0,0.08)"},children:e.jsxs(Ge,{sx:{p:0},children:[e.jsx(Fe,{sx:{p:2,overflowX:"auto"},children:e.jsxs(Le,{sx:{minWidth:1200},children:[e.jsx(Ne,{children:e.jsxs(oe,{sx:{backgroundColor:"rgba(102, 126, 234, 0.05)"},children:[e.jsx(d,{align:"center",sx:{fontWeight:700,color:"#667eea",minWidth:150,width:200},children:t("assets.hostName")}),e.jsx(d,{align:"center",sx:{fontWeight:700,color:"#667eea",width:160},children:t("assets.hostIP")}),e.jsx(d,{align:"center",sx:{fontWeight:700,color:"#667eea",width:80},children:t("assets.port")}),e.jsx(d,{align:"center",sx:{fontWeight:700,color:"#667eea",width:140},children:t("assets.deviceType")}),e.jsx(d,{align:"center",sx:{fontWeight:700,color:"#667eea",width:120},children:t("common.status")}),e.jsx(d,{align:"center",sx:{fontWeight:700,color:"#667eea",width:180},children:t("assets.tags")}),e.jsx(d,{align:"center",sx:{fontWeight:700,color:"#667eea",width:100},children:t("common.actions")})]})}),e.jsx($e,{children:Te.map(s=>e.jsxs(oe,{hover:!0,sx:{transition:"all 0.2s ease","&:hover":{backgroundColor:"rgba(102, 126, 234, 0.05)",transform:"scale(1.005)"}},children:[e.jsx(d,{align:"center",sx:{minWidth:150,width:200},children:e.jsx(q,{title:s.name,arrow:!0,children:e.jsx(W,{fontWeight:700,sx:{color:"#1a202c",fontSize:"1rem",letterSpacing:"0.01em",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",cursor:"pointer",textAlign:"center"},children:s.name})})}),e.jsx(d,{align:"center",sx:{width:160},children:e.jsx(R,{label:s.ip,size:"small",variant:"outlined",sx:{fontFamily:"monospace",fontWeight:600}})}),e.jsx(d,{align:"center",sx:{width:80},children:e.jsx(R,{label:s.port,size:"small",sx:{fontFamily:"monospace"}})}),e.jsx(d,{align:"center",sx:{width:140},children:e.jsx(R,{label:Ee(s.deviceType),size:"small",color:"info",variant:"outlined",sx:{fontWeight:600}})}),e.jsx(d,{align:"center",sx:{width:120},children:e.jsx(R,{label:s.status==="online"?"üü¢ Âú®Á∫ø":" Á¶ªÁ∫ø",color:s.status==="online"?"success":"error",size:"small",sx:{fontWeight:600}})}),e.jsx(d,{align:"center",sx:{width:180,maxWidth:180},children:e.jsx(c,{display:"flex",gap:.5,flexWrap:"wrap",justifyContent:"center",children:s.tags.map(a=>e.jsx(R,{label:a,size:"small",sx:{backgroundColor:"rgba(102, 126, 234, 0.1)",color:"#667eea",fontWeight:500}},a))})}),e.jsx(d,{align:"center",sx:{width:100},children:e.jsx(c,{display:"flex",gap:1,justifyContent:"center",children:Q&&e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"ÁºñËæë‰∏ªÊú∫",children:e.jsx(Z,{size:"small",onClick:()=>be(s),sx:{backgroundColor:"rgba(255, 152, 0, 0.1)",color:"#ff9800","&:hover":{backgroundColor:"rgba(255, 152, 0, 0.2)"}},children:e.jsx(Me,{fontSize:"small"})})}),e.jsx(q,{title:"Âà†Èô§‰∏ªÊú∫",children:e.jsx("span",{children:e.jsx(Z,{size:"small",onClick:()=>we(s),disabled:f,sx:{backgroundColor:"rgba(244, 67, 54, 0.1)",color:"#f44336","&:hover":{backgroundColor:"rgba(244, 67, 54, 0.2)"},"&:disabled":{backgroundColor:"transparent",color:"rgba(0, 0, 0, 0.26)"}},children:e.jsx(Oe,{fontSize:"small"})})})})]})})})]},s.id))})]})}),e.jsx(Be,{rowsPerPageOptions:[5,10,25,50],component:"div",count:Y.length,rowsPerPage:G,page:F,onPageChange:ye,onRowsPerPageChange:Ce,labelRowsPerPage:t("common.rowsPerPage"),labelDisplayedRows:({from:s,to:a,count:r})=>t("common.displayedRows",{from:s,to:a,count:r}),sx:{borderTop:"1px solid #e2e8f0",mt:0,width:"100%",".MuiTablePagination-toolbar":{paddingLeft:2,paddingRight:2,minHeight:"52px",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},".MuiTablePagination-spacer":{flex:"1 1 auto"},".MuiTablePagination-selectLabel":{marginRight:1,marginBottom:0,fontWeight:500,fontSize:"0.875rem",color:"text.secondary",display:"flex",alignItems:"center",lineHeight:1.5},".MuiTablePagination-displayedRows":{marginBottom:0,fontWeight:500,fontSize:"0.875rem",color:"text.secondary",display:"flex",alignItems:"center",lineHeight:1.5},".MuiTablePagination-select":{fontSize:"0.875rem",marginRight:2,marginTop:0,marginBottom:0},".MuiTablePagination-actions":{marginLeft:1,display:"flex",alignItems:"center"}}})]})}),e.jsx(qe,{open:ue,autoHideDuration:6e3,onClose:U,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ze,{onClose:U,severity:he,sx:{width:"100%","& .MuiAlert-message":{fontSize:"1rem",fontWeight:500}},children:ce})}),e.jsxs(ee,{open:me,onClose:$,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:[e.jsx(se,{sx:{pb:2,pt:2,px:3,background:"linear-gradient(135deg, #ff9800 0%, #ff5722 100%)",color:"white"},children:e.jsxs(c,{children:[e.jsxs(W,{variant:"h6",sx:{fontWeight:700,fontSize:"1.25rem",mb:.5},children:["‚úèÔ∏è ",t("assets.editHost")]}),b&&e.jsx(W,{variant:"body2",sx:{opacity:.95,fontWeight:500,fontSize:"0.95rem",letterSpacing:"0.02em"},children:b.name})]})}),e.jsx(te,{sx:{pt:3,mt:2},children:e.jsxs(c,{display:"flex",flexDirection:"column",gap:2.5,children:[e.jsx(p,{label:t("assets.hostName"),value:n.name,onChange:s=>m({...n,name:s.target.value}),fullWidth:!0,required:!0,placeholder:t("assets.hostNamePlaceholder"),variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:2},"& .MuiInputLabel-root":{marginTop:"10px"}}}),e.jsx(p,{label:t("assets.hostIP"),value:n.ip,onChange:s=>m({...n,ip:s.target.value}),fullWidth:!0,required:!0,placeholder:t("assets.hostIPPlaceholder"),variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),e.jsx(p,{label:t("assets.port"),type:"number",value:n.port,onChange:s=>m({...n,port:parseInt(s.target.value)||22}),fullWidth:!0,required:!0,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(P,{children:t("assets.deviceType")}),e.jsxs(k,{value:n.deviceType,label:t("assets.deviceType"),onChange:s=>m({...n,deviceType:s.target.value}),sx:{borderRadius:2},children:[e.jsx(o,{value:"linux",children:"Linux ÊúçÂä°Âô®"}),e.jsx(o,{value:"windows",children:"Windows ÊúçÂä°Âô®"}),e.jsx(o,{value:"vmware",children:"VMware ËôöÊãüÊú∫"}),e.jsx(o,{value:"docker",children:"Docker ÂÆπÂô®"}),e.jsx(o,{value:"switch",children:"‰∫§Êç¢Êú∫"}),e.jsx(o,{value:"router",children:"Ë∑ØÁî±Âô®"}),e.jsx(o,{value:"firewall",children:"Èò≤ÁÅ´Â¢ô"}),e.jsx(o,{value:"storage",children:"Â≠òÂÇ®ËÆæÂ§á"}),e.jsx(o,{value:"other",children:"ÂÖ∂‰ªñËÆæÂ§á"})]})]}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(P,{children:t("common.status")}),e.jsxs(k,{value:n.status,label:t("common.status"),onChange:s=>m({...n,status:s.target.value}),sx:{borderRadius:2},children:[e.jsx(o,{value:"online",children:"üü¢ Âú®Á∫ø"}),e.jsx(o,{value:"offline",children:" Á¶ªÁ∫ø"})]})]}),e.jsx(p,{label:t("assets.tags"),value:n.tags,onChange:s=>m({...n,tags:s.target.value}),fullWidth:!0,placeholder:t("assets.tagsPlaceholder"),variant:"outlined",helperText:"Ê†áÁ≠æÁî®‰∫éÂàÜÁªÑÂíåË∑ØÁî±ÂÜ≥Á≠ñ",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(P,{children:t("assets.hostGroups")}),e.jsx(k,{multiple:!0,value:O,label:t("assets.hostGroups"),onChange:s=>{const a=s.target.value;T(typeof a=="string"?a.split(","):a)},renderValue:s=>s.length===0?e.jsx("em",{children:t("assets.noHostGroups")}):M.filter(a=>s.includes(a.id)).map(a=>`${a.icon?a.icon+" ":""}${a.name}`).join(", "),sx:{borderRadius:2},children:M.map(s=>e.jsxs(o,{value:s.id,children:[e.jsx(ae,{checked:O.indexOf(s.id)>-1}),e.jsxs(c,{component:"span",sx:{ml:1},children:[s.icon&&`${s.icon} `,s.name,s.hostCount!==void 0&&` (${s.hostCount}${t("assets.hostsCount")})`]})]},s.id))})]})]})}),e.jsxs(re,{sx:{px:3,pb:3,pt:2},children:[e.jsx(w,{onClick:$,disabled:f,sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3},children:"ÂèñÊ∂à"}),e.jsx(w,{onClick:ve,variant:"contained",disabled:f,sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,background:"linear-gradient(135deg, #ff9800 0%, #ff5722 100%)","&:hover":{background:"linear-gradient(135deg, #ff5722 0%, #ff9800 100%)"}},children:f?e.jsx(B,{size:20,color:"inherit"}):"Á°ÆËÆ§‰øùÂ≠ò"})]})]}),e.jsxs(ee,{open:ge,onClose:N,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,boxShadow:"0 8px 32px rgba(0,0,0,0.12)"}},children:[e.jsxs(se,{sx:{pb:2,pt:2,px:3,fontWeight:700,fontSize:"1.25rem",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},children:["‚ûï ",t("assets.addHost")]}),e.jsx(te,{sx:{pt:3,mt:2},children:e.jsxs(c,{display:"flex",flexDirection:"column",gap:2.5,children:[e.jsx(p,{label:t("assets.hostName"),value:i.name,onChange:s=>j({...i,name:s.target.value}),fullWidth:!0,required:!0,placeholder:t("assets.hostNamePlaceholder"),variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),e.jsx(p,{label:t("assets.hostIP"),value:i.ip,onChange:s=>j({...i,ip:s.target.value}),fullWidth:!0,required:!0,placeholder:t("assets.hostIPPlaceholder"),variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),e.jsx(p,{label:"Á´ØÂè£Âè∑",type:"number",value:i.port,onChange:s=>j({...i,port:parseInt(s.target.value)||22}),fullWidth:!0,required:!0,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(P,{children:t("assets.deviceType")}),e.jsxs(k,{value:i.deviceType,label:t("assets.deviceType"),onChange:s=>j({...i,deviceType:s.target.value}),sx:{borderRadius:2},children:[e.jsx(o,{value:"linux",children:"Linux ÊúçÂä°Âô®"}),e.jsx(o,{value:"windows",children:"Windows ÊúçÂä°Âô®"}),e.jsx(o,{value:"vmware",children:"VMware ËôöÊãüÊú∫"}),e.jsx(o,{value:"docker",children:"Docker ÂÆπÂô®"}),e.jsx(o,{value:"switch",children:"‰∫§Êç¢Êú∫"}),e.jsx(o,{value:"router",children:"Ë∑ØÁî±Âô®"}),e.jsx(o,{value:"firewall",children:"Èò≤ÁÅ´Â¢ô"}),e.jsx(o,{value:"storage",children:"Â≠òÂÇ®ËÆæÂ§á"}),e.jsx(o,{value:"other",children:"ÂÖ∂‰ªñËÆæÂ§á"})]})]}),e.jsx(p,{label:t("assets.tags"),value:i.tags,onChange:s=>j({...i,tags:s.target.value}),fullWidth:!0,placeholder:t("assets.tagsPlaceholder"),variant:"outlined",helperText:t("assets.tagsHelper"),sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),e.jsxs(I,{fullWidth:!0,children:[e.jsx(P,{children:t("assets.hostGroups")}),e.jsx(k,{multiple:!0,value:C,label:t("assets.hostGroups"),onChange:s=>{const a=s.target.value;L(typeof a=="string"?a.split(","):a)},renderValue:s=>s.length===0?e.jsx("em",{children:t("assets.noHostGroups")}):M.filter(a=>s.includes(a.id)).map(a=>`${a.icon?a.icon+" ":""}${a.name}`).join(", "),sx:{borderRadius:2},children:M.map(s=>e.jsxs(o,{value:s.id,children:[e.jsx(ae,{checked:C.indexOf(s.id)>-1}),e.jsxs(c,{component:"span",sx:{ml:1},children:[s.icon&&`${s.icon} `,s.name,s.hostCount!==void 0&&` (${s.hostCount}${t("assets.hostsCount")})`]})]},s.id))})]})]})}),e.jsxs(re,{sx:{px:3,pb:3,pt:2},children:[e.jsx(w,{onClick:N,disabled:f,sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3},children:"ÂèñÊ∂à"}),e.jsx(w,{onClick:je,variant:"contained",disabled:f,sx:{borderRadius:2,textTransform:"none",fontWeight:600,px:3,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)","&:hover":{background:"linear-gradient(135deg, #764ba2 0%, #667eea 100%)"}},children:f?e.jsx(B,{size:20,color:"inherit"}):t("assets.confirmAdd")})]})]})]})}export{ss as default};
