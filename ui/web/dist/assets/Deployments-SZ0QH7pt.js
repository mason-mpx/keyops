import{u as S,ax as w,r as l,bf as o,j as e,B as i,T as d,w as u,x as j,b as D,C as I,a as W,ci as N}from"./index-CJIrazW8.js";import{k as $}from"./index-WecCn6t4.js";import{k as E}from"./k8sClusterApi-CNrfXk7P.js";import{C as z}from"./ClusterSelector-jwLavnc9.js";import{N as B}from"./NamespaceSelector-Cwt8R29p.js";import{T as A,a as L,b as R,c as p,d as a,e as F}from"./TableRow-JrGpygSA.js";import{C as H}from"./Chip-Bh8gAKTq.js";import"./utils---T2rn-T.js";import"./yaml-ARGwl1H1.js";import"./namespaces-DchDgKey.js";function X(){const{t}=S(),f=w(),[g,x]=l.useState(!1),[m,h]=l.useState([]),[r,b]=l.useState(""),[c,y]=l.useState(""),[C,k]=l.useState(null);l.useEffect(()=>{r&&E.getCluster(r).then(k).catch(s=>{o(s?.response?.data?.message||"获取集群信息失败")})},[r]);const T=async()=>{if(!r){o("请先选择集群");return}try{x(!0);const s={clusterId:r,namespace:c||void 0},n=await $.getDeploymentList(s);h(n)}catch(s){const n=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||"获取Deployment列表失败";o(n),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&h([])}finally{x(!1)}};l.useEffect(()=>{r&&T()},[r,c]);const v=(s,n)=>s===n&&s>0?"success":s>0?"warning":"error";return e.jsxs(i,{sx:{width:"100%",p:3},children:[e.jsx(i,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:e.jsxs(i,{children:[e.jsx(d,{variant:"h4",component:"h1",fontWeight:"700",children:t("k8s.deployments.title")}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:t("k8s.deployments.subtitle")})]})}),e.jsx(u,{sx:{mb:3},children:e.jsx(j,{children:e.jsxs(i,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(i,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(z,{value:r,onChange:b,size:"medium",fullWidth:!0,label:t("k8s.selectCluster")})}),r&&e.jsx(i,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(B,{value:c,onChange:y,clusterId:r,defaultNamespace:C?.defaultNamespace,size:"medium",fullWidth:!0,label:t("k8s.selectNamespace")})})]})})}),r?g?e.jsx(i,{display:"flex",justifyContent:"center",p:3,children:e.jsx(I,{})}):e.jsx(u,{children:e.jsx(j,{children:e.jsx(A,{children:e.jsxs(L,{children:[e.jsx(R,{children:e.jsxs(p,{children:[e.jsx(a,{children:t("k8s.deployments.name")}),e.jsx(a,{children:t("k8s.deployments.namespace")}),e.jsx(a,{children:t("k8s.deployments.ready")}),e.jsx(a,{children:t("k8s.deployments.upToDate")}),e.jsx(a,{children:t("k8s.deployments.available")}),e.jsx(a,{children:t("k8s.deployments.age")}),e.jsx(a,{children:t("common.actions")})]})}),e.jsx(F,{children:m.length===0?e.jsx(p,{children:e.jsx(a,{colSpan:7,align:"center",children:e.jsx(d,{color:"textSecondary",children:t("common.noData")})})}):m.map(s=>e.jsxs(p,{children:[e.jsx(a,{children:s.name}),e.jsx(a,{children:s.namespace}),e.jsx(a,{children:e.jsx(H,{label:`${s.ready}/${s.upToDate||s.ready}`,color:v(s.ready,s.available),size:"small"})}),e.jsx(a,{children:s.upToDate}),e.jsx(a,{children:s.available}),e.jsx(a,{children:s.age}),e.jsx(a,{children:e.jsx(W,{size:"small",variant:"outlined",startIcon:e.jsx(N,{}),onClick:()=>{if(!r){o("请先选择集群");return}const n=`/k8s/deployments/${r}/${s.namespace}/${s.name}`;f(n)},disabled:!r,children:t("k8s.viewDetails","详情")})})]},`${s.namespace}-${s.name}`))})]})})})}):e.jsx(D,{severity:"info",children:t("k8s.selectClusterFirst")})]})}export{X as default};
