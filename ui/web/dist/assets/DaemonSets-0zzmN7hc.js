import{u as T,ax as w,r as l,bf as i,j as e,B as o,T as d,w as j,x as f,b as I,C as N,a as W,ci as D}from"./index-wVs8DYHr.js";import{k as $}from"./index-BIq8ZW4m.js";import{k as E}from"./k8sClusterApi-Bz6qMnao.js";import{C as z}from"./ClusterSelector-DqWR8dyY.js";import{N as B}from"./NamespaceSelector-BppKItkw.js";import{T as A,a as F,b as L,c as m,d as a,e as R}from"./TableRow-17IyVPm2.js";import{C as H}from"./Chip-DzNpApxT.js";import"./utils-DifSMk6h.js";import"./yaml-B1Nq9-gN.js";import"./namespaces-Biqx1aVY.js";function X(){const{t}=T(),S=w(),[g,x]=l.useState(!1),[p,h]=l.useState([]),[n,b]=l.useState(""),[c,C]=l.useState(""),[u,k]=l.useState(null);l.useEffect(()=>{n&&E.getCluster(n).then(k).catch(s=>{i(s?.response?.data?.message||"获取集群信息失败")})},[n]);const y=async()=>{if(!n){i(t("k8s.selectClusterFirst"));return}try{x(!0);const s={clusterId:n,namespace:c||void 0},r=await $.getDaemonSetList(s);h(r)}catch(s){const r=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||t("k8s.daemonSets.loadFailed");i(r),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&h([])}finally{x(!1)}};l.useEffect(()=>{n&&y()},[n,c]);const v=(s,r)=>s===r&&s>0?"success":s>0?"warning":"error";return e.jsxs(o,{sx:{width:"100%",p:3},children:[e.jsx(o,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:e.jsxs(o,{children:[e.jsx(d,{variant:"h4",component:"h1",fontWeight:"700",children:t("k8s.daemonSets.title")}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:t("k8s.daemonSets.subtitle")})]})}),e.jsx(j,{sx:{mb:3},children:e.jsx(f,{children:e.jsxs(o,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(o,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(z,{value:n,onChange:b,size:"medium",fullWidth:!0,label:t("k8s.selectCluster")})}),n&&e.jsx(o,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(B,{value:c,onChange:C,clusterId:n,allowedNamespaces:u?void 0:[],defaultNamespace:u?.defaultNamespace,size:"medium",fullWidth:!0,label:t("k8s.selectNamespace")})})]})})}),n?g?e.jsx(o,{display:"flex",justifyContent:"center",p:3,children:e.jsx(N,{})}):e.jsx(j,{children:e.jsx(f,{children:e.jsx(A,{children:e.jsxs(F,{children:[e.jsx(L,{children:e.jsxs(m,{children:[e.jsx(a,{children:t("k8s.daemonSets.name")}),e.jsx(a,{children:t("k8s.daemonSets.namespace")}),e.jsx(a,{children:t("k8s.daemonSets.desired")}),e.jsx(a,{children:t("k8s.daemonSets.current")}),e.jsx(a,{children:t("k8s.daemonSets.ready")}),e.jsx(a,{children:t("k8s.daemonSets.upToDate")}),e.jsx(a,{children:t("k8s.daemonSets.available")}),e.jsx(a,{children:t("k8s.daemonSets.age")}),e.jsx(a,{children:t("common.actions")})]})}),e.jsx(R,{children:p.length===0?e.jsx(m,{children:e.jsx(a,{colSpan:9,align:"center",children:e.jsx(d,{color:"textSecondary",children:t("common.noData")})})}):p.map(s=>e.jsxs(m,{children:[e.jsx(a,{children:s.name}),e.jsx(a,{children:s.namespace}),e.jsx(a,{children:s.desired}),e.jsx(a,{children:s.current}),e.jsx(a,{children:e.jsx(H,{label:`${s.ready}/${s.desired}`,color:v(s.ready,s.desired),size:"small"})}),e.jsx(a,{children:s.upToDate}),e.jsx(a,{children:s.available}),e.jsx(a,{children:s.age}),e.jsx(a,{children:e.jsx(W,{size:"small",variant:"outlined",startIcon:e.jsx(D,{}),onClick:()=>{if(!n){i("请先选择集群");return}const r=`/k8s/daemonsets/${n}/${s.namespace}/${s.name}`;S(r)},disabled:!n,children:t("k8s.viewDetails","详情")})})]},`${s.namespace}-${s.name}`))})]})})})}):e.jsx(I,{severity:"info",children:t("k8s.selectClusterFirst")})]})}export{X as default};
