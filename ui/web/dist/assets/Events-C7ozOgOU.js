import{u as w,r as l,bf as d,j as e,B as r,T as x,w as b,x as g,m as v,a as E,b as I,C as z}from"./index-CJIrazW8.js";import{k as F}from"./index-WecCn6t4.js";import{k as O}from"./k8sClusterApi-CNrfXk7P.js";import{C as P}from"./ClusterSelector-jwLavnc9.js";import{N as B}from"./NamespaceSelector-Cwt8R29p.js";import{T as A,a as K,b as D,c as p,d as n,e as L}from"./TableRow-JrGpygSA.js";import{C as R}from"./Chip-Bh8gAKTq.js";import"./utils---T2rn-T.js";import"./yaml-ARGwl1H1.js";import"./namespaces-DchDgKey.js";function Z(){const{t}=w(),[m,h]=l.useState(!1),[j,c]=l.useState([]),[a,y]=l.useState(""),[u,k]=l.useState(""),[C,S]=l.useState(null),[i,W]=l.useState(""),[f,N]=l.useState("Pod");l.useEffect(()=>{a&&O.getCluster(a).then(S).catch(s=>{d(s?.response?.data?.message||"获取集群信息失败")})},[a]);const T=async()=>{if(!a){d(t("k8s.selectClusterFirst"));return}if(!i){c([]);return}try{h(!0);const s={clusterId:a,namespace:u||void 0},o=await F.getEventList(s,i,f);c(o)}catch(s){const o=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||t("k8s.events.loadFailed");d(o),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&c([])}finally{h(!1)}};return e.jsxs(r,{sx:{width:"100%",p:3},children:[e.jsx(r,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:e.jsxs(r,{children:[e.jsx(x,{variant:"h4",component:"h1",fontWeight:"700",children:t("k8s.events.title")}),e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:t("k8s.events.subtitle")})]})}),e.jsx(b,{sx:{mb:3},children:e.jsx(g,{children:e.jsxs(r,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(r,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(P,{value:a,onChange:y,size:"medium",fullWidth:!0,label:t("k8s.selectCluster")})}),a&&e.jsx(r,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(B,{value:u,onChange:k,clusterId:a,defaultNamespace:C?.defaultNamespace,size:"medium",fullWidth:!0,label:t("k8s.selectNamespace")})}),a&&e.jsxs(e.Fragment,{children:[e.jsx(r,{sx:{minWidth:{xs:"100%",sm:"150px"},maxWidth:{xs:"100%",sm:"150px"}},children:e.jsxs(v,{fullWidth:!0,size:"medium",label:t("k8s.events.objectKind"),select:!0,value:f,onChange:s=>N(s.target.value),SelectProps:{native:!0},children:[e.jsx("option",{value:"Pod",children:t("k8s.pods.title")}),e.jsx("option",{value:"Service",children:t("k8s.services.title")}),e.jsx("option",{value:"Deployment",children:t("k8s.deployments.title")})]})}),e.jsx(r,{sx:{minWidth:{xs:"100%",sm:"200px"},maxWidth:{xs:"100%",sm:"200px"}},children:e.jsx(v,{fullWidth:!0,size:"medium",label:t("k8s.events.objectName"),value:i,onChange:s=>W(s.target.value),placeholder:t("k8s.events.objectNamePlaceholder")})}),e.jsx(r,{children:e.jsx(E,{variant:"contained",onClick:T,disabled:!i||m,size:"medium",children:t("common.query")})})]})]})})}),a?m?e.jsx(r,{display:"flex",justifyContent:"center",p:3,children:e.jsx(z,{})}):e.jsx(b,{children:e.jsx(g,{children:e.jsx(A,{children:e.jsxs(K,{children:[e.jsx(D,{children:e.jsxs(p,{children:[e.jsx(n,{children:t("k8s.events.type")}),e.jsx(n,{children:t("k8s.events.reason")}),e.jsx(n,{children:t("k8s.events.object")}),e.jsx(n,{children:t("k8s.events.message")}),e.jsx(n,{children:t("k8s.events.firstSeen")}),e.jsx(n,{children:t("k8s.events.lastSeen")}),e.jsx(n,{children:t("k8s.events.count")})]})}),e.jsx(L,{children:j.length===0?e.jsx(p,{children:e.jsx(n,{colSpan:7,align:"center",children:e.jsx(x,{color:"textSecondary",children:t(i?"common.noData":"k8s.events.pleaseInputObjectName")})})}):j.map((s,o)=>e.jsxs(p,{children:[e.jsx(n,{children:e.jsx(R,{label:s.type,color:s.type==="Warning"?"warning":"default",size:"small"})}),e.jsx(n,{children:s.reason}),e.jsx(n,{children:s.object}),e.jsx(n,{children:s.message}),e.jsx(n,{children:s.firstSeen}),e.jsx(n,{children:s.lastSeen}),e.jsx(n,{children:s.count})]},o))})]})})})}):e.jsx(I,{severity:"info",children:t("k8s.selectClusterFirst")})]})}export{Z as default};
