import{u as W,r as n,bf as c,j as e,B as l,T as m,I as y,v as z,w as b,x as k,b as L,C as Y,a as B,ci as D,cj as E}from"./index-Cih9_E47.js";import{k as R}from"./k8sClusterApi-B1gmk072.js";import{g as A}from"./yaml-QAtnNmSC.js";import{C as M}from"./ClusterSelector-DNhvsi-8.js";import{N as O}from"./NamespaceSelector-B-Fs44Ov.js";import{Y as F}from"./YamlViewerDialog-GsnPY0Cp.js";import{T as H,a as $,b as q,c as u,d as a,e as G}from"./TableRow-Bl_73t-R.js";import{C as J}from"./Chip-D6-9bdkU.js";import"./namespaces-DpyjThg4.js";import"./utils-DfbPgXsB.js";function ne(){const{t}=W(),[h,j]=n.useState(!1),[f,C]=n.useState([]),[r,w]=n.useState(""),[g,S]=n.useState(""),[v,I]=n.useState(null),[T,d]=n.useState(!1),[i,x]=n.useState(null);n.useEffect(()=>{r&&R.getCluster(r).then(I).catch(s=>{c(s?.response?.data?.message||"获取集群信息失败")})},[r]);const p=n.useCallback(async()=>{if(!r){c("请先选择集群");return}try{j(!0),C([])}catch(s){const o=(s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"data"in s.response&&s.response.data&&typeof s.response.data=="object"&&"message"in s.response.data&&typeof s.response.data.message=="string"?s.response.data.message:null)||"获取PVC列表失败";c(o),s&&typeof s=="object"&&"response"in s&&s.response&&typeof s.response=="object"&&"status"in s.response&&s.response.status===403&&C([])}finally{j(!1)}},[r]);n.useEffect(()=>{r&&p()},[r,g,p]);const P=s=>s?.toLowerCase().includes("bound")?"success":s?.toLowerCase().includes("pending")?"warning":s?.toLowerCase().includes("failed")||s?.toLowerCase().includes("error")?"error":"default";return e.jsxs(l,{sx:{width:"100%",p:3},children:[e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:2,children:[e.jsxs(l,{children:[e.jsx(m,{variant:"h4",component:"h1",fontWeight:"700",children:t("k8s.pvc.title","PVC 管理")}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:t("k8s.pvc.subtitle","管理持久卷声明（Persistent Volume Claim）")})]}),e.jsx(y,{onClick:p,disabled:!r||h,title:t("common.refresh"),children:e.jsx(z,{})})]}),e.jsx(b,{sx:{mb:3},children:e.jsx(k,{children:e.jsxs(l,{display:"flex",gap:2,alignItems:"flex-end",flexWrap:"wrap",children:[e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(M,{value:r,onChange:w,size:"medium",fullWidth:!0,label:t("k8s.selectCluster")})}),r&&e.jsx(l,{sx:{minWidth:{xs:"100%",sm:"220px"},maxWidth:{xs:"100%",sm:"220px"}},children:e.jsx(O,{value:g,onChange:S,clusterId:r,defaultNamespace:v?.defaultNamespace,size:"medium",fullWidth:!0,label:t("k8s.selectNamespace")})})]})})}),r?h?e.jsx(l,{display:"flex",justifyContent:"center",p:3,children:e.jsx(Y,{})}):e.jsx(b,{children:e.jsx(k,{children:e.jsx(H,{children:e.jsxs($,{children:[e.jsx(q,{children:e.jsxs(u,{children:[e.jsx(a,{children:t("k8s.pvc.name","名称")}),e.jsx(a,{children:t("k8s.pvc.namespace","命名空间")}),e.jsx(a,{children:t("k8s.pvc.status","状态")}),e.jsx(a,{children:t("k8s.pvc.capacity","容量")}),e.jsx(a,{children:t("k8s.pvc.accessModes","访问模式")}),e.jsx(a,{children:t("k8s.pvc.storageClass","存储类")}),e.jsx(a,{children:t("k8s.pvc.volume","卷")}),e.jsx(a,{children:t("k8s.pvc.age","运行时间")}),e.jsx(a,{children:t("common.actions")})]})}),e.jsx(G,{children:f.length===0?e.jsx(u,{children:e.jsx(a,{colSpan:9,align:"center",children:e.jsx(m,{color:"textSecondary",children:t("common.noData")})})}):f.map((s,o)=>e.jsxs(u,{children:[e.jsx(a,{children:s.name}),e.jsx(a,{children:s.namespace}),e.jsx(a,{children:e.jsx(J,{label:s.status,color:P(s.status),size:"small"})}),e.jsx(a,{children:s.capacity}),e.jsx(a,{children:s.accessModes.join(", ")}),e.jsx(a,{children:s.storageClass||"-"}),e.jsx(a,{children:s.volume||"-"}),e.jsx(a,{children:s.age||"N/A"}),e.jsx(a,{children:e.jsxs(l,{display:"flex",gap:.5,children:[e.jsx(B,{size:"small",variant:"outlined",startIcon:e.jsx(D,{}),onClick:()=>{if(!r){c("请先选择集群");return}x(s),d(!0)},disabled:!r,children:t("k8s.viewDetails","详情")}),e.jsx(y,{size:"small",onClick:()=>{x(s),d(!0)},title:t("k8s.viewYaml"),children:e.jsx(E,{fontSize:"small"})})]})})]},o))})]})})})}):e.jsx(L,{severity:"info",children:t("k8s.selectClusterFirst")}),i&&e.jsx(F,{open:T,onClose:()=>{d(!1),x(null)},title:`PVC - ${i.name}`,clusterId:r,namespace:i.namespace,resourceType:"pvc",resourceName:i.name,onLoadYaml:async(s,o,V,N)=>await A({clusterId:s,namespace:o},V,N)})]})}export{ne as default};
