import{u as E,r as i,a8 as p,a9 as H,j as e,B as d,T as n,aa as w,a as b,A as q,b as M,w as S,x as R,d as $,ab as O,P as Q,ac as V,I as _,h as G,i as J,k as K,l as X,m as j,F as T,n as A,o as D,M as g,_ as Y,p as Z,a7 as k}from"./index-z51Q_M-r.js";import{C as m}from"./Chip-BoE43uAD.js";import{T as ee,a as se,b as ae,c as f,d as t,e as le}from"./TableRow-CKQKXB8v.js";import{S as W}from"./Switch-CFen4WHb.js";import{S as te}from"./Stack-07-bXrzl.js";function de(){const{t:a}=E(),[x,y]=i.useState([]),[,C]=i.useState(!1),[I,o]=i.useState(!1),[U,v]=i.useState([]),[l,c]=i.useState({command:"",pattern:"",description:"",scope:"global",users:[],enabled:!0}),B=[{command:"rm",pattern:"rm",description:"删除文件"},{command:"rm -rf",pattern:"rm -rf *",description:"递归强制删除"},{command:"reboot",pattern:"reboot",description:"重启系统"},{command:"shutdown",pattern:"shutdown",description:"关机"},{command:"halt",pattern:"halt",description:"停机"},{command:"init 0",pattern:"init 0",description:"关机"},{command:"init 6",pattern:"init 6",description:"重启"}];i.useEffect(()=>{h(),z()},[]);const h=async()=>{try{C(!0);const s=await p.getRules();y(s.rules||[])}catch(s){console.error("获取黑名单失败:",s),y([])}finally{C(!1)}},z=async()=>{try{const s=await H.getUsers();v(s.users||[])}catch(s){console.error("获取用户列表失败:",s),v([])}},P=async()=>{if(!l.command||!l.pattern){alert(a("blacklist.fillRequired"));return}try{await p.createRule(l),k(a("blacklist.addSuccess")),h(),o(!1),c({command:"",pattern:"",description:"",scope:"global",users:[],enabled:!0})}catch(s){console.error("添加黑名单失败:",s)}},F=async s=>{if(confirm(a("blacklist.deleteConfirm")))try{await p.deleteRule(s),k(a("blacklist.deleteSuccess")),h()}catch(r){console.error("删除失败:",r)}},L=async(s,r)=>{try{await p.updateRule(s,{enabled:r}),k(`${a("blacklist.rule")} ${a(r?"common.enabled":"common.disabled")}`),h()}catch(u){console.error("更新失败:",u)}},N=s=>{c({...l,command:s.command,pattern:s.pattern,description:s.description}),o(!0)};return e.jsxs(d,{children:[e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(n,{variant:"h4",component:"h1",children:[e.jsx(w,{sx:{mr:1,verticalAlign:"middle"}}),a("blacklist.title")]}),e.jsx(b,{variant:"contained",color:"primary",startIcon:e.jsx(q,{}),onClick:()=>o(!0),children:a("blacklist.addRule")})]}),e.jsx(M,{severity:"warning",sx:{mb:3},children:e.jsxs(n,{variant:"body2",children:[a("blacklist.ruleDescription")," ",a("blacklist.scopeDescription")]})}),e.jsx(S,{sx:{mb:3},children:e.jsxs(R,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:a("blacklist.quickAdd")}),e.jsx(d,{display:"flex",flexWrap:"wrap",gap:1,mt:2,children:B.map((s,r)=>e.jsx($,{title:s.description,children:e.jsx(m,{label:s.command,icon:e.jsx(O,{}),onClick:()=>N(s),color:"warning",variant:"outlined",sx:{cursor:"pointer"}})},r))})]})}),e.jsx(S,{children:e.jsxs(R,{children:[e.jsxs(n,{variant:"h6",gutterBottom:!0,children:[a("blacklist.currentRules")," (",x.length,")"]}),e.jsx(ee,{component:Q,sx:{mt:2},children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(f,{children:[e.jsx(t,{children:a("common.status")}),e.jsx(t,{children:a("blacklist.commandName")}),e.jsx(t,{children:a("blacklist.pattern")}),e.jsx(t,{children:a("common.description")}),e.jsx(t,{children:a("blacklist.scope")}),e.jsx(t,{children:a("blacklist.restrictUsers")}),e.jsx(t,{children:a("common.createdAt")}),e.jsx(t,{align:"center",children:a("common.actions")})]})}),e.jsx(le,{children:x.length===0?e.jsx(f,{children:e.jsx(t,{colSpan:8,align:"center",sx:{py:8},children:e.jsx(n,{color:"textSecondary",children:a("blacklist.noRules")})})}):x.map(s=>e.jsxs(f,{hover:!0,children:[e.jsx(t,{children:e.jsx(W,{checked:s.enabled,onChange:r=>L(s.id,r.target.checked),color:"primary",size:"small"})}),e.jsx(t,{children:e.jsx(n,{variant:"body2",fontWeight:"bold",children:s.command})}),e.jsx(t,{children:e.jsx("code",{style:{backgroundColor:"#f5f5f5",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},children:s.pattern})}),e.jsx(t,{children:e.jsx(n,{variant:"body2",color:"textSecondary",children:s.description||"-"})}),e.jsx(t,{children:e.jsx(m,{label:s.scope==="global"?a("blacklist.global"):a("blacklist.specificUsers"),color:s.scope==="global"?"error":"warning",size:"small",icon:s.scope==="global"?e.jsx(w,{}):e.jsx(V,{})})}),e.jsx(t,{children:s.scope==="user"&&s.users&&s.users.length>0?e.jsx(d,{display:"flex",flexWrap:"wrap",gap:.5,children:s.users.map((r,u)=>e.jsx(m,{label:r,size:"small",variant:"outlined"},u))}):e.jsx(n,{variant:"body2",color:"textSecondary",children:"-"})}),e.jsx(t,{children:e.jsx(n,{variant:"body2",color:"textSecondary",children:new Date(s.createdAt).toLocaleString("zh-CN")})}),e.jsx(t,{align:"center",children:e.jsx(_,{color:"error",size:"small",onClick:()=>F(s.id),children:e.jsx(G,{})})})]},s.id))})]})})]})}),e.jsxs(J,{open:I,onClose:()=>o(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(K,{children:a("blacklist.addRuleDialog")}),e.jsx(X,{children:e.jsxs(te,{spacing:2.5,sx:{mt:1},children:[e.jsx(j,{fullWidth:!0,label:a("blacklist.commandName"),value:l.command||"",onChange:s=>c({...l,command:s.target.value}),placeholder:a("blacklist.commandPlaceholder"),helperText:a("blacklist.commandHelp")}),e.jsx(j,{fullWidth:!0,label:a("blacklist.pattern"),value:l.pattern||"",onChange:s=>c({...l,pattern:s.target.value}),placeholder:a("blacklist.patternPlaceholder"),helperText:a("blacklist.patternHelp")}),e.jsx(j,{fullWidth:!0,label:a("common.description"),value:l.description||"",onChange:s=>c({...l,description:s.target.value}),placeholder:a("blacklist.descriptionPlaceholder"),multiline:!0,rows:2}),e.jsxs(T,{fullWidth:!0,children:[e.jsx(A,{children:a("blacklist.scope")}),e.jsxs(D,{value:l.scope||"global",label:a("blacklist.scope"),onChange:s=>c({...l,scope:s.target.value}),children:[e.jsx(g,{value:"global",children:a("blacklist.globalAllUsers")}),e.jsx(g,{value:"user",children:a("blacklist.specificUsers")})]})]}),l.scope==="user"&&e.jsxs(T,{fullWidth:!0,children:[e.jsx(A,{children:a("blacklist.restrictUsers")}),e.jsx(D,{multiple:!0,value:l.users||[],label:a("blacklist.restrictUsers"),onChange:s=>c({...l,users:s.target.value}),renderValue:s=>e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.map(r=>e.jsx(m,{label:r,size:"small"},r))}),children:U.map(s=>e.jsxs(g,{value:s.username,children:[s.username," - ",s.realname||s.email]},s.id))})]}),e.jsx(Y,{control:e.jsx(W,{checked:l.enabled??!0,onChange:s=>c({...l,enabled:s.target.checked})}),label:a("blacklist.enableRule")})]})}),e.jsxs(Z,{children:[e.jsx(b,{onClick:()=>o(!1),children:a("common.cancel")}),e.jsx(b,{onClick:P,variant:"contained",color:"primary",children:a("common.add")})]})]})]})}export{de as default};
