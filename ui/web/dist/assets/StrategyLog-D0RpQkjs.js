import{u as L,cL as A,r as o,j as e,B as d,w as D,x as E,T as h,a as N,v as z,m as k,P as B}from"./index-Cih9_E47.js";import{a as R}from"./alertApi-31gYUd4n.js";import{T as $,a as F,b as M,c as x,d as r,e as H}from"./TableRow-Bl_73t-R.js";import{C as w}from"./Chip-D6-9bdkU.js";import{P as K}from"./Pagination-B3Cgsyn8.js";import"./LastPage-BDzvmy5H.js";function Q(){const{t:s}=L(),[m,j]=A(),[p,g]=o.useState([]),[f,b]=o.useState(!1),[c,S]=o.useState(1),[y]=o.useState(10),[T,u]=o.useState(0),[a,_]=o.useState(m.get("alert_id")||"");o.useEffect(()=>{const t=m.get("alert_id");t&&t!==a&&_(t)},[m,a]);const C=o.useCallback(async()=>{try{b(!0);const t={page:c,page_size:y};if(a){const l=parseInt(a);!isNaN(l)&&l>0&&(t.alert_id=l)}const n=await R.getStrategyLogs(t);console.log("[通知日志] 查询响应:",n.data);const i=n.data;if(i.code===0||i.code===200){const l=i.data||[],v=i.total||0;console.log(`[通知日志] 查询成功: 找到 ${l.length} 条记录，总计 ${v} 条`),g(l),u(v)}else console.error("[通知日志] 查询失败:",i.message||"Unknown error"),g([]),u(0)}catch(t){const n=t;console.error("[通知日志] 请求失败:",t),console.error("[通知日志] 错误详情:",n?.response?.data),g([]),u(0)}finally{b(!1)}},[c,y,a]);o.useEffect(()=>{console.log(`[通知日志] 触发查询: alertId=${a||"全部"}, page=${c}`),C()},[a,c]);const I=()=>{j(a?{alert_id:a}:{}),S(1)},P=t=>{switch(t){case 1:return s("Alert")||"告警";case 2:return s("Recovery")||"恢复";default:return"-"}};return e.jsx(d,{sx:{p:3},children:e.jsx(D,{children:e.jsxs(E,{children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(h,{variant:"h5",gutterBottom:!0,children:s("menu.monitorStrategyLog")||"通知日志查询"}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(z,{}),onClick:C,disabled:f,children:s("common.refresh")})]}),e.jsxs(d,{sx:{mb:2,display:"flex",gap:2,alignItems:"center"},children:[e.jsx(k,{label:s("Alert ID"),value:a,onChange:t=>_(t.target.value),type:"number",size:"small",sx:{width:200},helperText:s("Enter alert ID to filter strategy logs (optional)")||"输入告警ID过滤通知日志（可选）",onKeyPress:t=>{t.key==="Enter"&&I()}}),e.jsx(N,{variant:"contained",onClick:I,children:s("common.search")})]}),e.jsx($,{component:B,children:e.jsxs(F,{children:[e.jsx(M,{children:e.jsxs(x,{children:[e.jsx(r,{children:s("Alert ID")}),e.jsx(r,{children:s("Strategy Name")||"策略名称"}),e.jsx(r,{children:s("Notification Type")||s("Notify Type")||"通知类型"}),e.jsx(r,{children:s("Is Notify")}),e.jsx(r,{children:s("Error Message")}),e.jsx(r,{children:s("Created At")})]})}),e.jsx(H,{children:f?e.jsx(x,{children:e.jsx(r,{colSpan:6,align:"center",children:s("common.loading")})}):p.length===0?e.jsx(x,{children:e.jsx(r,{colSpan:6,align:"center",children:s("common.noData")})}):p.map(t=>e.jsxs(x,{children:[e.jsx(r,{children:t.alert_id}),e.jsx(r,{children:t.strategy_name?e.jsx(h,{variant:"body2",children:t.strategy_name}):e.jsxs(h,{variant:"body2",color:"text.secondary",children:[s("Strategy ID"),": ",t.strategy_id]})}),e.jsx(r,{children:e.jsx(w,{label:P(t.notify_type),color:t.notify_type===1?"error":"success",size:"small"})}),e.jsx(r,{children:e.jsx(w,{label:t.is_notify?s("Success")||"成功":s("Failed")||"失败",color:t.is_notify?"success":"error",size:"small"})}),e.jsx(r,{children:e.jsx(h,{variant:"body2",color:t.err_message?"error":"text.secondary",sx:{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis"},children:t.err_message||"-"})}),e.jsx(r,{children:(()=>{const n=t.createdAt||t.created_at;if(!n)return"-";try{const i=new Date(n);return isNaN(i.getTime())?"-":i.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"-"}})()})]},t.id))})]})}),T>0&&e.jsx(d,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(K,{count:Math.ceil(T/y),page:c,onChange:(t,n)=>S(n),color:"primary"})})]})})})}export{Q as default};
