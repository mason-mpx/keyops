import{u as L,r as t,ad as B,j as e,B as c,C as E,T as r,I as y,v as F,w as I,x as w,m as D,s as v,t as H}from"./index-CJIrazW8.js";import{T as N,a as K,b as _,c as S,d as a,e as $}from"./TableRow-JrGpygSA.js";import{C as T}from"./Chip-Bh8gAKTq.js";import{T as q}from"./TablePagination-BC9Ek9KZ.js";import"./LastPage-CClrOV-o.js";function U(){const{t:o}=L(),[P,d]=t.useState(!0),[R,f]=t.useState([]),[l,g]=t.useState(""),[m,C]=t.useState(""),[x,i]=t.useState(0),[h,W]=t.useState(10),[u,b]=t.useState(0),p=t.useCallback(async()=>{d(!0);try{const s=await B.getCommandRecords({page:x+1,pageSize:h,search:l}),j=s.commands.map(n=>({id:n.id,sessionId:n.sessionId||"",hostName:n.hostIp||"",hostIp:n.hostIp||"",username:n.username||"",command:n.command||"",executedAt:new Date(n.executedAt).toLocaleString("zh-CN"),status:n.status||"success"}));f(j),b(s.total),d(!1)}catch(s){console.error("Failed to load commands:",s),f([]),b(0),d(!1)}},[x,h,l]);t.useEffect(()=>{p()},[p]);const k=s=>{s.key==="Enter"&&(g(m),i(0))},A=()=>{C(""),g(""),i(0)},z=R.filter(s=>s.command.toLowerCase().includes(l.toLowerCase())||s.hostIp.toLowerCase().includes(l.toLowerCase()));return P?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(E,{})}):e.jsxs(c,{children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(r,{variant:"h4",component:"h1",children:o("commands.title")}),e.jsx(y,{onClick:p,color:"primary",children:e.jsx(F,{})})]}),e.jsx(I,{elevation:0,sx:{mb:3,border:"1px solid #e2e8f0"},children:e.jsx(w,{children:e.jsx(D,{placeholder:o("common.search")+"...",value:m,onChange:s=>C(s.target.value),onKeyDown:k,size:"small",fullWidth:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(H,{})}),endAdornment:m&&e.jsx(v,{position:"end",children:e.jsx(y,{size:"small",onClick:A,children:"âœ•"})})}})})}),e.jsx(I,{elevation:0,sx:{border:"1px solid #e2e8f0"},children:e.jsxs(w,{sx:{p:0},children:[e.jsxs(c,{sx:{px:3,py:2.5,borderBottom:"1px solid #e2e8f0"},children:[e.jsx(r,{variant:"h6",fontWeight:"600",color:"text.primary",children:o("commands.executedRecords")}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:o("commands.totalRecords",{count:u})})]}),e.jsx(N,{children:e.jsxs(K,{children:[e.jsx(_,{children:e.jsxs(S,{children:[e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("commands.executedAt")}),e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.host")}),e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.user")}),e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("commands.command")}),e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("common.status")}),e.jsx(a,{sx:{fontWeight:700,color:"#667eea"},children:o("sessions.sessionId")})]})}),e.jsx($,{children:z.map(s=>e.jsxs(S,{hover:!0,sx:{transition:"all 0.2s ease","&:hover":{backgroundColor:"rgba(102, 126, 234, 0.05)"}},children:[e.jsx(a,{children:e.jsx(r,{variant:"body2",color:"text.secondary",children:s.executedAt})}),e.jsx(a,{children:e.jsx(r,{variant:"body2",fontWeight:500,children:s.hostIp})}),e.jsx(a,{children:e.jsx(T,{label:s.username,size:"small",sx:{backgroundColor:"rgba(102, 126, 234, 0.1)",color:"#667eea"}})}),e.jsx(a,{children:e.jsx(c,{sx:{fontFamily:"monospace",fontSize:"0.85rem",backgroundColor:"#f7fafc",padding:"6px 10px",borderRadius:1,maxWidth:"400px",overflow:"auto",whiteSpace:"nowrap"},children:s.command})}),e.jsx(a,{children:e.jsx(T,{label:o("common.success"),size:"small",sx:{backgroundColor:"#f0fff4",color:"#38a169"}})}),e.jsx(a,{children:e.jsx(r,{variant:"caption",fontFamily:"monospace",children:s.sessionId})})]},s.id))})]})}),u>0&&e.jsx(q,{component:"div",count:u,page:x,onPageChange:(s,j)=>i(j),rowsPerPage:h,onRowsPerPageChange:s=>{W(parseInt(s.target.value,10)),i(0)},labelRowsPerPage:`${o("common.rowsPerPage")}:`})]})})]})}export{U as default};
